
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>1.8. For developpers &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.8. For developpers</a><ul>
<li><a class="reference internal" href="#use-your-own-version">1.8.1. Use your own version</a></li>
<li><a class="reference internal" href="#coding-rules">1.8.2. Coding rules</a></li>
<li><a class="reference internal" href="#architecture">1.8.3. Architecture</a></li>
<li><a class="reference internal" href="#generation-of-the-sphinx-documentation">1.8.4. Generation of the sphinx documentation</a><ul>
<li><a class="reference internal" href="#generation-of-the-figures-of-the-scripts">1.8.4.1. Generation of the figures of the scripts</a></li>
<li><a class="reference internal" href="#force-the-regeneration-of-the-figures-of-the-colormaps">1.8.4.2. Force the regeneration of the figures of the colormaps</a></li>
<li><a class="reference internal" href="#generate-missing-test-files">1.8.4.3. Generate missing test files</a></li>
<li><a class="reference internal" href="#compilation">1.8.4.4. Compilation</a></li>
<li><a class="reference internal" href="#regeneration-of-tikz-figures">1.8.4.5. Regeneration of TikZ figures</a></li>
<li><a class="reference internal" href="#automate-it-in-a-crontab">1.8.4.6. Automate it in a crontab</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-add-a-new-tutorial">1.8.5. How to add a new tutorial</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-test">1.8.6. How to add a new test</a></li>
<li><a class="reference internal" href="#tagging-of-versions">1.8.7. Tagging of versions</a></li>
<li><a class="reference internal" href="#working-with-branches">1.8.8. Working with branches</a></li>
<li><a class="reference internal" href="#distributing-the-library-as-a-package">1.8.9. Distributing the library as a package</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/user.dev.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="for-developpers">
<span id="user-dev"></span><h1>1.8. For developpers<a class="headerlink" href="#for-developpers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="use-your-own-version">
<h2>1.8.1. Use your own version<a class="headerlink" href="#use-your-own-version" title="Permalink to this headline">¶</a></h2>
<p>To use the library without installing it, see doc sections <span class="xref std std-ref">user.install.install</span> and
<a class="reference internal" href="user.install.modenv.html#user-install-modenv"><span class="std std-ref">Using environment modules</span></a>.</p>
</div>
<div class="section" id="coding-rules">
<h2>1.8.2. Coding rules<a class="headerlink" href="#coding-rules" title="Permalink to this headline">¶</a></h2>
<p>Please follow the <a class="reference internal" href="appendix.conventions.html#appendix-conventions"><span class="std std-ref">Coding rules</span></a>.</p>
</div>
<div class="section" id="architecture">
<h2>1.8.3. Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>The architecture of the library must follow the spirit
of what is explained at section <a class="reference internal" href="user.desc.fond.html#user-desc-basis-arch"><span class="std std-ref">General architecture</span></a>.
For instance, generic stuff must go in the <a class="reference internal" href="library/misc.html#module-vacumm.misc" title="vacumm.misc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vacumm.misc</span></code></a>
module.
When a new module is specialized, it should find a place elsewhere.</p>
</div>
<div class="section" id="generation-of-the-sphinx-documentation">
<span id="user-dev-doc"></span><h2>1.8.4. Generation of the sphinx documentation<a class="headerlink" href="#generation-of-the-sphinx-documentation" title="Permalink to this headline">¶</a></h2>
<p>Quickly: see <a class="reference internal" href="#user-dev-doc-comp"><span class="std std-ref">Compilation</span></a>.</p>
<div class="section" id="generation-of-the-figures-of-the-scripts">
<h3>1.8.4.1. Generation of the figures of the scripts<a class="headerlink" href="#generation-of-the-figures-of-the-scripts" title="Permalink to this headline">¶</a></h3>
<p>Some of the scripts located in the <code class="file docutils literal notranslate"><span class="pre">scripts</span></code> directory
create figure that are included in the documentation.
You must run them before compiling the documentation to make
sure that all needed figures are available.
For that, just run a <strong class="program">make</strong> in the <code class="file docutils literal notranslate"><span class="pre">scripts</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> scripts
$ make
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is not necessary to re-generate these figures each time you compile!</p>
</div>
</div>
<div class="section" id="force-the-regeneration-of-the-figures-of-the-colormaps">
<h3>1.8.4.2. Force the regeneration of the figures of the colormaps<a class="headerlink" href="#force-the-regeneration-of-the-figures-of-the-colormaps" title="Permalink to this headline">¶</a></h3>
<p>Some samples of colormap of the <a class="reference internal" href="library/misc.color.html#module-vacumm.misc.color" title="vacumm.misc.color"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vacumm.misc.color</span></code></a> module are displayed
in the documentation. They are usually generated automatically at compile time
by an integrated sphinx extension (the file <code class="file docutils literal notranslate"><span class="pre">doc/pshinx/source/sphinxext/gen_cmaps</span></code>)
each time the module is modified or when no figure is present.</p>
<p>You can force the regeneration of theses figure for the next compilation with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ touch lib/python/vacumm/misc/color.py
</pre></div>
</div>
</div>
<div class="section" id="generate-missing-test-files">
<h3>1.8.4.3. Generate missing test files<a class="headerlink" href="#generate-missing-test-files" title="Permalink to this headline">¶</a></h3>
<p>The test scripts (<code class="file docutils literal notranslate"><span class="pre">scripts/test/test_*.py</span></code>) are presented in the appendix
(<a class="reference internal" href="tests/index.html#appendix-tests"><span class="std std-ref">Test scripts</span></a>)
thanks to corresponding rst files situated in directory <code class="file docutils literal notranslate"><span class="pre">doc/pshinx/source/tests</span></code>.
You can update these rst files with the <strong class="program">make.py</strong> present in this directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> doc/pshinx/source/tests
$ make.py <span class="c1"># -h for help</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The title of each of these rst files is copied from the first line of the test script.</p>
</div>
<p>If new files are created, add them to subversion:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ svn add test_newtest.py
</pre></div>
</div>
<p>Then make a commit:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ svn ci -m <span class="s1">&#39;adding new test rst files&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="compilation">
<span id="user-dev-doc-comp"></span><h3>1.8.4.4. Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline">¶</a></h3>
<p>The documentation is written in <a class="reference external" href="http://docutils.sourceforge.net/rst.html">rst</a> language,
and compilated with <a class="reference external" href="http://sphinx.pocoo.org">Sphinx</a> .
Source files are located in the  <code class="file docutils literal notranslate"><span class="pre">doc/sphinx/source</span></code> directory.
To compile it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> doc/sphinx
$ make      <span class="c1"># html + pdf</span>
$ make html <span class="c1"># html only</span>
$ make pdf  <span class="c1"># pdf only using pdflatex</span>
</pre></div>
</div>
<p>The documentation is generated in directories
<code class="file docutils literal notranslate"><span class="pre">doc/sphinx/build/html</span></code> and <code class="file docutils literal notranslate"><span class="pre">doc/sphinx/build/latex</span></code>.</p>
</div>
<div class="section" id="regeneration-of-tikz-figures">
<h3>1.8.4.5. Regeneration of TikZ figures<a class="headerlink" href="#regeneration-of-tikz-figures" title="Permalink to this headline">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">What is PGF/TikZ ?</p>
<p class="last">This is a library for creating high quality figures from an TeX source code.
The best overview is provided by the site that lists examples (tutorials):
<a class="reference external" href="http://www.texample.net/tikz/examples">http://www.texample.net/tikz/examples</a> .
Most of them are based on a more recent than the one installed by default on a system release.
Its on CVS <em>build</em> that the figures in this documentation are based.</p>
</div>
<p>This documentation contains several figures drawn with
<strong class="program">pdflatex</strong> and
<a class="reference external" href="http://pgf.sourceforge.net">PGF/TikZ</a> (logo, architecture
of the librairie).
The advantage is being able to put figure sources on the svn server,
so that everyone can re-generate them.</p>
<p>It is necessary to have a recent version of PGF/TikZ,
you can for example get here: <a class="reference external" href="http://www.texample.net/tikz/builds/">http://www.texample.net/tikz/builds/</a>
(here is <a class="reference external" href="http://media.texample.net/pgf/builds/pgfCVS2010-09-28_TDS.zip">a version</a>).
For installation, proceed as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mkdir -p ~/texmf
$ <span class="nb">cd</span> ~/texmf
$ wget http://media.texample.net/pgf/builds/pgfCVS2010-09-28_TDS.zip
$ unzip pgfCVS2010-09-28_TDS.zip
$ rm pgfCVS2010-09-28_TDS.zip
</pre></div>
</div>
<p>Figure TikZ can now be generated with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> doc/sphinx/sources
$ make
</pre></div>
</div>
<p>The latex code is then compiled, generating a pdf which is then converted
to ppm format and png formats.</p>
</div>
<div class="section" id="automate-it-in-a-crontab">
<span id="user-dev-doc-auto"></span><h3>1.8.4.6. Automate it in a crontab<a class="headerlink" href="#automate-it-in-a-crontab" title="Permalink to this headline">¶</a></h3>
<p>You can execute a script with at least the following commands,
and register it in a crontab:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Go to the root directory of sources</span>
<span class="nb">cd</span> <span class="o">{</span>/path/to/<span class="o">}</span>vacumm/trunk

<span class="c1"># Update the tree</span>
svn up

<span class="c1"># Make sure the fortran extensions are compilated</span>
make lib

<span class="c1"># Generate figures of test files</span>
<span class="nb">cd</span> <span class="nb">test</span>
make
<span class="nb">cd</span> ..

<span class="c1"># Generate figures of tutorials</span>
<span class="nb">cd</span> scripts/tutorials
make
<span class="nb">cd</span> ../..

<span class="c1"># Force the future generation of all colormap figures</span>
touch lib/python/vacumm/misc/color.py

<span class="c1"># Generate sphinx docs</span>
<span class="nb">cd</span> doc/sphinx
make
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-add-a-new-tutorial">
<span id="user-dev-tut"></span><h2>1.8.5. How to add a new tutorial<a class="headerlink" href="#how-to-add-a-new-tutorial" title="Permalink to this headline">¶</a></h2>
<p>It is strongly suggested to developers to create tutorials on important features they develop.
These tutorials have two interests:</p>
<blockquote>
<div><ul class="simple">
<li>They complete the documentation: it is an example and it may add an entry
to the gallery.</li>
<li>They can be used to perform tests,
thanks to the <strong class="program">check.py</strong> script.</li>
</ul>
</div></blockquote>
<p>To add a new tutorial script:</p>
<ol class="arabic">
<li><p class="first">Create your script in the <code class="file docutils literal notranslate"><span class="pre">scripts/tutorials</span></code>.</p>
<ul>
<li><p class="first">Its name is typically compound of subnames separated with dots.</p>
</li>
<li><p class="first">If you create a figure, please use the <a class="reference internal" href="library/misc.plot.html#vacumm.misc.plot.savefigs" title="vacumm.misc.plot.savefigs"><code class="xref py py-func docutils literal notranslate"><span class="pre">vacumm.misc.plot.savefigs()</span></code></a>
function to save your figure, with the <code class="docutils literal notranslate"><span class="pre">file__</span></code> variable as first argument:
this function convert dots to “-” (better with Latex) and allow to save
also in pdf format, which good with 1D plots or pure contours:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>savefigs<span class="o">(</span>__file__, <span class="nv">pdf</span><span class="o">=</span>True<span class="o">)</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Add a reference into the documentation.
For that, create a new rst file in the <code class="file docutils literal notranslate"><span class="pre">doc/sphinx/source/tutorials</span></code>
directory which the same root name as the script:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="nt">_user.tut.my.tut:</span>

     My test script
     ==============

     Explain what it does.

<span class="p">     ..</span> <span class="nt">_fig.tut.my.tut:</span>
<span class="p">     ..</span> <span class="ow">figure</span><span class="p">::</span> ../../../../scripts/tutorials/my.tut.png

         Legend of the figure.


<span class="p">     ..</span> <span class="ow">literalinclude</span><span class="p">::</span> ../../../../scripts/tutorials/my.tut.py
</pre></div>
</div>
<p>Insert a reference to this file into the doc tree.
Then commit the new and modified files.</p>
</li>
</ol>
<p>The <strong class="program">check.py</strong> script is located in the tutorials directory
(<code class="file docutils literal notranslate"><span class="pre">scripts/tutorials</span></code>).
Its use is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ check.py <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>pattern1 <span class="o">[</span>pattern2<span class="o">]</span> ...<span class="o">]</span>
</pre></div>
</div>
<p>It takes as argument one (or more) global patterns to list the test scripts.
The default is <code class="docutils literal notranslate"><span class="pre">&quot;*.py&quot;</span></code>.
It is then possible to exclude scripts that list with the <a class="reference internal" href="user.scripts.vacumm_edit_config.html#cmdoption-e"><code class="xref std std-option docutils literal notranslate"><span class="pre">-e</span></code></a> option.</p>
<p>This script displays to the console information about the tests,
and store all information in the <code class="file docutils literal notranslate"><span class="pre">check.log</span></code> file.
The logging level at the console can be modified with the <code class="xref std std-option docutils literal notranslate"><span class="pre">-l</span></code> option.</p>
<p>Examples of use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ check.py -e <span class="s2">&quot;misc.color.py&quot;</span> -e misc.grid.masking.* <span class="s2">&quot;misc.*.py&quot;</span>
$ check.py --loglevel<span class="o">=</span>debug
</pre></div>
</div>
<p class="rubric">Options de <strong class="program">check.py</strong></p>
<dl class="option">
<dt id="cmdoption-check-py-h">
<code class="descname">-h</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--help</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-check-py-h" title="Permalink to this definition">¶</a></dt>
<dd><p>Affiche l’aide.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-check-py-e">
<code class="descname">-e</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--exclude</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-check-py-e" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a global pattern listing scripts to exclude tests.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-check-py-l">
<code class="descname">-l</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--loglevel</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-check-py-l" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the level of logging to the console.
This can have the following values:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&quot;debug&quot;</span></code>:  Displays standard output and standard error.</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;info&quot;</span></code>: Displays the name of the successful scripts (default).</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;error&quot;</span></code>: Displays the name of the scripts that failed.</li>
</ul>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="how-to-add-a-new-test">
<span id="user-dev-test"></span><h2>1.8.6. How to add a new test<a class="headerlink" href="#how-to-add-a-new-test" title="Permalink to this headline">¶</a></h2>
<p>The goal of tests is to test a small part of the library:
we are speaking of the so-called “unit tests”.
Theses tests can also be viewed as good examples of coding.
A test script can be executed directly or withing the
testing framework of the library, which is located in the <code class="file docutils literal notranslate"><span class="pre">test</span></code> directory.
This directory contains several modules whose name is starting with <code class="docutils literal notranslate"><span class="pre">test_</span></code>:
they declare <a class="reference external" href="https://docs.python.org/dev/library/unittest.html#unittest.TestCase" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a> classes where one classes embeds several
tests as methods starting also with <code class="docutils literal notranslate"><span class="pre">test_</span></code> (automatically generated).
Each of these methods execute one of the test script, and then check for the
existence of the <code class="docutils literal notranslate"><span class="pre">result</span></code> variable to perform more tests on this script.</p>
<p>To add a new one:</p>
<ol class="arabic">
<li><p class="first">Create such script in the <code class="file docutils literal notranslate"><span class="pre">scripts/test</span></code> directory,
with the following rules:</p>
<ul>
<li><p class="first">Makes sure the name of your script is not too generic of specific.
Try for instance to group some these scripts under the same root name.
If you test a function of method of a well known module or class,
use it as a root name. for instance, if test the
<a class="reference internal" href="library/misc.phys.units.html#vacumm.misc.phys.units.deg2m" title="vacumm.misc.phys.units.deg2m"><code class="xref py py-func docutils literal notranslate"><span class="pre">vacumm.misc.phys.units.deg2m()</span></code></a> function, create a script called
<code class="file docutils literal notranslate"><span class="pre">test_units_deg2m.py</span></code>.</p>
</li>
<li><p class="first">Insert a docstring of a single line telling what the script tests.
See examples here: <a class="reference internal" href="tests/index.html#appendix-tests"><span class="std std-ref">Test scripts</span></a>.</p>
</li>
<li><p class="first">Make explicit imports (without *):</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>from vcmq import DS
</pre></div>
</div>
</li>
<li><p class="first">If you create one or several figures, use the following syntax
to name your file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">vcmq</span> <span class="kn">import</span> <span class="n">code_file_name</span>

<span class="c1"># single file</span>
<span class="n">figfile</span> <span class="o">=</span> <span class="n">code_base_name</span><span class="p">()</span>

<span class="c1"># multiple files</span>
<span class="n">figfile1</span> <span class="o">=</span> <span class="n">code_file_name</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s1">&#39;_1.png&#39;</span><span class="p">)</span>
<span class="n">figfile2</span> <span class="o">=</span> <span class="n">code_file_name</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s1">&#39;_2.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>All your figure files will be created in the same directory as
the script, either executed directly or from the <a class="reference external" href="https://docs.python.org/dev/library/unittest.html#module-unittest" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> framework.</p>
</li>
<li><p class="first">At the end of the script, you can set the <code class="docutils literal notranslate"><span class="pre">result</span></code> variable.
This variable will be latter used by the testing framework to
perform more checks.
It must be a list of tuples, and the first element of each is
of one of the follwing types:</p>
<ul class="simple">
<li>The string <code class="docutils literal notranslate"><span class="pre">&quot;files&quot;</span></code>: the second element of the tuple must
then be a single or a list of file names.
The testing framework will check for the existence of these files.
Be caferul to remove them before trying to create them in the script!</li>
<li>A string starting with <code class="docutils literal notranslate"><span class="pre">&quot;assert&quot;</span></code>: It is assumed to be the name of
a method of the class <a class="reference external" href="https://docs.python.org/dev/library/unittest.html#unittest.TestCase" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a>.
The second element of the tuple is converted as a list and passed as arguments
to the method.</li>
<li>A callable object: The second element is passed to this object.</li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span>
   <span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="s1">&#39;myfile.nc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;myfile1.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;myfile2.cfg&#39;</span><span class="p">]),</span>
   <span class="p">(</span><span class="s1">&#39;assertEqual&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;assertTrue&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span><span class="n">var2</span><span class="p">)),</span>
   <span class="p">(</span><span class="n">mytestfunc</span><span class="p">,</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">))]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">The script must now be integrated to the <a class="reference external" href="https://docs.python.org/dev/library/unittest.html#module-unittest" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> framework.
Create a test module in the <code class="file docutils literal notranslate"><span class="pre">test</span></code> directory, if it does not exist,
with the following rules:</p>
<ul>
<li><p class="first">Its name follows the same naming rules has for the test script:
it is the root part of the names of the test scripts it will test.
Using the example above, it must be named <code class="file docutils literal notranslate"><span class="pre">test_units.py</span></code>,
and contain all the test of the <a class="reference internal" href="library/misc.phys.units.html#module-vacumm.misc.phys.units" title="vacumm.misc.phys.units"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vacumm.misc.phys.units</span></code></a> module.</p>
</li>
<li><p class="first">Its contents must be close to the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">TSF</span><span class="p">(</span><span class="n">VCTestCase</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">test_name</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s1">&#39;test_units_deg2m&#39;</span><span class="p">,</span>
        <span class="s1">&#39;test_units_m2deg&#39;</span><span class="p">,</span>
        <span class="p">]:</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">method_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_name</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The header of the <code class="xref py py-class docutils literal notranslate"><span class="pre">TSF</span></code>
(or <code class="xref py py-class docutils literal notranslate"><span class="pre">TestSequenceFunctions</span></code>) class contains a loop
on all the test scripts names (without suffix) that will be tested.
If the module already exists, just add your new test script to this loop.</p>
</li>
</ul>
</li>
<li><p class="first">If the test module does not exist, add an entry the <code class="docutils literal notranslate"><span class="pre">TEST</span></code> variable
of the <code class="file docutils literal notranslate"><span class="pre">test/Makefile</span></code> file.</p>
</li>
<li><p class="first">Update the documentation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> doc/sphinx/source/tests
$ make.py
</pre></div>
</div>
<p>Run the <strong class="program">svn</strong> commands that are displayed on the output of the
<strong class="program">make.py</strong> script.
If the test module was not existing, insert a reference to it in the <code class="file docutils literal notranslate"><span class="pre">index.rst</span></code>.
For example:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="gh">Units</span>
<span class="gh">-----</span>

Testing module <span class="na">:mod:</span><span class="nv">`~vacumm.misc.phys.units`</span>.

<span class="p">..</span> <span class="ow">toctree</span><span class="p">::</span>
    <span class="nc">:glob:</span>

    test_units_*
</pre></div>
</div>
<p>Then commit this file too.</p>
</li>
</ol>
</div>
<div class="section" id="tagging-of-versions">
<h2>1.8.7. Tagging of versions<a class="headerlink" href="#tagging-of-versions" title="Permalink to this headline">¶</a></h2>
<p>See also: <a class="reference external" href="http://en.wikipedia.org/wiki/Software_versioning">http://en.wikipedia.org/wiki/Software_versioning</a></p>
<p>The version number must be defined in a unique location.</p>
<p>Vacumm set the version number into its python root package, <code class="xref py py-attr docutils literal notranslate"><span class="pre">vacumm.__version__</span></code> module attribute (<code class="file docutils literal notranslate"><span class="pre">vacumm/__init__.py</span></code>)</p>
<dl class="docutils">
<dt>This __version__ string must use the following conventions:</dt>
<dd><ul class="first last simple">
<li>at least three numerical parts, separated with dots (‘.’): <code class="docutils literal notranslate"><span class="pre">__version__</span> <span class="pre">=</span> <span class="pre">'X.Y.Z'</span></code></li>
<li><dl class="first docutils">
<dt>these three numerical parts have the following meaning:</dt>
<dd><ul class="first last">
<li>X is the major version number, incremented when there is a significant change of the software (when reaching a certain maturity or when reorganization or when there are API breakage).</li>
<li>Y is the minor version number, incremented when new features have been added to the software.</li>
<li>Z is the revision number, incremented when there are some fixes to the corresponding X.Y version</li>
</ul>
</dd>
</dl>
</li>
<li>an extra part can be present to indicate a release status: <code class="docutils literal notranslate"><span class="pre">__version__</span> <span class="pre">=</span> <span class="pre">'1.0.0.alpha'</span></code> (or <code class="docutils literal notranslate"><span class="pre">'1.0.0.beta'</span></code>, <code class="docutils literal notranslate"><span class="pre">'1.0.0.rc1'</span></code>, …)</li>
</ul>
</dd>
<dt>When a version is ready to be tagged, proceed with the following steps:</dt>
<dd><ul class="first last">
<li><p class="first">check or set <code class="xref py py-attr docutils literal notranslate"><span class="pre">vacumm.__version__</span></code>,</p>
</li>
<li><p class="first">make a svn copy (which in fact only put a reference to a revision number):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ svn copy https://gforge.ifremer.fr/svn/vacumm/trunk <span class="se">\</span>
    https://gforge.ifremer.fr/svn/vacumm/tags/vacumm-X.Y.Z
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
<p>Using a tag named with <code class="docutils literal notranslate"><span class="pre">'vacumm'</span></code> and the version string <code class="docutils literal notranslate"><span class="pre">'X.Y.Z'</span></code> together is a preferred way since a checkout will then result in an explicit <code class="file docutils literal notranslate"><span class="pre">vacumm-X.Y.Z</span></code> directory (instead of a lonely <code class="file docutils literal notranslate"><span class="pre">X.Y.Z</span></code>).</p>
<p>After a tag have been created, you can then change <code class="xref py py-attr docutils literal notranslate"><span class="pre">vacumm.__version__</span></code> from, for example <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code> to <code class="docutils literal notranslate"><span class="pre">1.1.0.alpha</span></code> to mark a difference for the people who uses the trunk.
However these users must be aware of what they’re doing and then know if the <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code> version they’re using is the trunk or the real <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code> version.
The most important thing to do is to correctly setup the version number before creating a new tag.
The rules for changing setting the version number are typically the following:</p>
<blockquote>
<div><ul class="simple">
<li>If the changes are mainly bug fixes, change the last digit: <code class="docutils literal notranslate"><span class="pre">1.0.X</span></code>.</li>
<li>If the changes are new features of medium importance or
changes that does not affect compatibility, change the second digit: <code class="docutils literal notranslate"><span class="pre">1.X.0</span></code>.</li>
<li>If a major feature has been added or if changes add important incompatibilities,
changes the first digit: <code class="docutils literal notranslate"><span class="pre">X.0.0</span></code>.</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>If you created the tag too quickly and need to correct something, then</dt>
<dd><ul class="first last">
<li><p class="first">fix it</p>
</li>
<li><p class="first">remove the created faulty tag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ svn rm https://gforge.ifremer.fr/svn/vacumm/tags/vacumm-X.Y.Z
</pre></div>
</div>
</li>
<li><p class="first">re-create the expected tag (<code class="docutils literal notranslate"><span class="pre">svn</span> <span class="pre">copy</span></code>, see above).</p>
</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="working-with-branches">
<span id="user-dev-branch"></span><h2>1.8.8. Working with branches<a class="headerlink" href="#working-with-branches" title="Permalink to this headline">¶</a></h2>
<p>If you plan to make some sensitive changes that may require time
to develop and test, you should consider making a branch for your developments.
Proceed as follow.</p>
<p>Create the branch <code class="docutils literal notranslate"><span class="pre">mybranch</span></code> from the trunk:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ svn copy -m <span class="s2">&quot;create new branch mybranch&quot;</span> <span class="se">\</span>
    https://gforge.ifremer.fr/svn/vacumm/trunk <span class="se">\</span>
    https://gforge.ifremer.fr/svn/vacumm/branches/mybranch
</pre></div>
</div>
<p>Get it on your local copy of the tree:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">{</span>/path/to/<span class="o">}</span>branches
$ svn up mybranch
</pre></div>
</div>
<p>Update it in case the trunk has changed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">{</span>/path/to/<span class="o">}</span>branches/mybranch
$ svn merge ^/trunk
</pre></div>
</div>
<p>Commit intermediate changes to your branch:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">{</span>/path/to/<span class="o">}</span>branches/mybranch
$ svn ci -m comment ...
</pre></div>
</div>
<p>Now that you have finished, merge it back with trunk:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="o">{</span>/path/to/<span class="o">}</span>trunk
$ svn --reintegrate https://gforge.ifremer.fr/svn/vacumm/branches/mybranch
$ svn -m <span class="s2">&quot;merge with branch mybranch&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="distributing-the-library-as-a-package">
<h2>1.8.9. Distributing the library as a package<a class="headerlink" href="#distributing-the-library-as-a-package" title="Permalink to this headline">¶</a></h2>
<p>It is possible to create packages typically corresponding to specific versions (for example stability).
The procedure is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py sdist
</pre></div>
</div>
<p>This command will then create a distributable file, whose name is close to
<code class="file docutils literal notranslate"><span class="pre">vacumm-0.9-svn128.tar.gz</span></code>.
This file can then be placed in the files section of the gforge site of the project
(<a class="reference external" href="https://forge.ifremer.fr/frs/admin/qrs.php?package=&amp;group_id=93">at this address</a>).</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>