
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>1.5.4. Using the generic data classes &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.5.4. Using the generic data classes</a><ul>
<li><a class="reference internal" href="#goal">1.5.4.1. Goal</a></li>
<li><a class="reference internal" href="#usage">1.5.4.2. Usage</a></li>
<li><a class="reference internal" href="#sample-of-the-capabilities">1.5.4.3. Sample of the capabilities</a><ul>
<li><a class="reference internal" href="#reading-multiple-files">1.5.4.3.1. Reading multiple files</a></li>
<li><a class="reference internal" href="#searching-for-variables-and-axes">1.5.4.3.2. Searching for variables and axes</a></li>
<li><a class="reference internal" href="#simple-variables">1.5.4.3.3. Simple variables</a></li>
<li><a class="reference internal" href="#advanced-variables">1.5.4.3.4. Advanced variables</a><ul>
<li><a class="reference internal" href="#from-slices">1.5.4.3.4.1. From slices</a></li>
<li><a class="reference internal" href="#from-algorithms">1.5.4.3.4.2. From algorithms</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spatial-and-temporal-selections">1.5.4.3.5. Spatial and temporal selections</a></li>
<li><a class="reference internal" href="#reshaping-variables">1.5.4.3.6. Reshaping variables</a></li>
<li><a class="reference internal" href="#interpolating-a-variable-to-another-grid-location">1.5.4.3.7. Interpolating a variable to another grid location</a></li>
<li><a class="reference internal" href="#vertical-coordinates">1.5.4.3.8. Vertical coordinates</a></li>
<li><a class="reference internal" href="#logging-and-verbosity">1.5.4.3.9. Logging and verbosity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#development">1.5.4.4. Development</a><ul>
<li><a class="reference internal" href="#adding-a-new-get-method">1.5.4.4.1. Adding a new get method</a><ul>
<li><a class="reference internal" href="#simple-variable-to-read">1.5.4.4.1.1. Simple variable to read</a></li>
<li><a class="reference internal" href="#advanced-variable">1.5.4.4.1.2. Advanced variable</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-new-class-for-a-new-dataset-type">1.5.4.4.2. Adding a new class for a new dataset type</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/user.desc.dataset.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-the-generic-data-classes">
<span id="user-desc-dataset"></span><h1>1.5.4. Using the generic data classes<a class="headerlink" href="#using-the-generic-data-classes" title="Permalink to this headline">¶</a></h1>
<p>These classes are all inherited from <a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.Dataset" title="vacumm.data.misc.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a>.</p>
<div class="section" id="goal">
<h2>1.5.4.1. Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h2>
<p>Theses classes are generic interfaces to gridded data stored in
CF compliant netcdf files.
They provide standard method for accessing simple or complex quantities.</p>
<p>For instance, to access sea surface temperature, whatever the data
are satellite observations or results from models, you use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mydata</span> <span class="o">=</span> <span class="n">MyData</span><span class="p">(</span><span class="n">myfile</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ss</span> <span class="o">=</span> <span class="n">mydata</span><span class="o">.</span><span class="n">get_sst</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">MyData</span></code> will access the SST directly in the netcdf file,
or extract a surface slice from 3D temperature.</p>
<p>Specialized classes inherited from <a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.Dataset" title="vacumm.data.misc.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a>
are implemented to manage the interface to the different sources of data.</p>
<ul class="simple">
<li>There are some rather generic interfaces:
<a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.OceanDataset" title="vacumm.data.misc.dataset.OceanDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">OceanDataset</span></code></a>,
<a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.OceanSurfaceDataset" title="vacumm.data.misc.dataset.OceanSurfaceDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">OceanSurfaceDataset</span></code></a>,
<a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.AtmosDataset" title="vacumm.data.misc.dataset.AtmosDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtmosDataset</span></code></a>,
<a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.AtmosSurfaceDataset" title="vacumm.data.misc.dataset.AtmosSurfaceDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtmosSurfaceDataset</span></code></a>,
<a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.GenericDataset" title="vacumm.data.misc.dataset.GenericDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericDataset</span></code></a>.</li>
<li>There are some very specialized ones:
<a class="reference internal" href="library/data.model.mars.html#vacumm.data.model.mars3d.Mars3D" title="vacumm.data.model.mars3d.Mars3D"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mars3D</span></code></a>,
<a class="reference internal" href="library/data.model.nemo.html#vacumm.data.model.nemo.Nemo" title="vacumm.data.model.nemo.Nemo"><code class="xref py py-class docutils literal notranslate"><span class="pre">Nemo</span></code></a>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">HYCOM</span></code>,
<a class="reference internal" href="library/data.model.swan.html#vacumm.data.model.swan.SWAN" title="vacumm.data.model.swan.SWAN"><code class="xref py py-class docutils literal notranslate"><span class="pre">SWAN</span></code></a>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">CFSR</span></code>,
and more.
This list will increase with time.</li>
</ul>
</div>
<div class="section" id="usage">
<h2>1.5.4.2. Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>You must provide at least a file name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">vacumm.data.model.mars3d</span> <span class="k">import</span> <span class="n">Mars3D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydata</span> <span class="o">=</span> <span class="n">Mars3D</span><span class="p">(</span><span class="n">ncfile</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also use the <a class="reference internal" href="library/data.html#vacumm.data.DS" title="vacumm.data.DS"><code class="xref py py-func docutils literal notranslate"><span class="pre">vacumm.data.DS()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mydata</span> <span class="o">=</span> <span class="n">DS</span><span class="p">(</span><span class="n">ncfile</span><span class="p">,</span> <span class="s1">&#39;mars&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this latter case,  if you don’t specify the dataset type (here “mars”),
the generic class <a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.GenericDataset" title="vacumm.data.misc.dataset.GenericDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericDataset</span></code></a> is used.</p>
<p>Some options are supported at initialization. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mydata</span> <span class="o">=</span> <span class="n">Mars3D</span><span class="p">(</span><span class="n">ncfile</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>  <span class="n">logger_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then,  numerous methods are availables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lon</span> <span class="o">=</span> <span class="n">mydata</span><span class="o">.</span><span class="n">get_lon_u</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mld</span> <span class="o">=</span> <span class="n">mydata</span><span class="o">.</span><span class="n">get_mld</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;deltadens&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="sample-of-the-capabilities">
<h2>1.5.4.3. Sample of the capabilities<a class="headerlink" href="#sample-of-the-capabilities" title="Permalink to this headline">¶</a></h2>
<div class="section" id="reading-multiple-files">
<h3>1.5.4.3.1. Reading multiple files<a class="headerlink" href="#reading-multiple-files" title="Permalink to this headline">¶</a></h3>
<p>These classes fully take advantage of the  (see documentation).
For example,  you can provide sereval files or a file name with date patterns.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Mars3D</span><span class="p">([</span><span class="n">ncfile1</span><span class="p">,</span> <span class="n">ncfile2</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Mars3D</span><span class="p">(</span><span class="s1">&#39;myfile.%Y.nc&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="s1">&#39;2010&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>It also accepts url, global unix patterns (<code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">?</span></code>, etc),
and date patterns (<code class="docutils literal notranslate"><span class="pre">%Y</span></code>, <code class="docutils literal notranslate"><span class="pre">%m</span></code>, etc, see <a class="reference internal" href="library/misc.atime.html#vacumm.misc.atime.strftime" title="vacumm.misc.atime.strftime"><code class="xref py py-func docutils literal notranslate"><span class="pre">strftime()</span></code></a>).
For more information on how to read a set of files, please read the
<a class="reference internal" href="library/misc.io.html#vacumm.misc.io.list_forecast_files" title="vacumm.misc.io.list_forecast_files"><code class="xref py py-func docutils literal notranslate"><span class="pre">list_forecast_files()</span></code></a> function for options.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Files are sorted by alphabetically, unless you you pass
the <code class="docutils literal notranslate"><span class="pre">sort</span></code> keyword to prevent or tune sorting.</p>
</div>
</div>
<div class="section" id="searching-for-variables-and-axes">
<h3>1.5.4.3.2. Searching for variables and axes<a class="headerlink" href="#searching-for-variables-and-axes" title="Permalink to this headline">¶</a></h3>
<p>The search algorithm typically exploit lists of standard names and names.
These lists are defined in the <a class="reference internal" href="library/data.cf.html#module-vacumm.data.cf" title="vacumm.data.cf"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cf</span></code></a> module,
and can be completed within the specialized classes.
The functions that search for objects are
<code class="xref py py-func docutils literal notranslate"><span class="pre">ncfind_axis()</span></code>.</p>
</div>
<div class="section" id="simple-variables">
<span id="user-desc-dataset-cap-sim"></span><h3>1.5.4.3.3. Simple variables<a class="headerlink" href="#simple-variables" title="Permalink to this headline">¶</a></h3>
<p>You can access these variables using the generic way like the method
<a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.OceanDataset.get_temp" title="vacumm.data.misc.dataset.OceanDataset.get_temp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_temp()</span></code></a>.
If the variable cannot be found directly, the methods searches for it
using a name at another similar location name (no location or its physical
location according to <code class="xref py py-attr docutils literal notranslate"><span class="pre">vacumm.data.cf.var_specs</span></code>).
Finally, the method try to get it by reading it at different
location and interpolate it to the right one.</p>
<p>The method provide the <strong>mode</strong> keyword to choose the retreiving mode.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&quot;var&quot;</span></code>: Read it directly from the file.</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;stag&quot;</span></code>: Get it from staggered location thanks to interpolation.</li>
<li><code class="docutils literal notranslate"><span class="pre">None</span></code>: Try them all!</li>
</ul>
</div>
<div class="section" id="advanced-variables">
<span id="user-desc-dataset-cap-adv"></span><h3>1.5.4.3.4. Advanced variables<a class="headerlink" href="#advanced-variables" title="Permalink to this headline">¶</a></h3>
<p>Generally, a method will search for a variable which is
already in the dataset.
Other methods can also be implemented manually to retreive the variable,
typically from other physical variables.
You can choose which retreiving method to use thanks to the <strong>mode</strong> keyword:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mld</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_mld</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;var&#39;</span><span class="p">)</span> <span class="c1"># read it</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mld</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_mld</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;deltadens&#39;</span><span class="p">)</span> <span class="c1"># compute it</span>
</pre></div>
</div>
<p>In the second case, it is computed from the temperature, the salinity and the depths.</p>
<div class="section" id="from-slices">
<h4>1.5.4.3.4.1. From slices<a class="headerlink" href="#from-slices" title="Permalink to this headline">¶</a></h4>
<p>A variable can be accesed as a slice of another variable.
For instance, SST can be defined as the surface slice of temperature
in 3D models.
This is setup within the specification of the class.</p>
</div>
<div class="section" id="from-algorithms">
<h4>1.5.4.3.4.2. From algorithms<a class="headerlink" href="#from-algorithms" title="Permalink to this headline">¶</a></h4>
<p>Sometimes,  variable can also be retreived as computation
using existing variables.
For instance, if the mixed layer depth is not store in
the netcdf file, it can be computed using temperature,  density or Kz
with the <a class="reference internal" href="library/diag.thermdyn.html#vacumm.diag.thermdyn.mixed_layer_depth" title="vacumm.diag.thermdyn.mixed_layer_depth"><code class="xref py py-func docutils literal notranslate"><span class="pre">vacumm.diag.thermdyn.mixed_layer_depth()</span></code></a>.
The <a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.OceanDataset.get_mld" title="vacumm.data.misc.dataset.OceanDataset.get_mld"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_mld()</span></code></a> method
will read all needed variables to compute it.</p>
</div>
</div>
<div class="section" id="spatial-and-temporal-selections">
<h3>1.5.4.3.5. Spatial and temporal selections<a class="headerlink" href="#spatial-and-temporal-selections" title="Permalink to this headline">¶</a></h3>
<p>Spatial and temporal selections are availablesat initialization
or running time,  using the <code class="docutils literal notranslate"><span class="pre">lon</span></code>,  <code class="docutils literal notranslate"><span class="pre">lat</span></code>,  <code class="docutils literal notranslate"><span class="pre">level</span></code> and <code class="docutils literal notranslate"><span class="pre">time</span></code>
generic keywords:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mars</span> <span class="o">=</span> <span class="n">Mars3d</span><span class="p">(</span><span class="n">ncfile</span><span class="p">,</span>  <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="s1">&#39;2010&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sst</span> <span class="o">=</span> <span class="n">mars</span><span class="o">.</span><span class="n">get_sst</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
<p>Selection argument are those of CDAT,  and works well even
on curvilinear grids.</p>
</div>
<div class="section" id="reshaping-variables">
<h3>1.5.4.3.6. Reshaping variables<a class="headerlink" href="#reshaping-variables" title="Permalink to this headline">¶</a></h3>
<p>It can be useful sometimes to reshape a variable so that it has the same
shape as another variable, for instance to mathematical combinations
or statistics.
You can use the <strong>asvar</strong> keyword for such task.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bathy3d</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_bathy</span><span class="p">(</span><span class="n">asvar</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="interpolating-a-variable-to-another-grid-location">
<h3>1.5.4.3.7. Interpolating a variable to another grid location<a class="headerlink" href="#interpolating-a-variable-to-another-grid-location" title="Permalink to this headline">¶</a></h3>
<p>When a dataset is on an staggered Arakawa grid (such as a C grid),
you can use the <strong>at</strong> keyword to interpolate a variable
at another location.
For instance, to put sst at a U location, just use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sst_u</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_sst</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Note that sometimes a method already exists to do it:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sst_u</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_sst_u</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="vertical-coordinates">
<h3>1.5.4.3.8. Vertical coordinates<a class="headerlink" href="#vertical-coordinates" title="Permalink to this headline">¶</a></h3>
<p>Depth can be either a 1D axis,  a volumique variable,  or
estimated from sigma coordinates (using the
<a class="reference internal" href="library/data.misc.sigma.html#module-vacumm.data.misc.sigma" title="vacumm.data.misc.sigma"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sigma</span></code></a> module) or
by integrated layer thicknesses.</p>
</div>
<div class="section" id="logging-and-verbosity">
<h3>1.5.4.3.9. Logging and verbosity<a class="headerlink" href="#logging-and-verbosity" title="Permalink to this headline">¶</a></h3>
<p>Data classes integrate the logging system of module <a class="reference internal" href="library/misc.log.html#module-vacumm.misc.log" title="vacumm.misc.log"><code class="xref py py-mod docutils literal notranslate"><span class="pre">log</span></code></a>.
You can for instance define a logging level and print messages
of different level of importance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mars</span> <span class="o">=</span> <span class="n">Mars3D</span><span class="p">(</span><span class="n">ncfile</span><span class="p">,</span> <span class="n">logger_level</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="n">logger_file</span><span class="o">=</span><span class="s1">&#39;mars.log&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mars</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;debug message&#39;</span><span class="p">)</span> <span class="c1"># nothing is printed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mars</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;warning message&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="development">
<h2>1.5.4.4. Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adding-a-new-get-method">
<h3>1.5.4.4.1. Adding a new get method<a class="headerlink" href="#adding-a-new-get-method" title="Permalink to this headline">¶</a></h3>
<p>This is useful to …</p>
<div class="section" id="simple-variable-to-read">
<h4>1.5.4.4.1.1. Simple variable to read<a class="headerlink" href="#simple-variable-to-read" title="Permalink to this headline">¶</a></h4>
<p>In this case, you just define an interface to read the variable in a netcdf file.</p>
<p>First, define a new entry in the <code class="xref py py-attr docutils literal notranslate"><span class="pre">var_specs</span></code> dictionary
(see section <a class="reference internal" href="user.desc.cf.html#user-desc-cf-specs"><span class="std std-ref">Structure of the specification dictionaries</span></a>).
Let’s name it <code class="docutils literal notranslate"><span class="pre">myvar</span></code>.</p>
<p>Then you can choose between two methods:</p>
<ul>
<li><p class="first">Add the entry name <code class="docutils literal notranslate"><span class="pre">myvar</span></code> to the list defined by the <code class="xref py py-attr docutils literal notranslate"><span class="pre">auto_generic_var_names</span></code> class
attribute (create it if no present). This method also makes the <strong>mode</strong> keyword available
to choose the way you will retreive your variable <a class="reference internal" href="#user-desc-dataset-cap-sim"><span class="std std-ref">Simple variables</span></a>.</p>
</li>
<li><p class="first"><strong>Or</strong> define the method manually with the decorator <a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.getvar_fmtdoc" title="vacumm.data.misc.dataset.getvar_fmtdoc"><code class="xref py py-func docutils literal notranslate"><span class="pre">getvar_fmtdoc()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@getvar_fmtdoc</span>
<span class="k">def</span> <span class="nf">get_myvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;myvar&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="advanced-variable">
<h4>1.5.4.4.1.2. Advanced variable<a class="headerlink" href="#advanced-variable" title="Permalink to this headline">¶</a></h4>
<p>In this case, you want to be able to read the variable or compute it
(see paragraph <a class="reference internal" href="#user-desc-dataset-cap-adv"><span class="std std-ref">Advanced variables</span></a>).</p>
<p>You must define the method manually and introduce the <strong>mode</strong> keyword,
and use the <a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.check_mode" title="vacumm.data.misc.dataset.check_mode"><code class="xref py py-func docutils literal notranslate"><span class="pre">vacumm.data.misc.dataset.check_mode()</span></code></a> function to
verify which mode the user wants.
The <a class="reference internal" href="library/data.misc.dataset.html#vacumm.data.misc.dataset.getvar_fmtdoc" title="vacumm.data.misc.dataset.getvar_fmtdoc"><code class="xref py py-func docutils literal notranslate"><span class="pre">vacumm.data.misc.dataset.getvar_fmtdoc()</span></code></a> format the docstring
of the method.</p>
<p>In the follwing example, we want to be able to read the zonal wind stress,
or compute it from the wind speed components using function <a class="reference internal" href="library/diag.atmos.html#vacumm.diag.atmos.wind_stress" title="vacumm.diag.atmos.wind_stress"><code class="xref py py-func docutils literal notranslate"><span class="pre">wind_stress()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the method</span>
<span class="k">def</span> <span class="nf">get_taux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="c1"># Params</span>
    <span class="n">kwvar</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;level&#39;</span><span class="p">,</span><span class="s1">&#39;torect&#39;</span><span class="p">],</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">kwfinal</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;squeeze&#39;</span><span class="p">,</span><span class="s1">&#39;order&#39;</span><span class="p">,</span><span class="s1">&#39;asvar&#39;</span><span class="p">,</span> <span class="s1">&#39;at&#39;</span><span class="p">])</span>
    <span class="n">kwspeed</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;speed_&#39;</span><span class="p">)</span> <span class="c1">#</span>

    <span class="c1"># First, try to find a taux variable</span>
    <span class="k">if</span> <span class="n">check_mode</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="n">taux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;taux&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwvar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">taux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">check_mode</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_object</span><span class="p">(</span><span class="n">taux</span><span class="p">,</span> <span class="o">**</span><span class="n">kwfinal</span><span class="p">)</span>

    <span class="c1"># Estimate it from wind speed components</span>
    <span class="k">if</span> <span class="n">check_mode</span><span class="p">(</span><span class="s1">&#39;speed&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="n">u10m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_u10m</span><span class="p">(</span><span class="o">**</span><span class="n">kwvar</span><span class="p">)</span>
        <span class="n">v10m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v10m</span><span class="p">(</span><span class="o">**</span><span class="n">kwvar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u10m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v10m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">taux</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">wind_stress</span><span class="p">(</span><span class="n">u10m</span><span class="p">,</span> <span class="n">v10m</span><span class="p">,</span> <span class="n">format_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwspeed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">taux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">check_mode</span><span class="p">(</span><span class="s1">&#39;speed&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_object</span><span class="p">(</span><span class="n">taux</span><span class="p">,</span> <span class="n">depthup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwfinal</span><span class="p">)</span>

<span class="c1"># Generate the docstring</span>
<span class="n">getvar_fmtdoc</span><span class="p">(</span><span class="n">get_taux</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Retreiving mode</span>

<span class="s2">      - ``None``: Try all modes, in the following order.</span>
<span class="s2">      - ``&quot;var&quot;``: Read it from a variable.</span>
<span class="s2">      - ``&quot;speed&quot;``: Compute it from wind speed.</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">speed_rhoa</span><span class="o">=</span><span class="s2">&quot;Air density (in kg.m-3)&quot;</span><span class="p">,</span>
    <span class="n">speed_cd</span><span class="o">=</span><span class="s2">&quot;Drag coefficient&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-a-new-class-for-a-new-dataset-type">
<h3>1.5.4.4.2. Adding a new class for a new dataset type<a class="headerlink" href="#adding-a-new-class-for-a-new-dataset-type" title="Permalink to this headline">¶</a></h3>
<p>This can be useful for example to create an interface to a gridded
product such as model outputs or satellite data.</p>
<ol class="arabic">
<li><p class="first">Create a module somewhere in package <a class="reference internal" href="library/data.html#module-vacumm.data" title="vacumm.data"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vacumm.data</span></code></a> that contains a class
that is subclass of one or several classes of <a class="reference internal" href="library/data.misc.dataset.html#module-vacumm.data.misc.dataset" title="vacumm.data.misc.dataset"><code class="xref py py-mod docutils literal notranslate"><span class="pre">vacumm.data.misc.dataset</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">OceanDataset</span><span class="p">):</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
<li><p class="first">Define important class attributes:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="xref py py-attr docutils literal notranslate"><span class="pre">arakawa_grid_type</span></code> if the dataset is on a special grid.</p>
</li>
<li><p class="first"><code class="xref py py-attr docutils literal notranslate"><span class="pre">positive</span></code> if you know that your dataset is positive up or down for levels.</p>
</li>
<li><p class="first"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ncobj_specs</span></code> if you want to redefine the specification
of some variables in the same form as in <code class="xref py py-mod docutils literal notranslate"><span class="pre">var_specs</span></code>, but with
two other possible keys:</p>
<blockquote>
<div><ul class="simple">
<li><strong>select</strong>: To perform a systematic selection into the variable.</li>
<li><strong>squeeze</strong>: To systematically squeeze out one or more dimensions.</li>
</ul>
</div></blockquote>
<p>For instance, the SST in <a class="reference internal" href="library/data.model.mars.html#vacumm.data.model.mars3d.Mars3D" title="vacumm.data.model.mars3d.Mars3D"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mars3D</span></code></a> is redefined
so that it is read from the last level of 3D temperature, squeezing out the vertical
dimension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ncobj_specs</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1"># sea surface temperature</span>
    <span class="s1">&#39;sst&#39;</span><span class="p">:{</span>
        <span class="s1">&#39;inherit&#39;</span><span class="p">:</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span>
        <span class="s1">&#39;select&#39;</span><span class="p">:{</span><span class="s1">&#39;level&#39;</span><span class="p">:</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)},</span>
        <span class="s1">&#39;squeeze&#39;</span><span class="p">:</span><span class="s1">&#39;z&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ol>
<ol class="arabic simple" start="2">
<li>Define secondary class attributes and other special methods if needed.</li>
<li>Add an entry in <code class="xref py py-attr docutils literal notranslate"><span class="pre">vacumm.data.dataset_specs</span></code> to create a shortcut to
this dataset whe using <a class="reference internal" href="library/data.html#vacumm.data.DS" title="vacumm.data.DS"><code class="xref py py-func docutils literal notranslate"><span class="pre">vacumm.data.DS()</span></code></a>.</li>
</ol>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>