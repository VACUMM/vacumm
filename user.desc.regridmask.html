
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Regridding and masking &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Regridding and masking</a><ul>
<li><a class="reference internal" href="#regridding">Regridding</a><ul>
<li><a class="reference internal" href="#d-and-2d-regridding">1D and 2D regridding</a><ul>
<li><a class="reference internal" href="#generalities">Generalities</a><ul>
<li><a class="reference internal" href="#regridding-classes">Regridding classes</a></li>
<li><a class="reference internal" href="#le-probleme-des-valeurs-manquantes">Le problème des valeurs manquantes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regrillage-1d">Regrillage 1D</a></li>
<li><a class="reference internal" href="#regrillage-2d">Regrillage 2D</a></li>
<li><a class="reference internal" href="#ressources">Ressources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interpolation-de-nuages-de-points">Interpolation de nuages de points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#masking">Masking</a><ul>
<li><a class="reference internal" href="#polygones">Polygones</a></li>
<li><a class="reference internal" href="#interpolation-de-masque">Interpolation de masque</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/user.desc.regridmask.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="regridding-and-masking">
<h1>Regridding and masking<a class="headerlink" href="#regridding-and-masking" title="Permalink to this headline">¶</a></h1>
<div class="section" id="regridding">
<span id="user-desc-regridding"></span><h2>Regridding<a class="headerlink" href="#regridding" title="Permalink to this headline">¶</a></h2>
<div class="section" id="d-and-2d-regridding">
<h3>1D and 2D regridding<a class="headerlink" href="#d-and-2d-regridding" title="Permalink to this headline">¶</a></h3>
<div class="section" id="generalities">
<h4>Generalities<a class="headerlink" href="#generalities" title="Permalink to this headline">¶</a></h4>
<p>See also: <a class="reference internal" href="library/misc.grid.regridding.html#module-vacumm.misc.grid.regridding" title="vacumm.misc.grid.regridding"><code class="xref py py-mod docutils literal notranslate"><span class="pre">regridding</span></code></a></p>
<div class="section" id="regridding-classes">
<h5>Regridding classes<a class="headerlink" href="#regridding-classes" title="Permalink to this headline">¶</a></h5>
<p>There are two major classes of regridding:</p>
<blockquote>
<div><dl class="docutils">
<dt><strong>The interpolation</strong></dt>
<dd><p class="first">Elle peut être typiquement par plus proche voisin, linéaire ou cubique, ou faire appel à des
techniques plus sophistiquées en 2D.
L’interpolation est à utiliser dans deux cas de figure :</p>
<blockquote class="last">
<div>Pour passer <strong>d’une grille (ou axe en 1D) basse résolution vers une grille haute résolution</strong>.
Si elle est utilisée dans le sens opposé, elle peut être biaisée par de l’aliasing.</div></blockquote>
</dd>
<dt><strong>Le remapping</strong></dt>
<dd>Cette technique considère les points de grille comme des cellules :
pour chaque cellule cible, les cellules source recouvrant cette dernière
sont moyénées avec une pondération proportionnelle aux aires de recouvrement.
Elle est à utiliser pour passer <strong>d’une grille (ou axe en 1D)
haute résolution vers une grille basse résolution</strong>.</dd>
</dl>
</div></blockquote>
<p>Le tutoriel “<a class="reference internal" href="tutorials/misc.grid.regridding.remap_vs_interp_1d.html#user-tut-misc-grid-regridding-remap-vs-interp-1d"><span class="std std-ref">Remapping versus interpolation - 1D</span></a>” donne un aperçu du comportement des deux classes de regridding.</p>
<p>Le choix de la méthode peut être fait automatiquement.
Dans ce cas, la fonction <a class="reference internal" href="library/misc.grid.regridding.html#vacumm.misc.grid.regridding.regrid_method" title="vacumm.misc.grid.regridding.regrid_method"><code class="xref py py-func docutils literal notranslate"><span class="pre">regrid_method()</span></code></a> va calculer les résolutions
moyennes en entrée et en sortie, et choisir en fonction du rapport entre les deux.</p>
</div>
<div class="section" id="le-probleme-des-valeurs-manquantes">
<h5>Le problème des valeurs manquantes<a class="headerlink" href="#le-probleme-des-valeurs-manquantes" title="Permalink to this headline">¶</a></h5>
<p>Ce problème est résolu en interpolant les masques eux-mêmes et en utilisant des méthodes d’ordre moins élévé.
La méthode d’ordre le moins élévée, et donc celle de référence, est celle avec pondération par la distance (ou par plus proche voisin).
Par exemple, près d’une valeur manquante, l’interpolation linéaire est approximée par l’interpolation avec pondération par la distance dans la cellule.
De même, celle cubique est approximée par celle linéaire, puis celle avec pondération par la distance.</p>
<p>Dans le cas du remapping, les valeurs non masquées sont celles où le masque regrillé à une valeur
par exemple inférieure à .5.</p>
</div>
</div>
<div class="section" id="regrillage-1d">
<h4>Regrillage 1D<a class="headerlink" href="#regrillage-1d" title="Permalink to this headline">¶</a></h4>
<p>Le regridding 1D se fait sur l’un des axes d’une variable qui peut être multi-dimensionnelle.
Par exemple, on peut chercher à regriller sur la verticale une variable ‘tzyx’.</p>
<p>Le regridding 1D supporte en outre ce que l’on pourrait appeler les “axes étendus” :
un regridding toujours 1D, mais variable suivant certains des autres axes.
On utilise pour cela les mots clés <code class="docutils literal notranslate"><span class="pre">xmap</span></code> et <code class="docutils literal notranslate"><span class="pre">xmapper</span></code>.</p>
<p>Pour plus d’information, voir <a class="reference internal" href="library/misc.grid.regridding.html#vacumm.misc.grid.regridding.regrid1d" title="vacumm.misc.grid.regridding.regrid1d"><code class="xref py py-func docutils literal notranslate"><span class="pre">regrid1d()</span></code></a>.</p>
</div>
<div class="section" id="regrillage-2d">
<span id="user-desc-regridding-regrid2d"></span><h4>Regrillage 2D<a class="headerlink" href="#regrillage-2d" title="Permalink to this headline">¶</a></h4>
<p>Le regridding 2D se fait sur les deux derniers axes, qui sont généralement
associés aux axes de longitude et latitude en degrés.</p>
<p>L’utilisation du proche voisin à proximité immédiate de la côte
(valeur manquante pour la cellule voisine)
pose problème si l’on désire un rendu propre : des “marches d’escalier” apparaissent
sous le trait de côte.
Il est possible de prévenir cet inconvénient en utilisant une interpolation proportionnelle
à la distance à la place du proche voisin.
Les valeurs et le masque résultants sont en outre plus réalistes et naturels.</p>
<p>Pour plus d’information, voir <a class="reference internal" href="library/misc.grid.regridding.html#vacumm.misc.grid.regridding.regrid2d" title="vacumm.misc.grid.regridding.regrid2d"><code class="xref py py-func docutils literal notranslate"><span class="pre">regrid2d()</span></code></a>.</p>
</div>
<div class="section" id="ressources">
<h4>Ressources<a class="headerlink" href="#ressources" title="Permalink to this headline">¶</a></h4>
<p>Le module <a class="reference internal" href="library/misc.grid.regridding.html#module-vacumm.misc.grid.regridding" title="vacumm.misc.grid.regridding"><code class="xref py py-mod docutils literal notranslate"><span class="pre">regridding</span></code></a> met à disposition des fonctions et classes
afin de faciliter le regridding avec les méthodes évoquées ci-dessus.
Néanmoins, le coeur du regridding est délégué à d’autre modules.</p>
<blockquote>
<div><ul class="simple">
<li>Le regridding sur grilles rectangulaires est effectué notamment par les routines
Fortran du fichier <code class="file docutils literal notranslate"><span class="pre">interp.f90</span></code>. Ce fichier est converti en module
python grâce à <a class="reference external" href="http://docs.scipy.org/doc/numpy/user/c-info.python-as-glue.html#f2py">f2py</a>.</li>
<li>Le remapping sur grille rectangulaire est effectué par le module CDAT <code class="xref py py-mod docutils literal notranslate"><span class="pre">regrid2</span></code></li>
<li>Le regridding sur des grilles curvilinéaires fait appel au regrilleur
<a class="reference external" href="http://climate.lanl.gov/Software/SCRIP">SCRIP</a> et au module CDAT <code class="xref py py-mod docutils literal notranslate"><span class="pre">regrid2</span></code>.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="interpolation-de-nuages-de-points">
<h3>Interpolation de nuages de points<a class="headerlink" href="#interpolation-de-nuages-de-points" title="Permalink to this headline">¶</a></h3>
<p>Les seules techniques utilisée sont dérivées de la triangulation
et procèdent généralement à une interpolation dans un plan défini par trois points.
les algorithmes utilisés sont les suivants :</p>
<blockquote>
<div><ul class="simple">
<li><strong>Cargen</strong> : Développé par l’IFREMER (plus d’infos?), adapté et inclu dans le fichier
<code class="file docutils literal notranslate"><span class="pre">interp.f90</span></code>.</li>
<li><strong>Natgrid</strong> : Dérivé de la librairie <a class="reference external" href="http://www.dkrz.de/ngdoc/ng/ngmath/index.html">NgMath</a>
et inclu dans CDAT. Elle utilise un algorithme basé sur les voisin naturels.</li>
<li><strong>Csagrid</strong> : Même origine que Natgrid mais par fit de splines.</li>
</ul>
</div></blockquote>
<p>Si des valeurs masquées sont contenues dans les données d’entrée, le masque est lui aussi interpolé.</p>
<p>Sachant que ces méthodes peuvent demander des ressouces importante,
le domaine est découpé par blocs de même taille.</p>
<p>Pour plus d’information, voir <a class="reference internal" href="library/misc.grid.regridding.html#vacumm.misc.grid.regridding.griddata" title="vacumm.misc.grid.regridding.griddata"><code class="xref py py-func docutils literal notranslate"><span class="pre">griddata()</span></code></a>.</p>
</div>
</div>
<div class="section" id="masking">
<span id="user-desc-masking"></span><h2>Masking<a class="headerlink" href="#masking" title="Permalink to this headline">¶</a></h2>
<p>Le masquage des nuages de points et des données grillées est généralement effectué
soit par polygones, soit par interpolation de masque.</p>
<div class="section" id="polygones">
<h3>Polygones<a class="headerlink" href="#polygones" title="Permalink to this headline">¶</a></h3>
<p>Les polygones sont définis par une séries de coordonnées X/Y,
et prennent la forme d’objet de type <code class="xref py py-class docutils literal notranslate"><span class="pre">_geoslib.Polygon</span></code>.
Le module <code class="xref py py-mod docutils literal notranslate"><span class="pre">_geoslib</span></code> est fourni avec <a class="reference external" href="https://matplotlib.org/basemap/api/basemap_api.html#module-mpl_toolkits.basemap" title="(in Basemap Matplotlib Toolkit v1.1.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">basemap</span></code></a>,
et permet aussi de définir des objets de type <code class="xref py py-class docutils literal notranslate"><span class="pre">Line</span></code> ou <code class="xref py py-class docutils literal notranslate"><span class="pre">Point</span></code>.
Il est alors possible d’effectuer des tests d’inclusion (par exemple un point dans un polygone),
et de calculer des intersections (entre lignes et/ou polygones).</p>
<p>Si on définit par exemple un ensemble de polygones à partir d’un trait de côte,
nous pouvons masquer des points (<a class="reference internal" href="library/misc.grid.masking.html#vacumm.misc.grid.masking.polygon_select" title="vacumm.misc.grid.masking.polygon_select"><code class="xref py py-func docutils literal notranslate"><span class="pre">polygon_select()</span></code></a>)
ou des cellules d’une variable grillée (<a class="reference internal" href="library/misc.grid.masking.html#vacumm.misc.grid.masking.masked_polygon" title="vacumm.misc.grid.masking.masked_polygon"><code class="xref py py-func docutils literal notranslate"><span class="pre">masked_polygon()</span></code></a>).
Dans le cas des cellules, il est possible de masquer un point si le centre est sur la terre,
ou par exemple si plus de 50% de sa surface est de la terre.</p>
</div>
<div class="section" id="interpolation-de-masque">
<h3>Interpolation de masque<a class="headerlink" href="#interpolation-de-masque" title="Permalink to this headline">¶</a></h3>
<p>Si les données d’entrée possèdent des valeurs manquantes, le masque de
sortie peut être estimé en interpolant celui d’entrée converti en réels (de 0. et 1.),
et à l’aide d’un seuil (typiquement 0.5).
Cette approche est valable aussi bien pour les nuages de points que les données grillées.
Il convient néanmoins pour les données grillées d’adapter l’interpolation
près des cellules masquées (voir <a class="reference internal" href="#user-desc-regridding-regrid2d"><span class="std std-ref">Regrillage 2D</span></a>)
pour que le masque issu de l’interpolation des données soit moins restrictif
celui issu de l’interpolation du masque d’origine.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>