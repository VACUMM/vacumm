
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>vacumm.data.misc.coloc &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="../../../../_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../../index.html"><img src="../../../../static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../vacumm.html" >vacumm</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../../data.html" accesskey="U">vacumm.data</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vacumm.data.misc.coloc</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Copyright or Â© or Copr. Actimar/IFREMER (2010-2015)</span>
<span class="c1">#</span>
<span class="c1"># This software is a computer program whose purpose is to provide</span>
<span class="c1"># utilities for handling oceanographic and atmospheric data,</span>
<span class="c1"># with the ultimate goal of validating the MARS model from IFREMER.</span>
<span class="c1">#</span>
<span class="c1"># This software is governed by the CeCILL license under French law and</span>
<span class="c1"># abiding by the rules of distribution of free software.  You can  use,</span>
<span class="c1"># modify and/ or redistribute the software under the terms of the CeCILL</span>
<span class="c1"># license as circulated by CEA, CNRS and INRIA at the following URL</span>
<span class="c1"># &quot;http://www.cecill.info&quot;.</span>
<span class="c1">#</span>
<span class="c1"># As a counterpart to the access to the source code and  rights to copy,</span>
<span class="c1"># modify and redistribute granted by the license, users are provided only</span>
<span class="c1"># with a limited warranty  and the software&#39;s author,  the holder of the</span>
<span class="c1"># economic rights,  and the successive licensors  have only  limited</span>
<span class="c1"># liability.</span>
<span class="c1">#</span>
<span class="c1"># In this respect, the user&#39;s attention is drawn to the risks associated</span>
<span class="c1"># with loading,  using,  modifying and/or developing or reproducing the</span>
<span class="c1"># software by the user in light of its specific status of free software,</span>
<span class="c1"># that may mean  that it is complicated to manipulate,  and  that  also</span>
<span class="c1"># therefore means  that it is reserved for developers  and  experienced</span>
<span class="c1"># professionals having in-depth computer knowledge. Users are therefore</span>
<span class="c1"># encouraged to load and test the software&#39;s suitability as regards their</span>
<span class="c1"># requirements in conditions enabling the security of their systems and/or</span>
<span class="c1"># data to be ensured and,  more generally, to use and operate it in the</span>
<span class="c1"># same conditions as regards security.</span>
<span class="c1">#</span>
<span class="c1"># The fact that you are presently reading this means that you have had</span>
<span class="c1"># knowledge of the CeCILL license and that you accept its terms.</span>
<span class="c1">#</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Jonathan Wilkins&#39;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s1">&#39;wilkins@actimar.fr&#39;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s1">&#39;2011-01-17&#39;</span>
<span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;Dataset Colocalizations&#39;</span>


<span class="c1"># ==============================================================================</span>


<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">cdms2</span><span class="o">,</span> <span class="nn">MV2</span><span class="o">,</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">pylab</span><span class="o">,</span> <span class="nn">seawater</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="k">import</span> <span class="n">colorbar</span>

<span class="kn">from</span> <span class="nn">vacumm.data.misc.sigma</span> <span class="k">import</span> <span class="n">NcSigma</span>
<span class="kn">from</span> <span class="nn">vacumm.misc</span> <span class="k">import</span> <span class="n">auto_scale</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.atime</span> <span class="k">import</span> <span class="n">add</span> <span class="k">as</span> <span class="n">add_time</span><span class="p">,</span> <span class="n">comptime</span><span class="p">,</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">adatetime</span><span class="p">,</span> <span class="n">Intervals</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.axes</span> <span class="k">import</span> <span class="n">create_time</span><span class="p">,</span> <span class="n">create_dep</span><span class="p">,</span> <span class="n">create_lat</span><span class="p">,</span> <span class="n">create_lon</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.bases</span> <span class="k">import</span> <span class="n">Object</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.color</span> <span class="k">import</span> <span class="n">cmap_magic</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.io</span> <span class="k">import</span> <span class="n">ncget_var</span><span class="p">,</span> <span class="n">ncfind_var</span><span class="p">,</span> <span class="n">list_forecast_files</span><span class="p">,</span> <span class="n">ncread_best_estimate</span><span class="p">,</span> <span class="n">NcIterBestEstimate</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid.misc</span> <span class="k">import</span> <span class="n">meshweights</span><span class="p">,</span> <span class="n">resol</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid.regridding</span> <span class="k">import</span> <span class="n">resol</span><span class="p">,</span> <span class="n">interp1d</span><span class="p">,</span> <span class="n">regrid1dold</span><span class="p">,</span> <span class="n">grid2xy</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.misc</span> <span class="k">import</span> <span class="n">is_iterable</span><span class="p">,</span> <span class="n">kwfilter</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.phys.constants</span> <span class="k">import</span> <span class="n">g</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.plot</span> <span class="k">import</span> <span class="n">map2</span><span class="p">,</span> <span class="n">curve2</span><span class="p">,</span> <span class="n">section2</span><span class="p">,</span> <span class="n">hov2</span>


<div class="viewcode-block" id="Colocator"><a class="viewcode-back" href="../../../../library/data.misc.coloc.html#vacumm.data.misc.coloc.Colocator">[docs]</a><span class="k">class</span> <span class="nc">Colocator</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>

<span class="c1">#    def __init__(self, data1, data2):</span>
<span class="c1">#        Object.__init__(self)</span>
<span class="c1">#        self.data1 = data1</span>
<span class="c1">#        self.data2 = data2</span>

<div class="viewcode-block" id="Colocator.coloc_mod_on_pro"><a class="viewcode-back" href="../../../../library/data.misc.coloc.html#vacumm.data.misc.coloc.Colocator.coloc_mod_on_pro">[docs]</a>    <span class="k">def</span> <span class="nf">coloc_mod_on_pro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Colocalize model on profile data.</span>

<span class="sd">        Load model data corresponding to the selected profiles positions and time.</span>

<span class="sd">        Returns loaded model longitudes, latitudes, depths and requested variable(s)</span>

<span class="sd">        :Params:</span>
<span class="sd">            - **model**: model data :class:`~vacumm.data.misc.dataset.Dataset`</span>
<span class="sd">            - **profiles**: profile data :class:`~vacumm.data.misc.profile.ProfilesDataset`</span>
<span class="sd">            - **varnames**: variables to load (ex: (&#39;temp&#39;,&#39;sal&#39;) or ((&#39;temp&#39;,&#39;temperature&#39;),(&#39;sal&#39;,&#39;salinity&#39;))</span>
<span class="sd">            - **select**: selector</span>
<span class="sd">            - **method**: coloc method (**nearest** or **interp**)</span>

<span class="sd">        :Return:</span>
<span class="sd">            - **lons_mod**: model longitude coordinates, shape: (profile)</span>
<span class="sd">            - **lats_mod**: model latitude coordinates, shape: (profile)</span>
<span class="sd">            - **deps_mod**: model depth coordinates, shape: (level,profile)</span>
<span class="sd">            - **var1**: requested variables, shape: (level,profile)</span>
<span class="sd">            - ...</span>
<span class="sd">            - **varN**</span>

<span class="sd">        .. todo::</span>
<span class="sd">            - also load and return profile data here</span>
<span class="sd">            - exclude coords where profile data is masked (no data for specified depth)</span>
<span class="sd">            - return time coordinates</span>
<span class="sd">            - return depth and vars with shape (profile,level)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Colocalizing </span><span class="si">%s</span><span class="s1"> on </span><span class="si">%s</span><span class="se">\n</span><span class="s1">varnames: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">select: </span><span class="si">%s</span><span class="se">\n</span><span class="s1"> method: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">profiles</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="n">prof_pro</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prof_pro</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">prof_pro</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No profiles found, aborting&#39;</span><span class="p">)</span>
        <span class="n">lev_pro</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
        <span class="n">time_pro</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
        <span class="n">lons_pro</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
        <span class="n">lats_pro</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">create_time</span><span class="p">(</span><span class="n">time_pro</span><span class="p">)</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Number of profiles: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Profiles time coverage: </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Init model</span>
        <span class="n">td</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_time_res</span><span class="p">()</span>
        <span class="n">dtmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">days</span><span class="o">*</span><span class="mi">86400</span><span class="o">+</span><span class="n">td</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Detected model time step: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">td</span><span class="p">)</span>
        <span class="n">grid_mod</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_grid</span><span class="p">()</span>
        <span class="n">xres</span><span class="p">,</span> <span class="n">yres</span> <span class="o">=</span> <span class="n">resol</span><span class="p">(</span><span class="n">grid_mod</span><span class="p">)</span>
        <span class="n">time_mod</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">ctime_mod</span> <span class="o">=</span> <span class="n">time_mod</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Model time coverage: </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ctime_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ctime_mod</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">level_mod</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_level</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
        <span class="n">lons_mod</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">prof_pro</span><span class="p">),))</span><span class="o">+</span><span class="n">MV2</span><span class="o">.</span><span class="n">masked</span>
        <span class="n">lats_mod</span> <span class="o">=</span> <span class="n">lons_mod</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">deps_mod</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">level_mod</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">prof_pro</span><span class="p">)))</span><span class="o">+</span><span class="n">MV2</span><span class="o">.</span><span class="n">masked</span>
        <span class="n">deps_mod</span><span class="o">.</span><span class="n">setAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">prof_pro</span><span class="p">)</span>
        <span class="n">lons_mod</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">lats_mod</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">deps_mod</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span>

        <span class="c1"># Creation des variables demandees</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">level_mod</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">prof_pro</span><span class="p">)))</span><span class="o">+</span><span class="n">MV2</span><span class="o">.</span><span class="n">masked</span>
            <span class="n">v</span><span class="o">.</span><span class="n">setAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">prof_pro</span><span class="p">)</span>
            <span class="n">v</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">n</span>
            <span class="n">variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="n">cdms2</span><span class="o">.</span><span class="n">setAutoBounds</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># ???</span>

        <span class="c1"># Boucle temporelle</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dates</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Limites spatiales</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">lons_pro</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">lats_pro</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span>
                <span class="n">lon_min</span> <span class="o">=</span> <span class="n">lon</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">xres</span>
                <span class="n">lon_max</span> <span class="o">=</span> <span class="n">lon</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">xres</span>
                <span class="n">lat_min</span> <span class="o">=</span> <span class="n">lat</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">yres</span>
                <span class="n">lat_max</span> <span class="o">=</span> <span class="n">lat</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">yres</span>
                <span class="n">date_interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">add_time</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="o">-</span> <span class="n">dtmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">add_time</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">dtmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;ccb&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Colocalizing data for date </span><span class="si">%s</span><span class="s1">, lon: </span><span class="si">%s</span><span class="s1">, lat: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>

                <span class="c1"># Methode 1 : donnees les plus proches</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
                    <span class="n">sel</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;ccb&#39;</span><span class="p">),</span> <span class="n">longitude</span><span class="o">=</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="s1">&#39;ccb&#39;</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;ccb&#39;</span><span class="p">))</span>
                    <span class="c1"># Verifier la disponibilite des donnees</span>
                    <span class="k">if</span> <span class="n">time_mod</span><span class="o">.</span><span class="n">mapIntervalExt</span><span class="p">(</span><span class="n">sel</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Time interval </span><span class="si">%s</span><span class="s1"> not found&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">grid_mod</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span><span class="o">.</span><span class="n">mapInterval</span><span class="p">(</span><span class="n">sel</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Latitude coordinate </span><span class="si">%s</span><span class="s1"> not found&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">grid_mod</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span><span class="o">.</span><span class="n">mapInterval</span><span class="p">(</span><span class="n">sel</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Longitude coordinate </span><span class="si">%s</span><span class="s1"> not found&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
                        <span class="k">continue</span>

                    <span class="c1"># Load tmp depth to get lon &amp; lat coordinates</span>
                    <span class="c1">#tmp = model.get_depth(select=sel, squeeze=False) # tmp squeezed !!! see sigma ?</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">select</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">lons_mod</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lats_mod</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">deps_mod</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span>  <span class="n">model</span><span class="o">.</span><span class="n">get_depth</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">iv</span><span class="p">,</span><span class="n">vn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">):</span>
                        <span class="n">variables</span><span class="p">[</span><span class="n">iv</span><span class="p">][:,</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">vn</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Methode 2 : interpolation</span>
                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;interp&#39;</span><span class="p">:</span>
                    <span class="n">sel</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">date_interval</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">time_mod</span><span class="o">.</span><span class="n">mapIntervalExt</span><span class="p">(</span><span class="n">sel</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Time interval </span><span class="si">%s</span><span class="s1"> not found&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">grid_mod</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span><span class="o">.</span><span class="n">mapInterval</span><span class="p">(</span><span class="n">sel</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Latitude coordinate </span><span class="si">%s</span><span class="s1"> not found&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">grid_mod</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span><span class="o">.</span><span class="n">mapInterval</span><span class="p">(</span><span class="n">sel</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Longitude coordinate </span><span class="si">%s</span><span class="s1"> not found&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
                        <span class="k">continue</span>

                    <span class="c1"># Lectures</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="s1">&#39;tzyx&#39;</span>
                    <span class="c1"># lon &amp; lat du profile car interp sur cette position</span>
                    <span class="n">lons_mod</span><span class="p">[</span><span class="n">ip</span><span class="p">],</span> <span class="n">lats_mod</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span>
                    <span class="n">deps_mod_tzyx</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_depth</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">tmp_tzyx</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">iv</span><span class="p">,</span><span class="n">vn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">):</span>
                        <span class="n">tmp_tzyx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">vn</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

                    <span class="c1"># Interpolations temporelles</span>
                    <span class="n">mctime</span> <span class="o">=</span> <span class="n">tmp_tzyx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
                    <span class="n">mrtime</span> <span class="o">=</span> <span class="n">mctime</span><span class="o">.</span><span class="n">asRelativeTime</span><span class="p">()</span>
                    <span class="n">d0</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">mctime</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">mrtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="n">mrtime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">date</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">mctime</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">f0</span> <span class="o">=</span> <span class="n">d0</span> <span class="o">/</span> <span class="p">(</span><span class="n">d0</span> <span class="o">+</span> <span class="n">d1</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">/</span> <span class="p">(</span><span class="n">d0</span> <span class="o">+</span> <span class="n">d1</span><span class="p">)</span>
                    <span class="n">deps_mod_zyx</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">*</span> <span class="n">deps_mod_tzyx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">f1</span> <span class="o">*</span> <span class="n">deps_mod_tzyx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">tmp_zyx</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">iv</span><span class="p">,</span><span class="n">vn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">):</span>
                        <span class="n">tmp_zyx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f0</span> <span class="o">*</span> <span class="n">tmp_tzyx</span><span class="p">[</span><span class="n">iv</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">f1</span> <span class="o">*</span> <span class="n">tmp_tzyx</span><span class="p">[</span><span class="n">iv</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">tmp_tzyx</span>

                    <span class="c1"># Interpolations spatiales</span>
                    <span class="n">deps_mod</span><span class="p">[:,</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">grid2xy</span><span class="p">(</span><span class="n">deps_mod_zyx</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon</span><span class="p">]),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat</span><span class="p">]),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nat&#39;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">iv</span><span class="p">,</span><span class="n">vn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varnames</span><span class="p">):</span>
                        <span class="n">variables</span><span class="p">[</span><span class="n">iv</span><span class="p">][:,</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">grid2xy</span><span class="p">(</span><span class="n">tmp_zyx</span><span class="p">[</span><span class="n">iv</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon</span><span class="p">]),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat</span><span class="p">]),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nat&#39;</span><span class="p">))</span>
                    <span class="k">del</span> <span class="n">tmp_zyx</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid colocation method: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed to colocalize data for date </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">deps_mod</span><span class="p">]</span> <span class="o">+</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;level&#39;</span>
            <span class="n">v</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">designateLevel</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">deps_mod</span><span class="p">]</span> <span class="o">+</span> <span class="n">variables</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Colocalized data:</span><span class="se">\n</span><span class="s1">  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="Colocator.coloc_strat_mod_on_pro"><a class="viewcode-back" href="../../../../library/data.misc.coloc.html#vacumm.data.misc.coloc.Colocator.coloc_strat_mod_on_pro">[docs]</a>    <span class="k">def</span> <span class="nf">coloc_strat_mod_on_pro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get colocalized stratification data of a model on profiles</span>

<span class="sd">        See: :func:`coloc_mod_on_pro`</span>

<span class="sd">        :Return:</span>
<span class="sd">            - **lons_mod, lats_mod, deps_mod**:</span>
<span class="sd">            - **temp_mod, sal_mod**: temperature and salinity</span>
<span class="sd">            - **pres_mod, dens_mod**: pressure and density</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Coloc donnees modele sur profiles</span>
        <span class="n">varnames</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span><span class="s1">&#39;temperature&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sal&#39;</span><span class="p">,</span> <span class="s1">&#39;psal&#39;</span><span class="p">,</span><span class="s1">&#39;salinity&#39;</span><span class="p">))</span>
        <span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">deps_mod</span><span class="p">,</span> <span class="n">temp_mod</span><span class="p">,</span> <span class="n">sal_mod</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">coloc_mod_on_pro</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">varnames</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Calcul pression &amp; densite</span>
        <span class="n">pres_mod</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">temp_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">+</span><span class="n">MV2</span><span class="o">.</span><span class="n">masked</span>
        <span class="n">pres_mod</span><span class="o">.</span><span class="n">setAxisList</span><span class="p">(</span><span class="n">temp_mod</span><span class="o">.</span><span class="n">getAxisList</span><span class="p">())</span>
        <span class="n">dens_mod</span> <span class="o">=</span> <span class="n">pres_mod</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lons_mod</span><span class="p">)):</span>
            <span class="n">pres_mod</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">seawater</span><span class="o">.</span><span class="n">csiro</span><span class="o">.</span><span class="n">pres</span><span class="p">(</span><span class="n">deps_mod</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">resize</span><span class="p">([</span><span class="n">lats_mod</span><span class="p">[</span><span class="n">ip</span><span class="p">]],</span> <span class="n">deps_mod</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">dens_mod</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">seawater</span><span class="o">.</span><span class="n">csiro</span><span class="o">.</span><span class="n">dens</span><span class="p">(</span><span class="n">sal_mod</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">],</span> <span class="n">temp_mod</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">],</span> <span class="n">pres_mod</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">])</span>
        <span class="n">pres_mod</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;pressure&#39;</span>
        <span class="n">dens_mod</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;density&#39;</span>
        <span class="k">return</span> <span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">deps_mod</span><span class="p">,</span> <span class="n">temp_mod</span><span class="p">,</span> <span class="n">sal_mod</span><span class="p">,</span> <span class="n">pres_mod</span><span class="p">,</span> <span class="n">dens_mod</span></div>


<div class="viewcode-block" id="Colocator.plot_layer_mod_on_pro"><a class="viewcode-back" href="../../../../library/data.misc.coloc.html#vacumm.data.misc.coloc.Colocator.plot_layer_mod_on_pro">[docs]</a>    <span class="k">def</span> <span class="nf">plot_layer_mod_on_pro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get a layer of variable for a specified depth.</span>

<span class="sd">        :Params:</span>

<span class="sd">          - **varname**: variable to process</span>
<span class="sd">          - **depth**: output depth(s)</span>

<span class="sd">          Other params, see: :func:`coloc_mod_on_pro`</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Plotting layer of colocalized </span><span class="si">%s</span><span class="s1"> on </span><span class="si">%s</span><span class="se">\n</span><span class="s1">varname: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">depth: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">select: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">kwargs: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">profiles</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">deps_mod</span><span class="p">,</span> <span class="n">var_mod</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">coloc_mod_on_pro</span><span class="p">(</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span>
                <span class="c1"># If varname is a list of possible names, wrap it into a</span>
                <span class="c1"># tuple of one element as we are requiring only one variable</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">varname</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">varname</span><span class="p">,)</span> <span class="ow">or</span> <span class="n">varname</span><span class="p">,</span>
                <span class="n">select</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">odep</span> <span class="o">=</span> <span class="n">create_dep</span><span class="p">(</span><span class="n">is_iterable</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span> <span class="ow">and</span> <span class="n">depth</span> <span class="ow">or</span> <span class="p">[</span><span class="n">depth</span><span class="p">])</span>
        <span class="n">var_mod</span> <span class="o">=</span> <span class="n">var_mod</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s1">&#39;-z&#39;</span><span class="p">)</span>
        <span class="n">var_mod</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">var_mod</span><span class="p">,</span> <span class="n">axo</span><span class="o">=</span><span class="n">odep</span><span class="p">,</span> <span class="n">xmap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmapper</span><span class="o">=</span><span class="n">deps_mod</span><span class="p">)</span> <span class="c1"># Required order: ...z</span>
        <span class="n">var_mod</span> <span class="o">=</span> <span class="n">var_mod</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s1">&#39;z-&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;layer:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">var_mod</span><span class="p">)</span>

        <span class="n">lons_pro</span><span class="p">,</span> <span class="n">lats_pro</span><span class="p">,</span> <span class="n">var_pro</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
        <span class="n">profiles</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;layer:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">var_pro</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># TracÃ©s</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">var_pro</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">var_pro</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">var_mod</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">var_mod</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vmin</span><span class="p">)</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">var_mod</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No model data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;latitude&#39;</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
            <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="n">select</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">la</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_latitude</span><span class="p">()</span>
            <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">la</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;longitude&#39;</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
            <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="n">select</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_longitude</span><span class="p">()</span>
            <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lo</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">lo</span><span class="p">)</span>

        <span class="n">levels</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">((</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># CrÃ©ation de la palette</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap_magic</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
        <span class="c1"># On trace de champ du modÃ¨le moyenÃ© sur la pÃ©riode choisie</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">map2</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># On trace le modÃ¨le en fond</span>

        <span class="c1"># =====</span>
        <span class="n">msca</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">msca</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">var_mod</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed plotting model data&#39;</span><span class="p">)</span>
        <span class="c1"># =====</span>
        <span class="c1"># Triangulation du modÃ¨le</span>
<span class="c1">#        import matplotlib.tri as tri</span>
<span class="c1">#        triang = tri.Triangulation(lons_mod, lats_mod)</span>
<span class="c1">#        # On trace le modÃ¨le en fond</span>
<span class="c1">#        mod = m.axes.tripcolor(triang, var_mod, vmin=vmin, vmax=vmax, cmap=cmap)</span>
        <span class="c1"># =====</span>

        <span class="c1"># On trace les observations avec des points plus petits</span>
        <span class="n">psca</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">psca</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_pro</span><span class="p">,</span> <span class="n">lats_pro</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">var_pro</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;profiles&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed plotting profile data&#39;</span><span class="p">)</span>

        <span class="c1"># Colorbar</span>
        <span class="k">if</span> <span class="n">msca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar</span><span class="p">(</span><span class="n">msca</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar</span><span class="p">(</span><span class="n">psca</span><span class="p">)</span></div>

<div class="viewcode-block" id="Colocator.plot_mld_mod_on_pro"><a class="viewcode-back" href="../../../../library/data.misc.coloc.html#vacumm.data.misc.coloc.Colocator.plot_mld_mod_on_pro">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mld_mod_on_pro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot mixed layer depth of model data correspponding to profiles position</span>

<span class="sd">        :Params:</span>

<span class="sd">          - **deep**: deep water computation mode if true</span>

<span class="sd">          Other params, see: :func:`coloc_mod_on_pro`</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Plotting MLD of colocalized </span><span class="si">%s</span><span class="s1"> on </span><span class="si">%s</span><span class="se">\n</span><span class="s1">select: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">deep: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">kwargs: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">profiles</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># Lecture des donnees de stratification</span>
        <span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">deps_mod</span><span class="p">,</span> <span class="n">temp_mod</span><span class="p">,</span> <span class="n">sal_mod</span><span class="p">,</span> <span class="n">pres_mod</span><span class="p">,</span> <span class="n">dens_mod</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">coloc_strat_mod_on_pro</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># Calcul mld modele</span>

        <span class="c1"># MLD en eaux peu profondes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">deep</span><span class="p">:</span>
            <span class="n">ddeps</span> <span class="o">=</span> <span class="n">meshweights</span><span class="p">(</span><span class="n">deps_mod</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># DensitÃ© min/max</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="n">dens_mod</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="n">dens_mod</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># DensitÃ© moyenne</span>
            <span class="n">dmean</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dens_mod</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ddeps</span><span class="p">)</span>
            <span class="c1"># Profondeur max (max+demi Ã©paisseur)</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">deps_mod</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ddeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*.</span><span class="mi">5</span>
            <span class="c1"># MLD</span>
            <span class="n">mld_mod</span> <span class="o">=</span> <span class="n">H</span><span class="o">*</span><span class="p">(</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmean</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span><span class="p">)</span>
        <span class="c1"># MLD en eaux profondes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Profondeur de rÃ©fÃ©rence</span>
            <span class="n">dep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
            <span class="c1"># Axe pour interpolation</span>
            <span class="kn">from</span> <span class="nn">vacumm.misc.axes</span> <span class="k">import</span> <span class="n">create_dep</span>
            <span class="n">depaxis</span> <span class="o">=</span> <span class="n">create_dep</span><span class="p">([</span><span class="n">dep</span><span class="p">])</span>
            <span class="c1"># Interpolations</span>
            <span class="n">dens_mod_ref</span> <span class="o">=</span> <span class="n">dens_mod_ref</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s1">&#39;-z&#39;</span><span class="p">)</span>
            <span class="n">dens_mod_ref</span> <span class="o">=</span> <span class="n">regrid1dold</span><span class="p">(</span><span class="n">dens_mod</span><span class="p">,</span> <span class="n">axo</span><span class="o">=</span><span class="n">depaxis</span><span class="p">,</span> <span class="n">xmap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmapper</span><span class="o">=</span><span class="n">deps_mod</span><span class="p">)</span> <span class="c1"># Required order: ...z</span>
            <span class="n">dens_mod_ref</span> <span class="o">=</span> <span class="n">dens_mod_ref</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s1">&#39;z-&#39;</span><span class="p">)</span>
            <span class="c1"># Valeur du diffÃ©rentiel de densitÃ© (cf. de Boyer MontÃ©gut et all, 2003)</span>
            <span class="n">delta_dens</span> <span class="o">=</span> <span class="mf">0.03</span>
            <span class="c1"># DensitÃ© cible</span>
            <span class="n">dens_mod_target</span> <span class="o">=</span> <span class="n">dens_mod_ref</span><span class="o">+</span><span class="mf">0.03</span>
            <span class="c1"># Masques de la couche mÃ©langÃ©e et des eaux profondes</span>
            <span class="n">dens_mod_target3d</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">dens_mod_target</span><span class="p">,</span> <span class="n">dens_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">dens_mod_good</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens_mod</span><span class="o">.</span><span class="n">asma</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">dens_mod_target3d</span><span class="o">.</span><span class="n">asma</span><span class="p">())</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">dens_mod_bad</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens_mod</span><span class="o">.</span><span class="n">asma</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">dens_mod_target3d</span><span class="o">.</span><span class="n">asma</span><span class="p">())</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Profondeurs juste au dessus et en dessous de la MLD</span>
            <span class="n">deps_mod_above</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">dens_mod_bad</span><span class="p">,</span> <span class="n">deps_mod</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">deps_mod_below</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">dens_mod_good</span><span class="p">,</span> <span class="n">deps_mod</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Masques associÃ©s</span>
            <span class="kn">from</span> <span class="nn">vacumm.misc</span> <span class="k">import</span> <span class="n">closeto</span>
            <span class="n">mask_above</span> <span class="o">=</span> <span class="n">closeto</span><span class="p">(</span><span class="n">deps_mod</span><span class="p">,</span> <span class="n">MV2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">deps_mod_above</span><span class="p">,</span> <span class="n">deps_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">mask_below</span> <span class="o">=</span> <span class="n">closeto</span><span class="p">(</span><span class="n">deps_mod</span><span class="p">,</span> <span class="n">MV2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">deps_mod_below</span><span class="p">,</span> <span class="n">deps_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="c1"># DensitÃ©s juste au dessus et en dessous de la MLD</span>
            <span class="n">dens_mod_above</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">dens_mod</span><span class="p">,</span> <span class="n">mask_above</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dens_mod_below</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">dens_mod</span><span class="p">,</span> <span class="n">mask_below</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Interpolation</span>
            <span class="n">dens_mod_delta</span> <span class="o">=</span> <span class="n">dens_mod_above</span><span class="o">-</span><span class="n">dens_mod_below</span>
            <span class="n">deps_mod_mld</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens_mod_target</span><span class="o">-</span><span class="n">dens_mod_above</span><span class="p">)</span><span class="o">*</span><span class="n">deps_mod_above</span>
            <span class="n">deps_mod_mld</span> <span class="o">+=</span> <span class="p">(</span><span class="n">dens_mod_below</span><span class="o">-</span><span class="n">dens_mod_target</span><span class="p">)</span><span class="o">*</span><span class="n">deps_mod_below</span>
            <span class="n">deps_mod_mld</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dens_mod_delta</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked</span><span class="p">,</span> <span class="n">deps_mod_mld</span><span class="o">/</span><span class="n">dens_mod_delta</span><span class="p">)</span>
            <span class="n">mld_mod</span> <span class="o">=</span> <span class="n">deps_mod_mld</span>
        <span class="c1"># Finalize</span>
        <span class="n">mld_mod</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mld_mod</span><span class="p">)</span>
        <span class="n">mld_mod</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
        <span class="n">mld_mod</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;Profondeur de la couche de melange&#39;</span>
        <span class="n">mld_mod</span><span class="o">.</span><span class="n">setAxisList</span><span class="p">(</span><span class="n">lons_mod</span><span class="o">.</span><span class="n">getAxisList</span><span class="p">())</span>
        <span class="n">model</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;MLD:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">mld_mod</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># Calcul mld profiles</span>
        <span class="n">mld_pro</span><span class="p">,</span> <span class="n">lats_pro</span><span class="p">,</span> <span class="n">lons_pro</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">get_mld</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>
        <span class="n">profiles</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;MLD:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">mld_pro</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># TracÃ©s</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">mld_pro</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">mld_pro</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mld_mod</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mld_mod</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vmin</span><span class="p">)</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mld_mod</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No model data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;latitude&#39;</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
            <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="n">select</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">la</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_latitude</span><span class="p">()</span>
            <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">la</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;longitude&#39;</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
            <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="n">select</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_longitude</span><span class="p">()</span>
            <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lo</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">lo</span><span class="p">)</span>

        <span class="n">levels</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">((</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># CrÃ©ation de la palette</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap_magic</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
        <span class="c1"># On trace de champ du modÃ¨le moyenÃ© sur la pÃ©riode choisie</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">map2</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># On trace le modÃ¨le en fond</span>

        <span class="c1"># =====</span>
        <span class="n">msca</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">msca</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">mld_mod</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed plotting model data&#39;</span><span class="p">)</span>
        <span class="c1"># =====</span>
        <span class="c1"># Triangulation du modÃ¨le</span>
<span class="c1">#        import matplotlib.tri as tri</span>
<span class="c1">#        triang = tri.Triangulation(lons_mod, lats_mod)</span>
<span class="c1">#        # On trace le modÃ¨le en fond</span>
<span class="c1">#        mod = m.axes.tripcolor(triang, mld_mod, vmin=vmin, vmax=vmax, cmap=cmap)</span>
        <span class="c1"># =====</span>

        <span class="c1"># On trace les observations avec des points plus petits</span>
        <span class="n">psca</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">psca</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_pro</span><span class="p">,</span> <span class="n">lats_pro</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">mld_pro</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;profiles&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed plotting profiles data&#39;</span><span class="p">)</span>

        <span class="c1"># Colorbar</span>
        <span class="k">if</span> <span class="n">msca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar</span><span class="p">(</span><span class="n">msca</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar</span><span class="p">(</span><span class="n">psca</span><span class="p">)</span></div>


<div class="viewcode-block" id="Colocator.plot_ped_mod_on_pro"><a class="viewcode-back" href="../../../../library/data.misc.coloc.html#vacumm.data.misc.coloc.Colocator.plot_ped_mod_on_pro">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ped_mod_on_pro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot potential energy deficit of model data correspponding to profiles position</span>

<span class="sd">        :Params: See: :func:`coloc_mod_on_pro`</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Plotting PED of colocalized </span><span class="si">%s</span><span class="s1"> on </span><span class="si">%s</span><span class="se">\n</span><span class="s1">select: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">kwargs: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">profiles</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># Lecture des donnees de stratification</span>
        <span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">deps_mod</span><span class="p">,</span> <span class="n">temp_mod</span><span class="p">,</span> <span class="n">sal_mod</span><span class="p">,</span> <span class="n">pres_mod</span><span class="p">,</span> <span class="n">dens_mod</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">coloc_strat_mod_on_pro</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># Calcul ped modele</span>
        <span class="n">ddeps</span> <span class="o">=</span> <span class="n">meshweights</span><span class="p">(</span><span class="n">deps_mod</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># DensitÃ© moyenne</span>
        <span class="n">dmean</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dens_mod</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ddeps</span><span class="p">)</span>
        <span class="c1"># Anomalie de densitÃ©</span>
        <span class="n">danom</span> <span class="o">=</span> <span class="n">dens_mod</span><span class="o">-</span><span class="n">dmean</span>
        <span class="c1"># Ãnergie potentielle disponible</span>
        <span class="n">ape</span> <span class="o">=</span> <span class="n">danom</span> <span class="o">*</span> <span class="n">g</span>
        <span class="n">ape</span> <span class="o">*=</span> <span class="n">ddeps</span>
        <span class="c1"># Deficit</span>
        <span class="n">ped_mod</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">ape</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ddeps</span><span class="p">)</span>
        <span class="n">ped_mod</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;J.m^{-2}&#39;</span>
        <span class="n">ped_mod</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Definit d&#39;energie potentielle&quot;</span>
        <span class="n">ped_mod</span><span class="o">.</span><span class="n">setAxisList</span><span class="p">(</span><span class="n">lons_mod</span><span class="o">.</span><span class="n">getAxisList</span><span class="p">())</span>
        <span class="n">model</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;PED:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ped_mod</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># Calcul ped profiles</span>
        <span class="n">ped_pro</span><span class="p">,</span> <span class="n">lats_pro</span><span class="p">,</span> <span class="n">lons_pro</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">get_ped</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>
        <span class="n">profiles</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;PED:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ped_pro</span><span class="p">)</span>

        <span class="c1"># =====</span>
        <span class="c1"># TracÃ©s</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">ped_pro</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">ped_pro</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ped_mod</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ped_mod</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vmin</span><span class="p">)</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ped_mod</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No model data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;latitude&#39;</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
            <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="n">select</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">la</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_latitude</span><span class="p">()</span>
            <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">la</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;longitude&#39;</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
            <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="n">select</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_longitude</span><span class="p">()</span>
            <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lo</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">lo</span><span class="p">)</span>

        <span class="n">levels</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">((</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># CrÃ©ation de la palette</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap_magic</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
        <span class="c1"># On trace de champ du modÃ¨le moyenÃ© sur la pÃ©riode choisie</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">map2</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># On trace le modÃ¨le en fond</span>
        <span class="n">msca</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">msca</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_mod</span><span class="p">,</span> <span class="n">lats_mod</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">ped_mod</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed plotting model data&#39;</span><span class="p">)</span>
        <span class="c1"># On trace les observations avec des points plus petits</span>
        <span class="n">psca</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">psca</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_pro</span><span class="p">,</span> <span class="n">lats_pro</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">ped_pro</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;profiles&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed plotting profiles data&#39;</span><span class="p">)</span>

        <span class="c1"># Colorbar</span>
        <span class="k">if</span> <span class="n">msca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar</span><span class="p">(</span><span class="n">msca</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar</span><span class="p">(</span><span class="n">psca</span><span class="p">)</span></div></div>




</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../vacumm.html" >vacumm</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../../data.html" >vacumm.data</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>