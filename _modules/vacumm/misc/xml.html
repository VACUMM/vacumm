
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>vacumm.misc.xml &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="../../../_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" accesskey="U">vacumm</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vacumm.misc.xml</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Copyright or Â© or Copr. Actimar/IFREMER (2010-2015)</span>
<span class="c1">#</span>
<span class="c1"># This software is a computer program whose purpose is to provide</span>
<span class="c1"># utilities for handling oceanographic and atmospheric data,</span>
<span class="c1"># with the ultimate goal of validating the MARS model from IFREMER.</span>
<span class="c1">#</span>
<span class="c1"># This software is governed by the CeCILL license under French law and</span>
<span class="c1"># abiding by the rules of distribution of free software.  You can  use,</span>
<span class="c1"># modify and/ or redistribute the software under the terms of the CeCILL</span>
<span class="c1"># license as circulated by CEA, CNRS and INRIA at the following URL</span>
<span class="c1"># &quot;http://www.cecill.info&quot;.</span>
<span class="c1">#</span>
<span class="c1"># As a counterpart to the access to the source code and  rights to copy,</span>
<span class="c1"># modify and redistribute granted by the license, users are provided only</span>
<span class="c1"># with a limited warranty  and the software&#39;s author,  the holder of the</span>
<span class="c1"># economic rights,  and the successive licensors  have only  limited</span>
<span class="c1"># liability.</span>
<span class="c1">#</span>
<span class="c1"># In this respect, the user&#39;s attention is drawn to the risks associated</span>
<span class="c1"># with loading,  using,  modifying and/or developing or reproducing the</span>
<span class="c1"># software by the user in light of its specific status of free software,</span>
<span class="c1"># that may mean  that it is complicated to manipulate,  and  that  also</span>
<span class="c1"># therefore means  that it is reserved for developers  and  experienced</span>
<span class="c1"># professionals having in-depth computer knowledge. Users are therefore</span>
<span class="c1"># encouraged to load and test the software&#39;s suitability as regards their</span>
<span class="c1"># requirements in conditions enabling the security of their systems and/or</span>
<span class="c1"># data to be ensured and,  more generally, to use and operate it in the</span>
<span class="c1"># same conditions as regards security.</span>
<span class="c1">#</span>
<span class="c1"># The fact that you are presently reading this means that you have had</span>
<span class="c1"># knowledge of the CeCILL license and that you accept its terms.</span>
<span class="c1">#</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span> <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Jonathan Wilkins&#39;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s1">&#39;wilkins@actimar.fr&#39;</span>
<span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">**This module provides XML serialization/deserialization features.**</span>

<span class="s1">It is intented to provide a way to define python classes able to load/save data</span>
<span class="s1">from/to XML elements, strings or files. The idea is to make a close but non restrictive</span>
<span class="s1">link between XML and Python objects models with the least possible effort.</span>

<span class="s1">Below is an example to briefly introduce how to use this module.</span>
<span class="s1">This could be simplified because there are shortcuts for default type, values</span>
<span class="s1">and other stuff but we will be as explicit as possible to demonstrate how this</span>
<span class="s1">module work.</span>

<span class="s1">Suppose you have or want the following XML syntax:</span>

<span class="s1">.. code-block:: xml</span>

<span class="s1">    &lt;Report&gt;</span>
<span class="s1">        &lt;MapFigure showgrid=&quot;True&quot; output=&quot;meteo.png&quot;&gt;</span>
<span class="s1">            &lt;Title&gt;Temperature and Wind&lt;/Title&gt;</span>
<span class="s1">            &lt;BoundingBox lonmin=&quot;-10&quot; lonmax=&quot;10&quot; latmin=&quot;40&quot; latmax=&quot;60&quot;&gt;</span>
<span class="s1">            &lt;ColorBar levels=&quot;0,5,10,15,20,25,30&quot;/&gt;</span>
<span class="s1">            &lt;Data file=&quot;/path/to/data/file&quot; variable=&quot;temperature&quot;/&gt;</span>
<span class="s1">            &lt;Data file=&quot;/path/to/data/file&quot; variable=&quot;wind&quot; plot=&quot;windbarbs&quot;/&gt;</span>
<span class="s1">        &lt;/Map&gt;</span>
<span class="s1">    &lt;/Report&gt;</span>

<span class="s1">This can be serialized with the following python definitions:</span>

<span class="s1">.. code-block:: python</span>

<span class="s1">    class BoundingBox(XmlConfig):</span>
<span class="s1">        xml_attributes = {</span>
<span class="s1">            &#39;lonmin&#39;:{type:float, default:-180},</span>
<span class="s1">            &#39;lonmax&#39;:{type:float, default:180},</span>
<span class="s1">            &#39;latmin&#39;:{type:float, default:-90},</span>
<span class="s1">            &#39;latmax&#39;:{type:float, default:90},</span>
<span class="s1">        }</span>

<span class="s1">    def parseFloatList(floatListString):</span>
<span class="s1">        return map(float, floatListString.split(&#39;,&#39;))</span>

<span class="s1">    class ColorBar(XmlConfig):</span>
<span class="s1">        xml_attributes = {</span>
<span class="s1">            &#39;levels&#39;:{type:parseFloatList, default:[0, 10, 20, 30]},</span>
<span class="s1">        }</span>

<span class="s1">    class Data(XmlConfig):</span>
<span class="s1">        xml_attributes = {</span>
<span class="s1">            &#39;file&#39;:{type:unicode, default:None},</span>
<span class="s1">            &#39;variable&#39;:{type:unicode, default:None},</span>
<span class="s1">            &#39;plot&#39;:{type=unicode, default:&#39;fillcolor&#39;},</span>
<span class="s1">        }</span>

<span class="s1">    class MapFigure(XmlConfig):</span>
<span class="s1">        xml_attributes = {</span>
<span class="s1">            &#39;showgrid&#39;:{type:bool, default:False},</span>
<span class="s1">            &#39;temperature&#39;:{type:unicode, default:&#39;output.png&#39;},</span>
<span class="s1">        }</span>
<span class="s1">        xml_childnodes = {</span>
<span class="s1">            &#39;boundingBox&#39;:{&#39;type&#39;:BoundingBox, single:True},</span>
<span class="s1">            &#39;colorBar&#39;:{&#39;type&#39;:BoundingBox, single:True},</span>
<span class="s1">            &#39;data&#39;:{&#39;type&#39;:Data},</span>
<span class="s1">        }</span>
<span class="s1">        xml_textnodes = {</span>
<span class="s1">            &#39;title&#39;:{&#39;type&#39;:unicode, &#39;tagName&#39;:&#39;Title&#39;, single:True},</span>
<span class="s1">        }</span>

<span class="s1">    class Report(XmlConfig):</span>
<span class="s1">        xml_childnodes = {</span>
<span class="s1">            &#39;mapFigures&#39;:{type:MapFigure},</span>
<span class="s1">        }</span>

<span class="s1">To load a file &#39;report.xml&#39; containing the XML code above, you can either do:</span>

<span class="s1">.. code-block:: python</span>

<span class="s1">    r = Report()</span>
<span class="s1">    r.load_xml_file(&#39;report.xml&#39;)</span>

<span class="s1">or</span>

<span class="s1">.. code-block:: python</span>

<span class="s1">    r = Report.from_xml_file(&#39;report.xml&#39;)</span>

<span class="s1">To save a xml file from the loaded object above you can do:</span>

<span class="s1">.. code-block:: python</span>

<span class="s1">    r.save_xml_file(&#39;report.xml&#39;)</span>

<span class="s1">.. warning::</span>

<span class="s1">    * This module make use of xml.etree.ElementTree and works with python &gt;= 2.6.</span>
<span class="s1">    * Some XML functionnalities are not handled, there is no namespace</span>
<span class="s1">      support although namespaces can be ignored when loading XML data.</span>
<span class="s1">      When specifying an attribute name as &#39;namespace:name&#39; the namespace is ignored</span>
<span class="s1">      when loading but is kept when saving.</span>
<span class="s1">    * When loading a list of elements into a dictionnary (e.g. using an attribute value as key),</span>
<span class="s1">      the order will be kept if the module collections.OrderedDict is available (python &gt; 2.7)</span>

<span class="s1">&#39;&#39;&#39;</span>

<span class="c1">#__all__ = [&#39;XmlConfig&#39;, &#39;XmlConfigList&#39;, &#39;XmlConfigDict&#39;]</span>

<span class="kn">import</span> <span class="nn">codecs</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">urllib2</span>

<span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">xml.etree.cElementTree</span> <span class="k">as</span> <span class="nn">ElementTree</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ElementTree</span>


<span class="c1"># Debugging stuff</span>
<span class="n">_debug</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XML_DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="n">_debug_classes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XML_DEBUG_CLASS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;XML_DEBUG_CLASS&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="k">else</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pprint</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">o</span> <span class="ow">and</span> <span class="n">_debug_classes</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_debug_classes</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[XML </span><span class="si">%s</span><span class="s1">] </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span>
            <span class="n">o</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">m</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">dict</span><span class="p">))</span> <span class="k">else</span> <span class="n">aa</span> <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">a</span><span class="p">)))</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="log"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span> <span class="k">pass</span></div>
<span class="n">log</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Debugging log function&#39;&#39;&#39;</span>


<span class="c1"># Check presence of xml.dom.ext for pretty printing</span>
<span class="n">_xmldomext</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">xml.dom.ext.reader</span> <span class="k">import</span> <span class="n">Sax2</span>
    <span class="kn">from</span> <span class="nn">xml.dom.ext</span> <span class="k">import</span> <span class="n">PrettyPrint</span>
    <span class="n">_xmldomext</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>


<div class="viewcode-block" id="pretty_indent"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.pretty_indent">[docs]</a><span class="k">def</span> <span class="nf">pretty_indent</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Indent an ElementTree element avoiding extraneous spaces around node text.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">level</span><span class="o">*</span><span class="n">indent</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">indent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
            <span class="n">pretty_indent</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span></div>


<span class="c1"># Use ordered dicts when possible</span>
<span class="n">Dict</span> <span class="o">=</span> <span class="nb">dict</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
    <span class="n">Dict</span> <span class="o">=</span> <span class="n">OrderedDict</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">log</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="s1">&#39;collections not available: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>


<span class="n">_true</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>
<span class="n">_false</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">]</span>
<div class="viewcode-block" id="parse_bool"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.parse_bool">[docs]</a><span class="k">def</span> <span class="nf">parse_bool</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Boolean string parser, accepts:</span>
<span class="sd">        - %s as True</span>
<span class="sd">        - %s as False</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_true</span><span class="p">),</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_false</span><span class="p">))</span>
    <span class="n">_s</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">_true</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">_false</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not parse bool from string </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">_s</span><span class="p">)</span></div>


<span class="c1"># A &quot;do nothing&quot; function</span>
<span class="n">_emptyfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>


<div class="viewcode-block" id="register"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.register">[docs]</a><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Populate an object with data</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **obj**: the object to be manipulated</span>
<span class="sd">        - **attributes**, optional: dict, used with setattr on obj</span>
<span class="sd">        - **elements**, optional: list, used with obj.extend</span>
<span class="sd">        - **entries**, optional: dict, used with obj.update</span>

<span class="sd">    :Return: obj</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">elements</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">entries</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span></div>


<span class="k">class</span> <span class="nc">_no_default</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Type for representating a &#39;no default value&#39; to allow None as default value</span>
<span class="sd">    later in this code.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="usafe"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.usafe">[docs]</a><span class="k">def</span> <span class="nf">usafe</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return a unicode textual representation of the given object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">o</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">o</span></div>



<div class="viewcode-block" id="xml_element_name"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.xml_element_name">[docs]</a><span class="k">def</span> <span class="nf">xml_element_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Build an xml element name from the given name, this function returns a</span>
<span class="sd">    CamelCase name with any non alphanumeric characters omitted (eg. &#39;Class_A&#39;</span>
<span class="sd">    =&gt; &#39;ClassA&#39;, &#39;class_b&#39; =&gt; &#39;Classb&#39; and class_C =&gt; &#39;ClassC&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-1]+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span></div>


<span class="c1">#def xml_attribute_name(name):</span>
<span class="c1">#    name = xml_element_name(name)</span>
<span class="c1">#    return name[0].lower()+name[1:]</span>


<span class="c1">#def create_xml_document():</span>
<span class="c1">#    return ElementTree.ElementTree()</span>


<div class="viewcode-block" id="create_xml_element"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.create_xml_element">[docs]</a><span class="k">def</span> <span class="nf">create_xml_element</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">childnodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skipNone</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create an xml element with given attributes and children</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **name**: the element tag name</span>
<span class="sd">        - **attributes**, optional: dict of attributes name:value</span>
<span class="sd">        - **childnodes**, optional: list/tuple/dict of ElementTree.Element object</span>
<span class="sd">        - **skipNone**, optional: skip attributes which value is None</span>

<span class="sd">    :Return: a ElementTree.Element object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">elt</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">attrValue</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">attrValue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">skipNone</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">attrValue</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">attrValue</span><span class="p">,)</span>
            <span class="n">elt</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attrName</span><span class="p">,</span> <span class="n">attrValue</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">childnodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">childnodes</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">childnodes</span> <span class="o">=</span> <span class="p">(</span><span class="n">childnodes</span><span class="p">,)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">childnodes</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">childnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">elt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">childnodes</span><span class="p">:</span>
                <span class="n">elt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">elt</span></div>


<div class="viewcode-block" id="splitns"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.splitns">[docs]</a><span class="k">def</span> <span class="nf">splitns</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Split a &#39;namespace:name&#39; string into (&#39;namespace&#39;, &#39;name&#39;) or (None, &#39;name&#39;)</span>
<span class="sd">    if the name doesnt contains a namespace.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span></div>


<div class="viewcode-block" id="findchildren"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.findchildren">[docs]</a><span class="k">def</span> <span class="nf">findchildren</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find children of an element ignoring namespaces</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **elt**: element to search in</span>
<span class="sd">        - **name**: searched element tag name</span>

<span class="sd">    :Return: a generator on ElementTree.Element objects</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ns</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">splitns</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elt</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span> <span class="k">yield</span> <span class="n">e</span>
        <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">tag</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">:</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">tagname</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">#if ns and ns != namespace: continue</span>
            <span class="k">if</span> <span class="n">tagname</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span> <span class="k">yield</span> <span class="n">e</span></div>


<div class="viewcode-block" id="getattribute"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.getattribute">[docs]</a><span class="k">def</span> <span class="nf">getattribute</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the attribute value of an element ignoring namespaces</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **elt**: element to search in</span>
<span class="sd">        - **name**: searched attribute name</span>
<span class="sd">        - **default**, optional: default value when elt has no such attribute</span>

<span class="sd">    :Return: attribute value or default</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ns</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">splitns</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">an</span><span class="p">,</span> <span class="n">av</span> <span class="ow">in</span> <span class="n">elt</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">an</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span> <span class="k">return</span> <span class="n">av</span>
        <span class="k">elif</span> <span class="n">an</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">:</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">attname</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">#if ns and ns != namespace: continue</span>
            <span class="k">if</span> <span class="n">attname</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span> <span class="k">return</span> <span class="n">av</span>
    <span class="k">return</span> <span class="n">default</span></div>


<div class="viewcode-block" id="hasattribute"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.hasattribute">[docs]</a><span class="k">def</span> <span class="nf">hasattribute</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check the presence of an element attribute ignoring namespaces</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **elt**: element to search in</span>
<span class="sd">        - **name**: searched attribute name</span>

<span class="sd">    :Return: boolean</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">getattribute</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span></div>


<span class="c1"># Internal name of the flag used to track if an attribute was loaded from xml element</span>
<span class="n">__loaded_from_elt__</span> <span class="o">=</span> <span class="s1">&#39;__loaded_from_elt__&#39;</span>
<div class="viewcode-block" id="load_xml_attributes"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.load_xml_attributes">[docs]</a><span class="k">def</span> <span class="nf">load_xml_attributes</span><span class="p">(</span><span class="n">elt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Deserialize attributes from an element</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **elt**: element to search in</span>
<span class="sd">        - **attributes**: specification for attributes deserialization</span>
<span class="sd">            This may be either:</span>
<span class="sd">                - **a list of attribute names**</span>
<span class="sd">                - **a dict of attributes** {name:spec, ...} with name as a string and spec as:</span>
<span class="sd">                    - **a type function**</span>
<span class="sd">                    - **a list or tuple** (type function, default value)</span>
<span class="sd">                    - **a dict** {&#39;type&#39;:function, &#39;default&#39;:value}</span>
<span class="sd">        - **dst**: an object that will be populated with the attributes</span>
<span class="sd">        - **create**: whether to create attributes in dst with the default value when they are not in elt</span>

<span class="sd">    The type must be a callable taking the attribute value as single string argument and returning the converted value</span>
<span class="sd">    With no type function, attributes are loaded without modification (as string)</span>

<span class="sd">    :Return: dict of deserialized attributes</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">elt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">elt</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
<span class="c1"># load all attributes as raw data ? must be configurable</span>
<span class="c1">#    if attributes is None:</span>
<span class="c1">#        for a in elt.attrib.keys():</span>
<span class="c1">#            m[str(a)] = getattribute(elt, a)a)</span>
<span class="c1">#    elif isinstance(attributes, (list,tuple)):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hasattribute</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="n">m</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span> <span class="o">=</span> <span class="n">getattribute</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">create</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">dspec</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">nsa</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">ns</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">splitns</span><span class="p">(</span><span class="n">nsa</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dspec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">ddef</span> <span class="o">=</span> <span class="n">dspec</span><span class="p">[:]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dspec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">ddef</span> <span class="o">=</span> <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">ddef</span> <span class="o">=</span> <span class="n">dspec</span><span class="p">,</span> <span class="kc">None</span>
            <span class="c1">#if dtype is bool: dtype = parse_bool</span>
            <span class="n">log</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;load_xml_attributes processing &quot;</span><span class="si">%s</span><span class="s1">&quot; with spec </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">dspec</span><span class="p">)</span> <span class="c1">#####</span>
            <span class="k">if</span> <span class="n">hasattribute</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">nsa</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">m</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;parse&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_emptyfunc</span><span class="p">)(</span><span class="n">getattribute</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">nsa</span><span class="p">))</span>
                    <span class="n">dspec</span><span class="p">[</span><span class="n">__loaded_from_elt__</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;*** load_xml_attributes failed loading attribute &quot;</span><span class="si">%s</span><span class="s1">&quot; of element &quot;</span><span class="si">%s</span><span class="s1">&quot;: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">elt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="c1">#####</span>
                    <span class="k">if</span> <span class="n">create</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;*** load_xml_attributes setting default value for &quot;</span><span class="si">%s</span><span class="s1">&quot;: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">ddef</span><span class="p">)</span> <span class="c1">#####</span>
                        <span class="n">m</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ddef</span>
            <span class="k">elif</span> <span class="n">create</span> <span class="ow">and</span> <span class="n">dst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="n">m</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ddef</span>
    <span class="k">if</span> <span class="n">dst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">register</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span></div>


<div class="viewcode-block" id="load_xml_childnodes"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.load_xml_childnodes">[docs]</a><span class="k">def</span> <span class="nf">load_xml_childnodes</span><span class="p">(</span><span class="n">elt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">childnodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Deserialize children from an element</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **elt**: element to search in</span>
<span class="sd">        - **childnodes**: specification for children deserialization</span>
<span class="sd">            This must be a dict of **object attribute** {name:spec, ...} with name as a string and spec as:</span>
<span class="sd">                - **a type function**</span>
<span class="sd">                - **a list or tuple** (type function, default value)</span>
<span class="sd">                - **a dict with the entries**:</span>
<span class="sd">                    - **type**: a XmlConfig subclass</span>
<span class="sd">                    - **default**: default value, expected as instance or list or dict of XMlConfig object(s), depending on the single/key parameters</span>
<span class="sd">                    - **create**: whether to create the instance or list when there are no such children in elt</span>
<span class="sd">                    - **args**: positionnal arguments for XmlConfig children creation</span>
<span class="sd">                    - **kwargs**: named arguments for XmlConfig children creation</span>
<span class="sd">                    - **single**: whether we expect a single instance or a list of instance as result in dst (default is False). This may also be an integer specifying the child 0-based index.</span>
<span class="sd">                    - **self**: whether we want to register loaded children in dst as dict entries (default is False)</span>
<span class="sd">                    - **key**: which children attribute to use as key when loading with self=True</span>
<span class="sd">        - **dst**: an object that will be populated with the children</span>
<span class="sd">        - **create**: whether to create attributes in dst with the default value when they are not in elt</span>

<span class="sd">    The type must be a subclass of XmlConfig which will be used to deserialize the children elements</span>

<span class="sd">    :Return: a tuple (attributes, elements, entries) of the loaded data</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">elt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">elt</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">dst</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">attrs</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">entries</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(),</span> <span class="p">[],</span> <span class="n">Dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">dname</span><span class="p">,</span><span class="n">dspec</span> <span class="ow">in</span> <span class="n">childnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">dname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dspec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">ddef</span><span class="p">),</span> <span class="n">dcreate</span><span class="p">,</span> <span class="n">dargs</span><span class="p">,</span> <span class="n">dkwargs</span><span class="p">,</span> <span class="n">dsingle</span><span class="p">,</span> <span class="n">dself</span><span class="p">,</span> <span class="n">dkey</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">dspec</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{},</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dspec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">dtype</span><span class="p">,</span> <span class="n">ddef</span><span class="p">,</span> <span class="n">dcreate</span><span class="p">,</span> <span class="n">dargs</span><span class="p">,</span> <span class="n">dkwargs</span><span class="p">,</span> <span class="n">dsingle</span><span class="p">,</span> <span class="n">dself</span><span class="p">,</span> <span class="n">dkey</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">),</span> <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">_no_default</span><span class="p">),</span>
                <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="ow">not</span> <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span> <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="p">{}),</span>
                <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">dspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span><span class="p">,</span> <span class="n">ddef</span><span class="p">,</span> <span class="n">dcreate</span><span class="p">,</span> <span class="n">dargs</span><span class="p">,</span> <span class="n">dkwargs</span><span class="p">,</span> <span class="n">dsingle</span><span class="p">,</span> <span class="n">dself</span><span class="p">,</span> <span class="n">dkey</span> <span class="o">=</span> <span class="n">dspec</span><span class="p">,</span> <span class="n">_no_default</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{},</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dsingle</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="n">isingle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">dsingle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dsingle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span> <span class="n">dsingle</span><span class="p">,</span><span class="n">isingle</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">dsingle</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">isingle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dargs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span> <span class="n">dargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">dargs</span><span class="p">]</span>
        <span class="n">log</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;load_xml_childnodes processing &quot;</span><span class="si">%s</span><span class="s1">&quot; with spec </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dname</span><span class="p">,</span> <span class="n">dspec</span><span class="p">)</span> <span class="c1">#####</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[(</span><span class="n">getattribute</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">dkey</span><span class="p">)</span> <span class="k">if</span> <span class="n">dkey</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">findchildren</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">tag_name</span><span class="p">())]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dsingle</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">dname</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">from_xml_elt</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">isingle</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">dargs</span><span class="p">,</span> <span class="o">**</span><span class="n">dkwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">from_xml_elt</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">dargs</span><span class="p">,</span> <span class="o">**</span><span class="n">dkwargs</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dself</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dkey</span><span class="p">:</span> <span class="n">entries</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Dict</span><span class="p">(</span><span class="n">objs</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dkey</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">dname</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">dname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">dself</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ddef</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_no_default</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">dname</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddef</span>
            <span class="k">elif</span> <span class="n">create</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dcreate</span><span class="p">:</span>
                    <span class="c1"># Create default except when same class (avoid recursion)</span>
                    <span class="k">if</span> <span class="n">dsingle</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">dst</span><span class="p">)):</span>
                            <span class="nb">print</span> <span class="vm">__file__</span><span class="p">,</span><span class="s1">&#39;*** avoided recursion in creation of attribute &quot;</span><span class="si">%s</span><span class="s1">&quot; with type &quot;</span><span class="si">%s</span><span class="s1">&quot; on object with same type&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">dname</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">dname</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtype</span><span class="p">(</span><span class="o">*</span><span class="n">dargs</span><span class="p">,</span> <span class="o">**</span><span class="n">dkwargs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">dname</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">dkey</span> <span class="k">else</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dsingle</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">dname</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">dname</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">dkey</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">register</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span>
    <span class="n">log</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;load_xml_childnodes done:</span><span class="se">\n</span><span class="s1">  attributes: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">  elements: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">  entries: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span> <span class="c1">#####</span>
    <span class="k">return</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">entries</span></div>


<div class="viewcode-block" id="load_xml_textnodes"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.load_xml_textnodes">[docs]</a><span class="k">def</span> <span class="nf">load_xml_textnodes</span><span class="p">(</span><span class="n">elt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">textnodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xml_element_name</span><span class="o">=</span><span class="n">xml_element_name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Deserialize text node children from an element</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **elt**: element to search in</span>
<span class="sd">        - **textnodes**: specification for text node children deserialization</span>
<span class="sd">            This must be a dict of object attribute {name:spec, ...} with name as a string and spec as:</span>
<span class="sd">                - **the text nodes tag name**</span>
<span class="sd">                - **a list or tuple** (tag name, default value)</span>
<span class="sd">                - **a dict with the entries**:</span>
<span class="sd">                    - **tagName**: the text nodes tag name (default is the textnode name formatted by xml_element_name)</span>
<span class="sd">                    - **type**: a factory function taking the text node content as argument</span>
<span class="sd">                    - **default**: default value, expected as instance or list depending on the single parameter</span>
<span class="sd">                    - **args**: positionnal arguments for children creation</span>
<span class="sd">                    - **kwargs**: named arguments for children creation</span>
<span class="sd">                    - **single**: whether we expect a single instance or a list of instance as result in dst (default is False). This may also be an integer specifying the child 0-based index.</span>
<span class="sd">        - **dst**: an object that will be populated with the text node children</span>
<span class="sd">        - **create**: whether to create attributes in dst with the default value when they are not in elt</span>

<span class="sd">    The type must be a callable taking the text node value as single string argument and returning the converted value.</span>

<span class="sd">    With no type function, text nodes are loaded without modification (as string)</span>

<span class="sd">    :Return: None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">elt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">elt</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">dst</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">spec</span> <span class="ow">in</span> <span class="n">textnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">log</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;load_xml_textnodes processing &quot;</span><span class="si">%s</span><span class="s1">&quot; with spec </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span> <span class="c1">#####</span>
        <span class="n">tagName</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">single</span> <span class="o">=</span> <span class="n">xml_element_name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">_emptyfunc</span><span class="p">,</span> <span class="n">_no_default</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">tagName</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">spec</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">tagName</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">single</span> <span class="o">=</span> <span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tagName&#39;</span><span class="p">,</span> <span class="n">tagName</span><span class="p">),</span>
                <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">factory</span><span class="p">),</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">default</span><span class="p">),</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">single</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">spec</span><span class="p">:</span>
            <span class="n">tagName</span> <span class="o">=</span> <span class="n">spec</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">factory</span><span class="p">:</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">_emptyfunc</span>
        <span class="k">if</span> <span class="n">factory</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">parse_bool</span>
        <span class="k">if</span> <span class="n">single</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="n">isingle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">single</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">single</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span> <span class="n">single</span><span class="p">,</span><span class="n">isingle</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">single</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">isingle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">childElements</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">findchildren</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="n">tagName</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">childElements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">factory</span><span class="p">(</span><span class="n">childElements</span><span class="p">[</span><span class="n">isingle</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">childElements</span><span class="p">[</span><span class="n">isingle</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="n">factory</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">text</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">childElements</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_no_default</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">create</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">single</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">[])</span></div>


<span class="c1"># Internal name used to pass the xml element from XmlConfig.from_xml_elt to XmlConfig.__init__ through XmlConfigMetaClass.__call__</span>
<span class="n">__load_xml_elt__</span> <span class="o">=</span> <span class="s1">&#39;__load_xml_elt__&#39;</span>
<div class="viewcode-block" id="XmlConfigMetaClass"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfigMetaClass">[docs]</a><span class="k">class</span> <span class="nc">XmlConfigMetaClass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Metaclass used to pass the xml element from XmlConfig.from_xml_elt to</span>
<span class="sd">    XmlConfig.__init__. This allow XmlConfig descendants to use the loaded</span>
<span class="sd">    data in their __init__ straight after XmlConfig.__init__ have been called</span>

<span class="sd">    If your implementation already inherit from a metaclass based class, you may use the code at:</span>
<span class="sd">    http://code.activestate.com/recipes/204197-solving-the-metaclass-conflict/</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">__load_xml_elt__</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">__load_xml_elt__</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">o</span></div>


<div class="viewcode-block" id="XmlConfig"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig">[docs]</a><span class="k">class</span> <span class="nc">XmlConfig</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Base class for XML serializations/deserializations.</span>

<span class="sd">    Subclasses can define the following **class attributes** which define the serialization specifications:</span>
<span class="sd">        - **xml_tag_name**: The corresponding xml element name (default is the class name formatted by :meth:`xml_element_name`).</span>
<span class="sd">        - **xml_attributes**: Attribute specifications, see :func:`load_xml_attributes`</span>
<span class="sd">        - **xml_childnodes**: Children elements specifications, see :func:`load_xml_childnodes`</span>
<span class="sd">        - **xml_textnodes**: Text children elements specifications, see :func:`load_xml_textnodes`</span>

<span class="sd">    **These attributes can also be passed as named arguments to the constructor to extend or overwrite</span>
<span class="sd">    those declared in the class definition.**</span>

<span class="sd">    **XML attributes, childnodes and textnodes are stored in this instance (object) attributes.**</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">XmlConfigMetaClass</span>

    <span class="n">xml_tag_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">xml_attributes</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
    <span class="n">xml_childnodes</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
    <span class="n">xml_textnodes</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Can receive extra specification in kwargs with the same keys as the class special attributes</span>
<span class="sd">        (xml_tag_name, xml_attributes,xml_childnodes and xml_textnodes)</span>

<span class="sd">        kwargs can contain the **xml_create_attributes** flag specifying whether to initalize expected</span>
<span class="sd">        attributes/childnodes/textnodes with None/empty-list/empty-dict depending on specifications (default is True)</span>

<span class="sd">        Other parameters in kwargs are used as initialization values when they are known by (present in) the given in specifications</span>
<span class="sd">        (the order of processing is then attributes, childnodes, textnodes), the user is then responsible of the types of these initial values.</span>

<span class="sd">        This class also maintain the currently loaded/saved file if any, see set_current_file and get_current_file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__init__:</span><span class="se">\n</span><span class="s1">  args: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">  kwargs: </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="c1">#####</span>
        <span class="c1"># Attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span><span class="p">)</span>
        <span class="n">xml_attributes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xml_attributes&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xml_attributes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes_specs</span><span class="p">(</span><span class="n">xml_attributes</span><span class="p">))</span>
        <span class="c1"># Child nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes</span><span class="p">)</span>
        <span class="n">xml_childnodes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xml_childnodes&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xml_childnodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes_specs</span><span class="p">(</span><span class="n">xml_childnodes</span><span class="p">))</span>
        <span class="c1"># Text nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="p">)</span>
        <span class="n">xml_textnodes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xml_textnodes&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xml_textnodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes_specs</span><span class="p">(</span><span class="n">xml_textnodes</span><span class="p">))</span>
        <span class="c1"># Force creation of object attributes</span>
        <span class="c1"># TODO: create defaults only when they dont already exists or wont be created by load_xml_elt below</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xml_create_attributes&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">load_xml_attributes</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">load_xml_childnodes</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">load_xml_textnodes</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">xml_element_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_element_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nsa</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ns</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">splitns</span><span class="p">(</span><span class="n">nsa</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unsupported type </span><span class="si">%r</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> required&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unsupported type </span><span class="si">%r</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> required&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unsupported type </span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1"> required&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">t</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unsupported type </span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1"> required&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unsupported type </span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1"> required&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)))</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                                <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="o">**</span><span class="n">vv</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">t</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unsupported type </span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1"> required&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
        <span class="c1">#import pdb; pdb.set_trace()</span>
        <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__init__ done:</span><span class="se">\n</span><span class="s1">  xml_attributes: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">  xml_childnodes: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">  xml_textnodes: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="p">)</span> <span class="c1">#####</span>
        <span class="c1"># Check if we are created from factory function from_xml_elt, then load the element here,</span>
        <span class="c1"># allowing the implementation to use some loaded data in its __init__ constructor</span>
        <span class="n">e</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__load_xml_elt__</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_xml_elt</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__load_xml_elt__</span><span class="p">)</span>

    <span class="c1"># TODO: validate modifications using setattr; more actions needed for nested lists/dicts (for children)</span>
    <span class="c1">#def __setattr__(self, k, v):</span>

<div class="viewcode-block" id="XmlConfig.dict"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Wrapper to collections.OrderedDict if available, dict otherwise&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">Dict</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.xml_attributes_specs"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.xml_attributes_specs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">xml_attributes_specs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> <span class="c1"># copy=False has odd side effects depending on usages ... !</span>
        <span class="sd">&#39;&#39;&#39;Fix attrs as used internally&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span> <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">([(</span><span class="n">a</span><span class="p">,{})</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Invalid attributes specifications: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attrs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">spec</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">spec</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_bool</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;formatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="n">attrs</span></div>

<div class="viewcode-block" id="XmlConfig.xml_childnodes_specs"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.xml_childnodes_specs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">xml_childnodes_specs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">childnodes</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> <span class="c1"># copy=False has odd side effects depending on usages ... !</span>
        <span class="sd">&#39;&#39;&#39;Fix childnodes as used internally&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">childnodes</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span> <span class="n">childnodes</span> <span class="o">=</span> <span class="n">childnodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Invalid childnodes specifications: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">childnodes</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">spec</span> <span class="ow">in</span> <span class="n">childnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">spec</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">}</span>
            <span class="n">childnodes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="n">childnodes</span></div>

<div class="viewcode-block" id="XmlConfig.xml_textnodes_specs"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.xml_textnodes_specs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">xml_textnodes_specs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">textnodes</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> <span class="c1"># copy=False has odd side effects depending on usages ... !</span>
        <span class="sd">&#39;&#39;&#39;Fix textnodes as used internally&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">textnodes</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span> <span class="n">textnodes</span> <span class="o">=</span> <span class="n">textnodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Invalid textnodes specifications: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">textnodes</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">spec</span> <span class="ow">in</span> <span class="n">textnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">spec</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_bool</span>
            <span class="n">textnodes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="n">textnodes</span></div>

<div class="viewcode-block" id="XmlConfig.set_current_file"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.set_current_file">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the currently used xml file. This method automatically called when loading/saving xml file&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xml_current_file</span> <span class="o">=</span> <span class="n">f</span></div>

<div class="viewcode-block" id="XmlConfig.get_current_file"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.get_current_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the currently used xml file (from last load/save or manual set)&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;xml_current_file&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.tag_name"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.tag_name">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tag_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the xml element name for this class or instance.</span>
<span class="sd">        If cls.xml_tag_name is not set, return class name formatted by :func:`xml_element_name`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">xml_tag_name</span><span class="p">:</span> <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">xml_tag_name</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">xml_element_name</span><span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">cls</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.xml_element_name"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.xml_element_name">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">xml_element_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">xml_element_name</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.from_xml_doc"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.from_xml_doc">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml_doc</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Factory method instanciating from xml dom document.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_xml_elt</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">)</span> <span class="k">else</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.from_xml_file"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.from_xml_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Factory method instanciating from xml file.&#39;&#39;&#39;</span>
        <span class="n">log</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;from_xml_file &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="c1">#####</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_xml_doc</span><span class="p">(</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">set_current_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">o</span></div>

<div class="viewcode-block" id="XmlConfig.from_xml_str"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.from_xml_str">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml_str</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Factory method instanciating from xml string.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_xml_doc</span><span class="p">(</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.from_url"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.from_url">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Factory method instanciating from xml string returned by url.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_xml_str</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.from_xml_elt"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.from_xml_elt">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xml_elt</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Factory method instanciating from xml  element.&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">__load_xml_elt__</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">xmlmax</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="o">*</span><span class="mi">100</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xml</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">e</span><span class="p">)[:</span><span class="n">xmlmax</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">ee</span><span class="p">:</span> <span class="n">xml</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]&#39;</span><span class="o">%</span><span class="n">ee</span>
            <span class="k">raise</span> <span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s1">&#39;Failed to create </span><span class="si">%s</span><span class="s1"> from xml element:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">tb</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">o</span></div>

<div class="viewcode-block" id="XmlConfig.load_xml_doc"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.load_xml_doc">[docs]</a>    <span class="k">def</span> <span class="nf">load_xml_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Load from an ElementTree object&#39;&#39;&#39;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">)</span> <span class="k">else</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_xml_elt</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.load_xml_file"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.load_xml_file">[docs]</a>    <span class="k">def</span> <span class="nf">load_xml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Load from a file&#39;&#39;&#39;</span>
        <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;load_xml_file &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="c1">#####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_xml_doc</span><span class="p">(</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_current_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.load_xml_str"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.load_xml_str">[docs]</a>    <span class="k">def</span> <span class="nf">load_xml_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Load from a string&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_xml_doc</span><span class="p">(</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.load_xml_elt"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.load_xml_elt">[docs]</a>    <span class="k">def</span> <span class="nf">load_xml_elt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Load configurations from an xml element.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__load_xml_elt__</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pre_load_xml</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
        <span class="n">load_xml_attributes</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">load_xml_childnodes</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">load_xml_textnodes</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">xml_element_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_element_name</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;load_xml_elt done:</span><span class="se">\n</span><span class="s1">  elt: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">  args: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">  kwargs: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">  vars:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="c1">#####</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__load_xml_elt__</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">post_load_xml</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.pre_load_xml"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.pre_load_xml">[docs]</a>    <span class="k">def</span> <span class="nf">pre_load_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called before load_xml_elt is executed&#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="XmlConfig.post_load_xml"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.post_load_xml">[docs]</a>    <span class="k">def</span> <span class="nf">post_load_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called after load_xml_elt is executed&#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="XmlConfig.to_xml_elt"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.to_xml_elt">[docs]</a>    <span class="k">def</span> <span class="nf">to_xml_elt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dump object to an xml element.&#39;&#39;&#39;</span>
        <span class="n">dumpnonloaded</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dumpnonloaded&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># can be overriden in attr spec</span>
        <span class="n">dumpdefault</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dumpdefault&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># can be overriden in attr spec</span>
        <span class="c1"># Attributes</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">nsa</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">ns</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">splitns</span><span class="p">(</span><span class="n">nsa</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">__loaded_from_elt__</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dumpnonloaded&#39;</span><span class="p">,</span> <span class="n">dumpnonloaded</span><span class="p">)):</span> <span class="k">continue</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">d</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dumpdefault&#39;</span><span class="p">,</span> <span class="n">dumpdefault</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;formatter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="c1">#attributes[&#39;{%s}%s&#39;%(ns,a) if ns else a] = usafe(v)</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">ns</span> <span class="k">else</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">usafe</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">childnodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Text nodes</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span> <span class="n">spec</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">tagName</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tagName&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_element_name</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;formatter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">tagName</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">usafe</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">childnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;List of textnodes values expected for </span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> (spec: </span><span class="si">%r</span><span class="s1">), got </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag_name</span><span class="p">(),</span> <span class="n">name</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">f</span><span class="p">:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">tagName</span><span class="p">)</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">usafe</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">childnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="c1"># Child nodes</span>
        <span class="k">for</span> <span class="n">child</span><span class="p">,</span><span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_childnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">tmpchildnodes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;to_xml_elt</span><span class="se">\n</span><span class="s1">  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="c1">#####</span>
            <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">to_xml_elt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]):</span>
                            <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span> <span class="n">usafe</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                        <span class="n">tmpchildnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmpchildnodes</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">o</span><span class="o">.</span><span class="n">to_xml_elt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1">#print self, child, getattr(self, child)</span>
                        <span class="n">tmpchildnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span><span class="o">.</span><span class="n">to_xml_elt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                            <span class="n">e</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">to_xml_elt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]):</span>
                                <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span>
                            <span class="n">tmpchildnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1">#print self, child, spec, getattr(self, child), kwargs</span>
                        <span class="n">tmpchildnodes</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">o</span><span class="o">.</span><span class="n">to_xml_elt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">)))</span>
            <span class="c1"># Exclude empty nodes (no attributes and no child)</span>
            <span class="n">childnodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tmpchildnodes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">create_xml_element</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag_name</span><span class="p">(),</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">,</span> <span class="n">childnodes</span><span class="o">=</span><span class="n">childnodes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.to_xml_doc"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.to_xml_doc">[docs]</a>    <span class="k">def</span> <span class="nf">to_xml_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dump object to an ElementTree&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_xml_elt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="XmlConfig.to_xml_stream"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.to_xml_stream">[docs]</a>    <span class="k">def</span> <span class="nf">to_xml_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dump object to a file object like stream.&#39;&#39;&#39;</span>
        <span class="n">close</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">close</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">_xmldomext</span><span class="p">:</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_xml_elt</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pretty</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_xmldomext</span><span class="p">:</span>
                    <span class="n">PrettyPrint</span><span class="p">(</span><span class="n">Sax2</span><span class="o">.</span><span class="n">Reader</span><span class="p">()</span><span class="o">.</span><span class="n">fromString</span><span class="p">(</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span>
                        <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">preserveElements</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
<span class="c1">#                    minidom.parseString(</span>
<span class="c1">#                        ElementTree.tostring(e)).writexml(</span>
<span class="c1">#                            stream, addindent=indent, newl=&#39;\n&#39;)</span>
                    <span class="n">pretty_indent</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="c1">#d.write(stream, xml_declaration=True, method=&quot;xml&quot;)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;xml&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">close</span><span class="p">:</span> <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">e</span></div>

<div class="viewcode-block" id="XmlConfig.to_xml_str"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.to_xml_str">[docs]</a>    <span class="k">def</span> <span class="nf">to_xml_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dump object to a xml string.&#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">StringIO</span> <span class="k">import</span> <span class="n">StringIO</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_xml_stream</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span></div>

<div class="viewcode-block" id="XmlConfig.to_xml_file"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.to_xml_file">[docs]</a>    <span class="k">def</span> <span class="nf">to_xml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dump object to a xml file.&#39;&#39;&#39;</span>
        <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;to_xml_file &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="c1">#####</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_xml_stream</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_current_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">e</span></div>

<div class="viewcode-block" id="XmlConfig.to_obj"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.to_obj">[docs]</a>    <span class="k">def</span> <span class="nf">to_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="c1">#def to_obj(self, obj=None):</span>
        <span class="k">def</span> <span class="nf">to_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">XmlConfig</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">xml_attributes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;formatter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">f</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">xml_childnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                            <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span><span class="n">vv</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                <span class="n">dd</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="o">=</span> <span class="n">vv</span><span class="o">.</span><span class="n">to_obj</span><span class="p">()</span>
                            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;__items__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dd</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">to_obj</span><span class="p">())</span>
                            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;__items__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
                    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                                <span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">to_obj</span><span class="p">()</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                                    <span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">kk</span><span class="p">,</span> <span class="n">vv</span><span class="o">.</span><span class="n">to_obj</span><span class="p">())</span> <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">vv</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">vv</span><span class="o">.</span><span class="n">to_obj</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;formatter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">f</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">to_obj</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(((</span><span class="n">k</span><span class="p">,</span><span class="n">to_obj</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()))</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="n">to_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="XmlConfig.set_obj"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfig.set_obj">[docs]</a>    <span class="k">def</span> <span class="nf">set_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">](</span><span class="n">v</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="c1"># TODO: childnodes ?</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_textnodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">](</span><span class="n">v</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div></div>


<span class="c1">#    # test method to validate to_obj</span>
<span class="c1">#    def to_obj_to_json(self):</span>
<span class="c1">#        import pprint</span>
<span class="c1">#        obj = self.to_obj()</span>
<span class="c1">#        print pprint.pformat(obj, indent=2)</span>
<span class="c1">#        import json</span>
<span class="c1">#        return json.JSONEncoder(sort_keys=True, indent=4).encode(obj)</span>

<span class="c1"># Need update for textnodes (at least..:)</span>
<span class="c1">#    def to_json(self):</span>
<span class="c1">#        import json</span>
<span class="c1">#        class JSONEncoder(json.JSONEncoder):</span>
<span class="c1">#            def default(self, obj):</span>
<span class="c1">#                if isinstance(obj, XmlConfig):</span>
<span class="c1">#                    d = dict(((a, getattr(obj, a)) for a in obj.xml_attributes.iterkeys() if hasattr(obj, a)))</span>
<span class="c1">#                    for a,v in obj.xml_childnodes.iteritems():</span>
<span class="c1">#                        if v.get(&#39;self&#39;, None):</span>
<span class="c1">#                            if v.get(&#39;key&#39;, None):</span>
<span class="c1">#                                dd = {}</span>
<span class="c1">#                                for aa,vv in obj.iteritems():</span>
<span class="c1">#                                    dd[aa] = self.default(vv)</span>
<span class="c1">#                                d[&#39;__items__&#39;] = dd</span>
<span class="c1">#                            else:</span>
<span class="c1">#                                l = []</span>
<span class="c1">#                                for vv in obj:</span>
<span class="c1">#                                    l.append(self.default(vv))</span>
<span class="c1">#                                d[&#39;__items__&#39;] = l</span>
<span class="c1">#                        elif hasattr(obj, a):</span>
<span class="c1">#                            d[a] = self.default(getattr(obj, a))</span>
<span class="c1">#                    return d</span>
<span class="c1">#                #return json.JSONEncoder.default(self, obj)</span>
<span class="c1">#                return obj</span>
<span class="c1">#        return JSONEncoder(sort_keys=True, indent=4).encode(self)</span>


<div class="viewcode-block" id="XmlConfigList"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfigList">[docs]</a><span class="k">class</span> <span class="nc">XmlConfigList</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">XmlConfig</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convenient class inheriting list and XmlConfig&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">XmlConfig</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="XmlConfigDict"><a class="viewcode-back" href="../../../library/misc.xml.html#vacumm.misc.xml.XmlConfigDict">[docs]</a><span class="k">class</span> <span class="nc">XmlConfigDict</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="n">XmlConfig</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convenient class inheriting Dict and XmlConfig to avoid metaclasses conflict when Dict is collections.OrderedDict&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="s1">&#39;__metaclass__&#39;</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">XmlConfigDictMeta</span><span class="p">(</span><span class="n">Dict</span><span class="o">.</span><span class="n">__metaclass__</span><span class="p">,</span> <span class="n">XmlConfig</span><span class="o">.</span><span class="n">__metaclass__</span><span class="p">):</span> <span class="k">pass</span>
        <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">XmlConfigDictMeta</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">XmlConfig</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_test</span><span class="p">():</span>
    <span class="nb">print</span> <span class="s1">&#39; TEST XML &#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">SKlass</span><span class="p">(</span><span class="n">XmlConfig</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">class</span> <span class="nc">Klass</span><span class="p">(</span><span class="n">XmlConfig</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">XmlConfig</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">xml_attributes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">([</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,(</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;default&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s1">&#39;boolean&#39;</span><span class="p">,(</span><span class="nb">bool</span><span class="p">,</span><span class="kc">False</span><span class="p">)),</span>
                <span class="p">]),</span>
                <span class="n">xml_childnodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">([</span>
                    <span class="p">(</span><span class="s1">&#39;childnodes&#39;</span><span class="p">,{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">Klass</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}),</span>
                    <span class="p">(</span><span class="s1">&#39;single_childnode&#39;</span><span class="p">,{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">SKlass</span><span class="p">,</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}),</span>
                <span class="p">]),</span>
                <span class="n">xml_textnodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">([</span>
                    <span class="p">(</span><span class="s1">&#39;textnode1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;single&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}),</span>
                    <span class="p">(</span><span class="s1">&#39;textnodes&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="p">]),</span>
            <span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;Klass&gt;</span>
<span class="s1">    &lt;Klass name=&quot;a&quot;/&gt;</span>
<span class="s1">    &lt;Klass name=&quot;b&quot; boolean=&quot;true&quot;/&gt;</span>
<span class="s1">    &lt;SKlass/&gt;</span>
<span class="s1">    &lt;Textnode1&gt;textnode1&lt;/Textnode1&gt;</span>
<span class="s1">    &lt;Textnodes&gt;text1&lt;/Textnodes&gt;</span>
<span class="s1">    &lt;Textnodes&gt;text2&lt;/Textnodes&gt;</span>
<span class="s1">&lt;/Klass&gt;</span>
<span class="s1">    &#39;&#39;&#39;</span>
    <span class="nb">print</span> <span class="s1">&#39; xml &#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">x</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">Klass</span><span class="o">.</span><span class="n">from_xml_str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39; object from_xml_str </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)))</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-20s</span><span class="s1"> : </span><span class="si">%-20s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;xml_&#39;</span><span class="p">))</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39; object to_xml_str </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)))</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">o</span><span class="o">.</span><span class="n">to_xml_str</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39; object to_obj </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)))</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">pprint</span>
    <span class="nb">print</span> <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">to_obj</span><span class="p">())</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39; object from_xml_str(to_xml_str).to_xml_str </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)))</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">Klass</span><span class="o">.</span><span class="n">from_xml_str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">to_xml_str</span><span class="p">())</span><span class="o">.</span><span class="n">to_xml_str</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">_test</span><span class="p">()</span>


</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" >vacumm</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>