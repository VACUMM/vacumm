
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>vacumm.misc.misc &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="../../../_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" accesskey="U">vacumm</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vacumm.misc.misc</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Misc tools</span>

<span class="sd">.. note::</span>
<span class="sd">    You can import it directly for example like this::</span>

<span class="sd">    &gt;&gt;&gt; from vacumm.misc import auto_scale</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Copyright or Â© or Copr. Actimar/IFREMER (2010-2017)</span>
<span class="c1">#</span>
<span class="c1"># This software is a computer program whose purpose is to provide</span>
<span class="c1"># utilities for handling oceanographic and atmospheric data,</span>
<span class="c1"># with the ultimate goal of validating the MARS model from IFREMER.</span>
<span class="c1">#</span>
<span class="c1"># This software is governed by the CeCILL license under French law and</span>
<span class="c1"># abiding by the rules of distribution of free software.  You can  use,</span>
<span class="c1"># modify and/ or redistribute the software under the terms of the CeCILL</span>
<span class="c1"># license as circulated by CEA, CNRS and INRIA at the following URL</span>
<span class="c1"># &quot;http://www.cecill.info&quot;.</span>
<span class="c1">#</span>
<span class="c1"># As a counterpart to the access to the source code and  rights to copy,</span>
<span class="c1"># modify and redistribute granted by the license, users are provided only</span>
<span class="c1"># with a limited warranty  and the software&#39;s author,  the holder of the</span>
<span class="c1"># economic rights,  and the successive licensors  have only  limited</span>
<span class="c1"># liability.</span>
<span class="c1">#</span>
<span class="c1"># In this respect, the user&#39;s attention is drawn to the risks associated</span>
<span class="c1"># with loading,  using,  modifying and/or developing or reproducing the</span>
<span class="c1"># software by the user in light of its specific status of free software,</span>
<span class="c1"># that may mean  that it is complicated to manipulate,  and  that  also</span>
<span class="c1"># therefore means  that it is reserved for developers  and  experienced</span>
<span class="c1"># professionals having in-depth computer knowledge. Users are therefore</span>
<span class="c1"># encouraged to load and test the software&#39;s suitability as regards their</span>
<span class="c1"># requirements in conditions enabling the security of their systems and/or</span>
<span class="c1"># data to be ensured and,  more generally, to use and operate it in the</span>
<span class="c1"># same conditions as regards security.</span>
<span class="c1">#</span>
<span class="c1"># The fact that you are presently reading this means that you have had</span>
<span class="c1"># knowledge of the CeCILL license and that you accept its terms.</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">cycle</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="k">import</span> <span class="n">IntType</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">,</span> <span class="n">LongType</span><span class="p">,</span> <span class="n">ComplexType</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">N</span><span class="o">,</span> <span class="nn">MV2</span><span class="o">,</span> <span class="nn">cdms2</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">MV2</span> <span class="k">import</span> <span class="n">nomask</span>
<span class="kn">from</span> <span class="nn">cdms2</span> <span class="k">import</span> <span class="n">createAxis</span><span class="p">,</span> <span class="n">isVariable</span>
<span class="kn">from</span> <span class="nn">genutil</span> <span class="k">import</span> <span class="n">grower</span><span class="p">,</span> <span class="n">minmax</span>
<span class="kn">from</span> <span class="nn">configobj</span> <span class="k">import</span> <span class="n">ConfigObj</span><span class="p">,</span> <span class="n">Section</span>

<span class="kn">from</span> <span class="nn">..__init__</span> <span class="k">import</span> <span class="n">VACUMMError</span>


<span class="n">MV</span> <span class="o">=</span> <span class="n">MV2</span>
<span class="n">MA</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ismasked&#39;</span><span class="p">,</span> <span class="s1">&#39;bound_ops&#39;</span><span class="p">,</span> <span class="s1">&#39;auto_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;basic_auto_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;geo_scale&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_atts&#39;</span><span class="p">,</span> <span class="s1">&#39;cp_atts&#39;</span><span class="p">,</span> <span class="s1">&#39;set_atts&#39;</span><span class="p">,</span> <span class="s1">&#39;check_def_atts&#39;</span><span class="p">,</span> <span class="s1">&#39;iterable&#39;</span><span class="p">,</span> <span class="s1">&#39;isnumber&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rm_html_tags&#39;</span><span class="p">,</span> <span class="s1">&#39;deg2str&#39;</span><span class="p">,</span> <span class="s1">&#39;lonlab&#39;</span><span class="p">,</span> <span class="s1">&#39;latlab&#39;</span><span class="p">,</span> <span class="s1">&#39;deplab&#39;</span><span class="p">,</span> <span class="s1">&#39;deg_from_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;kwfilter&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dict_filter&#39;</span><span class="p">,</span><span class="s1">&#39;dict_aliases&#39;</span><span class="p">,</span> <span class="s1">&#39;dict_merge&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_nan&#39;</span><span class="p">,</span> <span class="s1">&#39;write_ascii_time1d&#39;</span><span class="p">,</span> <span class="s1">&#39;xls_style&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FileTree&#39;</span><span class="p">,</span> <span class="s1">&#39;geodir&#39;</span><span class="p">,</span> <span class="s1">&#39;main_geodir&#39;</span><span class="p">,</span> <span class="s1">&#39;intersect&#39;</span><span class="p">,</span> <span class="s1">&#39;Att&#39;</span><span class="p">,</span> <span class="s1">&#39;broadcast&#39;</span><span class="p">,</span> <span class="s1">&#39;makeiter&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_svn_revision&#39;</span><span class="p">,</span> <span class="s1">&#39;dirsize&#39;</span><span class="p">,</span> <span class="s1">&#39;Cfg2Att&#39;</span><span class="p">,</span> <span class="s1">&#39;closeto&#39;</span><span class="p">,</span> <span class="s1">&#39;cp_props&#39;</span><span class="p">,</span>
    <span class="s1">&#39;zoombox&#39;</span><span class="p">,</span><span class="s1">&#39;scalebox&#39;</span><span class="p">,</span><span class="s1">&#39;history&#39;</span><span class="p">,</span> <span class="s1">&#39;dict_check_defaults&#39;</span><span class="p">,</span> <span class="s1">&#39;is_iterable&#39;</span><span class="p">,</span> <span class="s1">&#39;squarebox&#39;</span><span class="p">,</span>
    <span class="s1">&#39;grow_variables&#39;</span><span class="p">,</span> <span class="s1">&#39;grow_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;grow_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;phaselab&#39;</span><span class="p">,</span> <span class="s1">&#39;ArgTuple&#39;</span><span class="p">,</span>
    <span class="s1">&#39;create_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;selector2str&#39;</span><span class="p">,</span> <span class="s1">&#39;split_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;squeeze_variable&#39;</span><span class="p">,</span> <span class="s1">&#39;dict_copy_items&#39;</span><span class="p">,</span>
    <span class="s2">&quot;N_choose&quot;</span><span class="p">,</span> <span class="s1">&#39;MV2_concatenate&#39;</span><span class="p">,</span> <span class="s1">&#39;MV2_axisConcatenate&#39;</span><span class="p">,</span> <span class="s1">&#39;ArgList&#39;</span><span class="p">,</span>
    <span class="s1">&#39;set_lang&#39;</span><span class="p">,</span><span class="s1">&#39;set_lang_fr&#39;</span><span class="p">,</span> <span class="s1">&#39;lunique&#39;</span><span class="p">,</span> <span class="s1">&#39;tunique&#39;</span><span class="p">,</span> <span class="s1">&#39;numod&#39;</span><span class="p">,</span> <span class="s1">&#39;dict_filter_out&#39;</span><span class="p">,</span>
    <span class="s1">&#39;kwfilterout&#39;</span><span class="p">,</span> <span class="s1">&#39;filter_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;isempty&#39;</span><span class="p">,</span> <span class="s1">&#39;checkdir&#39;</span><span class="p">,</span> <span class="s1">&#39;splitidx&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CaseChecker&#39;</span><span class="p">,</span> <span class="s1">&#39;check_case&#39;</span><span class="p">,</span> <span class="s1">&#39;indices2slices&#39;</span><span class="p">,</span> <span class="s1">&#39;filter_level_selector&#39;</span><span class="p">,</span>
    <span class="s1">&#39;match_atts&#39;</span><span class="p">,</span> <span class="s1">&#39;match_string&#39;</span><span class="p">,</span> <span class="s1">&#39;dicttree_get&#39;</span><span class="p">,</span> <span class="s1">&#39;dicttree_set&#39;</span><span class="p">,</span>
    <span class="s1">&#39;minbox&#39;</span><span class="p">,</span> <span class="s1">&#39;bivariate_normal&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_format_string&#39;</span><span class="p">]</span>
<span class="n">__all__</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<div class="viewcode-block" id="broadcast"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.broadcast">[docs]</a><span class="k">def</span> <span class="nf">broadcast</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Broadcast ``set`` to the specified length ``n``</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **set**: A single element or a sequence.</span>
<span class="sd">        - **n**: Final requested length.</span>
<span class="sd">        - **mode**, optional: Filling mode.</span>

<span class="sd">            - ``&quot;last&quot;``: Use the last element.</span>
<span class="sd">            - ``&quot;first&quot;``: Use the first element.</span>
<span class="sd">            - ``&quot;cycle&quot;``: Cycle through set.</span>
<span class="sd">            - if ``fillvalue`` is passed as a keyword, it is used to fill.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; broadcast([2,4], 5)</span>
<span class="sd">        &gt;&gt;&gt; broadcast(5, 4)</span>
<span class="sd">        &gt;&gt;&gt; broadcast((2,3), 3)</span>
<span class="sd">        &gt;&gt;&gt; broadcast((2,3), 3, mode=&#39;first&#39;)</span>
<span class="sd">        &gt;&gt;&gt; broadcast([2,3], 3, mode=&#39;value&#39;, fillvalue=999)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">set</span> <span class="o">=</span> <span class="n">makeiter</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">):</span> <span class="k">return</span> <span class="nb">set</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;fillvalue&#39;</span><span class="p">):</span>
        <span class="n">fillvalue</span> <span class="o">=</span> <span class="n">makeiter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fillvalue&#39;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;cycle&#39;</span><span class="p">:</span>
        <span class="n">fillvalue</span> <span class="o">=</span> <span class="nb">set</span>
    <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;first&#39;</span><span class="p">:</span>
        <span class="n">fillvalue</span> <span class="o">=</span> <span class="nb">set</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fillvalue</span> <span class="o">=</span> <span class="nb">set</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">filliter</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">fillvalue</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">)):</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filliter</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>

<div class="viewcode-block" id="makeiter"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.makeiter">[docs]</a><span class="k">def</span> <span class="nf">makeiter</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make var iterable as a list if not ietrable or a string&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="fm">__len__</span><span class="p">)</span> <span class="ow">or</span> \
        <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;__getslice__&#39;</span><span class="p">):</span>
        <span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">var</span></div>

<div class="viewcode-block" id="Att"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.Att">[docs]</a><span class="k">class</span> <span class="nc">Att</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to create a dictionnary and access and set keys as attributes.</span>

<span class="sd">    You initialize and manage it as using :class:`dict`.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; dd = Att(toto=3)</span>
<span class="sd">        &gt;&gt;&gt; print dd[&#39;toto&#39;]</span>
<span class="sd">        3</span>
<span class="sd">        &gt;&gt;&gt; print dd.toto</span>
<span class="sd">        3</span>
<span class="sd">        &gt;&gt;&gt; dd.toto = 5</span>
<span class="sd">        &gt;&gt;&gt; print dd[&#39;toto&#39;]</span>
<span class="sd">        5</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">att</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="Cfg2Att"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.Cfg2Att">[docs]</a><span class="k">def</span> <span class="nf">Cfg2Att</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a :class:`~configobj.ConfigObj` object to an arborescence of :class:`~vacumm.misc.misc.Att` objects&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">configobj</span> <span class="k">import</span> <span class="n">ConfigObj</span><span class="p">,</span> <span class="n">Section</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">Att</span><span class="p">):</span> <span class="k">return</span> <span class="n">cfg</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="p">(</span><span class="n">Section</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)),</span> <span class="s1">&#39;You must pass a ConfigObj object&#39;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">Att</span><span class="p">()</span>
    <span class="n">a</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">sec</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">a</span><span class="p">[</span><span class="n">sec</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cfg2Att</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">sec</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">a</span></div>



<div class="viewcode-block" id="ismasked"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.ismasked">[docs]</a><span class="k">def</span> <span class="nf">ismasked</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="n">nomask</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="n">MA</span><span class="o">.</span><span class="n">nomask</span></div>


<div class="viewcode-block" id="bound_ops"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.bound_ops">[docs]</a><span class="k">def</span> <span class="nf">bound_ops</span><span class="p">(</span><span class="n">bounds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get operators that must be used for checking inclusion within boundaries.</span>
<span class="sd">    Returned operators (ops) must be used in the following way to return True if value is inside bounds:</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **bounds**: Boundary closing indicator (like &#39;co&#39;)</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; ops[0](value,lower_bound)</span>
<span class="sd">        &gt;&gt;&gt; ops[1](value,upper_bound)</span>

<span class="sd">    :Return:</span>

<span class="sd">        A 2-element tuple of operators taken within (operator.ge,operator.gt,operator.le,operator.lt).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
        <span class="n">ops</span> <span class="o">+=</span> <span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ops</span> <span class="o">+=</span> <span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">ops</span></div>


<div class="viewcode-block" id="auto_scale"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.auto_scale">[docs]</a><span class="k">def</span> <span class="nf">auto_scale</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nmax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">vmin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">separators</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fractions</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">symetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">keepminmax</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes levels according to a dataset and its range of values. Locators are on a 10-base. Different scaling can be used with this version.</span>

<span class="sd">    :Params:</span>

<span class="sd">    - **data**: The dataset</span>
<span class="sd">    - **vmax**, optional: Replaces max(data)</span>
<span class="sd">    - **vmin**, optional:   //   min(data)</span>
<span class="sd">    - **symetric**, optional: min_value and max_value are made symetric with respect to zero [default: False]</span>
<span class="sd">    - **nmax**, optional:  Maximal number of levels</span>
<span class="sd">    - **separators**, optional: Subdivision for irregular levels</span>
<span class="sd">    - **fractions**, optional: Consider separators as fractions (]0.,1.[)</span>
<span class="sd">    - **steps**, optional: Base 10 steps for finding levels [default: [1,2,2.5,5,10]]</span>
<span class="sd">    - **geo**, optional: Treat levels as geographical degrees [default: False]</span>
<span class="sd">    - Other parameters are given to MaxNLocator</span>

<span class="sd">    :Return:</span>

<span class="sd">        Array of levels</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`basic_auto_scale` :func:`geo_scale`</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_value&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_value&#39;</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span> \
        <span class="s1">&#39;If data is not given, you must pass vmin and vmax as keywords&#39;</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">minv</span><span class="p">,</span><span class="n">maxv</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">minv</span><span class="p">,</span><span class="n">maxv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minv</span> <span class="o">=</span> <span class="n">vmin</span>
    <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxv</span> <span class="o">=</span> <span class="n">vmax</span>

    <span class="k">if</span> <span class="n">symetric</span><span class="p">:</span>
        <span class="n">maxv</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">maxv</span><span class="p">),</span><span class="nb">abs</span><span class="p">(</span><span class="n">minv</span><span class="p">)])</span>
        <span class="n">minv</span> <span class="o">=</span> <span class="o">-</span><span class="n">maxv</span>

    <span class="k">if</span> <span class="n">nmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">nmax</span> <span class="o">=</span> <span class="mi">7</span>

    <span class="k">if</span> <span class="n">separators</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">basic_auto_scale</span><span class="p">(</span><span class="n">minv</span><span class="p">,</span><span class="n">maxv</span><span class="p">,</span><span class="n">nmax</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">separators</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">separators</span> <span class="o">=</span> <span class="p">[</span><span class="n">separators</span><span class="p">,]</span>
        <span class="n">nsep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">separators</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fractions</span><span class="p">:</span>
            <span class="n">relsep</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">separators</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
                    <span class="n">relsep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minv</span><span class="o">+</span><span class="p">(</span><span class="n">maxv</span><span class="o">-</span><span class="n">minv</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">separators</span> <span class="o">=</span> <span class="n">relsep</span>

        <span class="n">nint</span> <span class="o">=</span> <span class="n">nsep</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nmax_sep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nint</span><span class="p">))</span>
        <span class="n">separators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">minv</span><span class="p">)</span>
        <span class="n">separators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maxv</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nint</span><span class="p">):</span>
            <span class="n">these_levels</span> <span class="o">=</span> <span class="n">basic_auto_scale</span><span class="p">(</span><span class="n">separators</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                       <span class="n">separators</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">nmax_sep</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">levels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">these_levels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last_level</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">these_levels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="n">last_level</span><span class="p">:</span>
                        <span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="c1"># Min/max</span>
    <span class="k">if</span> <span class="n">keepminmax</span><span class="p">:</span>
        <span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">minv</span>
        <span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxv</span>

    <span class="k">return</span> <span class="n">levels</span></div>

<div class="viewcode-block" id="basic_auto_scale"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.basic_auto_scale">[docs]</a><span class="k">def</span> <span class="nf">basic_auto_scale</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">nmax</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">geo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">minutes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes levels according to a dataset and its range of values. Locators are on a 10-base.</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **vmin/vmax**: Find levels around this range.</span>
<span class="sd">        - **nmax**, optional: Maximal number of steps.</span>
<span class="sd">        - **steps**, optional: Base 10 steps for finding levels [default: [1,2,2.5,5,10]]</span>
<span class="sd">        - **geo**, optional: Assume longitude or latitude degrees [default: False].</span>
<span class="sd">        - **minutes**, optional: If geo, find suitable levels to match nice minutes locations when locations have floating values (like 1.2) [default: False].</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`auto_scale` :func:`geo_scale`</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">MaxNLocator</span>

    <span class="k">if</span> <span class="n">geo</span><span class="p">:</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">60</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">50.</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">3.</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">minutes</span> <span class="ow">and</span> <span class="n">vmax</span><span class="o">//</span><span class="n">mn</span> <span class="o">!=</span> <span class="n">vmin</span><span class="o">//</span><span class="n">mn</span><span class="p">:</span>
<span class="c1">#           # Minimal range</span>
<span class="c1">#           if (vmax-vmin) &lt; 1:</span>
<span class="c1">#               vmax -= .5/60.</span>
<span class="c1">#               vmin += .5/60.</span>
            <span class="c1"># Minimal number of steps</span>
            <span class="n">nmn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span><span class="o">*</span><span class="mf">60.</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#           nmax = min(max(nmax, int(N.ceil((vmax-vmin)*60.))+1), 10)</span>
            <span class="n">nmax</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="c1"># Steps</span>
            <span class="k">if</span> <span class="n">nmn</span> <span class="o">&gt;</span> <span class="n">nmax</span><span class="p">:</span>
                <span class="n">minutes_steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">/</span><span class="mf">6.</span><span class="p">,</span><span class="mi">15</span><span class="o">/</span><span class="mf">6.</span><span class="p">,</span><span class="mi">20</span><span class="o">/</span><span class="mf">6.</span><span class="p">,</span><span class="mi">30</span><span class="o">/</span><span class="mf">6.</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Strictly every minutes or less</span>
                <span class="c1"># TODO: must again use basic_auto_scale for minutes and seconds</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">vmin</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">vmax</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span><span class="o">/</span><span class="mf">60.</span>
            <span class="c1"># Try it</span>
            <span class="n">myloc</span> <span class="o">=</span> <span class="n">basic_auto_scale</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">nmax</span><span class="p">,</span><span class="n">steps</span><span class="o">=</span><span class="n">minutes_steps</span><span class="p">,</span><span class="n">geo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># Check that we really have minutes, ie not only degrees</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">N</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myloc</span><span class="p">)</span><span class="o">%</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.e-4</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">myloc</span>

    <span class="n">intv</span> <span class="o">=</span> <span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nmax</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="n">nmax</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">myloc</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">myloc</span><span class="o">.</span><span class="n">create_dummy_axis</span><span class="p">()</span>
    <span class="n">myloc</span><span class="o">.</span><span class="n">set_view_interval</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
    <span class="n">myloc</span><span class="o">.</span><span class="n">set_data_interval</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

    <span class="n">locs</span> <span class="o">=</span> <span class="n">myloc</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">N</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="n">vmin</span><span class="p">):</span> <span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">N</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">locs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">vmax</span><span class="p">):</span> <span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">locs</span></div>

<div class="viewcode-block" id="geo_scale"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.geo_scale">[docs]</a><span class="k">def</span> <span class="nf">geo_scale</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; :func:`auto_scale()` with geo=True</span>


<span class="sd">    :See also:</span>

<span class="sd">        :func:`basic_auto_scale` :func:`auto_scale`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;geo&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">auto_scale</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_atts"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.get_atts">[docs]</a><span class="k">def</span> <span class="nf">get_atts</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get all attributes from a variable</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **var**: Target variable</span>
<span class="sd">        - **id**, optional: Get also id [default: False]</span>
<span class="sd">        - Other keywords are set as attributes</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`cp_atts` :func:`set_atts` :func:`check_def_atts`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">atts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s1">&#39;attributes&#39;</span><span class="p">):</span>
        <span class="n">atts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">):</span>
        <span class="n">atts</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">units</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">):</span>
        <span class="n">atts</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">id</span>
    <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">extra</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
                <span class="n">atts</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
    <span class="n">atts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">atts</span></div>

<div class="viewcode-block" id="cp_atts"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.cp_atts">[docs]</a><span class="k">def</span> <span class="nf">cp_atts</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Copy all atributes from one variable to another</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **var1/var2**: Copy var1 attributes to var2</span>
<span class="sd">        - **id**, optional: Also copy id [default: False]</span>
<span class="sd">        - **overwrite**, optional: Overwrite attributes of ``var2``?</span>
<span class="sd">        - **select**, optional: Copy only these attributes.</span>
<span class="sd">        - **exclude**, optional: Attributes that must be excuded from copy.</span>
<span class="sd">        - Other keywords are set as attributes</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`get_atts` :func:`set_atts`  :func:`check_def_atts`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Default list</span>
    <span class="n">atts</span> <span class="o">=</span> <span class="n">get_atts</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">extra</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Selection</span>
    <span class="k">if</span> <span class="n">atts</span> <span class="ow">and</span> <span class="n">select</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">select</span> <span class="o">=</span> <span class="p">[</span><span class="n">select</span><span class="p">]</span>
        <span class="n">atts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">atts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">select</span><span class="p">)</span>

    <span class="c1"># Exclusion</span>
    <span class="k">if</span> <span class="n">atts</span> <span class="ow">and</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exclude</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="n">exclude</span><span class="p">]</span>
        <span class="n">atts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">atts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span>

    <span class="c1"># Set</span>
    <span class="n">set_atts</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">atts</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span></div>

<div class="viewcode-block" id="set_atts"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.set_atts">[docs]</a><span class="k">def</span> <span class="nf">set_atts</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">atts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set attributes</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **var**: Change attributes of var</span>
<span class="sd">        - **atts**, optional: A dictionary of attributes</span>
<span class="sd">        - **overwrite**, optional: Overwrite attributes of ``var2``?</span>
<span class="sd">        - Other keywords are set as attributes</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`cp_atts` :func:`get_atts` :func:`check_def_atts`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">atts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">atts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">atts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">att</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">atts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>



<div class="viewcode-block" id="check_def_atts"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.check_def_atts">[docs]</a><span class="k">def</span> <span class="nf">check_def_atts</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">defaults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check defaults attributes and set them if empty</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`get_atts` :func:`cp_atts` :func:`set_atts`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">att</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">att</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">att</span><span class="p">,</span><span class="n">val</span><span class="p">)</span></div>


<div class="viewcode-block" id="match_string"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.match_string">[docs]</a><span class="k">def</span> <span class="nf">match_string</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">checks</span><span class="p">,</span> <span class="n">ignorecase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check that a string verify a check list that consists of</span>
<span class="sd">    a list of either strings or callables&quot;&quot;&quot;</span>
    <span class="c1"># Nothing</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ss</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Setup</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ignorecase</span><span class="p">:</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">checks</span><span class="p">):</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">[</span><span class="n">checks</span><span class="p">]</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">checks</span><span class="p">)</span>

    <span class="c1"># Callables</span>
    <span class="n">sss</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">checks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">check</span><span class="p">):</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="ow">and</span> <span class="n">check</span><span class="p">(</span><span class="n">ss</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">sss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>

    <span class="c1"># Strings</span>
    <span class="n">sss</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span> <span class="n">sss</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ignorecase</span><span class="p">:</span>
        <span class="n">sss</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">sss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">sss</span></div>

<div class="viewcode-block" id="match_atts"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.match_atts">[docs]</a><span class="k">def</span> <span class="nf">match_atts</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">checks</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignorecase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check that at least one of the attributes of an object matches check list</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **obj**: An object</span>
<span class="sd">        - **checks**: A dictionary of (attributes name, checklist)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">checks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">attname</span><span class="p">,</span> <span class="n">attchecks</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attname</span><span class="p">)</span> <span class="ow">and</span> <span class="n">match_string</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attname</span><span class="p">),</span>
                <span class="n">attchecks</span><span class="p">,</span> <span class="n">ignorecase</span><span class="o">=</span><span class="n">ignorecase</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>

<span class="k">def</span> <span class="nf">_pospos_</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">i</span> <span class="k">if</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
    <span class="n">jj</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
        <span class="n">jj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="k">if</span> <span class="n">j</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">j</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="n">jj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_negpos_</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">i</span> <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">n</span><span class="p">)</span>
    <span class="n">jj</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
        <span class="n">jj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="k">if</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="n">jj</span><span class="p">)</span>


<div class="viewcode-block" id="cp_props"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.cp_props">[docs]</a><span class="k">def</span> <span class="nf">cp_props</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">atts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exaxes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exatts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">owatts</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Copy properties of a variable to another variabes</span>

<span class="sd">    Proporties are attributes, axes and grid.</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **var1/var2**: cdms variables.</span>
<span class="sd">        - **axes**, optional: Position of axes to copy. Positions are</span>
<span class="sd">          converted to relative position to that last dimension to handle</span>
<span class="sd">          the case of variables that don&#39;t have the same number of dimensions.</span>
<span class="sd">          Set it to ``False`` to not copy axes.</span>
<span class="sd">        - **exaxes**, optional: Position of axes to not copy.</span>
<span class="sd">        - **grid**, optional: Also copy the grid?</span>
<span class="sd">        - **atts**, optional: Attributes to copy. Set it to ``False`` to not</span>
<span class="sd">          copy attributes.</span>
<span class="sd">        - **exatts**, optional: Attributes to exclude from copy.</span>
<span class="sd">        - **owatts**, optional: Overwrite attributes?</span>

<span class="sd">    :Examples:</span>

<span class="sd">        &gt;&gt;&gt; cp_props(var1, var2, atts=False)</span>
<span class="sd">        &gt;&gt;&gt; cp_props(var1, var2, axes=[1,-1], atts=[&#39;units&#39;,&#39;long_name&#39;])</span>
<span class="sd">        &gt;&gt;&gt; cp_props(var1, var2, exaxes=0, grid=False)</span>
<span class="sd">        &gt;&gt;&gt; cp_props(var1, var2, axes=False, exatts=&#39;units&#39;, owatts=False)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Axes</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">var1</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">_negpos_</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">var1</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exaxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exaxes</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">exaxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">exaxes</span><span class="p">]</span>
            <span class="n">exaxes</span> <span class="o">=</span> <span class="n">_negpos_</span><span class="p">(</span><span class="n">exaxes</span><span class="p">,</span> <span class="n">var1</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">axes</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exaxes</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">iaxis</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">var1</span><span class="o">.</span><span class="n">ndim</span><span class="o">+</span><span class="n">iaxis</span> <span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">var2</span><span class="o">.</span><span class="n">ndim</span><span class="o">+</span><span class="n">iaxis</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">var2</span><span class="o">.</span><span class="n">setAxis</span><span class="p">(</span><span class="n">iaxis</span><span class="p">,</span> <span class="n">var1</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="n">iaxis</span><span class="p">))</span>

    <span class="c1"># Grid</span>
    <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">var1</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">vacumm.misc.grid</span> <span class="k">import</span> <span class="n">set_grid</span>
            <span class="n">set_grid</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>

    <span class="c1"># Attributes</span>
    <span class="k">if</span> <span class="n">atts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">cp_atts</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">atts</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exatts</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">owatts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">var2</span></div>

<div class="viewcode-block" id="is_iterable"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.is_iterable">[docs]</a><span class="k">def</span> <span class="nf">is_iterable</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nostr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nogen</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if an object is iterable or not.</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **obj**: Object to check</span>

<span class="sd">    :Return: True/False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">nogen</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="n">types</span><span class="o">.</span><span class="n">GeneratorType</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
    <span class="c1">#try: len(obj)</span>
    <span class="c1">#except: return False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="fm">__len__</span><span class="p">)):</span> <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">nostr</span><span class="p">:</span> <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span></div>

<span class="n">iterable</span> <span class="o">=</span> <span class="n">is_iterable</span>

<div class="viewcode-block" id="isnumber"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.isnumber">[docs]</a><span class="k">def</span> <span class="nf">isnumber</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">IntType</span><span class="p">,</span><span class="n">FloatType</span><span class="p">,</span><span class="n">LongType</span><span class="p">,</span><span class="n">ComplexType</span><span class="p">]</span></div>



<div class="viewcode-block" id="rm_html_tags"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.rm_html_tags">[docs]</a><span class="k">def</span> <span class="nf">rm_html_tags</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove html tags from a string</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **str**: A string</span>

<span class="sd">    :Return:</span>

<span class="sd">        Cleaned string</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; rm_html_tags(&#39;&lt;title&gt;My title&lt;/title&gt;&#39;)</span>
<span class="sd">        My title</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">re</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&lt;[^&gt;]+&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span></div>





<span class="n">phase_params</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;- **decimal**, optional: Use decimal representation</span>
<span class="s2">        - **fmt**, optional: Format for decimal representation</span>
<span class="s2">        - **no_seconds**, optional: Do not add seconds to degrees representation</span>
<span class="s2">        - **tex**, optional: Use Tex degree symbol</span>
<span class="s2">          (depends on ``rcParams[&#39;text.usetex&#39;]`` by default)</span>
<span class="s2">        - **no_symbol**, optional: Don&#39;t use degree symbol</span>
<span class="s2">        - **no_zeros**, optional: Don&#39;t insert zeros when integer &lt; 10</span>
<span class="s2">        - **auto**, optional: If True, find the ticks according to the range of values</span>
<span class="s2">        - **auto_minutes**, optional: Automatically suppress degrees if value is not exactly a degree (just display minutes and seconds) else display degree</span>
<span class="s2">        - **bfdeg**, optional: Use bold face for degrees when alone if auto_minutes and</span>
<span class="s2">          ``rcParams[&#39;text.usetex&#39;]`` are True.</span>
<span class="s2">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="deg2str"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.deg2str">[docs]</a><span class="k">def</span> <span class="nf">deg2str</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">phase</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="phaselab"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.phaselab">[docs]</a><span class="k">def</span> <span class="nf">phaselab</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.5g</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_minutes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">no_seconds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">no_symbol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">no_zeros</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bfdeg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a nice label for degrees</span>

<span class="sd">    Inspired from Basemap toolkit of Matplotlib</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;nosec&#39;</span><span class="p">):</span> <span class="n">no_seconds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nosec&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">):</span> <span class="n">decimal</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;nosym&#39;</span><span class="p">):</span> <span class="n">no_symbol</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nosym&#39;</span><span class="p">]</span>

    <span class="c1"># Longitude/latitude/none</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span>
        <span class="n">pstr</span><span class="p">,</span><span class="n">mstr</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;W&#39;</span>
    <span class="k">elif</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span>
        <span class="n">pstr</span><span class="p">,</span><span class="n">mstr</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pstr</span><span class="p">,</span><span class="n">mstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Use tex strings</span>
    <span class="k">if</span> <span class="n">tex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">usetex</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">tex</span><span class="p">:</span>
        <span class="n">usetex</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">usetex</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">usetex</span><span class="p">:</span>
        <span class="n">sdeg</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$^{\circ}$&quot;</span>
        <span class="n">smin</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$^{&#39;}$&quot;</span>
        <span class="n">ssec</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$^{&#39;&#39;}$ &quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sdeg</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">&#39;</span>
        <span class="n">smin</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&#39;&quot;</span>
        <span class="n">ssec</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&#39;&#39;&quot;</span>

    <span class="c1"># Integer format</span>
    <span class="k">if</span> <span class="n">no_zeros</span><span class="p">:</span>
        <span class="n">ifmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ifmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%02i</span><span class="s1">&#39;</span>
    <span class="n">gfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2g</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">decimal</span><span class="p">:</span> <span class="n">auto_minutes</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">iterable</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
        <span class="n">it</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">vals</span><span class="p">,]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">it</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">in_one_degree</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span><span class="o">!=</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">auto_minutes</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span> <span class="ow">or</span> <span class="n">auto_minutes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">auto_minutes</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">in_one_degree</span>

    <span class="c1"># Bold degrees</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">usetex</span><span class="p">:</span>
        <span class="n">bfdeg</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">bfdeg</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span> <span class="ow">or</span> <span class="n">bfdeg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># not bold if degrees only</span>
        <span class="n">bfdeg</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span><span class="o">!=</span><span class="mi">0</span>

    <span class="c1"># Loop</span>
    <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span> <span class="c1"># Equator or Greenwich</span>
            <span class="k">if</span> <span class="n">no_symbol</span><span class="p">:</span>
                <span class="n">labstr</span> <span class="o">=</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labstr</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">+</span><span class="n">sdeg</span>
            <span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labstr</span><span class="o">%</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">-=</span> <span class="mf">360.</span>
            <span class="k">elif</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">180.</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">+=</span> <span class="mf">360.</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">sig</span> <span class="o">=</span> <span class="n">mstr</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sig</span> <span class="o">=</span> <span class="n">pstr</span>
            <span class="n">nodeg</span> <span class="o">=</span> <span class="n">auto_minutes</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e-4</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">decimal</span><span class="p">:</span> <span class="c1"># Minutes&#39;(seconds&#39;&#39;)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">ifmt</span>
                <span class="k">if</span> <span class="n">bfdeg</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\textbf{</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="o">%</span><span class="n">fmt</span>
<span class="c1">#                if usetex and not ifmt.startswith(&#39;$&#39;):</span>
<span class="c1">#                    ifmt = r&#39;$%s$&#39;%ifmt</span>
                <span class="n">dd</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="n">ss</span> <span class="o">=</span> <span class="n">deg_from_dec</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">no_seconds</span><span class="p">:</span> <span class="c1"># Round seconds to minute</span>
                    <span class="n">mm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mm</span><span class="o">+</span><span class="n">ss</span><span class="o">/</span><span class="mf">60.</span><span class="p">))</span>
                    <span class="n">ss</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">ifmt</span><span class="o">%</span><span class="n">ss</span> <span class="o">!=</span> <span class="n">ifmt</span><span class="o">%</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># Seconds needed</span>
                    <span class="n">vv</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(ifmt)s%(smin)s%(gfmt)s%(ssec)s</span><span class="s2">&quot;</span><span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">ifmt</span><span class="o">%</span><span class="n">mm</span> <span class="o">!=</span> <span class="n">ifmt</span><span class="o">%</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># Just minutes</span>
                    <span class="n">vv</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(ifmt)s%(smin)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># Nothing</span>
                    <span class="n">vv</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vv</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">nodeg</span><span class="p">:</span>
                <span class="n">labstr</span> <span class="o">=</span> <span class="n">vv</span>
            <span class="k">elif</span> <span class="n">no_symbol</span><span class="p">:</span>
                <span class="n">labstr</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">+</span><span class="n">vv</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labstr</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">+</span><span class="n">sdeg</span><span class="o">+</span><span class="n">vv</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">decimal</span><span class="p">:</span>
                <span class="n">cc</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">nodeg</span><span class="p">:</span>
                    <span class="n">cc</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">vv</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ssec</span><span class="p">):</span>
                    <span class="n">cc</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mm</span><span class="p">,</span><span class="n">ss</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">vv</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">smin</span><span class="p">):</span>
                    <span class="n">cc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span>
                <span class="n">labstr</span> <span class="o">=</span> <span class="n">labstr</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labstr</span> <span class="o">=</span> <span class="n">labstr</span> <span class="o">%</span> <span class="n">val</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nodeg</span><span class="p">:</span> <span class="n">labstr</span> <span class="o">+=</span> <span class="n">sig</span>
            <span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labstr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">it</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">labs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">labs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="lonlab"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.lonlab">[docs]</a><span class="k">def</span> <span class="nf">lonlab</span><span class="p">(</span><span class="n">longitudes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return nice longitude labels</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **longitudes**: Value of longitudes</span>
<span class="sd">        %s</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`phaselab` :func:`latlab` :func:`deplab`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lon&#39;</span>
    <span class="k">return</span> <span class="n">phaselab</span><span class="p">(</span><span class="n">longitudes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
<span class="k">if</span> <span class="n">lonlab</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">lonlab</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">lonlab</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">%</span> <span class="n">phase_params</span>

<div class="viewcode-block" id="latlab"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.latlab">[docs]</a><span class="k">def</span> <span class="nf">latlab</span><span class="p">(</span><span class="n">latitudes</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return nice latitude labels</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **latitudes**: Value of latitudes</span>
<span class="sd">        %s</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`phaselab` :func:`lonlab` :func:`deplab`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lat&#39;</span>
    <span class="k">return</span> <span class="n">phaselab</span><span class="p">(</span><span class="n">latitudes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
<span class="k">if</span> <span class="n">latlab</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">latlab</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">latlab</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">%</span> <span class="n">phase_params</span>

<div class="viewcode-block" id="deplab"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.deplab">[docs]</a><span class="k">def</span> <span class="nf">deplab</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nosign</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return well formatted depth labels</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **depths**: Numerical depths</span>

<span class="sd">        - **fmt**, optional: Numeric format of the string (including units) [default: &#39;%gm&#39;]</span>
<span class="sd">        - **auto**, optional: If True, find the ticks according to the range of depths [default: False]</span>
<span class="sd">        - **nosign**, optional: Absolute values are used.</span>

<span class="sd">    :See also:</span>

<span class="sd">        :func:`lonlab` :func:`latlab`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">single</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">iterable</span><span class="p">(</span><span class="n">depths</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">single</span><span class="p">:</span> <span class="n">depths</span> <span class="o">=</span> <span class="p">[</span><span class="n">depths</span><span class="p">,]</span>
    <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>    <span class="n">depths</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">(</span><span class="n">depths</span><span class="p">)</span>

    <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nosign</span><span class="p">:</span> <span class="n">depth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
        <span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">depth</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">labs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">labs</span></div>



<div class="viewcode-block" id="deg_from_dec"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.deg_from_dec">[docs]</a><span class="k">def</span> <span class="nf">deg_from_dec</span><span class="p">(</span><span class="n">dec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert from decimal degrees to degrees,minutes,seconds &quot;&quot;&quot;</span>

    <span class="n">degrees</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dec</span><span class="o">-</span><span class="n">degrees</span><span class="p">)</span><span class="o">*</span><span class="mf">60.</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="p">(</span><span class="n">dec</span><span class="o">-</span><span class="n">minutes</span><span class="p">)</span><span class="o">*</span><span class="mf">60.</span>

    <span class="c1"># Approximations</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-6</span><span class="p">:</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">elif</span> <span class="p">(</span><span class="mf">60.</span><span class="o">-</span><span class="n">seconds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-6</span><span class="p">:</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">minutes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">minutes</span> <span class="o">==</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">degrees</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">degrees</span><span class="p">,</span><span class="n">minutes</span><span class="p">,</span><span class="n">seconds</span></div>


<div class="viewcode-block" id="dict_filter"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dict_filter">[docs]</a><span class="k">def</span> <span class="nf">dict_filter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">filters</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">short</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwadd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Filter out kwargs (typically extra calling keywords)</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **kwargs**: Dictionnary to filter.</span>
<span class="sd">        - **filters**: Single or list of prefixes.</span>
<span class="sd">        - *defaults*: dictionnary of default values for output fictionnary.</span>
<span class="sd">        - *copy*: Simply copy items, do not remove them from kwargs.</span>
<span class="sd">        - *short*: Allow prefixes to not end with ``&quot;_&quot;``.</span>
<span class="sd">        - *keep*: Keep prefix filter in output keys.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; kwargs = {&#39;basemap&#39;:&#39;f&#39;, &#39;basemap_fillcontinents&#39;:True, &#39;quiet&#39;:False,&#39;basemap_plot&#39;:False}</span>
<span class="sd">        &gt;&gt;&gt; print kwfilter(kwargs,&#39;basemap&#39;, defaults=dict(drawcoastlines=True,plot=True),good=True)</span>
<span class="sd">        {&#39;plot&#39;: False, &#39;fillcontinents&#39;: True, &#39;good&#39;: True, &#39;basemap&#39;: &#39;f&#39;, &#39;drawcoastlines&#39;: True}</span>
<span class="sd">        &gt;&gt;&gt; print kwargs</span>
<span class="sd">        {&#39;quiet&#39;: False}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">filters</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
        <span class="n">kwread</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kwread</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span>

    <span class="c1"># Set initial items</span>
    <span class="n">kwout</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">filter</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="nb">filter</span><span class="p">],</span><span class="nb">dict</span><span class="p">):</span>
                <span class="n">kwout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwread</span><span class="p">(</span><span class="nb">filter</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kwout</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwread</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">short</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">filter</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span> <span class="nb">filter</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span>
        <span class="k">for</span> <span class="n">att</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">att</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">att</span> <span class="o">!=</span> <span class="nb">filter</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
                    <span class="n">kwout</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwread</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwout</span><span class="p">[</span><span class="n">att</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">filter</span><span class="p">):]]</span> <span class="o">=</span> <span class="n">kwread</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>

    <span class="c1"># Add some items</span>
    <span class="n">kwout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwadd</span><span class="p">)</span>

    <span class="c1"># Set some default values</span>
    <span class="k">if</span> <span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">att</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">kwout</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">att</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kwout</span></div>

<div class="viewcode-block" id="kwfilter"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.kwfilter">[docs]</a><span class="k">def</span> <span class="nf">kwfilter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Alias for :func:`dict_filter`&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dict_filter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="dict_filter_out"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dict_filter_out">[docs]</a><span class="k">def</span> <span class="nf">dict_filter_out</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;start&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove entries from a dictionary</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **kwargs**: Valid dictionary.</span>
<span class="sd">        - **filters**: Single or list of prefixes. Entries with a key starting with</span>
<span class="sd">          one of these filters are removed.</span>
<span class="sd">        - **copy**, optional: Create a copy or work on original dict?</span>
<span class="sd">        - **mode**, optional: Matching mode.</span>

<span class="sd">            - ``&quot;start&quot;``: remove if key starts with filter.</span>
<span class="sd">            - ``&quot;end&quot;``: remove if key ends with filter.</span>
<span class="sd">            - ``&quot;regexp&quot;``: remove if key match regexp match filter.</span>
<span class="sd">            - else remove if key is exactly filter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">copy</span><span class="p">:</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">filters</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s2">&quot;regexp&quot;</span><span class="p">:</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="k">for</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">filter</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="k">break</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">mode</span><span class="o">+</span><span class="s1">&#39;swith&#39;</span><span class="p">)(</span><span class="nb">filter</span><span class="p">):</span> <span class="k">break</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="nb">filter</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kwargs</span></div>
<span class="n">kwfilterout</span> <span class="o">=</span> <span class="n">dict_filter_out</span>

<div class="viewcode-block" id="dict_aliases"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dict_aliases">[docs]</a><span class="k">def</span> <span class="nf">dict_aliases</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">aliases</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove duplicate entries in a dictionnary according to a list of aliases.</span>
<span class="sd">    The first alias has priority over the following.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; kwargs = dict(min=4, title=&#39;Title&#39;, label=&#39;Label&#39;)</span>
<span class="sd">        &gt;&gt;&gt; dict_aliases(kwargs, [&#39;label&#39;, &#39;title&#39;])</span>
<span class="sd">        {&#39;min&#39;: 4, &#39;label&#39;: &#39;Label&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aliases</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="n">aliases</span><span class="p">]</span>
    <span class="n">ref_alias</span> <span class="o">=</span> <span class="n">aliases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">alias</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">aliases</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">alias</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">ref_alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">aliases</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">aliases</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">aliases</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">kwargs</span></div>

<div class="viewcode-block" id="dict_check_defaults"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dict_check_defaults">[docs]</a><span class="k">def</span> <span class="nf">dict_check_defaults</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">defs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check that a dictionary has some default values&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">defs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">defs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">defs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="o">*</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kwargs</span></div>

<div class="viewcode-block" id="lunique"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.lunique">[docs]</a><span class="k">def</span> <span class="nf">lunique</span><span class="p">(</span><span class="n">mylist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uniquify a list to a new list&quot;&quot;&quot;</span>
    <span class="n">ulist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ulist</span></div>

<div class="viewcode-block" id="tunique"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.tunique">[docs]</a><span class="k">def</span> <span class="nf">tunique</span><span class="p">(</span><span class="n">mytuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uniquify a tuple to a new tuple&quot;&quot;&quot;</span>
    <span class="n">utuple</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mytuple</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seen</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="k">continue</span>
        <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">utuple</span> <span class="o">+=</span> <span class="n">item</span><span class="p">,</span>
    <span class="k">return</span> <span class="n">utuple</span></div>

<div class="viewcode-block" id="isempty"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.isempty">[docs]</a><span class="k">def</span> <span class="nf">isempty</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if empty&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="dict_merge"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dict_merge">[docs]</a><span class="k">def</span> <span class="nf">dict_merge</span><span class="p">(</span><span class="o">*</span><span class="n">dd</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merge dictionaries</span>

<span class="sd">    First dictionaries have priority over next</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **dd**: Argument are interpreted as dictionary to merge.</span>
<span class="sd">          Those who are not dictionaries are skipped.</span>
<span class="sd">        - **mergesubdicts**, optional: Also merge dictionary items</span>
<span class="sd">          (like in a tree) [default: True].</span>
<span class="sd">        - **mergetuples**, optional: Also merge tuple items [default: False].</span>
<span class="sd">        - **mergelists**, optional: Also merge list items [default: False].</span>
<span class="sd">        - **unique**, optional: Uniquify lists and tuples [default: True].</span>
<span class="sd">        - **skipnones**, optional: Skip Nones [default: True].</span>
<span class="sd">        - **skipempty**, optional: Skip everything that is not converted to False</span>
<span class="sd">          using bool [default: False].</span>
<span class="sd">        - **cls**, optional: Class to use. Default to the first class found in arguments</span>
<span class="sd">          that is not a :class:`dict`, else defaults to :class:`dict`.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; d1 = dict(a=3, b=5)</span>
<span class="sd">        &gt;&gt;&gt; d2 = dict(a=5, c=7)</span>
<span class="sd">        &gt;&gt;&gt; print dict_merge(d1,d2)</span>
<span class="sd">        {&#39;a&#39;: 3, &#39;c&#39;: 7, &#39;b&#39;: 5}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Options</span>
    <span class="n">mergesubdicts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mergesubdicts&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">mergelists</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mergelists&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">mergetuples</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mergetuples&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">unique</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">skipnones</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skipnones&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">overwriteempty</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overwriteempty&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">)</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">dd</span><span class="p">)</span>

    <span class="c1"># Get the class</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">dict</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="vm">__class__</span>
                <span class="k">break</span>

    <span class="c1"># Init</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">Section</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Section</span><span class="p">):</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t initialise Section for merging&quot;</span><span class="p">)</span>
        <span class="n">outd</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outd</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

    <span class="c1"># Loop</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="k">continue</span>

        <span class="c1"># Content</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">skipnones</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outd</span> <span class="ow">or</span> <span class="p">(</span><span class="n">overwriteempty</span> <span class="ow">and</span> <span class="n">isempty</span><span class="p">(</span><span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">])):</span> <span class="c1"># Not set so we set</span>
                <span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="n">mergesubdicts</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="c1"># Merge subdict</span>
                <span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_merge</span><span class="p">(</span><span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mergelists</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="c1"># Merge lists</span>
                <span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
                    <span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lunique</span><span class="p">(</span><span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">mergetuples</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span> <span class="c1"># Merge tuples</span>
                <span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
                    <span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tunique</span><span class="p">(</span><span class="n">outd</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="c1"># Comments for ConfigObj instances</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">ConfigObj</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">outd</span><span class="o">.</span><span class="n">initial_comment</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;initial_comment&#39;</span><span class="p">):</span>
           <span class="n">outd</span><span class="o">.</span><span class="n">initial_comment</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">initial_comment</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">outd</span><span class="o">.</span><span class="n">final_comment</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;final_comment&#39;</span><span class="p">):</span>
           <span class="n">outd</span><span class="o">.</span><span class="n">final_comment</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">final_comment</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;inline_comments&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">inline_comments</span><span class="p">:</span>
            <span class="n">outd</span><span class="o">.</span><span class="n">inline_comments</span> <span class="o">=</span> <span class="n">dict_merge</span><span class="p">(</span><span class="n">outd</span><span class="o">.</span><span class="n">inline_comments</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">inline_comments</span><span class="p">,</span>
                <span class="n">overwriteempty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">outd</span></div>

<div class="viewcode-block" id="dict_copy_items"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dict_copy_items">[docs]</a><span class="k">def</span> <span class="nf">dict_copy_items</span><span class="p">(</span><span class="n">ddi</span><span class="p">,</span> <span class="n">ddo</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Copy existing items of an array to another one</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **ddi**: Dictionary from which items are taken.</span>
<span class="sd">        - **ddo**: Dictionary in which items are put.</span>
<span class="sd">        - **keys**: single or list of keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>
    <span class="n">single</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ddo</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">single</span><span class="p">:</span> <span class="n">ddo</span> <span class="o">=</span> <span class="p">[</span><span class="n">ddo</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ddi</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">ddo</span><span class="p">:</span>
                <span class="n">dd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">single</span><span class="p">:</span> <span class="k">return</span> <span class="n">ddo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ddo</span></div>

<div class="viewcode-block" id="mask_nan"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.mask_nan">[docs]</a><span class="k">def</span> <span class="nf">mask_nan</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mask NaN from a variable</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **input**: Array (numpy, numpy.ma or MV2)</span>

<span class="sd">    .. note::</span>

<span class="sd">        If input is pure numpy, it is converted to numpy.ma</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; var = N.array([1,N.nan])</span>
<span class="sd">        &gt;&gt;&gt; print mask_nan(var)</span>
<span class="sd">        [1.0 --]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">isma</span> <span class="o">=</span> <span class="n">isVariable</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="ow">or</span> <span class="n">MA</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isma</span><span class="p">:</span>
        <span class="n">pure_num</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">filled</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pure_num</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">MA</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pure_num</span><span class="p">),</span> <span class="nb">input</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isma</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">output</span>
    <span class="k">return</span> <span class="n">output</span></div>

<span class="c1">#   # Masking function</span>
<span class="c1">#   if isVariable(input):</span>
<span class="c1">#       M = MV</span>
<span class="c1">#   else:</span>
<span class="c1">#       M = MA</span>
<span class="c1">#</span>
<span class="c1">#   # Work on numerical values</span>
<span class="c1">#   if MA.isMA(input):</span>
<span class="c1">#       num = MA.filled(input)</span>
<span class="c1">#   else:</span>
<span class="c1">#       num = input</span>
<span class="c1">#</span>
<span class="c1">#   # Compute the mask</span>
<span class="c1">#   a=N.greater(num,0.)</span>
<span class="c1">#   b=N.less_equal(num,0.)</span>
<span class="c1">#   mask = N.logical_not(N.logical_or(a,b))</span>
<span class="c1">#   del a,b</span>
<span class="c1">#</span>
<span class="c1">#   # Apply the mask if needed</span>
<span class="c1">#   # Output is always at least a MA class</span>
<span class="c1">#   if N.sometrue(mask):</span>
<span class="c1">#       output = M.array(input, mask= mask)</span>
<span class="c1">#   else:</span>
<span class="c1">#       output = M.array(input, copy=0)</span>
<span class="c1">#</span>
<span class="c1">#   return output</span>

<div class="viewcode-block" id="write_ascii_time1d"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.write_ascii_time1d">[docs]</a><span class="k">def</span> <span class="nf">write_ascii_time1d</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">file</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write an ascii file in the following format: YYY/MM/DD HH:MN:SS DATA where DATA is one column.</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **var**: a cdms variable WITH A TIME AXIS</span>
<span class="sd">        - **file**: output file name</span>
<span class="sd">        - **fmt**, optional: format of DATA [default: &#39;%g&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">vacumm.misc.atime</span> <span class="k">as</span> <span class="nn">T</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s1">&#39;[write_ascii1d] No axis time attached to this variable&#39;</span>

    <span class="n">line_fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">+</span><span class="n">fmt</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">setMissing</span><span class="p">(</span><span class="mf">999.</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)):</span>
        <span class="n">stime</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">num_to_ascii</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">it</span><span class="p">])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">stime</span><span class="p">,</span><span class="n">var</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="xls_style"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.xls_style">[docs]</a><span class="k">def</span> <span class="nf">xls_style</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">o</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Excel style sheet for pyExcelerator cell objects</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **style**, optional: Style object to update.</span>
<span class="sd">        - **scopy**, optional: Make a copy of ``style`` if passed.</span>
<span class="sd">        - **b**, optional: Bold [True/False].</span>
<span class="sd">        - **i**, optional: italic[True/False].</span>
<span class="sd">        - **u**, optional: Underline [True/False].</span>
<span class="sd">        - **c**, optional: Colour index [from 0 to 82!, with 0=black, 1=white, 2=red, 3=green, 4=blue, 5=yellow, 6=magenta, 7=cyan].</span>
<span class="sd">        - **o**, optional: Outline [True/False].</span>
<span class="sd">        - **bd**, optional: Borders [True/int/False/dict(top=int...)].</span>
<span class="sd">        - **fmt**, optional: Format [&#39;general&#39;,&#39;0.0&#39;,...].</span>
<span class="sd">        - **va**, optional: Vertical alignment [&#39;top&#39;,&#39;bottom&#39;,&#39;center&#39;,&#39;justified&#39;].</span>
<span class="sd">        - **ha**, optional: Horizontal alignment [&#39;left&#39;,&#39;right&#39;,&#39;center&#39;,&#39;justified&#39;].</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; style_num = xls_style(fmt=&#39;0.00&#39;)</span>
<span class="sd">        &gt;&gt;&gt; style_num_left = xls_style(style_num, left=2, copy=True)</span>
<span class="sd">        &gt;&gt;&gt; style_full = xls_style(c=2, b=True, va=&#39;center&#39;, ha=&#39;justified&#39;)</span>

<span class="sd">    :Tutorial: :ref:`user.tut.misc.io.xls`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pyExcelerator</span> <span class="k">import</span> <span class="n">XFStyle</span><span class="p">,</span><span class="n">Borders</span><span class="p">,</span><span class="n">Alignment</span><span class="p">,</span> <span class="n">Font</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">xlwt</span> <span class="k">import</span> <span class="n">XFStyle</span><span class="p">,</span><span class="n">Borders</span><span class="p">,</span><span class="n">Alignment</span><span class="p">,</span> <span class="n">Font</span>
    <span class="c1"># Style object</span>
    <span class="k">if</span> <span class="n">style</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">XFStyle</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">copy</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
    <span class="c1"># Format</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">num_format_str</span> <span class="o">=</span> <span class="n">fmt</span>
    <span class="c1"># Font syle</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s1">&#39;font&#39;</span><span class="p">):</span>
        <span class="n">style</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">bold</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">italic</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">underline</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">outline</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">colour_index</span> <span class="o">=</span> <span class="n">c</span><span class="c1">#hex(c)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c1"># Borders</span>
    <span class="n">bdnames</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span>
    <span class="k">if</span> <span class="n">bd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bd</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bd</span><span class="p">)</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">bd</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="n">bd</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="n">bd</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">bd</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">bdname</span> <span class="ow">in</span> <span class="n">bdnames</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">bdname</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">bdname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bd</span><span class="p">[</span><span class="n">bdname</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s1">&#39;borders&#39;</span><span class="p">):</span>
        <span class="n">style</span><span class="o">.</span><span class="n">borders</span> <span class="o">=</span> <span class="n">Borders</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bd</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">borders</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c1"># Alignment</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="s1">&#39;alignment&#39;</span><span class="p">):</span>
        <span class="n">style</span><span class="o">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">va</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">vert</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Alignment</span><span class="p">,</span><span class="s1">&#39;VERT_&#39;</span><span class="o">+</span><span class="n">va</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">ha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">horz</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Alignment</span><span class="p">,</span><span class="s1">&#39;HORZ_&#39;</span><span class="o">+</span><span class="n">ha</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">style</span></div>





<div class="viewcode-block" id="FileTree"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.FileTree">[docs]</a><span class="k">class</span> <span class="nc">FileTree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build a file tree</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **input_dir**: Input directory.</span>
<span class="sd">        - **patterns**, optional: A string (or a list of strings) indicating which REGULAR EXPRESSION patterns files must match (using glob.glob) [default: &#39;.*&#39;]</span>
<span class="sd">        - **exclude**, optional:: A string (or a list of strings) indicating which REGULAR EXPRESSION patterns files must not match (using re.search) [default: [&#39;CVS/&#39;,&#39;.svn/&#39;]]</span>
<span class="sd">        - **include**, optional:: A string (or a list of strings) indicating which REGULAR EXPRESSION patterns files must match if they are excluded by &#39;exclude&#39; patterns (using re.search) [default: None]</span>
<span class="sd">        - **relative**, optional:: Return file names relative to input_dir [default: False]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_patterns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;.*&#39;</span><span class="p">],</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;~$&#39;</span><span class="p">,</span><span class="s1">&#39;^CVS$/&#39;</span><span class="p">,</span><span class="s1">&#39;^\.svn$/&#39;</span><span class="p">,</span><span class="s1">&#39;^\.DS_Store$&#39;</span><span class="p">,</span><span class="s1">&#39;\.db$&#39;</span><span class="p">,</span><span class="s1">&#39;\.ini$&#39;</span><span class="p">],</span><span class="n">include</span><span class="o">=</span><span class="p">[],)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">input_dir</span><span class="p">,</span><span class="n">relative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">scan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_dir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="s1">&#39;Directory not found: &#39;</span><span class="o">+</span><span class="n">input_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_dir</span> <span class="o">=</span> <span class="n">input_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_relative</span> <span class="o">=</span> <span class="n">relative</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_selectors_</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">exclude</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">include</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">scan</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="FileTree.file_list"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.FileTree.file_list">[docs]</a>    <span class="k">def</span> <span class="nf">file_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span></div>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="p">)</span>

<div class="viewcode-block" id="FileTree.scan"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.FileTree.scan">[docs]</a>    <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recursive scan to list files&quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_selectors_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">current_dir</span><span class="p">,</span><span class="n">dirs</span><span class="p">,</span><span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_dir</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">isfile</span><span class="p">,</span><span class="n">targets</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">copy</span><span class="p">(</span><span class="n">dirs</span><span class="p">),</span><span class="n">copy</span><span class="p">(</span><span class="n">files</span><span class="p">))):</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">isfile</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_target_</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span><span class="s1">&#39;patterns&#39;</span><span class="p">,</span><span class="n">target</span><span class="p">))</span> <span class="ow">or</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_target_</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span><span class="s1">&#39;exclude&#39;</span><span class="p">,</span><span class="n">target</span><span class="p">)</span> <span class="ow">and</span> \
                         <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_target_</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span><span class="s1">&#39;include&#39;</span><span class="p">,</span><span class="n">target</span><span class="p">))</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">:</span>
                            <span class="n">dirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">isfile</span><span class="p">:</span>
                            <span class="n">this_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relative</span><span class="p">:</span>
                                <span class="n">this_file</span> <span class="o">=</span> <span class="n">this_file</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_dir</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_file</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_check_target_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current_dir</span><span class="p">,</span><span class="n">pattern_type</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">pattern_type</span><span class="p">):</span>
            <span class="n">thistarget</span> <span class="o">=</span> <span class="n">target</span>
            <span class="k">if</span> <span class="n">pat</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/$&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span><span class="n">target</span><span class="p">)):</span>
                    <span class="c1"># Target must be a directory</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thistarget</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">pat</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_dir</span><span class="p">):</span>
                <span class="c1"># Pattern is matched against full path to root dir</span>
                <span class="n">thistarget</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span><span class="n">thistarget</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">thistarget</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>


<div class="viewcode-block" id="FileTree.set_patterns"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.FileTree.set_patterns">[docs]</a>    <span class="k">def</span> <span class="nf">set_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_selector_</span><span class="p">(</span><span class="s1">&#39;patterns&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
<div class="viewcode-block" id="FileTree.set_exclude"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.FileTree.set_exclude">[docs]</a>    <span class="k">def</span> <span class="nf">set_exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_selector_</span><span class="p">(</span><span class="s1">&#39;exclude&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
<div class="viewcode-block" id="FileTree.set_include"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.FileTree.set_include">[docs]</a>    <span class="k">def</span> <span class="nf">set_include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_selector_</span><span class="p">(</span><span class="s1">&#39;include&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_set_selector_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seltype</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
            <span class="n">append</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">seltype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;//&#39;</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;^&#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_dir</span><span class="p">,</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span> <span class="n">val</span> <span class="o">+=</span> <span class="s1">&#39;$&#39;</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">seltype</span><span class="p">,</span><span class="n">vals</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_selectors_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_patterns</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_patterns</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_selector_</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span></div>

<div class="viewcode-block" id="geodir"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.geodir">[docs]</a><span class="k">def</span> <span class="nf">geodir</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">from_north</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a direction in degrees in the form &#39;WNW&#39;&quot;&quot;&quot;</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;ENE&#39;</span><span class="p">,</span><span class="s1">&#39;NE&#39;</span><span class="p">,</span><span class="s1">&#39;NNE&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;NNW&#39;</span><span class="p">,</span><span class="s1">&#39;NW&#39;</span><span class="p">,</span><span class="s1">&#39;WNW&#39;</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;WSW&#39;</span><span class="p">,</span><span class="s1">&#39;SW&#39;</span><span class="p">,</span><span class="s1">&#39;SSW&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;SSE&#39;</span><span class="p">,</span><span class="s1">&#39;SE&#39;</span><span class="p">,</span><span class="s1">&#39;ESE&#39;</span><span class="p">]</span>
    <span class="n">nlab</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">dtheta</span> <span class="o">=</span> <span class="mf">360.</span><span class="o">/</span><span class="n">nlab</span>
    <span class="k">if</span> <span class="n">inverse</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">lb</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s2">&quot;Wrong geographic direction: </span><span class="si">%s</span><span class="s2">. Please use one of </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span>
                <span class="n">direction</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlab</span><span class="p">)</span><span class="o">*</span><span class="n">dtheta</span><span class="p">)[</span><span class="n">ll</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">from_north</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mf">90.</span><span class="o">-</span><span class="n">d</span>
        <span class="k">return</span> <span class="n">d</span>
    <span class="k">if</span> <span class="n">from_north</span> <span class="p">:</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="mf">90.</span> <span class="o">-</span> <span class="n">direction</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">direction</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.</span>
    <span class="k">return</span> <span class="n">labels</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">direction</span><span class="o">+</span><span class="n">dtheta</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">dtheta</span><span class="p">)</span><span class="o">%</span><span class="n">nlab</span><span class="p">]</span></div>


<div class="viewcode-block" id="main_geodir"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.main_geodir">[docs]</a><span class="k">def</span> <span class="nf">main_geodir</span><span class="p">(</span><span class="n">directions</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="n">getamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the dominant direction from a set of directions in degrees&quot;&quot;&quot;</span>
    <span class="n">cartesian</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directions</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cartesian</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;from_north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">directions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">directions</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">directions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">directions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">amp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">directions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">directions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">directions</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">directions</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">num</span> <span class="ow">and</span> <span class="n">amp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="mf">360.</span><span class="o">/</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="mf">360.</span><span class="o">/</span><span class="n">res</span><span class="p">,</span><span class="s1">&#39;360. must be a multiple of your resolution: </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">res</span>
        <span class="n">idirections</span> <span class="o">=</span> <span class="p">(((</span><span class="n">directions</span><span class="o">+</span><span class="mf">360.</span><span class="o">+</span><span class="n">res</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">)</span><span class="o">/</span><span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">bincount</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">360.</span><span class="o">/</span><span class="n">res</span><span class="p">))</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">idirections</span><span class="p">:</span>
            <span class="n">bincount</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">geodir</span><span class="p">(</span><span class="n">res</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">bincount</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">amp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">cartesian</span><span class="p">:</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmean</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">directions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ymean</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">directions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cartesian</span><span class="p">:</span>
            <span class="n">xmean</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">amp</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">directions</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">))</span>
            <span class="n">ymean</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">amp</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">directions</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">xmean</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ymean</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;There is no dominant directions&#39;</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">ymean</span><span class="p">,</span><span class="n">xmean</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">num</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">geodir</span><span class="p">(</span><span class="n">md</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">getamp</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">md</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xmean</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ymean</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">ymean</span><span class="p">,</span><span class="n">xmean</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span></div>


<div class="viewcode-block" id="intersect"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.intersect">[docs]</a><span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="n">seg1</span><span class="p">,</span><span class="n">seg2</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Intersection of two segments</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; intersect([1,10],(5,12))</span>
<span class="sd">        [5, 10]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">seg1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">seg2</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">seg2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">seg1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">length</span><span class="p">:</span> <span class="k">return</span> <span class="mf">0.</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">x0</span><span class="p">,</span><span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">seg1</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">seg2</span><span class="p">)),</span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">seg1</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">seg2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">length</span><span class="p">:</span> <span class="k">return</span> <span class="n">x1</span><span class="o">-</span><span class="n">x0</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">seg1</span><span class="p">)([</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">])</span></div>

<div class="viewcode-block" id="get_svn_revision"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.get_svn_revision">[docs]</a><span class="k">def</span> <span class="nf">get_svn_revision</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the revision number of a path</span>

<span class="sd">    Adapted from :class:`numpy.disutils.misc_util.Configuration`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">revision</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">max</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="n">m</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sin</span><span class="p">,</span> <span class="n">sout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen4</span><span class="p">(</span><span class="s1">&#39;svnversion&#39;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;revision&gt;\d+)&#39;</span><span class="p">,</span> <span class="n">sout</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">revision</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;revision&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">revision</span>
        <span class="kn">from</span> <span class="nn">numpy.distutils.misc_util</span> <span class="k">import</span> <span class="n">njoin</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s1">&#39;win32&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SVN_ASP_DOT_NET_HACK&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="n">njoin</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;_svn&#39;</span><span class="p">,</span><span class="s1">&#39;entries&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="n">njoin</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;.svn&#39;</span><span class="p">,</span><span class="s1">&#39;entries&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
            <span class="n">fstr</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fstr</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;?xml&#39;</span><span class="p">:</span>  <span class="c1"># pre 1.4</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;revision=&quot;(?P&lt;revision&gt;\d+)&quot;&#39;</span><span class="p">,</span><span class="n">fstr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">revision</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;revision&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># non-xml entries file --- check to be sure that</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;dir[\n\r]+(?P&lt;revision&gt;\d+)&#39;</span><span class="p">,</span> <span class="n">fstr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">revision</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;revision&#39;</span><span class="p">))</span>
    <span class="c1"># SR hack</span>
    <span class="k">if</span> <span class="n">revision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">subprocess</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;svnversion&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">revision</span></div>

<div class="viewcode-block" id="dirsize"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dirsize">[docs]</a><span class="k">def</span> <span class="nf">dirsize</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the size of a directory</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **folder**: path of the directory</span>
<span class="sd">        - **units**, optional:</span>

<span class="sd">            - ``&quot;b&quot;``: bytes</span>
<span class="sd">            - ``&quot;k&quot;``: Kb</span>
<span class="sd">            - ``&quot;m&quot;``: Mb</span>
<span class="sd">            - ``&quot;g&quot;``: Gb</span>
<span class="sd">            - ``&quot;t&quot;``: Tb</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">),</span> <span class="s1">&#39;Path not found: &#39;</span><span class="o">+</span><span class="n">folder</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">folder_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="n">folder_size</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">units</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">uu</span> <span class="o">=</span> <span class="s1">&#39;kmgt&#39;</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">folder_size</span><span class="o">/</span><span class="p">(</span><span class="mf">1024.</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">uu</span><span class="p">))</span></div>

<div class="viewcode-block" id="closeto"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.closeto">[docs]</a><span class="k">def</span> <span class="nf">closeto</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1.e-5</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.e-8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check which values of a numeric array are close to those of another array</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **a**: A :class:`numpy.ndarray` variable.</span>
<span class="sd">        - **b**: Another array.</span>

<span class="sd">    :See also: :func:`~numpy.allclose`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">nomask</span>
    <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">filled</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">|=</span> <span class="n">b</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">filled</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">xinf</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">xinf</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">),</span> <span class="n">atol</span> <span class="o">+</span> <span class="n">rtol</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="o">==</span><span class="n">y</span>
        <span class="n">g</span> <span class="o">=</span> <span class="o">~</span><span class="n">xinf</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">xinf</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">xinf</span><span class="p">]</span>
        <span class="n">b</span><span class="p">[</span><span class="o">~</span><span class="n">xinf</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">),</span> <span class="n">atol</span> <span class="o">+</span> <span class="n">rtol</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">nomask</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="MV2_concatenate"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.MV2_concatenate">[docs]</a><span class="k">def</span> <span class="nf">MV2_concatenate</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axisid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axisattributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">arrays</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span> <span class="n">arrays</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">arrays</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span> <span class="k">return</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">axisid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axisattributes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">setAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MV2_axisConcatenate</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">],</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">axisid</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">axisattributes</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">cp_atts</span><span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">var</span></div>
<span class="n">MV2_concatenate</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">concatenate</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="MV2_axisConcatenate"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.MV2_axisConcatenate">[docs]</a><span class="k">def</span> <span class="nf">MV2_axisConcatenate</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Advanced version of MV2.axisConcatenate&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">axes</span> <span class="k">import</span> <span class="n">isaxis</span>
    <span class="c1"># Single</span>
    <span class="k">if</span> <span class="n">isaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">axes</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">return</span> <span class="n">axes</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">return</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Attributes</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
    <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span>

    <span class="c1"># Time units</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isTime</span><span class="p">():</span>
        <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">un</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">un</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">un</span><span class="o">!=</span><span class="n">units</span><span class="p">:</span>
                    <span class="n">axis</span><span class="o">.</span><span class="n">toRelativeTime</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>

    <span class="c1"># Basic concatenate</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">axisConcatenate</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axis</span></div>
<span class="n">MV2_axisConcatenate</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">axisConcatenate</span><span class="o">.</span><span class="vm">__doc__</span>


<span class="k">def</span> <span class="nf">_box2xyminmax_</span><span class="p">(</span><span class="n">box</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">box</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">box</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;You must provide a variable with a valid grid&#39;</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span>
    <span class="kn">from</span> <span class="nn">grid.misc</span> <span class="k">import</span> <span class="n">isgrid</span><span class="p">,</span> <span class="n">get_xy</span>
    <span class="k">if</span> <span class="n">isgrid</span><span class="p">(</span><span class="n">box</span><span class="p">):</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">get_xy</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">box</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">box</span>
    <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span>

<span class="k">def</span> <span class="nf">_returnbox_</span><span class="p">(</span><span class="n">oldbox</span><span class="p">,</span> <span class="n">newbox</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oldbox</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">oldbox</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">newbox</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oldbox</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="n">newbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">newbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="n">newbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">newbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">newbox</span><span class="p">)</span>


<div class="viewcode-block" id="scalebox"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.scalebox">[docs]</a><span class="k">def</span> <span class="nf">scalebox</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymargin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Alter box limits with a zoom factor</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **box**: A list of ``[xmin,ymin,xmax,ymax]``.</span>
<span class="sd">        - **factor**: Zoom factor where 1 means no change,</span>
<span class="sd">          and a factor &lt; 1 means a smaller box.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; scalebox([0,0,1,2], 1.1)</span>
<span class="sd">        [-0.55, -1.10, 1.55, 2.55]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Scale</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_box2xyminmax_</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">factor</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*.</span><span class="mi">5</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">factor</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*.</span><span class="mi">5</span>

    <span class="c1"># Margin</span>
    <span class="k">if</span> <span class="n">ymargin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ymargin</span> <span class="o">=</span> <span class="n">xmargin</span>
    <span class="k">if</span> <span class="n">xmargin</span><span class="p">:</span>
        <span class="n">dx</span> <span class="o">+=</span> <span class="n">xmargin</span>
    <span class="k">if</span> <span class="n">ymargin</span><span class="p">:</span>
        <span class="n">dy</span> <span class="o">+=</span> <span class="n">ymargin</span>

    <span class="n">newbox</span> <span class="o">=</span> <span class="n">xmin</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="n">ymin</span><span class="o">-</span><span class="n">dy</span><span class="p">,</span> <span class="n">xmax</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">ymax</span><span class="o">+</span><span class="n">dy</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">_returnbox_</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">newbox</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">square</span><span class="p">:</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">squarebox</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">box</span></div>

<div class="viewcode-block" id="zoombox"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.zoombox">[docs]</a><span class="k">def</span> <span class="nf">zoombox</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymargin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Alias for :func:`scalebox` with ``1/factor`` as zoom factor.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">scalebox</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">factor</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="n">square</span><span class="p">,</span> <span class="n">xmargin</span><span class="o">=</span><span class="n">xmargin</span><span class="p">,</span> <span class="n">ymargin</span><span class="o">=</span><span class="n">ymargin</span><span class="p">)</span></div>

<div class="viewcode-block" id="squarebox"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.squarebox">[docs]</a><span class="k">def</span> <span class="nf">squarebox</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get an approximate ``[xmin, ymin, xmax, ymax]`` that is square in meters&quot;&quot;&quot;</span>
    <span class="n">lonmin</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmax</span> <span class="o">=</span> <span class="n">_box2xyminmax_</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="n">dlon</span> <span class="o">=</span> <span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span>
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">latmax</span><span class="o">-</span><span class="n">latmin</span>
    <span class="n">mlon</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lonmin</span> <span class="o">+</span> <span class="n">lonmax</span><span class="p">)</span>
    <span class="n">mlat</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">latmin</span> <span class="o">+</span> <span class="n">latmax</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">dlon</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">mlat</span><span class="p">))</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">dlat</span> <span class="o">*</span> <span class="mf">1.</span>
    <span class="n">dyx</span> <span class="o">=</span> <span class="n">dy</span><span class="o">/</span><span class="n">dx</span>
    <span class="k">if</span> <span class="n">dyx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dlon</span> <span class="o">*=</span> <span class="n">dyx</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">mlon</span> <span class="o">-</span> <span class="n">dlon</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">mlon</span> <span class="o">+</span> <span class="n">dlon</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dlat</span> <span class="o">/=</span> <span class="n">dyx</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">mlat</span> <span class="o">-</span> <span class="n">dlat</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">mlat</span> <span class="o">+</span> <span class="n">dlat</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">newbox</span> <span class="o">=</span> <span class="n">scalebox</span><span class="p">([</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmax</span><span class="p">],</span> <span class="n">scale</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_returnbox_</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">newbox</span><span class="p">)</span></div>

<div class="viewcode-block" id="minbox"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.minbox">[docs]</a><span class="k">def</span> <span class="nf">minbox</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">dxmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dymin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensure that a box as minimal extents&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dxmin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dymin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">box</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_box2xyminmax_</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dxmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dxmin</span><span class="p">:</span>
        <span class="n">xmean</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmean</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmean</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="k">if</span> <span class="n">dymin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dymin</span><span class="p">:</span>
        <span class="n">ymean</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">+</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymean</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dymin</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymean</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dymin</span>
    <span class="n">newbox</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span>
    <span class="k">return</span> <span class="n">_returnbox_</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">newbox</span><span class="p">)</span></div>

<div class="viewcode-block" id="history"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.history">[docs]</a><span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">nbcommand</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display the command history for the interactive python.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">readline</span>
    <span class="k">if</span> <span class="n">nbcommand</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">readline</span><span class="o">.</span><span class="n">get_current_history_length</span><span class="p">()</span><span class="o">-</span><span class="n">nbcommand</span><span class="p">,</span><span class="n">readline</span><span class="o">.</span><span class="n">get_current_history_length</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">readline</span><span class="o">.</span><span class="n">get_current_history_length</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">readline</span><span class="o">.</span><span class="n">get_history_item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>


<div class="viewcode-block" id="create_selector"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.create_selector">[docs]</a><span class="k">def</span> <span class="nf">create_selector</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a :class:`cdms2.selectors.Selector`</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **args**: Each item of args is treated in a special way:</span>

<span class="sd">            - A dictionary is treated using: ``selector.refine(**args[i])``</span>
<span class="sd">            - A list  is treated using: ``selector.refine(*args[i])``</span>
<span class="sd">            - Else (single slice, tuple, etc): ``selector.refine(args[i])``</span>

<span class="sd">        - **kwargs**: Items are integrated using: ``selector.refine(**kwargs)``</span>

<span class="sd">    :Examples:</span>

<span class="sd">        &gt;&gt;&gt; create_selector((time1,time2),slice(0,1),lat=(lat1,lat2))</span>
<span class="sd">        &gt;&gt;&gt; create_selector([(time1,time2),(lat1,lat2)],(lon1,lon2))</span>
<span class="sd">        &gt;&gt;&gt; selector2 = create_selector(selector1, lon=(lon1,lon2))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">selectors</span><span class="o">.</span><span class="n">Selector</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">selector</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="o">**</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">selector</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span><span class="n">selector</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">selector</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">val</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">selector</span></div>

<div class="viewcode-block" id="selector2str"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.selector2str">[docs]</a><span class="k">def</span> <span class="nf">selector2str</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a selector to a generic string where &lt;obj ...&gt; labels are removed</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; sel = cdms2.selectors.Selector(slice(2,5),time=(4,6))</span>
<span class="sd">        &gt;&gt;&gt; selector2str(sel)</span>
<span class="sd">        &#39;((slice(2, 5, None)),(&quot;time&quot;, (4, 6)))&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">selectors</span><span class="o">.</span><span class="n">Selector</span><span class="p">):</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">create_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">selector</span><span class="o">.</span><span class="n">components</span><span class="p">():</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">ss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span></div>

<div class="viewcode-block" id="split_selector"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.split_selector">[docs]</a><span class="k">def</span> <span class="nf">split_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split a selector into (positionalComponents, axisComponents).</span>

<span class="sd">    :Params:</span>
<span class="sd">        - **selector**: cdms2.selectors.Selector</span>

<span class="sd">    :Return: a tuple of:</span>
<span class="sd">        - the list of positionalComponents</span>
<span class="sd">        - the :class:`~collections.OrderedDict` of axisComponents</span>

<span class="sd">    :Exemple:</span>

<span class="sd">        &gt;&gt;&gt; selector = cdms2.selectors.Selector(slice(2,5),time=(4,6))</span>
<span class="sd">        &gt;&gt;&gt; split_selector(selector)</span>
<span class="sd">        ((slice(2, 5, None),), {&#39;time&#39;: (4, 6)})</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">posed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">named</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">selector</span><span class="o">.</span><span class="n">components</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">selectors</span><span class="o">.</span><span class="n">positionalComponent</span><span class="p">):</span>
            <span class="n">posed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">selectors</span><span class="o">.</span><span class="n">requiredComponent</span><span class="p">):</span>
            <span class="n">named</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">spec</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">posed</span><span class="p">),</span> <span class="n">named</span></div>

<div class="viewcode-block" id="filter_selector"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.filter_selector">[docs]</a><span class="k">def</span> <span class="nf">filter_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keeppos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noslice</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Filter a :class:`cdms2.selectors.Selector` instance to keep or remove only a list of ids</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **selector**: A :class:`cdms2.selectors.Selector` instance.</span>
<span class="sd">        - **ids**, optional: Allowed ids.</span>
<span class="sd">        - **copy**, optional: Filter original or copy?</span>
<span class="sd">        - **out**, optional: Filter in (keep target selections)</span>
<span class="sd">          or out(remove target selections)?</span>
<span class="sd">        - **keeppos**, optional: Keep positional components?</span>
<span class="sd">        - **noslice**, optional: Remove slices?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">selectors</span><span class="o">.</span><span class="n">Selector</span><span class="p">):</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">create_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">copy</span><span class="p">:</span> <span class="n">selector</span> <span class="o">=</span> <span class="n">selector</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">selector</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
    <span class="n">ipos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keeppos</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span> <span class="n">keeppos</span> <span class="o">=</span> <span class="p">[</span><span class="n">keeppos</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">selector</span><span class="o">.</span><span class="n">_Selector__components</span><span class="p">):</span>

         <span class="c1"># Positional</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">selectors</span><span class="o">.</span><span class="n">positionalComponent</span><span class="p">):</span>
            <span class="n">ipos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">keeppos</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">keeppos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">ipos</span> <span class="ow">in</span> <span class="n">keeppos</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">out</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ipos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keeppos</span> <span class="ow">and</span> <span class="n">out</span><span class="p">):</span>
                <span class="k">continue</span>

        <span class="c1"># Named</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">comp</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">ids</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">out</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span> <span class="ow">and</span> <span class="n">out</span><span class="p">)):</span>
            <span class="k">continue</span>

        <span class="c1"># Remove</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">_Selector__components</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

    <span class="c1"># Remove slices?</span>
    <span class="k">if</span> <span class="n">noslice</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">selector</span><span class="o">.</span><span class="n">_Selector__components</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s1">&#39;spec&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="n">selector</span><span class="o">.</span><span class="n">_Selector__components</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">selector</span></div>

<div class="viewcode-block" id="filter_level_selector"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.filter_level_selector">[docs]</a><span class="k">def</span> <span class="nf">filter_level_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Filter a :class:`cdms2.selectors.Selector` instance to keep or remove z dimension</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span> <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">ids</span><span class="p">]</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">ids</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cdms2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">level_aliases</span><span class="p">)</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;lev&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="s1">&#39;dep&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">filter_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="squeeze_variable"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.squeeze_variable">[docs]</a><span class="k">def</span> <span class="nf">squeeze_variable</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">asmv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove singleton axes from a MV2 variable</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **var**: MV2 array.</span>
<span class="sd">        - **spec**, optional: Squeeze specification.</span>

<span class="sd">            - ``True`` or ``None``: Simply squeeze out all singletons.</span>
<span class="sd">            - ``False``: Does nothing (return the same variable).</span>
<span class="sd">            - A string containing geo letters like &#39;xyzt&#39; to remove</span>
<span class="sd">              axes according to their type.</span>

<span class="sd">        - **asmv**, optional: If True and input is a MV2 array,</span>
<span class="sd">          always return a MV2 array, even if all</span>
<span class="sd">          result is a scalar value or masked.</span>


<span class="sd">    :Examples:</span>

<span class="sd">        &gt;&gt;&gt; squeeze_variable(var)</span>
<span class="sd">        &gt;&gt;&gt; squeeze_variable(var, spec=&#39;tx&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Nothing to do</span>
    <span class="k">if</span> <span class="n">spec</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var</span>

    <span class="c1"># Squeeze all singletons</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">atts</span> <span class="o">=</span> <span class="n">get_atts</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">vacumm.misc.grid.misc</span> <span class="k">import</span> <span class="n">get_grid</span><span class="p">,</span> <span class="n">set_grid</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">get_grid</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spec</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">spec</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">spec</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="p">(</span><span class="n">squeeze</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">asmv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="n">set_atts</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">atts</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">var</span>
        <span class="k">return</span> <span class="n">var</span>

    <span class="c1"># Squeeze selection</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">axtype</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getOrder</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">axtype</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">iaxis</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">axtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">iaxis</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getAxisList</span><span class="p">()</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iaxis</span><span class="p">)</span>
                <span class="n">set_atts</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">atts</span><span class="p">)</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">iaxis</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">setAxisList</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
                    <span class="n">set_grid</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">var</span></div>

<div class="viewcode-block" id="grow_variables"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.grow_variables">[docs]</a><span class="k">def</span> <span class="nf">grow_variables</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grow dimensions of var1 and var2 until their match</span>

<span class="sd">    It is an improved version :func:`genutil.grower.grower`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Guess and merge orders</span>
    <span class="kn">from</span> <span class="nn">axes</span> <span class="k">import</span> <span class="n">merge_orders</span><span class="p">,</span> <span class="n">set_order</span>
    <span class="kn">from</span> <span class="nn">grid.misc</span> <span class="k">import</span> <span class="n">set_grid</span>
    <span class="n">order1</span><span class="p">,</span> <span class="n">order2</span> <span class="o">=</span> <span class="n">merge_orders</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">order1</span><span class="o">+</span><span class="n">order2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s2">&quot;All axes must have a known type (xyzt) to grow variables&quot;</span><span class="p">)</span>
    <span class="n">var1</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
    <span class="n">var2</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span>
    <span class="n">set_order</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">order1</span><span class="p">)</span>
    <span class="n">set_order</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">order2</span><span class="p">)</span>
    <span class="n">rev</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">order1</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">order2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rev</span><span class="p">:</span> <span class="c1"># reverse?</span>
        <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">var2</span><span class="p">,</span> <span class="n">var1</span>

    <span class="c1"># Grow variables</span>
    <span class="n">grid1</span> <span class="o">=</span> <span class="n">var1</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span>
    <span class="n">grid2</span> <span class="o">=</span> <span class="n">var2</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span>
    <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">grower</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">grid1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">grid2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ggrid1</span> <span class="o">=</span> <span class="n">grid1</span> <span class="ow">or</span> <span class="n">grid2</span>
        <span class="n">ggrid2</span> <span class="o">=</span> <span class="n">grid2</span> <span class="ow">or</span> <span class="n">grid1</span>
        <span class="n">set_grid</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">ggrid1</span><span class="p">)</span>
        <span class="n">set_grid</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">ggrid2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rev</span><span class="p">:</span> <span class="c1"># reverse?</span>
        <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">var2</span><span class="p">,</span> <span class="n">var1</span>
    <span class="k">return</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span></div>

<div class="viewcode-block" id="grow_depth"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.grow_depth">[docs]</a><span class="k">def</span> <span class="nf">grow_depth</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">getvar</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make depth and variable have the same shape</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **var**: A MV2 array with a depth dimension.</span>
<span class="sd">        - **depth**, optional: Depth axis or array. If None,</span>
<span class="sd">          it is guessed from var. If not found, it defaults to ``default``.</span>
<span class="sd">        - **default**, optional: Default value for depth if not found.</span>
<span class="sd">        - **mode**, optional: How to handle case where shape of var</span>
<span class="sd">          is changed:</span>

<span class="sd">            - ``None``: Nothing happens</span>
<span class="sd">            - ``&quot;warn&quot;``: A warning with :func:`~warnings.warn`.</span>
<span class="sd">            - ``&quot;raise&quot;``: Raise a :exc:`~vacumm.VACUMMError` exception.</span>

<span class="sd">    :Return: ``var, depth`` where ``depth`` may be a scalar equal to ``default``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getLevel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">N</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">depth</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">depth</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">designateLevel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="o">!=</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">var</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">grow_variables</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="o">!=</span><span class="n">s</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Shape of variable has changed (</span><span class="si">%s</span><span class="s1">-&gt;</span><span class="si">%s</span><span class="s1">) when guessing depth&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;warn&#39;</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;raise&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">getvar</span><span class="p">:</span> <span class="k">return</span> <span class="n">var</span><span class="p">,</span> <span class="n">depth</span>
    <span class="k">return</span> <span class="n">depth</span></div>

<div class="viewcode-block" id="grow_lat"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.grow_lat">[docs]</a><span class="k">def</span> <span class="nf">grow_lat</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">getvar</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make latitude and variable have the same shape</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **var**: A MV2 array with a lat dimension.</span>
<span class="sd">        - **depth**, optional: Latitude axis or array. If None,</span>
<span class="sd">          it is guessed from var.</span>
<span class="sd">        - **default**, optional: Default value for lat if not found.</span>
<span class="sd">        - **mode**, optional: How to handle case where shape of var</span>
<span class="sd">          is changed:</span>

<span class="sd">            - ``None``: Nothing happens</span>
<span class="sd">            - ``&quot;warn&quot;``: A warning with :func:`~warnings.warn`.</span>
<span class="sd">            - ``&quot;raise&quot;``: Raise a :exc:`~vacumm.VACUMMError` exception.</span>

<span class="sd">    :Return: ``var, lat where lat may be ``None``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">N</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">lat</span><span class="p">):</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">lat</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">designateLatitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lat</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">lat</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">designateLongitude</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">var</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">grow_variables</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="o">!=</span><span class="n">s</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Shape of variable has changed (</span><span class="si">%s</span><span class="s1">-&gt;</span><span class="si">%s</span><span class="s1">) when guessing latitude&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;warn&#39;</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;raise&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">getvar</span><span class="p">:</span> <span class="k">return</span> <span class="n">var</span><span class="p">,</span> <span class="n">lat</span>
    <span class="k">return</span> <span class="n">lat</span></div>


<div class="viewcode-block" id="N_choose"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.N_choose">[docs]</a><span class="k">def</span> <span class="nf">N_choose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Robust version to :func:`numpy.choose` valid also</span>
<span class="sd">    for masked arrays.</span>

<span class="sd">    The func:`numpy.choose` function fails when length of</span>
<span class="sd">    choices is greater than 32!</span>
<span class="sd">    You can verify it with::</span>

<span class="sd">        &gt;&gt;&gt; numpy.choose([0], numpy.zeros((50, 1))) ! FAIL</span>
<span class="sd">        &gt;&gt;&gt; N_choose([0], numpy.zeros((50, 1))) ! SUCCESS</span>

<span class="sd">    .. note:: Performances of this function can be improved, even</span>
<span class="sd">        if it should not take alot of time to run in the vast</span>
<span class="sd">        majority of cases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;wrap&#39;</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;clip&#39;</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">+</span><span class="mi">100</span>
    <span class="n">N_where</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">where</span> <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">else</span> <span class="n">N</span><span class="o">.</span><span class="n">where</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">out</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">N_where</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="n">choices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">out</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="ArgList"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.ArgList">[docs]</a><span class="k">class</span> <span class="nc">ArgList</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Utility to always manage arguments as list and return results as input</span>

<span class="sd">    :Examples:</span>

<span class="sd">        &gt;&gt;&gt; a = &#39;a&#39;</span>
<span class="sd">        &gt;&gt;&gt; al = ArgList(a)</span>
<span class="sd">        &gt;&gt;&gt; al.get() # input for function as list</span>
<span class="sd">        [&#39;a&#39;]</span>
<span class="sd">        &gt;&gt;&gt; al.put([&#39;aa&#39;]) # output as input</span>
<span class="sd">        &#39;aa&#39;</span>

<span class="sd">        &gt;&gt;&gt; a = [&#39;a&#39;,&#39;b&#39;]</span>
<span class="sd">        &gt;&gt;&gt; al = ArgList(a)</span>
<span class="sd">        &gt;&gt;&gt; al.get()</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">        &gt;&gt;&gt; al.put([&#39;aa&#39;])</span>
<span class="sd">        [&#39;aa&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argsi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argsi</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argsi</span> <span class="o">=</span> <span class="n">argsi</span>

<div class="viewcode-block" id="ArgList.get"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.ArgList.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">argsi</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">argsi</span></div>

<div class="viewcode-block" id="ArgList.put"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.ArgList.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argso</span><span class="p">):</span>
        <span class="n">so</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argso</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">so</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">single</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">so</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">single</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">argso</span>
        <span class="k">if</span> <span class="n">so</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">single</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">argso</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">argso</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="ArgTuple"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.ArgTuple">[docs]</a><span class="k">class</span> <span class="nc">ArgTuple</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Utility to always manage arguments as tuple and return results as input</span>

<span class="sd">    :Examples:</span>

<span class="sd">        &gt;&gt;&gt; a = &#39;a&#39;</span>
<span class="sd">        &gt;&gt;&gt; al = ArgTuple(a)</span>
<span class="sd">        &gt;&gt;&gt; al.get() # input for function as tuple</span>
<span class="sd">        [&#39;a&#39;]</span>
<span class="sd">        &gt;&gt;&gt; al.put([&#39;aa&#39;]) # output as input</span>
<span class="sd">        &#39;aa&#39;</span>

<span class="sd">        &gt;&gt;&gt; a = [&#39;a&#39;,&#39;b&#39;]</span>
<span class="sd">        &gt;&gt;&gt; al = ArgTuple(a)</span>
<span class="sd">        &gt;&gt;&gt; al.get()</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">        &gt;&gt;&gt; al.put([&#39;aa&#39;])</span>
<span class="sd">        [&#39;aa&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argsi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argsi</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argsi</span> <span class="o">=</span> <span class="n">argsi</span>

<div class="viewcode-block" id="ArgTuple.get"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.ArgTuple.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argsi</span><span class="p">,</span> <span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">argsi</span></div>

<div class="viewcode-block" id="ArgTuple.put"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.ArgTuple.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argso</span><span class="p">):</span>
        <span class="n">so</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argso</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">so</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">single</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">so</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">single</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">argso</span>
        <span class="k">if</span> <span class="n">so</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">single</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">argso</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">argso</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="set_lang"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.set_lang">[docs]</a><span class="k">def</span> <span class="nf">set_lang</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;en_US.UTF-8&#39;</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the default and numeric languages</span>

<span class="sd">    The numeric language defaults to the default language.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">locale</span>
    <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">num</span> <span class="o">=</span> <span class="n">default</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LANG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
    <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LC_NUMERIC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
    <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_NUMERIC</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span></div>

<div class="viewcode-block" id="set_lang_fr"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.set_lang_fr">[docs]</a><span class="k">def</span> <span class="nf">set_lang_fr</span><span class="p">(</span><span class="n">ennum</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set lang to french, except the numeric lang which is set to english by default&quot;&quot;&quot;</span>
    <span class="n">num</span> <span class="o">=</span> <span class="s1">&#39;en_US.UTF-8&#39;</span> <span class="k">if</span> <span class="n">ennum</span> <span class="k">else</span> <span class="s1">&#39;fr_FR.UTF-8&#39;</span>
    <span class="n">set_lang</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;fr_FR.UTF-8&#39;</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)</span></div>


<div class="viewcode-block" id="numod"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.numod">[docs]</a><span class="k">def</span> <span class="nf">numod</span><span class="p">(</span><span class="o">*</span><span class="n">vv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the needed numeric module to be able to handle all specified variables</span>

<span class="sd">    :Params: Scalars or numeric arrays.</span>

<span class="sd">    :Return: :mod:`numpy`, :mod:`numpy.ma` or :mod:`MV2`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nm</span> <span class="o">=</span> <span class="n">N</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="n">MV2</span>
        <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="n">nm</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span>
    <span class="k">return</span> <span class="n">nm</span></div>


<div class="viewcode-block" id="checkdir"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.checkdir">[docs]</a><span class="k">def</span> <span class="nf">checkdir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">asfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chmod</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make sure that a directory exists and has right access</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **path**: Directory of file path.</span>
<span class="sd">        - **asfile**, optional: Interpret ``path`` as file name instead of a</span>
<span class="sd">          directory name. When ``None``, it is set to ``True`` if it has a dot</span>
<span class="sd">          (``&quot;.&quot;``) inside.</span>

<span class="sd">      :Return: The directory name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">asfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">asfile</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">path</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">asfile</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s2">&quot;Path exists but is not a directory: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">chmod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chmod</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="splitidx"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.splitidx">[docs]</a><span class="k">def</span> <span class="nf">splitidx</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">crit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a list of split indices for a 1d array according to a criteria</span>



<span class="sd">    Params</span>
<span class="sd">    ------</span>
<span class="sd">    arr: 1D array</span>
<span class="sd">    crit: int, list of int, int array, float</span>
<span class="sd">        If a positive int, it refers to the number of almost equal intervals.</span>
<span class="sd">        If a negative int, it refers to the max number of item per interval.</span>
<span class="sd">        If a list or array of int, it is directly intepreted as split indices,</span>
<span class="sd">        with some checks.</span>
<span class="sd">        If a float, the input array is monotically increasing and the intervals</span>
<span class="sd">        are at least of size crit.</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    idx: list of ints</span>
<span class="sd">        Indices that are compatible ith :func:`numpy.array_split`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check array</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">[:])</span>
    <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">arr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Positive integer = equal size</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">int</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">crit</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">crit</span><span class="o">&gt;</span><span class="n">nx</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">crit</span><span class="p">)</span>

    <span class="c1"># Negative integer = fixed size</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">int</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="n">crit</span>
        <span class="k">if</span> <span class="n">crit</span><span class="o">&gt;</span><span class="n">nx</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">crit</span><span class="p">)</span>

    <span class="c1"># Float = equal value</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crit</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="s1">&#39;Array must be monotically increasing&#39;</span>
        <span class="k">if</span> <span class="n">crit</span><span class="o">&gt;=</span><span class="n">arr</span><span class="o">.</span><span class="n">ptp</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cum</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">cum</span><span class="o">+</span><span class="n">crit</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">cum</span> <span class="o">+=</span> <span class="n">crit</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="n">cum</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">idx</span>

    <span class="c1"># Direct list of ints</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">idx</span><span class="p">[</span><span class="n">idx</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nx</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[(</span><span class="n">idx</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">idx</span><span class="o">&lt;</span><span class="n">nx</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">idx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>


<div class="viewcode-block" id="CaseChecker"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.CaseChecker">[docs]</a><span class="k">class</span> <span class="nc">CaseChecker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check that a string that represents a &quot;case&quot; is valid&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valid_cases</span><span class="p">,</span> <span class="n">errmode</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">casename</span><span class="o">=</span><span class="s2">&quot;parameter&quot;</span><span class="p">):</span>

        <span class="c1"># Valid cases</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">valid_cases</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">valid_cases</span> <span class="o">=</span> <span class="p">[</span><span class="n">valid_cases</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_cases</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">valid_cases</span><span class="p">)</span>
        <span class="n">valid_cases</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span><span class="n">valid_cases</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ic</span> <span class="o">=</span> <span class="n">ic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">includes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excludes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iglobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eglobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">valid_cases</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">case</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">has_magic</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eglobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">excludes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">glob</span><span class="o">.</span><span class="n">has_magic</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iglobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">includes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">))</span>

<span class="c1">#        print self.includes</span>
<span class="c1">#        print self.iglobs</span>
<span class="c1">#        print self.excludes</span>
<span class="c1">#        print self.eglobs</span>

        <span class="c1"># Error mode</span>
        <span class="k">assert</span> <span class="n">errmode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">callable</span><span class="p">(</span><span class="n">errmode</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;errmode must&#39;</span>
            <span class="s1">&#39; be either &quot;raise&quot;,  &quot;exit&quot; or a callable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errmode</span> <span class="o">=</span> <span class="n">errmode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">casename</span> <span class="o">=</span> <span class="n">casename</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_isvalid_single_</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">valids</span><span class="p">,</span> <span class="n">globs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">valids</span> <span class="ow">and</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">valids</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">globs</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">globs</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="CaseChecker.isvalid"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.CaseChecker.isvalid">[docs]</a>    <span class="k">def</span> <span class="nf">isvalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that case is a valid string or None&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">case</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ic</span><span class="p">:</span>
            <span class="n">case</span> <span class="o">=</span> <span class="n">case</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Exclusion</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">excludes</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">eglobs</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid_single_</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">excludes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eglobs</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Inclusion</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">includes</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">iglobs</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid_single_</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">includes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iglobs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaseChecker.check"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.CaseChecker.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that case is a valid string or None and make an error if not&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvalid</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">imessage</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">includes</span><span class="p">:</span>
                <span class="n">imessage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;it must be one of </span><span class="si">{self.includes}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iglobs</span><span class="p">:</span>
                <span class="n">imessage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;it must match one of </span><span class="si">{self.iglobs}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">imessage</span> <span class="o">=</span> <span class="s1">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">imessage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">imessage</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imessage</span><span class="p">)</span>
            <span class="n">emessage</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excludes</span><span class="p">:</span>
                <span class="n">emessage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;it cannot be one of </span><span class="si">{self.excludes}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eglobs</span><span class="p">:</span>
                <span class="n">emessage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;it cannot be one of </span><span class="si">{self.eglobs}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">emessage</span> <span class="o">=</span> <span class="s1">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">emessage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">emessage</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emessage</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Invalid </span><span class="si">{self.casename}</span><span class="s2"> &#39;</span><span class="si">{case}</span><span class="s2">&#39;: &quot;</span> <span class="o">+</span>
                <span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span></div>

    <span class="fm">__call__</span> <span class="o">=</span> <span class="n">check</span>

<div class="viewcode-block" id="CaseChecker.error"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.CaseChecker.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exit with an error&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errmode</span><span class="o">==</span><span class="s1">&#39;exit&#39;</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errmode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errmode</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="check_case"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.check_case">[docs]</a><span class="k">def</span> <span class="nf">check_case</span><span class="p">(</span><span class="n">cases</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;isvalid&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check that case is valid using :class:``CaseChecker` and allowed cases&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;isvalid&#39;</span><span class="p">,</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="s1">&#39;isvalid&#39;</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;errmode&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">CaseChecker</span><span class="p">(</span><span class="n">cases</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;isvalid&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cs</span><span class="o">.</span><span class="n">isvalid</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">case</span><span class="p">)</span></div>



<div class="viewcode-block" id="indices2slices"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.indices2slices">[docs]</a><span class="k">def</span> <span class="nf">indices2slices</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a list of indices to a list of slices&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">indices</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">ii</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    <span class="n">slices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dii</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
    <span class="n">iic</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dii</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">slices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iic</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">iic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">slices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">slices</span></div>

<div class="viewcode-block" id="dicttree_get"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dicttree_get">[docs]</a><span class="k">def</span> <span class="nf">dicttree_get</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get value of tree of dicts&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dd</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;__default__&#39;</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;__default__&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">return</span> <span class="n">dicttree_get</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="o">*</span><span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="dicttree_set"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.dicttree_set">[docs]</a><span class="k">def</span> <span class="nf">dicttree_set</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="o">*</span><span class="n">keys</span><span class="p">,</span> <span class="o">**</span><span class="n">items</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set values in a tree of dicts</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dd: dict</span>
<span class="sd">        Dict of dicts to fill</span>
<span class="sd">    keys: strings</span>
<span class="sd">    items: dict</span>
<span class="sd">        To set</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; dd = {}</span>
<span class="sd">    &gt;&gt;&gt; dicttree_set(dd, &#39;sec&#39;, &#39;subsec&#39;, &#39;subsubsec&#39;, option=15)</span>
<span class="sd">    &gt;&gt;&gt; dicttree_set(dd, value1=30, value2=20)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s1">&#39;Input must a dict&#39;</span>
    <span class="n">basedd</span> <span class="o">=</span> <span class="n">dd</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">dd</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
            <span class="n">dd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">items</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">basedd</span></div>

<div class="viewcode-block" id="bivariate_normal"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.bivariate_normal">[docs]</a><span class="k">def</span> <span class="nf">bivariate_normal</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">sigmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sigmay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                     <span class="n">mux</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">muy</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sigmaxy</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bivariate Gaussian distribution for equal shape *X*, *Y*.</span>
<span class="sd">    See `bivariate normal</span>
<span class="sd">    &lt;http://mathworld.wolfram.com/BivariateNormalDistribution.html&gt;`_</span>
<span class="sd">    at mathworld.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Xmu</span> <span class="o">=</span> <span class="n">X</span><span class="o">-</span><span class="n">mux</span>
    <span class="n">Ymu</span> <span class="o">=</span> <span class="n">Y</span><span class="o">-</span><span class="n">muy</span>

    <span class="n">rho</span> <span class="o">=</span> <span class="n">sigmaxy</span><span class="o">/</span><span class="p">(</span><span class="n">sigmax</span><span class="o">*</span><span class="n">sigmay</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Xmu</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sigmax</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ymu</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sigmay</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">Xmu</span><span class="o">*</span><span class="n">Ymu</span><span class="o">/</span><span class="p">(</span><span class="n">sigmax</span><span class="o">*</span><span class="n">sigmay</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sigmax</span><span class="o">*</span><span class="n">sigmay</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">/</span> <span class="n">denom</span></div>

<div class="viewcode-block" id="scan_format_string"><a class="viewcode-back" href="../../../library/misc.misc.html#vacumm.misc.misc.scan_format_string">[docs]</a><span class="k">def</span> <span class="nf">scan_format_string</span><span class="p">(</span><span class="n">format_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scan a format string using :class:`string.Formatter`</span>

<span class="sd">    Source: SONAT</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    format_string: string</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    dict:</span>
<span class="sd">        Positional and keyword fields with their properties in a dict</span>
<span class="sd">    dict:</span>
<span class="sd">        Dictionary of properties with the following keys:</span>
<span class="sd">        - positional: list of positional field keys</span>
<span class="sd">        - keyword: list of keyword field keys</span>
<span class="sd">        - with_time: list of keys that have a date pattern format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;with_time&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;positional&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;keyword&#39;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">Formatter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">literal_text</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">,</span> <span class="n">conversion</span> <span class="ow">in</span> \
            <span class="n">f</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">format_string</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">first</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span><span class="o">.</span><span class="n">_formatter_field_name_split</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

        <span class="n">scan</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span> <span class="n">format_spec</span><span class="o">=</span><span class="n">format_spec</span><span class="p">,</span>
                    <span class="n">conversion</span><span class="o">=</span><span class="n">conversion</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">)):</span>
            <span class="n">props</span><span class="p">[</span><span class="s1">&#39;positional&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">props</span><span class="p">[</span><span class="s1">&#39;keyword&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;%&#39;</span> <span class="ow">in</span> <span class="n">format_spec</span><span class="p">:</span>
            <span class="n">props</span><span class="p">[</span><span class="s1">&#39;with_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fields</span><span class="p">,</span> <span class="n">props</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" >vacumm</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>