
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>vacumm.misc.config &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="../../../_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" accesskey="U">vacumm</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vacumm.misc.config</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Copyright or © or Copr. Actimar/IFREMER (2010-2017)</span>
<span class="c1">#</span>
<span class="c1"># This software is a computer program whose purpose is to provide</span>
<span class="c1"># utilities for handling oceanographic and atmospheric data,</span>
<span class="c1"># with the ultimate goal of validating the MARS model from IFREMER.</span>
<span class="c1">#</span>
<span class="c1"># This software is governed by the CeCILL license under French law and</span>
<span class="c1"># abiding by the rules of distribution of free software.  You can  use,</span>
<span class="c1"># modify and/ or redistribute the software under the terms of the CeCILL</span>
<span class="c1"># license as circulated by CEA, CNRS and INRIA at the following URL</span>
<span class="c1"># &quot;http://www.cecill.info&quot;.</span>
<span class="c1">#</span>
<span class="c1"># As a counterpart to the access to the source code and  rights to copy,</span>
<span class="c1"># modify and redistribute granted by the license, users are provided only</span>
<span class="c1"># with a limited warranty  and the software&#39;s author,  the holder of the</span>
<span class="c1"># economic rights,  and the successive licensors  have only  limited</span>
<span class="c1"># liability.</span>
<span class="c1">#</span>
<span class="c1"># In this respect, the user&#39;s attention is drawn to the risks associated</span>
<span class="c1"># with loading,  using,  modifying and/or developing or reproducing the</span>
<span class="c1"># software by the user in light of its specific status of free software,</span>
<span class="c1"># that may mean  that it is complicated to manipulate,  and  that  also</span>
<span class="c1"># therefore means  that it is reserved for developers  and  experienced</span>
<span class="c1"># professionals having in-depth computer knowledge. Users are therefore</span>
<span class="c1"># encouraged to load and test the software&#39;s suitability as regards their</span>
<span class="c1"># requirements in conditions enabling the security of their systems and/or</span>
<span class="c1"># data to be ensured and,  more generally, to use and operate it in the</span>
<span class="c1"># same conditions as regards security.</span>
<span class="c1">#</span>
<span class="c1"># The fact that you are presently reading this means that you have had</span>
<span class="c1"># knowledge of the CeCILL license and that you accept its terms.</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span> <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Stéphane Raynaud, Jonathan Wilkins&#39;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s1">&#39;raynaud@actimar.fr, wilkins@actimar.fr&#39;</span>
<span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">Configuration management with validation capabilities and commandline interaction.</span>
<span class="s1">It is based on :mod:`configobj` and :mod:`validate` modules.</span>


<span class="s1">List of builtin validators for :mod:`validate`, along with their plural form: </span><span class="si">{}</span><span class="s1"></span>

<span class="s1">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">operator</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="p">(</span><span class="n">OptionParser</span><span class="p">,</span> <span class="n">OptionGroup</span><span class="p">,</span> <span class="n">OptionContainer</span><span class="p">,</span> <span class="n">Option</span><span class="p">,</span>
                      <span class="n">OptionValueError</span><span class="p">,</span> <span class="n">IndentedHelpFormatter</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="k">import</span> <span class="p">(</span><span class="n">ArgumentParser</span><span class="p">,</span> <span class="n">_ArgumentGroup</span><span class="p">,</span>
                      <span class="n">HelpFormatter</span> <span class="k">as</span> <span class="n">ArgHelpFormatter</span><span class="p">,</span>
                      <span class="n">_StoreTrueAction</span> <span class="k">as</span> <span class="n">AP_StoreTrueAction</span><span class="p">,</span>
                      <span class="n">Action</span> <span class="k">as</span> <span class="n">AP_Action</span><span class="p">,</span>
                      <span class="n">_HelpAction</span><span class="p">,</span> <span class="n">Action</span> <span class="k">as</span> <span class="n">AP_Action</span><span class="p">,</span> <span class="n">SUPPRESS</span> <span class="k">as</span> <span class="n">AP_SUPPRESS</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

<span class="kn">from</span> <span class="nn">configobj</span> <span class="k">import</span> <span class="n">ConfigObj</span><span class="p">,</span> <span class="n">flatten_errors</span>
<span class="kn">from</span> <span class="nn">validate</span> <span class="k">import</span> <span class="n">Validator</span><span class="p">,</span> <span class="n">ValidateError</span><span class="p">,</span> <span class="n">VdtTypeError</span><span class="p">,</span> <span class="n">VdtValueTooSmallError</span><span class="p">,</span> <span class="n">VdtValueTooBigError</span>
<span class="kn">import</span> <span class="nn">validate</span>

<span class="k">try</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">numpy</span>
<span class="k">except</span><span class="p">:</span> <span class="n">numpy</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ConfigException&#39;</span><span class="p">,</span> <span class="s1">&#39;ValidationWarning&#39;</span><span class="p">,</span> <span class="s1">&#39;ConfigManager&#39;</span><span class="p">,</span> <span class="s1">&#39;print_short_help&#39;</span><span class="p">,</span>
    <span class="s1">&#39;opt2rst&#39;</span><span class="p">,</span> <span class="s1">&#39;cfg2rst&#39;</span><span class="p">,</span> <span class="s1">&#39;cfgargparse&#39;</span><span class="p">,</span> <span class="s1">&#39;cfgoptparse&#39;</span><span class="p">,</span> <span class="s1">&#39;get_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;get_secnames&#39;</span><span class="p">,</span>
    <span class="s1">&#39;list_options&#39;</span><span class="p">,</span> <span class="s1">&#39;option2rst&#39;</span><span class="p">,</span>  <span class="s1">&#39;filter_section&#39;</span><span class="p">,</span> <span class="s1">&#39;register_config_validator&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_validator&#39;</span><span class="p">,</span>
    <span class="s1">&#39;validator_bbox&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_cdtime&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_color&#39;</span><span class="p">,</span>
    <span class="s1">&#39;validator_datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_eval&#39;</span><span class="p">,</span>
    <span class="s1">&#39;validator_figsize&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_interval&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_minmax&#39;</span><span class="p">,</span>
    <span class="s1">&#39;validator_numerics&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_path&#39;</span><span class="p">,</span> <span class="s1">&#39;validator_timeunits&#39;</span><span class="p">,</span>
    <span class="s1">&#39;validator_workdir&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="ConfigException"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigException">[docs]</a><span class="k">class</span> <span class="nc">ConfigException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="ValidationWarning"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ValidationWarning">[docs]</a><span class="k">class</span> <span class="nc">ValidationWarning</span><span class="p">(</span><span class="ne">Warning</span><span class="p">):</span>
    <span class="k">pass</span></div>

<span class="k">class</span> <span class="nc">VdtSizeError</span><span class="p">(</span><span class="n">ValidateError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;List size is incorrect (nmin, nmax, odd, even or shape)&#39;&#39;&#39;</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">_valwrap_</span><span class="p">(</span><span class="n">validator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Wrap a validation function to allow extraneous named arguments in specfile,</span>
<span class="sd">    this is usefull when getting specification with</span>
<span class="sd">    validator._parse_with_caching(configspec[section][option])</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Already wrapped</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">validator</span><span class="o">.</span><span class="n">func_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;validator_wrapper-&#39;</span><span class="p">)</span> <span class="ow">or</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">func_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;list_validator_wrapper-&#39;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">validator</span>

    <span class="c1"># Wrapper</span>
    <span class="k">def</span> <span class="nf">validator_wrapper</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Handle None and default</span>
<span class="c1">#        if str(value) == &#39;None&#39;: return None</span>
<span class="c1">#        default = args[0] if len(args) else kwargs.get(&#39;default&#39;, None)</span>
<span class="c1">#        if value == &#39;&#39;: return default</span>
        <span class="c1"># Remove extraneous arguments the validator can&#39;t handle</span>
        <span class="n">argspec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">validator</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">argspec</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">validator_wrapper</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">validator</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">return</span> <span class="n">validator_wrapper</span>

<span class="k">def</span> <span class="nf">_valwraplist_</span><span class="p">(</span><span class="n">validator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Wrap a validation function to handle list value using an existing validator.</span>
<span class="sd">    This adds the following list checking behaviors that can be used as named</span>
<span class="sd">    arguments in specifications:</span>
<span class="sd">        - **n**: required fixed number of elements</span>
<span class="sd">        - **nmin**: required minimum number of elements</span>
<span class="sd">        - **nmax**: required maximum number of elements</span>
<span class="sd">        - **odd**: number of elements must be odd</span>
<span class="sd">        - **even**: number of elements must be even</span>
<span class="sd">        - **shape**: check value shape (requires numpy)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Already wrapped</span>
    <span class="k">if</span> <span class="n">validator</span><span class="o">.</span><span class="n">func_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;list_validator_wrapper-&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">validator</span>

    <span class="c1"># Wrapper</span>
    <span class="k">def</span> <span class="nf">list_validator_wrapper</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Handle None and default</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">else</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="n">default</span>

        <span class="c1"># Handle single value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>

        <span class="c1"># Do list checks</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">VdtSizeError</span><span class="p">(</span><span class="s1">&#39;Incorrect size: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> values expected&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">nmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nmin&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">nmin</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">VdtSizeError</span><span class="p">(</span><span class="s1">&#39;Incorrect size: </span><span class="si">%s</span><span class="s1">, at least </span><span class="si">%s</span><span class="s1"> values expected&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">nmin</span><span class="p">))</span>
        <span class="n">nmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nmax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">VdtSizeError</span><span class="p">(</span><span class="s1">&#39;Incorrect size: </span><span class="si">%s</span><span class="s1">, at most </span><span class="si">%s</span><span class="s1"> values expected&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">nmax</span><span class="p">))</span>
        <span class="n">odd</span> <span class="o">=</span> <span class="n">validate</span><span class="o">.</span><span class="n">is_boolean</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;odd&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">odd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VdtSizeError</span><span class="p">(</span><span class="s1">&#39;Incorrect size: </span><span class="si">%s</span><span class="s1">, odd number of values expected&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="n">even</span> <span class="o">=</span> <span class="n">validate</span><span class="o">.</span><span class="n">is_boolean</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;even&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">even</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VdtSizeError</span><span class="p">(</span><span class="s1">&#39;Incorrect size: </span><span class="si">%s</span><span class="s1">, even number of values expected&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

        <span class="c1"># TODO?: use numpy to also check min and max ? (applicable on number only...)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot check shape, numpy package is missing&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shape</span><span class="p">,</span> <span class="n">vshape</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">shape</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">vshape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">VdtSizeError</span><span class="p">(</span><span class="s1">&#39;Incorrect shape: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> shape expected&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">vshape</span><span class="p">,</span> <span class="n">shape</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidateError</span><span class="p">(</span><span class="s1">&#39;Cannot test value shape, this may be caused by an irregular array-like shape. Error was:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

        <span class="c1"># Preserve tuple type</span>
        <span class="n">istuple</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>

        <span class="c1"># Validate each values</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">validator</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">istuple</span> <span class="k">else</span> <span class="n">value</span>

    <span class="n">list_validator_wrapper</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">validator</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">return</span> <span class="n">list_validator_wrapper</span>

<div class="viewcode-block" id="validator_bbox"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_bbox">[docs]</a><span class="k">def</span> <span class="nf">validator_bbox</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse bbox coordinates with value format: x1,y1,x2,y2&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="n">default</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># two possible delimiters: whitespaces and &#39;,&#39;</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">():</span> <span class="n">c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span> <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span></div>


<div class="viewcode-block" id="validator_numerics"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_numerics">[docs]</a><span class="k">def</span> <span class="nf">validator_numerics</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator of a tuple of numeric values&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;()[] &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="n">n</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">()</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span><span class="o">&lt;</span><span class="nb">min</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span><span class="o">&gt;</span><span class="nb">max</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">val</span><span class="p">,</span>
    <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="validator_minmax"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_minmax">[docs]</a><span class="k">def</span> <span class="nf">validator_minmax</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator of a min,max pair&quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">validator_numerics</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="validator_figsize"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_figsize">[docs]</a><span class="k">def</span> <span class="nf">validator_figsize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator of a figure size (xsize,ysize)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">validator_numerics</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>



<div class="viewcode-block" id="validator_interval"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_interval">[docs]</a><span class="k">def</span> <span class="nf">validator_interval</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator of an interval of coordinates (min, max [,bounds])&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;()[] &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">):</span> <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span> <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">val</span><span class="p">,</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">m</span> <span class="o">=</span>  <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;([co]{1,2}[ne]{0,2})&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="validator_cmap"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_cmap">[docs]</a><span class="k">def</span> <span class="nf">validator_cmap</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator for colormaps&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.color</span> <span class="k">import</span> <span class="n">cmap_custom</span>
        <span class="k">return</span> <span class="n">cmap_custom</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">.color</span> <span class="k">import</span> <span class="n">get_cmap</span>
    <span class="k">return</span> <span class="n">get_cmap</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<span class="k">class</span> <span class="nc">VdtDateTimeError</span><span class="p">(</span><span class="n">ValidateError</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="validator_datetime"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_datetime">[docs]</a><span class="k">def</span> <span class="nf">validator_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Parse value as a traditionnal python datetime object&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="k">raise</span> <span class="n">VdtDateTimeError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<span class="n">_re_validator_workdir_split_</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\s*&gt;\s*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span>
<span class="n">_re_validator_workdir_start_</span> <span class="o">=</span>  <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^[\[(]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
<span class="n">_re_validator_workdir_stop_</span> <span class="o">=</span>  <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[\])]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
<div class="viewcode-block" id="validator_workdir"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_workdir">[docs]</a><span class="k">def</span> <span class="nf">validator_workdir</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">_re_validator_workdir_start_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">_re_validator_workdir_stop_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">stop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">svalue</span> <span class="o">=</span> <span class="n">_re_validator_workdir_split_</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">svalue</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">&gt;</span><span class="si">%s</span><span class="s1">)</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">svalue</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">svalue</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">&gt;</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">svalue</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">svalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<span class="c1"># TODO: fix interpolation and expand !</span>
<div class="viewcode-block" id="validator_path"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_path">[docs]</a><span class="k">def</span> <span class="nf">validator_path</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse a value as a path</span>
<span class="sd">    :Params:</span>
<span class="sd">        -- **expand**: expandvars and expandhome on loaded path</span>

<span class="sd">    **Warning: expand currently can&#39;t work with interpolation**</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">if</span> <span class="n">expand</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="validator_timeunits"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_timeunits">[docs]</a><span class="k">def</span> <span class="nf">validator_timeunits</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;days since 1950-01-01&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator of standard time units&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.atime</span> <span class="k">import</span> <span class="n">are_valid_units</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span><span class="o">==</span><span class="s1">&#39;None&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">are_valid_units</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="validator_cdtime"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_cdtime">[docs]</a><span class="k">def</span> <span class="nf">validator_cdtime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator of a date (compatible with :func:`cdtime.s2c`)&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">cdtime</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span> <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">s2c</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="c1">#not re.match(&#39;^\d+(-\d+(-\d+( \d+:(\d+(:\d+(\.(\d+)?)?)?)?)?)?)?$&#39;, value):</span>
    <span class="k">if</span> <span class="nb">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span><span class="o">&lt;</span><span class="n">cdtime</span><span class="o">.</span><span class="n">s2c</span><span class="p">(</span><span class="nb">min</span><span class="p">):</span> <span class="k">raise</span> <span class="n">VdtValueTooSmallError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span><span class="o">&gt;</span><span class="n">cdtime</span><span class="o">.</span><span class="n">s2c</span><span class="p">(</span><span class="nb">max</span><span class="p">):</span> <span class="k">raise</span> <span class="n">VdtValueTooBigError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="validator_eval"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_eval">[docs]</a><span class="k">def</span> <span class="nf">validator_eval</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unchanged_if_failed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate a string that can be evaluated&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">unchanged_if_failed</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="validator_color"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_color">[docs]</a><span class="k">def</span> <span class="nf">validator_color</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">as256</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.color</span> <span class="k">import</span> <span class="n">RGBA</span> <span class="k">as</span> <span class="n">CC</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.color</span> <span class="k">import</span> <span class="n">RGB</span> <span class="k">as</span> <span class="n">CC</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CC</span><span class="p">(</span><span class="n">_check256_</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">as256</span><span class="o">=</span><span class="n">as256</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CC</span><span class="p">(</span><span class="n">_check256_</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">as256</span><span class="o">=</span><span class="n">as256</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_check256_</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">as256</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span>
    <span class="k">if</span> <span class="n">as256</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">as256</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">v</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">[:</span><span class="mi">3</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">as256</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">v</span><span class="o">/</span><span class="mf">256.</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">[:</span><span class="mi">3</span><span class="p">]])</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">val</span>

<span class="n">_re_funccall</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*(\w+\(.*\))\s*$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="c1"># func(...)</span>
<span class="n">_re_acc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*(\{.*\})\s*$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="c1"># {...}</span>
<span class="n">_re_set</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*(\w+)\s*=\s*(.+)\s*$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="c1"># a=b</span>
<div class="viewcode-block" id="validator_dict"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.validator_dict">[docs]</a><span class="k">def</span> <span class="nf">validator_dict</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{},</span> <span class="n">vtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;validator for dictionaries</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    value:</span>

<span class="sd">        - dict(a=2, b=&quot;x&quot;)</span>
<span class="sd">        - {&quot;a&quot;:2, &quot;b&quot;:&quot;x&quot;}</span>
<span class="sd">        - a=2</span>
<span class="sd">        - a=2, b=&quot;x&quot;</span>
<span class="sd">        - OrderedDict(b=2)</span>
<span class="sd">        - dict([(&quot;a&quot;,2),(&quot;b&quot;,&quot;x&quot;)])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">value</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_re_funccall</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_re_acc</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">_re_set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;dict(&#39;</span><span class="o">+</span><span class="n">value</span><span class="o">+</span><span class="s1">&#39;)&#39;</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
    <span class="k">raise</span> <span class="n">VdtTypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>



<span class="c1"># Define additionnal specifications</span>
<span class="c1"># Value should be dict for internal use of this module (iterable, opttype, ...)</span>
<span class="c1"># If value is not a dict, it is supposed to be the validator function</span>

<span class="c1">#: Available VACUMM :mod:`configobj` validator specifications</span>
<span class="n">VALIDATOR_SPECS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># copy of some validate.Validator.functions to later build plural forms</span>
        <span class="s1">&#39;integer&#39;</span><span class="p">:</span><span class="n">validate</span><span class="o">.</span><span class="n">is_integer</span><span class="p">,</span>
        <span class="s1">&#39;float&#39;</span><span class="p">:</span><span class="n">validate</span><span class="o">.</span><span class="n">is_float</span><span class="p">,</span>
        <span class="s1">&#39;boolean&#39;</span><span class="p">:</span><span class="n">validate</span><span class="o">.</span><span class="n">is_boolean</span><span class="p">,</span>
        <span class="s1">&#39;string&#39;</span><span class="p">:</span><span class="n">validate</span><span class="o">.</span><span class="n">is_string</span><span class="p">,</span>
        <span class="c1"># single value</span>
        <span class="s1">&#39;date&#39;</span><span class="p">:</span><span class="n">validator_cdtime</span><span class="p">,</span>
        <span class="s1">&#39;cdtime&#39;</span><span class="p">:</span><span class="n">validator_cdtime</span><span class="p">,</span>
        <span class="s1">&#39;timeunits&#39;</span><span class="p">:</span><span class="n">validator_timeunits</span><span class="p">,</span>
        <span class="s1">&#39;minmax&#39;</span><span class="p">:</span><span class="n">validator_minmax</span><span class="p">,</span>
        <span class="s1">&#39;numerics&#39;</span><span class="p">:</span><span class="n">validator_numerics</span><span class="p">,</span>
        <span class="s1">&#39;figsize&#39;</span><span class="p">:</span><span class="n">validator_figsize</span><span class="p">,</span>
        <span class="s1">&#39;workdir&#39;</span><span class="p">:</span><span class="n">validator_workdir</span><span class="p">,</span>
        <span class="s1">&#39;bbox&#39;</span><span class="p">:</span><span class="n">validator_bbox</span><span class="p">,</span>
        <span class="s1">&#39;datetime&#39;</span><span class="p">:</span><span class="n">validator_datetime</span><span class="p">,</span>
        <span class="s1">&#39;file&#39;</span><span class="p">:</span><span class="n">validator_path</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span><span class="n">validator_path</span><span class="p">,</span>
        <span class="s1">&#39;directory&#39;</span><span class="p">:</span><span class="n">validator_path</span><span class="p">,</span>
        <span class="s1">&#39;interval&#39;</span><span class="p">:</span><span class="n">validator_interval</span><span class="p">,</span>
        <span class="s1">&#39;eval&#39;</span><span class="p">:</span><span class="n">validator_eval</span><span class="p">,</span>
        <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">validator_cmap</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="n">validator_color</span><span class="p">,</span>
        <span class="s1">&#39;dict&#39;</span><span class="p">:</span><span class="n">validator_dict</span><span class="p">,</span>
        <span class="c1"># lists validators for these scalars will be automatically generated</span>
<span class="p">}</span>

<span class="c1">#: Available VACUMM :mod:`configobj` validator functions as dict useful for :class:`validate.Validator`</span>
<span class="n">VALIDATOR_FUNCTIONS</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1">#: Available VACUMM :mod:`configobj` validator type names</span>
<span class="n">VALIDATOR_TYPES</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Aliases for backward compat</span>
<span class="n">_validator_specs_</span> <span class="o">=</span> <span class="n">_VALIDATOR_SPECS_</span> <span class="o">=</span> <span class="n">VALIDATOR_SPECS</span>
<span class="n">_validator_functions_</span> <span class="o">=</span> <span class="n">_VALIDATOR_FUNCTIONS_</span> <span class="o">=</span> <span class="n">VALIDATOR_FUNCTIONS</span>

<span class="k">def</span> <span class="nf">_update_registry_</span><span class="p">():</span>

    <span class="c1"># 1. Fix specs dicts</span>
    <span class="c1"># 2. Generate list validators</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">VALIDATOR_SPECS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="c1"># Check type of spec</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
            <span class="c1"># Update specs mapping</span>
            <span class="n">VALIDATOR_SPECS</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># Check minimum settings</span>
        <span class="n">v</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">.</span><span class="n">is_string</span><span class="p">)</span>
        <span class="n">v</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;base_func&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">])</span>
        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_valwrap_</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">])</span>
        <span class="n">v</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;iterable&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">v</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;opttype&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">v</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;argtype&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">])</span>

        <span class="c1"># Add plural forms and validators to handle list values</span>
        <span class="c1"># TODO: we should remove this plural form which is not really correct</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
            <span class="n">nk</span> <span class="o">=</span> <span class="n">k</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;ies&#39;</span>
        <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
            <span class="n">nk</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="s1">&#39;es&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nk</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="s1">&#39;s&#39;</span>
        <span class="k">for</span> <span class="n">nk</span> <span class="ow">in</span> <span class="p">(</span><span class="n">nk</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="s1">&#39;_list&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">nk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALIDATOR_SPECS</span><span class="p">:</span>
                <span class="n">nv</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">nv</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_valwraplist_</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">])</span>
                <span class="n">nv</span><span class="p">[</span><span class="s1">&#39;iterable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># OptionParser will check each value, not the list thus we provide the value validator</span>
                <span class="c1"># TODO: check how this is treated, add argtype ?</span>
                <span class="n">nv</span><span class="p">[</span><span class="s1">&#39;opttype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nk</span>
                <span class="n">VALIDATOR_SPECS</span><span class="p">[</span><span class="n">nk</span><span class="p">]</span> <span class="o">=</span> <span class="n">nv</span>

    <span class="c1"># List of names</span>
    <span class="k">while</span> <span class="n">VALIDATOR_TYPES</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">VALIDATOR_TYPES</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">VALIDATOR_TYPES</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">VALIDATOR_SPECS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">VALIDATOR_TYPES</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># Dict of functions</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">VALIDATOR_FUNCTIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">del</span> <span class="n">VALIDATOR_FUNCTIONS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">VALIDATOR_FUNCTIONS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">VALIDATOR_SPECS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;func&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">))</span>

<span class="n">_update_registry_</span><span class="p">()</span>

<span class="n">_for_doc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">VALIDATOR_TYPES</span><span class="p">:</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">VALIDATOR_SPECS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">func_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;list_validator_wrapper&#39;</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;:func:`</span><span class="si">{}</span><span class="s1"> &lt;</span><span class="si">{}</span><span class="s1">&gt;`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;base_func&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">func_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;:func:`</span><span class="si">{}</span><span class="s1">`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">_for_doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="vm">__doc__</span> <span class="o">=</span> <span class="vm">__doc__</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_for_doc</span><span class="p">))</span>

<span class="c1"># Build the mapping suitable for Validator.functions</span>
<span class="c1">#VALIDATOR_FUNCTIONS = dict((k, v[&#39;func&#39;]) for k,v in VALIDATOR_SPECS.iteritems() if &#39;func&#39; in v)</span>

<div class="viewcode-block" id="register_config_validator"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.register_config_validator">[docs]</a><span class="k">def</span> <span class="nf">register_config_validator</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a new configobj validator function</span>

<span class="sd">    :Example:</span>
<span class="sd">    &gt;&gt;&gt; register_config_validator(level=is_level)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">VALIDATOR_SPECS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_update_registry_</span><span class="p">()</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="ConfigManager"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager">[docs]</a><span class="k">class</span> <span class="nc">ConfigManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A configuration management class based on a configuration specification file</span>
<span class="sd">    and a :class:`validate.Validator`</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; Cfg = Config(&#39;config.ini&#39;, interpolation=&#39;template&#39;)</span>
<span class="sd">        &gt;&gt;&gt; Cfg.opt_parse()</span>
<span class="sd">        &gt;&gt;&gt; cfg = Cfg.load(&#39;config.cfg&#39;)</span>

<span class="sd">    :See also: :class:`configobj.ConfigObj` and :class:`validate.Validator`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfgspecfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;template&#39;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boolean_false</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">splitsecdesc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cfgfilter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">cfgfilter_default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">warn_empty_specs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :Params:</span>
<span class="sd">            - **cfgspecfile**, optional: The specification file, file object,</span>
<span class="sd">              or list of strings, to be used with this.</span>
<span class="sd">            - **validator**, optional: A custom :class:`validate.Validator`</span>
<span class="sd">              to use or a mapping dict of validator functions.</span>
<span class="sd">            - **interpolation**, optional: See :class:`configobj.ConfigObj`.</span>
<span class="sd">            - **boolean_false**, optional: Make sure that booleans have a default value.</span>
<span class="sd">            - **splitsecdesc**, optional: Section descriptions are split in two</span>
<span class="sd">              components separated by &#39;:&#39;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Specifications</span>
        <span class="c1"># - load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="o">=</span> <span class="n">encoding</span>
<span class="c1">#        if (cfgspecfile is not None and isinstance(cfgspecfile, basestring) and</span>
<span class="c1">#                not os.path.exists(cfgspecfile) and not hasattr(cfgspecfile,  &#39;read&#39;)):</span>
<span class="c1">#            raise ConfigException(&#39;Specification file not found: %s&#39;%cfgspecfile)</span>
<span class="c1">#        self._configspecfile = cfgspecfile</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgspecfile</span><span class="p">,</span> <span class="n">ConfigObj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span> <span class="o">=</span> <span class="n">cfgspecfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">cfgspecfile</span><span class="p">,</span> <span class="n">list_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">interpolation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">raise_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">file_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">warn_empty_specs</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Empty Config specifications&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># - filter</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfilter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">filter_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">,</span> <span class="n">cfgfilter</span><span class="p">,</span> <span class="n">cfgfilter_default</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cfgfilter</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span> <span class="ow">and</span> <span class="n">warn_empty_specs</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Empty Config specifications after filtering&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cfgfilter</span> <span class="o">=</span> <span class="n">cfgfilter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cfgfilter_default</span> <span class="o">=</span> <span class="n">cfgfilter_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configspecfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="o">.</span><span class="n">filename</span>

        <span class="c1"># Validator</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">Validator</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span> <span class="o">=</span> <span class="n">validator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span> <span class="o">=</span> <span class="n">get_validator</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="n">validator</span><span class="p">)</span>

        <span class="c1"># Makes sure that booleans have a default value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boolean_false</span> <span class="o">=</span> <span class="n">boolean_false</span>
        <span class="k">if</span> <span class="n">boolean_false</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_set_boolean_false_by_default_</span><span class="p">,</span>
                <span class="n">validator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="p">)</span>

        <span class="c1"># Interpolation</span>
        <span class="k">if</span> <span class="n">interpolation</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;template&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">specs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span>

    <span class="n">cfgspecs</span> <span class="o">=</span> <span class="n">configspecs</span> <span class="o">=</span> <span class="n">specs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span>

<div class="viewcode-block" id="ConfigManager.get_spec"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.get_spec">[docs]</a>    <span class="k">def</span> <span class="nf">get_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        See :func:`get_spec`</span>

<span class="sd">        If sec is a basestring, use configspec[sec][key]</span>
<span class="sd">        Otherwise use sec as a configspec, sec[key]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">get_spec</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">[</span><span class="n">sec</span><span class="p">]</span>
                         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="n">sec</span><span class="p">)[</span><span class="n">key</span><span class="p">],</span>
                         <span class="n">validator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="p">)</span></div>
    <span class="n">getspec</span> <span class="o">=</span> <span class="n">get_spec</span>

<div class="viewcode-block" id="ConfigManager.defaults"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.defaults">[docs]</a>    <span class="k">def</span> <span class="nf">defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nocomments</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the default config</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **nocomments**, optional: Do not include option comments in config file.</span>
<span class="sd">              If equal to 2, remove section comments too.</span>
<span class="sd">            - **interpolation**, optional: if True, interpolate values.</span>

<span class="sd">        :Return: A :class:`~configobj.ConfigObj` instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">interpolation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">interpolation</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">configspec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nocomments</span><span class="p">:</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_remove_all_comments_</span><span class="p">,</span> <span class="n">call_on_sections</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nocomments</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">:</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">inline_comments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="o">.</span><span class="n">inline_comments</span>
        <span class="k">return</span> <span class="n">cfg</span></div>

<div class="viewcode-block" id="ConfigManager.reset"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="s1">&#39;config.cfg&#39;</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nocomments</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset a config file  to default values</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **cfgfile**, optional: The configuration file to reset.</span>
<span class="sd">            - **backup**, optional: Backup the old config file.</span>
<span class="sd">            - **nocomments**, optional: Do not include comment in config file.</span>

<span class="sd">        :Return: A :class:`~configobj.ConfigObj` instance</span>

<span class="sd">        :See also: :meth:`defaults`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Load defaults</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">(</span><span class="n">nocomments</span><span class="o">=</span><span class="n">nocomments</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Remove old file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">+</span><span class="s1">&#39;.bak&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backup</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Write to new one</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">cfgfile</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;Created default config file: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">cfgfile</span>
            <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;Backuped old config file to: </span><span class="si">%s</span><span class="s2">.bak&quot;</span><span class="o">%</span><span class="n">cfgfile</span>
        <span class="k">return</span> <span class="n">cfg</span></div>

<div class="viewcode-block" id="ConfigManager.load"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="s1">&#39;config.cfg&#39;</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;fix&#39;</span><span class="p">,</span> <span class="n">geterr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">patch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cfgfilter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwpatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a :class:`~configobj.ConfigObj` instance loaded from a file</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **cfgfile**, optional: config file</span>

<span class="sd">                - a config file name</span>
<span class="sd">                - a :class:`~configobj.ConfigObj` instance</span>
<span class="sd">                - ``None``: defaults to ``&quot;config.cfg&quot;``</span>

<span class="sd">            - **validate**, optional: Type of validation</span>

<span class="sd">                - ``False``: no validation</span>
<span class="sd">                - ``&quot;fix&quot;``: validation fixes and reports errors</span>
<span class="sd">                - ``&quot;report&quot;``: validation reports errors</span>
<span class="sd">                - ``&quot;raise&quot;``: validation raises errors</span>

<span class="sd">            - **geterr**, optional: Return validation results as well</span>
<span class="sd">            - **force**, optional: Force re-instantiation of ``cfgfile`` when it is already</span>
<span class="sd">              a :class:`ConfigObj` instance.</span>

<span class="sd">        :Return: Depends on ``geterr``</span>

<span class="sd">            - if ``True``: ``(cfg, err)`` where is the result of :meth:`~configobj.ConfigObj.validate`</span>
<span class="sd">            - else: ``cfg`` (:class:`~configobj.ConfigObj` instance)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Load the config</span>
        <span class="k">if</span> <span class="n">cfgfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">):</span>
            <span class="n">cfgfile</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Instantiate / Copy</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">,</span> <span class="n">ConfigObj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span><span class="p">,</span>
                <span class="n">configspec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">cfgfile</span>


        <span class="c1"># Patch</span>
        <span class="k">if</span> <span class="n">kwpatch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">patch</span><span class="p">:</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">patch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwpatch</span><span class="p">:</span> <span class="c1"># Patch the patch!</span>
                <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">kwpatch</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Filter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cfgfilter</span> <span class="ow">and</span> <span class="n">cfgfilter</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfilter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">cfgfilter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cfgfilter</span>
            <span class="n">filter_section</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">cfgfilter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cfgfilter_default</span><span class="p">)</span>

        <span class="c1"># Validation</span>
        <span class="k">if</span> <span class="n">validate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">:</span>

            <span class="c1"># Validation itself</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="p">,</span> <span class="n">preserve_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Defaults for fixing</span>
            <span class="k">if</span> <span class="n">validate</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fix&#39;</span><span class="p">,</span> <span class="s1">&#39;report&#39;</span><span class="p">]:</span>
                <span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span>

            <span class="c1"># Loop on errors</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

                <span class="k">for</span> <span class="n">sections</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">flatten_errors</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>

                    <span class="c1"># Format explicit message</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
                        <span class="n">section</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="s1">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;] &#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">section</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Config value error: </span><span class="si">%s%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>

                    <span class="c1"># Check what to do</span>
                    <span class="k">if</span> <span class="n">validate</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fix&#39;</span><span class="p">,</span> <span class="s1">&#39;report&#39;</span><span class="p">]:</span>


                        <span class="c1"># Report</span>
                        <span class="n">sec</span> <span class="o">=</span> <span class="n">cfg</span>
                        <span class="n">secd</span> <span class="o">=</span> <span class="n">defaults</span>
                        <span class="k">for</span> <span class="n">subsec</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
                            <span class="n">sec</span> <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="n">subsec</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">subsec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">secd</span><span class="p">:</span>
                                <span class="n">secd</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="k">break</span>
                            <span class="n">secd</span> <span class="o">=</span> <span class="n">secd</span><span class="p">[</span><span class="n">subsec</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">secd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="c1">#                            sys.stderr.write(msg+&quot;\nCan&#39;t set it to default value because&quot;</span>
<span class="c1">#                                &quot; none available&quot;)</span>
                            <span class="k">continue</span>

                        <span class="c1"># Loop on keys</span>
                        <span class="n">keys</span> <span class="o">=</span> <span class="n">secd</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>

                            <span class="n">vdef</span> <span class="o">=</span> <span class="n">secd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting it to default value: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">vdef</span><span class="p">,))</span><span class="c1">#,ValidationWarning)</span>

                            <span class="c1"># Reset to default</span>
                            <span class="k">if</span> <span class="n">validate</span><span class="o">==</span><span class="s1">&#39;fix&#39;</span><span class="p">:</span>
                                <span class="n">sec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">vdef</span>

                    <span class="k">else</span><span class="p">:</span> <span class="c1"># Raise an error</span>
                        <span class="k">raise</span> <span class="n">ValidateError</span><span class="p">,</span> <span class="n">msg</span>

            <span class="k">if</span> <span class="n">geterr</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">err</span>

        <span class="k">return</span> <span class="n">cfg</span></div>


<div class="viewcode-block" id="ConfigManager.patch"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.patch">[docs]</a>    <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">cfgpatch</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace config values of ``cfg`` by those of ``cfgpatch``</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **cfg**: A :class:`~configobj.ConfigObj` instance, a config file or</span>
<span class="sd">              a dictionary, that must be patched.</span>
<span class="sd">            - **cfgpatch**: A :class:`~configobj.ConfigObj` instance, a config file or</span>
<span class="sd">              a dictionary, used for patching.</span>
<span class="sd">            - **validate**, optional: If ``True``, validate configs if they have a valid config spec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ConfigObj</span><span class="p">):</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">configspec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span><span class="c1">#, interpolation=False)</span>
        <span class="c1">#else:</span>
            <span class="c1">#cfg.interpolation = False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgpatch</span><span class="p">,</span> <span class="n">ConfigObj</span><span class="p">):</span>
            <span class="n">cfgpatch</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">cfgpatch</span><span class="p">,</span> <span class="n">configspec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_configspec</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfgpatch</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Merging based on specs with type check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgspecs</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_patch_</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">cfgpatch</span><span class="o">=</span><span class="n">cfgpatch</span><span class="p">)</span>

        <span class="c1"># Merging of missing stuff</span>
        <span class="n">cfgpatch</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_patch_</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">cfgpatch</span><span class="o">=</span><span class="n">cfgpatch</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">validate</span> <span class="ow">and</span> <span class="n">cfg</span><span class="o">.</span><span class="n">configspec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">)</span>
        <span class="c1">#cfg.interpolation = &#39;template&#39;</span>

        <span class="k">return</span> <span class="n">cfg</span></div>

<div class="viewcode-block" id="ConfigManager.arg_parse"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.arg_parse">[docs]</a>    <span class="k">def</span> <span class="nf">arg_parse</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="p">[],</span> <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">getparser</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">getargs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="s1">&#39;config.cfg&#39;</span><span class="p">,</span>
            <span class="n">patch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="s1">&#39;--cfgfile&#39;</span><span class="p">,</span> <span class="n">cfgfilepatch</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">,</span>
            <span class="n">nested</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extraopts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Options (:mod:`argparse`) and config mixer.</span>

<span class="sd">            1. Creates command-line options from config defaults</span>
<span class="sd">            2. Parse command-line argument and create a configuration patch</span>

<span class="sd">        For instance, the following config define the commandline option</span>
<span class="sd">        ``--section1-my-section2-my-key`` with ``value`` as a default value, s</span>
<span class="sd">        tored in a special group of options with a short name and a long description::</span>

<span class="sd">            [section1] # Short name : long description of the group</span>
<span class="sd">                [[my_section2]]</span>
<span class="sd">                    my_key=value</span>

<span class="sd">        .. warning:: Section and option names must not contain any space-like character !</span>

<span class="sd">        .. note::</span>

<span class="sd">            If you want to prevent conflict of options, don&#39;t use ``&quot;_&quot;`` in</span>
<span class="sd">            section and option names.</span>


<span class="sd">        :Params:</span>

<span class="sd">            - **parser**: optional, a default one is created if not given. This can be:</span>
<span class="sd">                - a :class:`OptionParser` instance</span>
<span class="sd">                - a :class:`dict` with keyword arguments for the one to be created</span>
<span class="sd">            - **exc**, optional: List of keys to be excluded from parsing.</span>
<span class="sd">            - **parse**, optional: If ``True``, parse commande line options and arguments</span>
<span class="sd">            - **args**, optional: List of arguments to parse instead of default sys.argv[1:]</span>
<span class="sd">            - **getparser**: allow getting the parser in addition to the config if parse=True</span>
<span class="sd">            - **getargs**: allow getting the parsed arguments in addition to the config if parse=True</span>
<span class="sd">            - **patch**, optional: used if parse is True.</span>
<span class="sd">                Can take the following values:</span>
<span class="sd">                - a :class:`bool` value indicating wheter to apply defaults on the returned config</span>
<span class="sd">                  before applying the command line config</span>
<span class="sd">                - a :class:`ConfigObj` instance to apply on the returned config</span>
<span class="sd">                  before applying the command line config</span>
<span class="sd">            - **cfgfileopt**: optional, if present a config file option will be added.</span>
<span class="sd">                Can be a :class:`string` or couple of strings to use as the option short and/or long name</span>
<span class="sd">            - **cfgfilepatch**: specify if the returned config must be patched if a config file command</span>
<span class="sd">                line option is provided and when to patch it. Can take the following values:</span>
<span class="sd">                - True or &#39;before&#39;: the config file would be used before command line options</span>
<span class="sd">                - &#39;after&#39;: the config file would be used after command line options</span>
<span class="sd">                - Any False like value: the config file would not be used</span>
<span class="sd">            - **nested**: Name of a section whose defines the configuration.</span>
<span class="sd">              It must be used when the configuration in nested in more general configuration.</span>
<span class="sd">            - **extraopts**: Extra options to declare in the form</span>
<span class="sd">              ``[(args1, kwargs1), ((args2, kwargs2), ...]``</span>

<span class="sd">        :Return:</span>
<span class="sd">            - the :class:`OptionParser` if parse is False</span>
<span class="sd">            - the resulting :class:`~configobj.ConfigObj` if parse is True and getparser is not True</span>
<span class="sd">            - the resulting :class:`~configobj.ConfigObj` and the :class:`OptionParser` if both parse and getparser are True</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Prepare the option parser</span>
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">parser</span><span class="p">[</span><span class="s1">&#39;add_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="o">**</span><span class="n">parser</span><span class="p">)</span>

        <span class="c1"># Add short and long helps</span>
        <span class="n">old_conflict_handler</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_optionals</span><span class="o">.</span><span class="n">conflict_handler</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">_optionals</span><span class="o">.</span><span class="n">conflict_handler</span> <span class="o">=</span> <span class="s1">&#39;resolve&#39;</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span><span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">AP_ShortHelpAction</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show a reduced help and exit&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--long-help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">_HelpAction</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show an extended help and exit&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--short-help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">AP_VeryShortHelpAction</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show a very reduced help and exit&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">_optionals</span><span class="o">.</span><span class="n">conflict_handler</span> <span class="o">=</span> <span class="n">old_conflict_handler</span>

        <span class="c1"># Add extra options first</span>
        <span class="k">if</span> <span class="n">extraopts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">eopt</span> <span class="ow">in</span> <span class="n">extraopts</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eopt</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eopt</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">eargs</span> <span class="o">=</span> <span class="n">eopt</span>
                        <span class="n">ekwargs</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">eargs</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">ekwargs</span> <span class="o">=</span> <span class="n">eopt</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eargs</span><span class="p">,</span> <span class="n">ekwargs</span> <span class="o">=</span> <span class="n">eopt</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">eargs</span><span class="p">,</span> <span class="o">**</span><span class="n">ekwargs</span><span class="p">)</span>

        <span class="c1"># Add the cfgfile option (configurable)</span>
        <span class="k">if</span> <span class="n">cfgfileopt</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfileopt</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cfgfileopt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfgfileopt</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">cfgfileopt</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">cfgfileopt</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cfgfileopt</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="o">+</span><span class="n">cfgfileopt</span>
                <span class="n">cfgfileopt</span> <span class="o">=</span> <span class="p">(</span><span class="n">cfgfileopt</span><span class="p">,)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">cfgfileopt</span><span class="p">,</span>
                <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cfgfile&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;user configuration file that overrides defauts&#39;</span>
                    <span class="s1">&#39; [default: &quot;</span><span class="si">%(default)s</span><span class="s1">&quot;]&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">cfgfile</span><span class="p">)</span>

        <span class="c1"># Default config</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span>

        <span class="c1"># Create global group of options from defaults</span>
        <span class="c1"># - inits</span>
        <span class="n">re_match_initcom</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;#\s*-\*-\s*coding\s*:\s*\S+\s*-\*-\s*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">re_match_initcom</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;global configuration options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">re_match_initcom</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">icom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re_match_initcom</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">)</span><span class="o">&gt;</span><span class="n">icom</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="n">icom</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="o">*</span><span class="n">desc</span><span class="p">)</span>
        <span class="c1"># - global options</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">scalars</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_walker_argcfg_setarg_</span><span class="p">(</span><span class="n">defaults</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="n">nested</span><span class="p">,</span>
                    <span class="n">boolean_false</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_boolean_false</span><span class="p">)</span>
<span class="c1">#                group.add_argument(&#39;--&#39;+_cfg2optname_(key, nested), help=_shelp_(defaults, key))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># Create secondary option groups from defaults</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">comment</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">inline_comments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="c1"># FIXME: always empty!</span>
            <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
                    <span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">desc</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">desc</span><span class="p">]</span>
            <span class="n">section</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="o">*</span><span class="n">desc</span><span class="p">)</span>
            <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_argcfg_setarg_</span><span class="p">,</span> <span class="n">raise_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">call_on_sections</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="n">nested</span><span class="p">,</span>
                <span class="n">boolean_false</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_boolean_false</span><span class="p">)</span>

        <span class="c1"># Now create a configuration instance from passed options</span>
        <span class="k">if</span> <span class="n">parse</span><span class="p">:</span>

            <span class="c1"># Which args ?</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="c1"># Parse</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

            <span class="c1"># Create a configuration to feed</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>

            <span class="c1"># Initial config from defaults or the one supplied</span>
            <span class="k">if</span> <span class="n">patch</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">patch</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">ConfigObj</span><span class="p">)</span> <span class="k">else</span> <span class="n">defaults</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cfgfilepatch</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfilepatch</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">cfgfilepatch</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)):</span>
                    <span class="n">cfgfilepatch</span> <span class="o">=</span> <span class="s1">&#39;after&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cfgfilepatch</span> <span class="o">=</span> <span class="s1">&#39;before&#39;</span>

            <span class="c1"># Feed config with cfgfile before command line options</span>
            <span class="k">if</span> <span class="n">cfgfilepatch</span> <span class="o">==</span> <span class="s1">&#39;before&#39;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;cfgfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">cfgfile</span><span class="p">))</span>

            <span class="c1"># Feed config with command line options</span>
            <span class="n">defaults</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_argcfg_setcfg_</span><span class="p">,</span> <span class="n">raise_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">call_on_sections</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="n">nested</span><span class="p">)</span>

            <span class="c1"># Feed config with cfgfile after command line options</span>
            <span class="k">if</span> <span class="n">cfgfilepatch</span> <span class="o">==</span> <span class="s1">&#39;after&#39;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;cfgfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">cfgfile</span><span class="p">))</span>


            <span class="k">if</span> <span class="ow">not</span> <span class="n">getparser</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">getargs</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cfg</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">,</span>
            <span class="k">if</span> <span class="n">getparser</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">parser</span><span class="p">,</span>
            <span class="k">if</span> <span class="n">getargs</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">vacumm_cfg</span> <span class="o">=</span> <span class="n">cfg</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">options</span><span class="p">,</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parser</span></div>

<div class="viewcode-block" id="ConfigManager.arg_patch"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.arg_patch">[docs]</a>    <span class="k">def</span> <span class="nf">arg_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="p">[],</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="s1">&#39;cfgfile&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call to :meth:`arg_parse` with an automatic patching of current configuration</span>

<span class="sd">        :Return: ``cfg, args``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create a patch configuration from commandline arguments</span>
        <span class="n">cfgpatch</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg_parse</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="n">cfgfileopt</span><span class="p">,</span> <span class="n">getargs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#  Load personal config file and default values</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">cfgfile</span><span class="p">)</span>

        <span class="c1">#  Patch it with commandeline options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">cfgpatch</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">args</span></div>


<div class="viewcode-block" id="ConfigManager.opt_parse"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.opt_parse">[docs]</a>    <span class="k">def</span> <span class="nf">opt_parse</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="p">[],</span> <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">getparser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="s1">&#39;config.cfg&#39;</span><span class="p">,</span>
            <span class="n">patch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="s1">&#39;--cfgfile&#39;</span><span class="p">,</span> <span class="n">cfgfilepatch</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">,</span>
            <span class="n">nested</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Options (:mod:`optparse`) and config mixer.</span>

<span class="sd">            1. Creates command-line options from config defaults</span>
<span class="sd">            2. Parse command-line argument and create a configuration patch</span>

<span class="sd">        For instance, the following config define the commandline option</span>
<span class="sd">        ``--section1-my-section2-my-key`` with ``value`` as a default value, s</span>
<span class="sd">        tored in a special group of options with a short name and a long description::</span>

<span class="sd">            [section1] # Short name : long description of the group</span>
<span class="sd">                [[my_section2]]</span>
<span class="sd">                    my_key=value</span>

<span class="sd">        .. warning:: Section and option names must not contain any space-like character !</span>

<span class="sd">        .. note::</span>

<span class="sd">            If you want to prevent conflict of options, don&#39;t use ``&quot;_&quot;`` in</span>
<span class="sd">            section and option names.</span>


<span class="sd">        :Params:</span>

<span class="sd">            - **parser**: optional, a default one is created if not given. This can be:</span>
<span class="sd">                - a :class:`OptionParser` instance</span>
<span class="sd">                - a :class:`dict` with keyword arguments for the one to be created</span>
<span class="sd">            - **exc**, optional: List of keys to be excluded from parsing.</span>
<span class="sd">            - **parse**, optional: If ``True``, parse commande line options and arguments</span>
<span class="sd">            - **args**, optional: List of arguments to parse instead of default sys.argv[1:]</span>
<span class="sd">            - **getparser**: allow getting the parser in addition to the config if parse=True</span>
<span class="sd">            - **patch**, optional: used if parse is True.</span>
<span class="sd">                Can take the following values:</span>
<span class="sd">                - a :class:`bool` value indicating wheter to apply defaults on the returned config</span>
<span class="sd">                  before applying the command line config</span>
<span class="sd">                - a :class:`ConfigObj` instance to apply on the returned config</span>
<span class="sd">                  before applying the command line config</span>
<span class="sd">            - **cfgfileopt**: optional, if present a config file option will be added.</span>
<span class="sd">                Can be a :class:`string` or couple of strings to use as the option short and/or long name</span>
<span class="sd">            - **cfgfilepatch**: specify if the returned config must be patched if a config file command</span>
<span class="sd">                line option is provided and when to patch it. Can take the following values:</span>
<span class="sd">                - True or &#39;before&#39;: the config file would be used before command line options</span>
<span class="sd">                - &#39;after&#39;: the config file would be used after command line options</span>
<span class="sd">                - Any False like value: the config file would not be used</span>

<span class="sd">        :Return:</span>
<span class="sd">            - the :class:`OptionParser` if parse is False</span>
<span class="sd">            - the resulting :class:`~configobj.ConfigObj` if parse is True and getparser is not True</span>
<span class="sd">            - the resulting :class:`~configobj.ConfigObj` and the :class:`OptionParser` if both parse and getparser are True</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Prepare the option parser</span>
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="o">**</span><span class="n">parser</span><span class="p">)</span>

        <span class="c1"># Add (or override!) option types checkers</span>
        <span class="c1"># Define a new Option class</span>
        <span class="k">class</span> <span class="nc">option_class</span><span class="p">(</span><span class="n">Option</span><span class="p">):</span>
            <span class="n">TYPES</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">option_class</span><span class="o">.</span><span class="n">TYPES</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">TYPE_CHECKER</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">option_class</span><span class="o">.</span><span class="n">TYPE_CHECKER</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Define the wrapping function for optparse option types which also handle list values</span>
        <span class="k">def</span> <span class="nf">wrap_option_type_checker</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">islist</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">wrapper_option_type_checker</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">islist</span><span class="p">:</span> <span class="c1"># Use configobj list parser</span>
                    <span class="n">value</span><span class="p">,</span><span class="n">comment</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">list_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span><span class="o">.</span><span class="n">_handle_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">wrapper_option_type_checker</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">return</span> <span class="n">wrapper_option_type_checker</span>
        <span class="c1"># Setup type checkers  into the new Option class</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">option_class</span><span class="o">.</span><span class="n">TYPE_CHECKER</span><span class="p">:</span>
                <span class="k">pass</span> <span class="c1"># warn(&#39;Overriding Option type checker %s&#39;%(name))</span>
            <span class="n">islist</span> <span class="o">=</span> <span class="n">VALIDATOR_SPECS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iterable&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">option_class</span><span class="o">.</span><span class="n">TYPE_CHECKER</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrap_option_type_checker</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">islist</span><span class="p">)</span>
        <span class="c1"># Replace the parser Option class</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">option_class</span> <span class="o">=</span> <span class="n">option_class</span>

        <span class="c1"># Add the cfgfile option (configurable)</span>
        <span class="k">if</span> <span class="n">cfgfileopt</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfileopt</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">cfgfileopt</span> <span class="o">=</span> <span class="p">(</span><span class="n">cfgfileopt</span><span class="p">,)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="o">*</span><span class="n">cfgfileopt</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cfgfile&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Configuration file [default: &quot;</span><span class="si">%s</span><span class="s1">&quot;]&#39;</span><span class="o">%</span><span class="n">cfgfile</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">cfgfile</span><span class="p">)</span>

        <span class="c1"># Default config</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span>

        <span class="c1"># Create global group of options from defaults</span>
        <span class="c1"># - inits</span>
        <span class="n">re_match_initcom</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;#\s*-\*-\s*coding\s*:\s*\S+\s*-\*-\s*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">re_match_initcom</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Global configuration options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">re_match_initcom</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">icom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re_match_initcom</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">)</span><span class="o">&gt;</span><span class="n">icom</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">initial_comment</span><span class="p">[</span><span class="n">icom</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="o">*</span><span class="n">desc</span><span class="p">)</span>
        <span class="c1"># - global options</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">scalars</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_walker_optcfg_setopt_</span><span class="p">(</span><span class="n">defaults</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="n">nested</span><span class="p">,</span>
                    <span class="n">boolean_false</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_boolean_false</span><span class="p">)</span>
<span class="c1">#                group.add_option(&#39;--&#39;+_cfg2optname_(key, nested), action=&#39;store&#39;, type=&quot;string&quot;,</span>
<span class="c1">#                    dest=key, help=_shelp_(defaults, key))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># - add to parser</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

        <span class="c1"># Create secondary option groups from defaults</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Undocumented section&#39;</span><span class="p">]</span>
            <span class="n">comment</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">inline_comments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">section</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="o">*</span><span class="n">desc</span><span class="p">)</span>
            <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_optcfg_setopt_</span><span class="p">,</span> <span class="n">raise_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">call_on_sections</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="n">nested</span><span class="p">,</span>
                <span class="n">boolean_false</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_boolean_false</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

        <span class="c1"># Now create a configuration instance from passed options</span>
        <span class="k">if</span> <span class="n">parse</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

            <span class="c1"># Intercept helps</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;long_help&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">print_short_help</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

            <span class="c1"># Create a configuration to feed</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolation</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>

            <span class="c1"># Initial config from defaults or the one supplied</span>
            <span class="k">if</span> <span class="n">patch</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">patch</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">ConfigObj</span><span class="p">)</span> <span class="k">else</span> <span class="n">defaults</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cfgfilepatch</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfilepatch</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">cfgfilepatch</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)):</span>
                    <span class="n">cfgfilepatch</span> <span class="o">=</span> <span class="s1">&#39;after&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cfgfilepatch</span> <span class="o">=</span> <span class="s1">&#39;before&#39;</span>

            <span class="c1"># Feed config with cfgfile before command line options</span>
            <span class="k">if</span> <span class="n">cfgfilepatch</span> <span class="o">==</span> <span class="s1">&#39;before&#39;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;cfgfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">cfgfile</span><span class="p">))</span>

            <span class="c1"># Feed config with command line options</span>
            <span class="n">defaults</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_optcfg_setcfg_</span><span class="p">,</span> <span class="n">raise_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">call_on_sections</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="n">nested</span><span class="p">)</span>

            <span class="c1"># Feed config with cfgfile after command line options</span>
            <span class="k">if</span> <span class="n">cfgfilepatch</span> <span class="o">==</span> <span class="s1">&#39;after&#39;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;cfgfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">cfgfile</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span> <span class="k">if</span> <span class="n">getparser</span> <span class="k">else</span> <span class="n">cfg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parser</span></div>

<div class="viewcode-block" id="ConfigManager.opt_patch"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.opt_patch">[docs]</a>    <span class="k">def</span> <span class="nf">opt_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="p">[],</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="s1">&#39;cfgfile&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call to :meth:`arg_parse` with an automatic patching of current configuration</span>

<span class="sd">        :Return: ``cfg, args``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create a patch configuration from commandline arguments</span>
        <span class="n">cfgpatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_parse</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="n">cfgfileopt</span><span class="p">)</span>

        <span class="c1">#  Load personal config file and default values</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">cfgfile</span><span class="p">)</span>

        <span class="c1">#  Patch it with commandeline options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">cfgpatch</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cfg</span></div>





<div class="viewcode-block" id="ConfigManager.opt_long_help"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.opt_long_help">[docs]</a>    <span class="k">def</span> <span class="nf">opt_long_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="s2">&quot;Usage: [prog] [options] ...&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Long help based on config specs&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the generic long help from config specs</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **rst**, optional: Reformat output in rst.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Standard options</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">add_help_option</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span><span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;help&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show a reduced help&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s1">&#39;--long-help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;long_help&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show an extended help&#39;</span><span class="p">)</span>

        <span class="c1"># Configuration options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt_parse</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rst</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">IndentedHelpFormatter</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span><span class="c1">#max_help_position=0)</span>
            <span class="n">shelp</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">format_option_help</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getdefaultencoding</span><span class="p">(),</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shelp</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getdefaultencoding</span><span class="p">(),</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>

        <span class="c1"># Convert to rst</span>
        <span class="k">if</span> <span class="n">rst</span><span class="p">:</span> <span class="n">shelp</span> <span class="o">=</span> <span class="n">opt2rst</span><span class="p">(</span><span class="n">shelp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">shelp</span></div>

<div class="viewcode-block" id="ConfigManager.arg_long_help"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.arg_long_help">[docs]</a>    <span class="k">def</span> <span class="nf">arg_long_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Long help based on config specs&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the generic long help from config specs</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **rst**, optional: Reformat output in rst.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Standard options</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span><span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show a reduced help&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--long-help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show an extended help&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--short-help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show a very reduced help&#39;</span><span class="p">)</span>

        <span class="c1"># Configuration options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg_parse</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rst</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">ArgHelpFormatter</span><span class="p">(</span><span class="n">max_help_position</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">action_group</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_action_groups</span><span class="p">:</span>
                <span class="n">formatter</span><span class="o">.</span><span class="n">start_section</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
                <span class="n">formatter</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">)</span>
                <span class="n">formatter</span><span class="o">.</span><span class="n">end_section</span><span class="p">()</span>
            <span class="n">shelp</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shelp</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>

        <span class="c1"># Encoding</span>
        <span class="n">shelp</span> <span class="o">=</span> <span class="n">shelp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getdefaultencoding</span><span class="p">(),</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>

        <span class="c1"># Convert to rst</span>
        <span class="k">if</span> <span class="n">rst</span><span class="p">:</span> <span class="n">shelp</span> <span class="o">=</span> <span class="n">opt2rst</span><span class="p">(</span><span class="n">shelp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">shelp</span></div>

<div class="viewcode-block" id="ConfigManager.get_rst"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.ConfigManager.get_rst">[docs]</a>    <span class="k">def</span> <span class="nf">get_rst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;specs&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the default configuration to rst declarations with :func:`cfg2rst`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cfg2rst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="filter_section"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.filter_section">[docs]</a><span class="k">def</span> <span class="nf">filter_section</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">cfgfilter</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Recursively filter a section according to a dict of specifications</span>

<span class="sd">    When encountering an option of ``sec``, it removed if its value</span>
<span class="sd">    in ``cfgfilter`` is set to False. When not found, it default to the</span>
<span class="sd">    ``__default__`` key of ``cfgfilter``. And if the ``__default__`` is not</span>
<span class="sd">    found, it defaults to ``False`` (filtered out).</span>
<span class="sd">    When an option is a section and its value in ``cfgfilter`` is a dictionary,</span>
<span class="sd">    this subsection is filtered in the same way with the value as restrictions</span>
<span class="sd">    (``cfgfilter[subsection]``).</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **sec**: A :class:`configobj.Section` instance.</span>
<span class="sd">        - **cfgfilter**: A dictionary tree with the same structure as ``sec``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Default behavior</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">cfgfilter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__default__&#39;</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="c1"># Exceptions</span>
    <span class="n">excepts</span> <span class="o">=</span> <span class="n">cfgfilter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__excepts__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">excepts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">excepts</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">excepts</span> <span class="o">=</span> <span class="p">[</span><span class="n">excepts</span><span class="p">]</span>

    <span class="c1"># First pass on level 0</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sec</span><span class="p">:</span>
        <span class="n">kdefault</span> <span class="o">=</span> <span class="n">default</span> <span class="k">if</span> <span class="n">excepts</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excepts</span> <span class="k">else</span> <span class="ow">not</span> <span class="n">default</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfgfilter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kdefault</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">sec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Filter subsections</span>
    <span class="k">for</span> <span class="n">subsec</span> <span class="ow">in</span> <span class="n">sec</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">subsec</span> <span class="ow">in</span> <span class="n">cfgfilter</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfgfilter</span><span class="p">[</span><span class="n">subsec</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">filter_section</span><span class="p">(</span><span class="n">sec</span><span class="p">[</span><span class="n">subsec</span><span class="p">],</span>  <span class="n">cfgfilter</span><span class="p">[</span><span class="n">subsec</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sec</span></div>

<div class="viewcode-block" id="cfgargparse"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.cfgargparse">[docs]</a><span class="k">def</span> <span class="nf">cfgargparse</span><span class="p">(</span><span class="n">cfgspecfile</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="s1">&#39;cfgfile&#39;</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="s1">&#39;config.cfg&#39;</span><span class="p">,</span>
        <span class="n">exc</span><span class="o">=</span><span class="p">[],</span> <span class="n">extraopts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merge configuration and commandline arguments</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **cfgspecfile**: Config specification file (.ini).</span>
<span class="sd">        - **parser**: :class:`~argpase.ArgumentParser` instance.</span>
<span class="sd">        - **cfgfileopt**, optional: Name of the option used to specify the</span>
<span class="sd">          user config file. Example: ``&#39;cfgfile&#39;`` creates the option</span>
<span class="sd">          ``--cfgfile=&lt;config file&gt;``.</span>
<span class="sd">        - **cfgfile**, optional: Default name for the loaded config file.</span>
<span class="sd">        - **exc**, optional: Config option name that must not be used to generated</span>
<span class="sd">          a commandline option.</span>
<span class="sd">        - Extra params are passed to :class:`ConfigManager` initialization.</span>

<span class="sd">    :Return: A :class:`ConfigObj` object</span>

<span class="sd">    :Tasks:</span>

<span class="sd">        1. Initialize a default configuration (:class:`ConfigManager`)</span>
<span class="sd">           from the specification file given by ``cfgspecfile``.</span>
<span class="sd">        2. Generate associated commandline options.</span>
<span class="sd">        3. Load a user configuration file (specified with the option</span>
<span class="sd">           whose name is given by ``cfgfileopt``).</span>
<span class="sd">        4. Patch this configuration with user supplied options retrieved</span>
<span class="sd">           using the :class:`~argpase.ArgumentParser` parser ``parser``.</span>

<span class="sd">        Technically it combines :class:`ConfigManager` and :meth:`ConfigManager.arg_parse`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ConfigManager</span><span class="p">(</span><span class="n">cfgspecfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">arg_parse</span><span class="p">(</span>
        <span class="n">parser</span><span class="p">,</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="n">cfgfileopt</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="n">cfgfile</span><span class="p">,</span> <span class="n">getargs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">extraopts</span><span class="o">=</span><span class="n">extraopts</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="cfgoptparse"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.cfgoptparse">[docs]</a><span class="k">def</span> <span class="nf">cfgoptparse</span><span class="p">(</span><span class="n">cfgspecfile</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="s1">&#39;cfgfile&#39;</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="s1">&#39;config.cfg&#39;</span><span class="p">,</span>
    <span class="n">exc</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merge configuration and commandline arguments</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **cfgspecfile**: Config specification file (.ini).</span>
<span class="sd">        - **parser**: :class:`~argpase.ArgumentParser` instance.</span>
<span class="sd">        - **cfgfileopt**, optional: Name of the option used to specify the</span>
<span class="sd">          user config file. Example: ``&#39;cfgfile&#39;`` creates the option</span>
<span class="sd">          ``--cfgfile=&lt;config file&gt;``.</span>
<span class="sd">        - **cfgfile**, optional: Default name for the loaded config file.</span>
<span class="sd">        - **exc**, optional: Config option name that must not be used to generated</span>
<span class="sd">          a commandline option.</span>
<span class="sd">        - Extra params are passed to :class:`ConfigManager` initialization.</span>

<span class="sd">    :Tasks:</span>

<span class="sd">        1. Initialize a default configuration (:class:`ConfigManager`)</span>
<span class="sd">           from the specification file given by ``cfgspecfile``.</span>
<span class="sd">        2. Generate associated commandline options.</span>
<span class="sd">        3. Load a user configuration file (specified with the option</span>
<span class="sd">           whose name is given by ``cfgfileopt``).</span>
<span class="sd">        4. Patch this configuration with user supplied options retrieved</span>
<span class="sd">           using the :class:`~optpase.OptionParser` parser ``parser``.</span>

<span class="sd">        Technically it combines :class:`ConfigManager` and :meth:`ConfigManager.opt_patch`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ConfigManager</span><span class="p">(</span><span class="n">cfgspecfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">opt_parse</span><span class="p">(</span>
        <span class="n">parser</span><span class="p">,</span> <span class="n">cfgfileopt</span><span class="o">=</span><span class="n">cfgfileopt</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="n">cfgfile</span><span class="p">,</span> <span class="n">getparser</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="opt2rst"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.opt2rst">[docs]</a><span class="k">def</span> <span class="nf">opt2rst</span><span class="p">(</span><span class="n">shelp</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secfmt</span><span class="o">=</span><span class="s1">&#39;:</span><span class="si">%(secname)s</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">descname</span><span class="o">=</span><span class="s1">&#39;Description&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert options displayed in an help string to rst declarations of options</span>

<span class="sd">    This is useful for autodocumenting executable python scripts that show a formatted help.</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **shelp**: Help string showing options (results from :option:``--help``).</span>
<span class="sd">        - **prog**, optional: Program name, otherwise guess it from usage.</span>

<span class="sd">    :Output: String converted to rst format (with :rst:dir:`cmdoption` directives).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rhelp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">multiline</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">s_param</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:\{[\w,]+\}|\w+)&#39;</span>
    <span class="n">s_sopt</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:-\w+(?: </span><span class="si">%(s_param)s</span><span class="s1">)?)&#39;</span><span class="o">%</span><span class="nb">locals</span><span class="p">()</span> <span class="c1"># short option (-t)</span>
    <span class="n">s_lopt</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:--[\w\-]+(?:[= ]+</span><span class="si">%(s_param)s</span><span class="s1">)?)&#39;</span><span class="o">%</span><span class="nb">locals</span><span class="p">()</span> <span class="c1"># long option (--toto)</span>
    <span class="n">s_optsep</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:, +)&#39;</span> <span class="c1"># option separator</span>
    <span class="n">s_desc</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:  (.+))&#39;</span>
    <span class="n">s_tot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^  (?:  )?((?:</span><span class="si">%(s_sopt)s</span><span class="s1">|</span><span class="si">%(s_lopt)s</span><span class="s1">)(?:</span><span class="si">%(s_optsep)s</span><span class="s1">(?:</span><span class="si">%(s_sopt)s</span><span class="s1">|</span><span class="si">%(s_lopt)s</span><span class="s1">))*)</span><span class="si">%(s_desc)s</span><span class="s1">?$&#39;</span><span class="o">%</span><span class="nb">locals</span><span class="p">()</span>
<span class="c1">#    s_tot = r&#39;^  (%(s_sopt)s|%(s_lopt)s)|%(s_sopt)s%(s_optsep)s%(s_lopt)s)%(s_desc)s?$&#39;%locals()</span>
    <span class="n">re_opt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">s_tot</span><span class="p">)</span><span class="o">.</span><span class="n">match</span>
    <span class="n">re_sec</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(?:  )?([\w\s]+):(?: (.+))?$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span>
    <span class="n">secname</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">shelp</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>

        <span class="c1"># Sections</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re_sec</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;ex:&#39;</span><span class="p">):</span>

            <span class="n">secname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Usage</span>
            <span class="k">if</span> <span class="n">secname</span><span class="o">==</span><span class="s1">&#39;Usage&#39;</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">usage</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">prog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">prog</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">usage</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rhelp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;.. program:: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">prog</span><span class="p">)</span>
                <span class="n">rhelp</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">secfmt</span><span class="o">%</span><span class="nb">locals</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">.. code-block:: bash</span><span class="se">\n\n\t\t</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">usage</span><span class="p">])</span>
                <span class="n">multiline</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rhelp</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">secfmt</span><span class="o">%</span><span class="nb">locals</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">rhelp</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>
                    <span class="n">multiline</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">continue</span>

        <span class="c1"># Options and other lines</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re_opt</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>

            <span class="n">rhelp</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">.. cmdoption:: &#39;</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="n">multiline</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rhelp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">elif</span> <span class="n">secname</span> <span class="ow">and</span> <span class="n">secname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;positional arguments&#39;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span>

            <span class="n">sline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">rhelp</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">.. cmdoption:: &#39;</span><span class="o">+</span><span class="n">sline</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="n">multiline</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sline</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rhelp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sline</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

        <span class="k">elif</span> <span class="n">multiline</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">3</span><span class="p">):</span>

            <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">secname</span><span class="o">==</span><span class="s1">&#39;Usage&#39;</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
            <span class="n">rhelp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="c1">#elif secname==descname:</span>
        <span class="c1">#    rhelp.append(&#39;\t&#39;+line)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">secname</span> <span class="ow">and</span> <span class="n">secname</span><span class="o">==</span><span class="n">descname</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
            <span class="n">rhelp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
            <span class="n">multiline</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">secname</span><span class="o">==</span><span class="s1">&#39;Usage&#39;</span><span class="p">:</span>
                <span class="n">secname</span> <span class="o">=</span> <span class="n">descname</span>
                <span class="n">rhelp</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">secfmt</span><span class="o">%</span><span class="nb">locals</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rhelp</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_opt2cfgname_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nested</span><span class="p">):</span>
    <span class="n">cfgkey</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nested</span> <span class="ow">and</span> <span class="n">cfgkey</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">nested</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
        <span class="n">cfgkey</span> <span class="o">=</span> <span class="n">cfgkey</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">nested</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="p">):]</span>
    <span class="k">return</span> <span class="n">cfgkey</span>

<span class="n">_re_cfg2optname_sub</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[_\s]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span>
<span class="k">def</span> <span class="nf">_cfg2optname_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">optkey</span> <span class="o">=</span> <span class="n">_re_cfg2optname_sub</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nested</span><span class="p">:</span> <span class="n">optkey</span> <span class="o">=</span> <span class="n">nested</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">optkey</span>
    <span class="k">return</span> <span class="n">optkey</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">_attdict_</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span> <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

<div class="viewcode-block" id="get_spec"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.get_spec">[docs]</a><span class="k">def</span> <span class="nf">get_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get an option specification.</span>

<span class="sd">        :Params:</span>
<span class="sd">            - **spec**: the specification string</span>
<span class="sd">            - **validator**: (optional) the validator to use</span>

<span class="sd">        :Return: A dict with keys:</span>
<span class="sd">            - **funcname**: the validation function name</span>
<span class="sd">            - **args**:  the positionnal arguments</span>
<span class="sd">            - **kwargs**: the named arguments</span>
<span class="sd">            - **default**: the default value</span>
<span class="sd">            - **iterable**: if the value is list-like</span>
<span class="sd">            - **func**: the validation function</span>
<span class="sd">            - **opttype**: the function used with :mod:`optparse`</span>
<span class="sd">            - **argtype**: the function used with :mod:`argparse`</span>

<span class="sd">        Read access to these keys can also be done as attribute of the returned dict</span>
<span class="sd">        (d.funcname == d[&#39;funcname&#39;], ...)</span>

<span class="sd">        For example, a specification file containing:</span>

<span class="sd">        [section]</span>
<span class="sd">            option = integer(default=0, min=-10, max=10)</span>

<span class="sd">        Would return: ``{&#39;funcname&#39;: integer, &#39;args&#39;: [],</span>
<span class="sd">                         &#39;kwargs&#39;: {&#39;min&#39;: &#39;-10&#39;, &#39;max&#39;: &#39;10&#39;}, &#39;default:&#39; 0,</span>
<span class="sd">                         &#39;opttype&#39;: &#39;int&#39;, &#39;argtype&#39;: int,</span>
<span class="sd">                         &#39;func&#39;:is_integer, &#39;iterable&#39;: None}</span>

<span class="sd">        This can be usefull when you added extraneous named arguments into your</span>
<span class="sd">        specification file for your own use.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validator</span><span class="p">:</span>
            <span class="n">validator</span> <span class="o">=</span> <span class="n">get_validator</span><span class="p">()</span>
        <span class="n">funcname</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">_parse_with_caching</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">VALIDATOR_SPECS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">funcname</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opttype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">argtype</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">funcname</span><span class="o">=</span><span class="n">funcname</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_attdict_</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span></div>

<span class="n">getspec</span> <span class="o">=</span> <span class="n">get_spec</span>

<div class="viewcode-block" id="get_validator"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.get_validator">[docs]</a><span class="k">def</span> <span class="nf">get_validator</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a default validator&quot;&quot;&quot;</span>

    <span class="c1"># Init</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">()</span>

    <span class="c1"># User defined functions</span>
    <span class="k">if</span> <span class="n">functions</span><span class="p">:</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>

    <span class="c1"># Wrap default functions to handle none and extra args</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">validator</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_valwrap_</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="c1"># This modules&#39;s validator functions are already wrapped</span>
    <span class="n">validator</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">VALIDATOR_FUNCTIONS</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">validator</span></div>

<span class="k">def</span> <span class="nf">_walker_remove_all_comments_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">sec</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">sec</span><span class="o">.</span><span class="n">inline_comments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">_walker_remove_comments_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">sec</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">_walker_remove_inline_comments_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">sec</span><span class="o">.</span><span class="n">inline_comments</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">_walker_unchanged_options_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sec</span><span class="o">.</span><span class="n">configspec</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">getspec</span><span class="p">(</span><span class="n">sec</span><span class="o">.</span><span class="n">configspec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">spec</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">sec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">remove_defaults</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_unchanged_options_</span><span class="p">,</span> <span class="n">call_on_sections</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_walker_optcfg_setcfg_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Walker to set config values&quot;&quot;&quot;</span>
    <span class="c1"># Find genealogy</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="n">_parent_list_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cfgkey</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">option</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="c1"># Option not set</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>

        <span class="c1"># Option matches key?</span>
        <span class="k">if</span> <span class="n">_opt2cfgname_</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">nested</span><span class="p">)</span> <span class="o">!=</span> <span class="n">cfgkey</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="k">continue</span>

        <span class="c1"># Check or create cfg genealogy</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">cfg</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">s</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_walker_optcfg_setopt_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boolean_false</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Walker to set options&quot;&quot;&quot;</span>
    <span class="c1"># Find option key and output var name</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">_parent_list_</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>
    <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pp</span><span class="o">+</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">optkey</span> <span class="o">=</span> <span class="n">_cfg2optname_</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">nested</span><span class="p">)</span>

    <span class="c1"># Check exceptions</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">:</span> <span class="k">return</span>

    <span class="c1"># Add option to group</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">VALIDATOR_SPECS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sec</span><span class="o">.</span><span class="n">configspec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">{})</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;opttype&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">boolean_false</span> <span class="ow">and</span> <span class="nb">type</span><span class="o">==</span><span class="s1">&#39;boolean&#39;</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store_false&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;store_true&#39;</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store&#39;</span>
        <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s1">&#39;--&#39;</span><span class="o">+</span><span class="n">optkey</span><span class="p">,</span>
            <span class="c1">#action=&#39;append&#39; if spec.get(&#39;iterable&#39;, None) else &#39;store&#39;,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">varname</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">_shelp_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">_walker_argcfg_setcfg_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Walker to set config values&quot;&quot;&quot;</span>
    <span class="c1"># Find genealogy</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="n">_parent_list_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cfgkey</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">option</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">_get_kwargs</span><span class="p">():</span>

        <span class="c1"># Option not set</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>

        <span class="c1"># Option matches key?</span>
        <span class="k">if</span> <span class="n">_opt2cfgname_</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">nested</span><span class="p">)</span> <span class="o">!=</span> <span class="n">cfgkey</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="k">continue</span>

        <span class="c1"># Check or create cfg genealogy</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">cfg</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">s</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_walker_argcfg_setarg_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">boolean_false</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Walker to set options&quot;&quot;&quot;</span>
    <span class="c1"># Find option key and output var name</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">_parent_list_</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>
    <span class="n">varname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pp</span><span class="o">+</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">optkey</span> <span class="o">=</span> <span class="n">_cfg2optname_</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">nested</span><span class="p">)</span>

    <span class="c1"># Check exceptions</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">if</span> <span class="n">sec</span><span class="o">.</span><span class="n">configspec</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sec</span><span class="o">.</span><span class="n">configspec</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">VALIDATOR_SPECS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sec</span><span class="o">.</span><span class="n">configspec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">{})</span>

    <span class="c1"># Define the wrapping function for argparse argument types which also handle list values</span>
    <span class="k">def</span> <span class="nf">wrap_argparse_type</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">islist</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrapper_argparse_type</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">islist</span><span class="p">:</span> <span class="c1"># Use configobj list parser</span>
                <span class="n">value</span><span class="p">,</span><span class="n">comment</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">list_values</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span><span class="o">.</span><span class="n">_handle_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">wrapper_argparse_type</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">wrapper_argparse_type</span>

    <span class="c1"># Add argument to group</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">wrap_argparse_type</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span><span class="n">s</span><span class="p">),</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iterable&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">boolean_false</span> <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;opttype&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;boolean&#39;</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store_true&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="s1">&#39;store_false&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store&#39;</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--&#39;</span><span class="o">+</span><span class="n">optkey</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">_shelp_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kw</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">_shelp_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(shelp)s</span><span class="s1"> [default: </span><span class="si">%(default)r</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
    <span class="n">undoc</span><span class="o">=</span><span class="s1">&#39;Undocumented&#39;</span><span class="p">,</span> <span class="n">adddot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get help string</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **mode**:</span>

<span class="sd">            - inline: inline comment only,</span>
<span class="sd">            - above: above comments only,</span>
<span class="sd">            - merge: merge inline and above comments,</span>
<span class="sd">            - auto: if one is empty use the other one, else use inline</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># filter</span>
    <span class="k">def</span> <span class="nf">strip</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">abcoms</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">strip</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sec</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
    <span class="n">incoms</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">strip</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">sec</span><span class="o">.</span><span class="n">inline_comments</span><span class="p">[</span><span class="n">key</span><span class="p">]]))</span>


    <span class="c1"># Merge comments above item and its inline comment</span>
    <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;merge&#39;</span><span class="p">:</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="n">abcoms</span><span class="o">+</span><span class="n">incoms</span>
    <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">incoms</span><span class="p">:</span>
            <span class="n">comments</span> <span class="o">=</span> <span class="n">abcoms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comments</span> <span class="o">=</span> <span class="n">incoms</span>
    <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;above&#39;</span><span class="p">:</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="n">abcoms</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="n">incoms</span>

    <span class="c1"># Force comments to end with a dot &#39;.&#39;</span>
    <span class="k">if</span> <span class="n">adddot</span><span class="p">:</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.&#39;</span><span class="o">%</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comments</span><span class="p">]</span>
    <span class="n">shelp</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>

    <span class="c1"># If no comments</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">shelp</span><span class="p">:</span> <span class="n">shelp</span> <span class="o">=</span> <span class="n">undoc</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">_sdefault_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">format</span><span class="o">%</span><span class="nb">locals</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_sdefault_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get default string or None&quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">sec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">default</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="p">)</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%%</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">default</span><span class="o">==</span><span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">default</span>


<span class="k">def</span> <span class="nf">_parent_list_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">sec</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parents</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">names</span> <span class="ow">and</span> <span class="n">sec</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sec</span><span class="p">)</span>
        <span class="n">sec</span> <span class="o">=</span> <span class="n">sec</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">return</span> <span class="n">parents</span>

<span class="k">def</span> <span class="nf">_walker_patch_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">patch_key</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">cfgpatch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Walk through the patch to apply it&quot;&quot;&quot;</span>
    <span class="n">psec</span> <span class="o">=</span> <span class="n">cfgpatch</span>
    <span class="n">csec</span> <span class="o">=</span> <span class="n">cfg</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_parent_list_</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">psec</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span> <span class="c1"># nothing to patch</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">csec</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="n">csec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">csec</span> <span class="o">=</span> <span class="n">csec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">psec</span> <span class="o">=</span> <span class="n">psec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">patch_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">psec</span><span class="p">:</span> <span class="c1"># nothing to patch</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">patch_key</span> <span class="ow">in</span> <span class="n">csec</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">psec</span><span class="p">[</span><span class="n">patch_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">csec</span><span class="p">[</span><span class="n">patch_key</span><span class="p">])(</span><span class="n">psec</span><span class="p">[</span><span class="n">patch_key</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">csec</span><span class="p">[</span><span class="n">patch_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">psec</span><span class="p">[</span><span class="n">patch_key</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_walker_set_boolean_false_by_default_</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">validator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">check</span> <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">fun_name</span><span class="p">,</span> <span class="n">fun_args</span><span class="p">,</span> <span class="n">fun_kwargs</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">_parse_with_caching</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fun_name</span><span class="o">==</span><span class="s1">&#39;boolean&#39;</span> <span class="ow">and</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fun_args</span> <span class="ow">or</span> <span class="n">fun_kwargs</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">check</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;, default=False)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">check</span><span class="o">+</span><span class="s1">&#39;(default=False)&#39;</span>
        <span class="n">sec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">check</span>

<div class="viewcode-block" id="get_secnames"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.get_secnames">[docs]</a><span class="k">def</span> <span class="nf">get_secnames</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get section names as list from top to bottom [&#39;sec0&#39;,&#39;sec1&#39;,...]&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">depth</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
    <span class="n">secnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">secnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">secnames</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<span class="k">def</span> <span class="nf">pathname</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">entry</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get a string representing the path of ConfigObj and optionally an entry in it.</span>
<span class="sd">        &gt;&gt;&gt; c=configobj.ConfigObj({&#39;a&#39;:{&#39;b&#39;:{&#39;c&#39;:&#39;d&#39;}}})</span>
<span class="sd">        &gt;&gt;&gt; cfgpath(c[&#39;a&#39;][&#39;b&#39;])</span>
<span class="sd">        &#39;a.b&#39;</span>
<span class="sd">        &gt;&gt;&gt; cfgpath(c[&#39;a&#39;], &#39;b&#39;)</span>
<span class="sd">        &#39;a.b&#39;</span>
<span class="sd">        &gt;&gt;&gt; cfgpath(c[&#39;a&#39;][&#39;b&#39;], &#39;c&#39;)</span>
<span class="sd">        &#39;a.b.c&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ancestors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ancestors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="n">curcfg</span> <span class="o">=</span> <span class="n">cfg</span>
    <span class="k">while</span> <span class="n">curcfg</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">curcfg</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">curcfg</span><span class="p">:</span>
        <span class="n">ancestors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curcfg</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">curcfg</span> <span class="o">=</span> <span class="n">curcfg</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">ancestors</span><span class="p">))</span>

<div class="viewcode-block" id="list_options"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.list_options">[docs]</a><span class="k">def</span> <span class="nf">list_options</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">optlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the list of options of section tree</span>

<span class="sd">    Each list items has the format ``(sections, optname)`` or</span>
<span class="sd">    ``(sections, optname, optvalue)`` depending on the ``values`` keyword.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">optlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># new list</span>
        <span class="n">optlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">parents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># parent sections</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">get_secnames</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sec</span><span class="o">.</span><span class="n">scalars</span><span class="p">:</span> <span class="c1"># add scalar items</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">(</span><span class="n">parents</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">+=</span> <span class="n">sec</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
        <span class="n">optlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">subsec</span> <span class="ow">in</span> <span class="n">sec</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span> <span class="c1"># deep into subsections</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">)</span> <span class="k">if</span> <span class="n">values</span> <span class="k">else</span> <span class="p">()</span>
        <span class="n">subparents</span> <span class="o">=</span> <span class="n">parents</span><span class="o">+</span><span class="p">[</span><span class="n">subsec</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">subsections</span> <span class="o">=</span> <span class="n">sections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subsec</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subsections</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">optlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">subparents</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sections</span><span class="p">:</span>
                <span class="n">optlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">subparents</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">subsections</span> <span class="o">=</span> <span class="n">sections</span>
        <span class="n">list_options</span><span class="p">(</span><span class="n">sec</span><span class="p">[</span><span class="n">subsec</span><span class="p">],</span> <span class="n">optlist</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="n">subparents</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="n">subsections</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">optlist</span></div>

<div class="viewcode-block" id="option2rst"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.option2rst">[docs]</a><span class="k">def</span> <span class="nf">option2rst</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">optrole</span><span class="o">=</span><span class="s1">&#39;confopt&#39;</span><span class="p">,</span>  <span class="n">secrole</span><span class="o">=</span><span class="s1">&#39;confsec&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format a tuple or ``(parents, optname)`` to a rst inline declaration&quot;&quot;&quot;</span>
    <span class="n">seclist</span><span class="p">,</span> <span class="n">optname</span> <span class="o">=</span> <span class="n">option</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="s1">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seclist</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
    <span class="k">if</span> <span class="n">optname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;:</span><span class="si">{secrole}</span><span class="s1">:`</span><span class="si">{parents}</span><span class="s1">`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">return</span> <span class="s1">&#39;:</span><span class="si">{optrole}</span><span class="s1">:`</span><span class="si">{parents}{optname}</span><span class="s1">`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span></div>

<span class="k">def</span> <span class="nf">redent</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;    &#39;</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="o">*</span><span class="n">indent</span><span class="o">+</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<div class="viewcode-block" id="cfg2rst"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.cfg2rst">[docs]</a><span class="k">def</span> <span class="nf">cfg2rst</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span> <span class="n">optrole</span><span class="o">=</span><span class="s1">&#39;confopt&#39;</span><span class="p">,</span>  <span class="n">secrole</span><span class="o">=</span><span class="s1">&#39;confsec&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a configuration to rst format</span>

<span class="sd">    Configuration sections are declared with the rst directive</span>
<span class="sd">    &quot;confsec&quot; and options are declared with the rst directive</span>
<span class="sd">    &quot;confopt&quot;.</span>

<span class="sd">    For instance:</span>

<span class="sd">    .. code-block:: ini</span>

<span class="sd">        a=1 # desc a</span>
<span class="sd">        [s1] # desc s1</span>
<span class="sd">            b=2  # desc b</span>
<span class="sd">            [[s2]] # desc s2</span>
<span class="sd">                c=$a-$b # desd c</span>
<span class="sd">                [sec1] # section 1</span>

<span class="sd">    is converted to:</span>

<span class="sd">    .. code-block:: rst</span>

<span class="sd">        .. confopt:: a</span>

<span class="sd">            desc a</span>

<span class="sd">        .. confsec:: [s1]</span>

<span class="sd">            desc s1</span>

<span class="sd">            .. confopt:: [s1] b</span>

<span class="sd">                desc b</span>

<span class="sd">            .. confsec:: [s1][s2]</span>

<span class="sd">                desc s2</span>

<span class="sd">                .. confopt:: [s1][s2] c</span>

<span class="sd">                    desd c</span>

<span class="sd">    Then one can reference an option with for example ``:confopt:`[s1][s2]c`.</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **cfg**: :class:`ConfigObj` or :class:`ConfigManager` instance.</span>
<span class="sd">          In the case of a :class:`ConfigManager`, the :meth:`~ConfigManager.defaults`</span>
<span class="sd">          are used.</span>

<span class="sd">    :Return: rst string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ConfigManager</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;specs&#39;</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">specs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_walker_cfg2rst_</span><span class="p">,</span> <span class="n">call_on_sections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span>
             <span class="n">optrole</span><span class="o">=</span><span class="n">optrole</span><span class="p">,</span> <span class="n">secrole</span><span class="o">=</span><span class="n">secrole</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_walker_cfg2rst_</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">optrole</span><span class="o">=</span><span class="s1">&#39;cfgopt&#39;</span><span class="p">,</span> <span class="n">secrole</span><span class="o">=</span><span class="s1">&#39;cfgsec&#39;</span><span class="p">,</span>
                     <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">dir_fmt</span><span class="o">=</span><span class="s1">&#39;.. </span><span class="si">{conftype}</span><span class="s1">:: </span><span class="si">{name}</span><span class="se">\n\n</span><span class="si">{desc}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">desc_fmt_desc_item</span><span class="o">=</span><span class="s2">&quot;| </span><span class="si">{key}</span><span class="s2">: ``</span><span class="si">{val}</span><span class="s2">``</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="c1">#                     desc_fmt_values=&#39;| Default value: ``{value}``\n| {desc}&#39;,</span>
<span class="c1">#                     desc_fmt_specs=(&#39;| Default value: ``{value}``\n&#39;</span>
<span class="c1">#                                     &#39;| Type: ``{type}``\n| {desc}&#39;),</span>
                                     <span class="p">):</span>

    <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">,</span> <span class="s1">&#39;specs&#39;</span><span class="p">)</span>

    <span class="c1"># Name, values and type</span>
    <span class="n">secnames</span> <span class="o">=</span> <span class="n">get_secnames</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
    <span class="n">specs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span> <span class="c1"># section</span>

        <span class="n">secnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">secnames</span><span class="p">),</span> <span class="p">)</span>
        <span class="n">conftype</span> <span class="o">=</span> <span class="n">secrole</span>

    <span class="k">else</span><span class="p">:</span> <span class="c1"># option</span>

        <span class="k">if</span> <span class="n">secnames</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">] </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;][&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">secnames</span><span class="p">),</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">conftype</span> <span class="o">=</span> <span class="n">optrole</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span>

            <span class="n">specs</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;specs&#39;</span><span class="p">:</span>

            <span class="n">spec</span> <span class="o">=</span> <span class="n">get_spec</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">)</span>
            <span class="n">specs</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>
            <span class="n">specs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;funcname&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]:</span>
                <span class="n">skey</span> <span class="o">=</span> <span class="s1">&#39;possible choices&#39;</span> <span class="k">if</span> <span class="n">name</span><span class="o">==</span><span class="s1">&#39;choice&#39;</span> <span class="k">else</span> <span class="s1">&#39;args&#39;</span>
                <span class="n">specs</span><span class="p">[</span><span class="n">skey</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]:</span>
                <span class="n">specs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">specs</span><span class="p">:</span> <span class="c1"># join lists</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">specs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">specs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>

    <span class="c1"># Description</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">inline_comments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">desc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

    <span class="c1"># Formatting</span>
    <span class="c1"># - description with specs</span>
    <span class="k">if</span> <span class="n">specs</span><span class="p">:</span>
        <span class="n">sdesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">specs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">sdesc</span> <span class="o">=</span> <span class="n">sdesc</span> <span class="o">+</span> <span class="n">desc_fmt_desc_item</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">sdesc</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">desc</span>
    <span class="c1"># - directive</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">redent</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">dir_fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">redent</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>



<div class="viewcode-block" id="print_short_help"><a class="viewcode-back" href="../../../library/misc.config.html#vacumm.misc.config.print_short_help">[docs]</a><span class="k">def</span> <span class="nf">print_short_help</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print all help of an :class:`~optparse.OptionParser` instance but those of groups.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">OptionParser</span><span class="p">):</span>
        <span class="c1"># - top</span>
        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">formatter</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">get_usage</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">format_description</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># - basic options skipping groups</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">store_option_strings</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">format_heading</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Options&quot;</span><span class="p">)))</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">indent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">option_list</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OptionContainer</span><span class="o">.</span><span class="n">format_option_help</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">formatter</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">dedent</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">format_epilog</span><span class="p">(</span><span class="n">formatter</span><span class="p">))</span>
        <span class="nb">print</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">ArgumentParser</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>

        <span class="c1"># usage</span>
        <span class="k">if</span> <span class="n">compressed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">compressed</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;-help&#39;</span><span class="p">,</span> <span class="s1">&#39;--long-help&#39;</span><span class="p">,</span> <span class="s1">&#39;--short-help&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;--cfgfile&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compressed</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compressed</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">compressed</span> <span class="o">=</span> <span class="p">[</span><span class="n">compressed</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">compressed</span><span class="p">:</span>
            <span class="n">fake_action</span> <span class="o">=</span> <span class="n">AP_Action</span><span class="p">([</span><span class="s1">&#39;other-options&#39;</span><span class="p">],</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">valid_option</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">optstr</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">optstr</span> <span class="ow">in</span> <span class="n">compressed</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">valid_option</span><span class="p">,</span> <span class="n">parser</span><span class="o">.</span><span class="n">_actions</span><span class="p">)</span>
            <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake_action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_actions</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span>
                            <span class="n">parser</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">)</span>

        <span class="c1"># description</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

        <span class="c1"># positionals, optionals and user-defined groups</span>
        <span class="k">for</span> <span class="n">action_group</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_action_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action_group</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;positional arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;optional arguments&#39;</span><span class="p">]:</span>
                <span class="n">formatter</span><span class="o">.</span><span class="n">start_section</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
                <span class="n">formatter</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">)</span>
                <span class="n">formatter</span><span class="o">.</span><span class="n">end_section</span><span class="p">()</span>

        <span class="c1"># epilog</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">epilog</span><span class="p">)</span>

        <span class="c1"># determine help from format above</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">(),</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">AP_ShortHelpAction</span><span class="p">(</span><span class="n">_HelpAction</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">print_short_help</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">AP_VeryShortHelpAction</span><span class="p">(</span><span class="n">_HelpAction</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">print_short_help</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">shelp</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Usage: showtime.py [options] ncfile</span>
<span class="s2">           [--logger-level LOGGER_LEVEL] [--logger-file LOGGER_FILE]</span>

<span class="s2">Show time axis dates of netcdf file.</span>
<span class="s2">Show time axis dates of netcdf file.</span>

<span class="s2">Options:</span>
<span class="s2">  -h, --help            show this help message and exit</span>
<span class="s2">  -t TNAME, --time=TNAME</span>
<span class="s2">                        name of the time axis variable</span>
<span class="s2">  -v VNAME, --var=VNAME</span>
<span class="s2">                        name of the variable from which to guess time</span>
<span class="s2">  -s TSLICE, --slice=TSLICE</span>
<span class="s2">                        time slice (examples: &quot;2&quot;, &quot;:-2:4&quot;)</span>
<span class="s2">  -m, --minmax          show min/max only (default: False)</span>
<span class="s2">  -n NCOL, --ncol=NCOL  number of comlumns for output (default: 5)</span>
<span class="s2">  -f FORMAT, --format=FORMAT</span>
<span class="s2">                        date format (default: %Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S)</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="c1">#    shelp=&quot;&quot;&quot;Options:</span>
<span class="c1">#  -h, --help            show a reduced help</span>
<span class="c1">#  --long-help           show an extended help</span>
<span class="c1">#  --cfgfile=CFGFILE     Configuration file [default: &quot;config.cfg&quot;]</span>
<span class="c1">#</span>
<span class="c1">#  Global configuration options:</span>
<span class="c1">#     Important general configuration options</span>
<span class="c1">#</span>
<span class="c1">#    --mars=MARS         complete configuration of mars. [default:</span>
<span class="c1">#                        &#39;MANGA-V8.11&#39;]</span>
<span class="c1">#    --mars-version=MARS_VERSION</span>
<span class="c1">#                        MARS version. [default: &#39;V8.11&#39;]</span>
<span class="c1">#&quot;&quot;&quot;</span>
    <span class="nb">print</span> <span class="n">opt2rst</span><span class="p">(</span><span class="n">shelp</span><span class="p">)</span>


</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" >vacumm</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>