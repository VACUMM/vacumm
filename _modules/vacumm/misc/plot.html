
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>vacumm.misc.plot &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="../../../_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" accesskey="U">vacumm</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vacumm.misc.plot</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generic plots using Matplotlib and taking advantage of CDAT</span>

<span class="sd">Tutorial: &quot;:ref:`user.tut.misc.plot`&quot;.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Copyright or Â© or Copr. Actimar/IFREMER (2010-2015)</span>
<span class="c1">#</span>
<span class="c1"># This software is a computer program whose purpose is to provide</span>
<span class="c1"># utilities for handling oceanographic and atmospheric data,</span>
<span class="c1"># with the ultimate goal of validating the MARS model from IFREMER.</span>
<span class="c1">#</span>
<span class="c1"># This software is governed by the CeCILL license under French law and</span>
<span class="c1"># abiding by the rules of distribution of free software.  You can  use,</span>
<span class="c1"># modify and/ or redistribute the software under the terms of the CeCILL</span>
<span class="c1"># license as circulated by CEA, CNRS and INRIA at the following URL</span>
<span class="c1"># &quot;http://www.cecill.info&quot;.</span>
<span class="c1">#</span>
<span class="c1"># As a counterpart to the access to the source code and  rights to copy,</span>
<span class="c1"># modify and redistribute granted by the license, users are provided only</span>
<span class="c1"># with a limited warranty  and the software&#39;s author,  the holder of the</span>
<span class="c1"># economic rights,  and the successive licensors  have only  limited</span>
<span class="c1"># liability.</span>
<span class="c1">#</span>
<span class="c1"># In this respect, the user&#39;s attention is drawn to the risks associated</span>
<span class="c1"># with loading,  using,  modifying and/or developing or reproducing the</span>
<span class="c1"># software by the user in light of its specific status of free software,</span>
<span class="c1"># that may mean  that it is complicated to manipulate,  and  that  also</span>
<span class="c1"># therefore means  that it is reserved for developers  and  experienced</span>
<span class="c1"># professionals having in-depth computer knowledge. Users are therefore</span>
<span class="c1"># encouraged to load and test the software&#39;s suitability as regards their</span>
<span class="c1"># requirements in conditions enabling the security of their systems and/or</span>
<span class="c1"># data to be ensured and,  more generally, to use and operate it in the</span>
<span class="c1"># same conditions as regards security.</span>
<span class="c1">#</span>
<span class="c1"># The fact that you are presently reading this means that you have had</span>
<span class="c1"># knowledge of the CeCILL license and that you accept its terms.</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">cycle</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">isNumberType</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="k">import</span> <span class="n">Template</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="k">import</span> <span class="n">mktemp</span>

<span class="kn">import</span> <span class="nn">cdtime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">N</span><span class="o">,</span><span class="nn">MV2</span><span class="o">,</span> <span class="nn">cdms2</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">P</span>
<span class="kn">from</span> <span class="nn">cdms2.axis</span> <span class="k">import</span> <span class="n">AbstractAxis</span>
<span class="kn">from</span> <span class="nn">genutil</span> <span class="k">import</span> <span class="n">minmax</span><span class="p">,</span> <span class="n">statistics</span>
<span class="kn">from</span> <span class="nn">matplotlib.axes</span> <span class="k">import</span> <span class="n">Subplot</span>
<span class="kn">from</span> <span class="nn">matplotlib.cm</span> <span class="k">import</span> <span class="n">ScalarMappable</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="k">import</span> <span class="n">LineCollection</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">ColorConverter</span><span class="p">,</span><span class="n">is_color_like</span><span class="p">,</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="k">import</span> <span class="p">(</span><span class="n">DateFormatter</span><span class="p">,</span> <span class="n">MonthLocator</span><span class="p">,</span> <span class="n">WeekdayLocator</span><span class="p">,</span> <span class="n">YearLocator</span><span class="p">,</span>
    <span class="n">DayLocator</span><span class="p">,</span> <span class="n">HourLocator</span><span class="p">,</span> <span class="n">MinuteLocator</span><span class="p">,</span> <span class="n">SecondLocator</span><span class="p">,</span> <span class="n">MONDAY</span><span class="p">,</span> <span class="n">WEEKLY</span><span class="p">,</span> <span class="n">YEARLY</span><span class="p">,</span> <span class="n">MONTHLY</span><span class="p">,</span>
    <span class="n">AutoDateLocator</span><span class="p">,</span> <span class="n">AutoDateFormatter</span><span class="p">,</span> <span class="n">MO</span><span class="p">,</span> <span class="n">DAILY</span><span class="p">,</span> <span class="n">HOURLY</span><span class="p">,</span> <span class="n">num2date</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Wedge</span><span class="p">,</span><span class="n">Shadow</span><span class="p">,</span><span class="n">Circle</span><span class="p">,</span> <span class="n">Arc</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">FormatStrFormatter</span><span class="p">,</span> <span class="n">Formatter</span><span class="p">,</span> <span class="n">FixedLocator</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="k">import</span> <span class="n">Basemap</span>

<span class="kn">from</span> <span class="nn">.misc</span> <span class="k">import</span> <span class="p">(</span><span class="n">dict_aliases</span><span class="p">,</span> <span class="n">latlab</span><span class="p">,</span> <span class="n">lonlab</span><span class="p">,</span> <span class="n">deplab</span><span class="p">,</span>
    <span class="n">geo_scale</span><span class="p">,</span> <span class="n">kwfilter</span><span class="p">,</span> <span class="n">dict_check_defaults</span><span class="p">,</span> <span class="n">auto_scale</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.atime</span> <span class="k">import</span> <span class="p">(</span><span class="n">mpl</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">axis_add</span><span class="p">,</span> <span class="n">compress</span><span class="p">,</span> <span class="n">SpecialDateFormatter</span><span class="p">,</span>
    <span class="p">)</span>
<span class="kn">from</span> <span class="nn">.axes</span> <span class="k">import</span> <span class="n">check_axes</span><span class="p">,</span> <span class="n">isaxis</span><span class="p">,</span> <span class="n">istime</span><span class="p">,</span> <span class="n">axis_type</span>
<span class="kn">from</span> <span class="nn">.color</span> <span class="k">import</span> <span class="n">simple_colors</span><span class="p">,</span> <span class="n">Scalar2RGB</span><span class="p">,</span> <span class="n">get_cmap</span>
<span class="kn">from</span> <span class="nn">.color</span> <span class="k">import</span> <span class="n">get_cmap</span><span class="p">,</span> <span class="n">Scalar2RGB</span>
<span class="kn">from</span> <span class="nn">.core_plot</span> <span class="k">import</span> <span class="p">(</span><span class="n">add_glow</span><span class="p">,</span> <span class="n">add_shadow</span><span class="p">,</span> <span class="n">add_agg_filter</span><span class="p">,</span> <span class="n">hlitvs</span><span class="p">,</span>
    <span class="n">AutoDateFormatter2</span><span class="p">,</span>  <span class="n">DualDateFormatter</span><span class="p">,</span> <span class="n">add_lightshading</span><span class="p">,</span>
    <span class="n">AutoDateLocator2</span><span class="p">,</span> <span class="n">AutoDateMinorLocator</span><span class="p">,</span> <span class="n">AutoDualDateFormatter</span><span class="p">,</span> <span class="n">add_compass</span><span class="p">,</span>
    <span class="n">add_right_label</span><span class="p">,</span> <span class="n">add_left_label</span><span class="p">,</span> <span class="n">add_top_label</span><span class="p">,</span> <span class="n">add_bottom_label</span><span class="p">,</span>
    <span class="n">add_lightshading</span><span class="p">,</span> <span class="n">add_param_label</span><span class="p">,</span> <span class="n">get_quiverkey_value</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.docstrings</span> <span class="k">import</span> <span class="n">docfill</span>
<span class="kn">from</span> <span class="nn">.grid.misc</span> <span class="k">import</span> <span class="p">(</span><span class="n">meshgrid</span><span class="p">,</span> <span class="n">meshbounds</span><span class="p">,</span> <span class="n">var2d</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.grid</span> <span class="k">import</span> <span class="n">regridding</span>
<span class="kn">from</span> <span class="nn">.grid.basemap</span> <span class="k">import</span> <span class="n">gshhs_reslist</span><span class="p">,</span> <span class="n">gshhs_autores</span><span class="p">,</span> <span class="n">cache_map</span><span class="p">,</span> <span class="n">cached_map</span>
<span class="kn">from</span> <span class="nn">.grid.misc</span> <span class="k">import</span> <span class="n">get_xy</span>
<span class="kn">from</span> <span class="nn">.misc</span> <span class="k">import</span> <span class="n">is_iterable</span><span class="p">,</span> <span class="n">broadcast</span><span class="p">,</span> <span class="n">squarebox</span><span class="p">,</span> <span class="n">zoombox</span>
<span class="kn">from</span> <span class="nn">.phys.units</span> <span class="k">import</span> <span class="n">deg2m</span><span class="p">,</span> <span class="n">m2deg</span>
<span class="kn">from</span> <span class="nn">..__init__</span> <span class="k">import</span> <span class="n">VACUMMError</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;traj&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipsis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;add_colorbar&#39;</span><span class="p">,</span> <span class="s1">&#39;scolorbar&#39;</span><span class="p">,</span><span class="s1">&#39;rotate_tick_labels&#39;</span><span class="p">,</span> <span class="s1">&#39;rotate_xlabels&#39;</span><span class="p">,</span> <span class="s1">&#39;rotate_ylabels&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scale_xlim&#39;</span><span class="p">,</span> <span class="s1">&#39;scale_ylim&#39;</span><span class="p">,</span> <span class="s1">&#39;xhide&#39;</span><span class="p">,</span> <span class="s1">&#39;yhide&#39;</span><span class="p">,</span> <span class="s1">&#39;xdate&#39;</span><span class="p">,</span> <span class="s1">&#39;ydate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_locator_from_units&#39;</span><span class="p">,</span> <span class="s1">&#39;set_major_locator&#39;</span><span class="p">,</span> <span class="s1">&#39;get_major_locator&#39;</span><span class="p">,</span>
    <span class="s1">&#39;set_minor_locator&#39;</span><span class="p">,</span> <span class="s1">&#39;get_minor_locator&#39;</span><span class="p">,</span> <span class="s1">&#39;add_logo&#39;</span><span class="p">,</span> <span class="s1">&#39;wedge&#39;</span><span class="p">,</span>
    <span class="s1">&#39;add_time_mark&#39;</span><span class="p">,</span> <span class="s1">&#39;xi2a&#39;</span><span class="p">,</span> <span class="s1">&#39;yi2a&#39;</span><span class="p">,</span> <span class="s1">&#39;yi2f&#39;</span><span class="p">,</span> <span class="s1">&#39;xi2f&#39;</span><span class="p">,</span> <span class="s1">&#39;gobjs&#39;</span><span class="p">,</span> <span class="s1">&#39;add_key&#39;</span><span class="p">,</span>
    <span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="s1">&#39;hldays&#39;</span><span class="p">,</span>  <span class="s1">&#39;xscale&#39;</span><span class="p">,</span> <span class="s1">&#39;yscale&#39;</span><span class="p">,</span> <span class="s1">&#39;xrotate&#39;</span><span class="p">,</span> <span class="s1">&#39;yrotate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;add_grid&#39;</span><span class="p">,</span> <span class="s1">&#39;savefigs&#39;</span><span class="p">,</span> <span class="s1">&#39;decorate_axis&#39;</span><span class="p">,</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;make_movie&#39;</span><span class="p">,</span> <span class="s1">&#39;taylor&#39;</span><span class="p">,</span> <span class="s1">&#39;vtaylor&#39;</span><span class="p">,</span> <span class="s1">&#39;get_cls&#39;</span><span class="p">,</span> <span class="s1">&#39;dtaylor&#39;</span><span class="p">,</span> <span class="s1">&#39;rankhist&#39;</span><span class="p">,</span>
    <span class="s1">&#39;curve2&#39;</span><span class="p">,</span> <span class="s1">&#39;bar2&#39;</span><span class="p">,</span> <span class="s1">&#39;stick2&#39;</span><span class="p">,</span> <span class="s1">&#39;hov2&#39;</span> <span class="p">,</span> <span class="s1">&#39;map2&#39;</span><span class="p">,</span> <span class="s1">&#39;section2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;minimap&#39;</span><span class="p">,</span> <span class="s1">&#39;add_map_point&#39;</span><span class="p">,</span> <span class="s1">&#39;add_map_line&#39;</span><span class="p">,</span> <span class="s1">&#39;add_map_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;add_map_box&#39;</span><span class="p">,</span>  <span class="s1">&#39;rshpere_wgs84&#39;</span><span class="p">,</span>
    <span class="s1">&#39;add_glow&#39;</span><span class="p">,</span> <span class="s1">&#39;add_shadow&#39;</span><span class="p">,</span> <span class="s1">&#39;add_agg_filter&#39;</span><span class="p">,</span> <span class="s1">&#39;plot2d&#39;</span><span class="p">,</span> <span class="s1">&#39;hlitvs&#39;</span><span class="p">,</span>
    <span class="s1">&#39;add_compass&#39;</span><span class="p">,</span> <span class="s1">&#39;add_param_label&#39;</span><span class="p">,</span> <span class="s1">&#39;dtarget&#39;</span><span class="p">,</span> <span class="s1">&#39;add_map_places&#39;</span><span class="p">,</span>
    <span class="s1">&#39;add_right_label&#39;</span><span class="p">,</span> <span class="s1">&#39;add_left_label&#39;</span><span class="p">,</span> <span class="s1">&#39;add_top_label&#39;</span><span class="p">,</span> <span class="s1">&#39;add_bottom_label&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_quiverkey_value&#39;</span><span class="p">,</span> <span class="s1">&#39;add_lightshading&#39;</span><span class="p">]</span>
<span class="n">__all__</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>


<span class="n">MA</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span>
<span class="n">MV</span> <span class="o">=</span> <span class="n">MV2</span>
<span class="n">cdms</span> <span class="o">=</span> <span class="n">cdms2</span>

<span class="c1">#try:</span>
<span class="c1">#   from matplotlib.toolkits.basemap import Basemap</span>
<span class="c1">#except:</span>



<span class="c1">#: WGS radius of earth</span>
<span class="n">rshpere_wgs84</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6378137.0</span><span class="p">,</span><span class="mf">6356752.3141</span><span class="p">)</span>

<span class="c1">#: Useful markers list</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="c1">#  : circl</span>
<span class="c1">#   &#39;.&#39;, #  : point</span>
<span class="c1">#   &#39;,&#39;, #  : pixel</span>
    <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="c1">#  : triangle_down</span>
    <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="c1">#  : triangle_up</span>
    <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="c1">#  : triangle_left</span>
    <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="c1">#  : triangle_right</span>
<span class="c1">#   &#39;1&#39;, #  : tri_down</span>
<span class="c1">#   &#39;2&#39;, #  : tri_up</span>
<span class="c1">#   &#39;3&#39;, #  : tri_left</span>
<span class="c1">#   &#39;4&#39;, #  : tri_right</span>
    <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="c1">#  : &#39;octogon</span>
    <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="c1">#  : square</span>
    <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="c1">#  : pentagon</span>
    <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="c1">#  : hexagon1</span>
<span class="c1">#   &#39;H&#39;, #  : hexagon2</span>
    <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="c1">#  : plus</span>
    <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="c1">#  : x</span>
<span class="c1">#   &#39;D&#39;, #  : diamond</span>
    <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="c1">#  : thin_diamond</span>
<span class="c1">#   &#39;|&#39;, #  : vline</span>
<span class="c1">#   &#39;_&#39;, #  : hline</span>
<span class="p">]</span>

<span class="c1">#: Useful linestyles list</span>
<span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;-&#39;</span> <span class="p">,</span> <span class="c1">#         : solid&#39;,</span>
    <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="c1">#         : dashed&#39;,</span>
    <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="c1">#         : dash_dot&#39;,</span>
    <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="c1">#          : dotted&#39;,</span>
<span class="p">]</span>



<div class="viewcode-block" id="traj"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.traj">[docs]</a><span class="k">def</span> <span class="nf">traj</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">zoom</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="c1"># Start the plot</span>
    <span class="n">_start_plot_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Time series</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">_check_var_</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">_check_var_</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Map</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lon_min</span><span class="p">,</span><span class="n">lon_max</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
        <span class="n">lat_min</span><span class="p">,</span><span class="n">lat_max</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>
        <span class="n">lon_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_min</span><span class="o">+</span><span class="n">lon_max</span><span class="p">)</span><span class="o">*.</span><span class="mi">5</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">lon_max</span><span class="o">-</span><span class="n">lon_min</span><span class="p">)</span><span class="o">/</span><span class="n">zoom</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lat_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat_min</span><span class="o">+</span><span class="n">lat_max</span><span class="p">)</span><span class="o">*.</span><span class="mi">5</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">lat_max</span><span class="o">-</span><span class="n">lat_min</span><span class="p">)</span><span class="o">/</span><span class="n">zoom</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">kwmap</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;map&#39;</span><span class="p">,</span><span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">lon_range</span><span class="p">,</span><span class="n">lat</span><span class="o">=</span><span class="n">lat_range</span><span class="p">))</span>
        <span class="n">kwmap</span><span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">kwmap</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span><span class="n">res</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="o">**</span><span class="n">kwmap</span><span class="p">)</span>

    <span class="c1"># Real coordinates</span>
    <span class="n">xx</span><span class="p">,</span><span class="n">yy</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>

    <span class="c1">#TODO:finish traj</span>
    <span class="c1"># Plot</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">is_color_like</span><span class="p">(</span><span class="n">color</span><span class="p">):</span> <span class="c1"># Classic one color</span>
        <span class="n">kwdots</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;dots&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwdots</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dots</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwdots</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># Color varying</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">):</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">istime</span><span class="p">(</span><span class="n">tt</span><span class="p">):</span> <span class="n">tt</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span><span class="c1">#,norm=no_norm())</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tt</span><span class="p">))</span>
        <span class="n">ttmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
        <span class="n">dtt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span><span class="o">-</span><span class="n">ttmin</span>
        <span class="n">color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rgba</span><span class="p">)</span> <span class="k">for</span> <span class="n">rgba</span> <span class="ow">in</span> <span class="n">mp</span><span class="o">.</span><span class="n">cmap</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">tt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">-</span><span class="n">ttmin</span><span class="p">)</span><span class="o">/</span><span class="n">dtt</span><span class="p">)])</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">[</span><span class="n">ip</span><span class="p">:</span><span class="n">ip</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span><span class="n">yy</span><span class="p">[</span><span class="n">ip</span><span class="p">:</span><span class="n">ip</span><span class="o">+</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">_get_lines</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)):</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span>
            <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dots</span><span class="p">:</span>
            <span class="n">kwdots</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;dots&#39;</span><span class="p">,</span><span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="s1">&#39;5&#39;</span><span class="p">))</span>
            <span class="n">kwdots</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">_get_lines</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwdots</span><span class="p">):</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span>
                <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;colorbar_horizontal&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">##          kwargs.setdefault(&#39;colorbar_aspect&#39;,20)</span>
            <span class="n">colorbar</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">tt</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># End plot</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;Trajectory&#39;</span><span class="p">)</span>
    <span class="n">_end_plot_</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">lons</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lines</span></div>


<div class="viewcode-block" id="vtaylor"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.vtaylor">[docs]</a><span class="k">def</span> <span class="nf">vtaylor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xoffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">yoffset</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stdmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a Taylor diagram using :mod:`vcs` module from CDAT</span>

<span class="sd">    - **data**: A single or several points where a point is a pair of (std, corr).</span>
<span class="sd">    - *ref*: Reference value (standard deviation of observations).</span>
<span class="sd">    - *color*: Color of the points. It can be a list to set a different color for each pair.</span>
<span class="sd">    - *label*: Label of the points. Obviously, if there are several points, there must have several labels.</span>
<span class="sd">    - *x|yoffset*: Offset in font size unit of label position.</span>
<span class="sd">    - *title*: A string or ``False``.</span>
<span class="sd">    - *savefig*: Save figure to ``savefig``.</span>
<span class="sd">    - *savefig_&lt;keyword&gt;*: ``keyword`` is used for saving figure.</span>
<span class="sd">    - Other keywords are passed to :meth:`plot`.</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; taylor([21.,.83], ref=30., title=&#39;Single point&#39;)</span>
<span class="sd">    &gt;&gt;&gt; taylor(([[[21.,.83], [33., .7]], ref=28., color=[&#39;blue&#39;, 242], label=[&#39;Point 1&#39;, &#39;Point2&#39;])</span>


<span class="sd">    .. warning::</span>

<span class="sd">        This function uses the :mod:`vcs` module for plotting.</span>
<span class="sd">        Therefore, yan can&#39;t alter the plot with :mod:`matplotlib` functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Data</span>
    <span class="k">if</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">)</span> <span class="ow">and</span> \
        <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">long_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">long_name</span>
    <span class="n">data</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
    <span class="n">np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Init canva and diagram</span>
    <span class="kn">import</span> <span class="nn">vcs</span>
    <span class="n">x</span><span class="o">=</span><span class="n">vcs</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">td</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">createtaylordiagram</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">std</span><span class="p">):</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">td</span><span class="o">.</span><span class="n">referencevalue</span> <span class="o">=</span> <span class="n">ref</span>
    <span class="n">td</span><span class="o">.</span><span class="n">preserveaspectratio</span><span class="o">=</span><span class="s1">&#39;n&#39;</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="nb">list</span><span class="p">([</span><span class="n">color</span><span class="p">]),</span> <span class="n">np</span><span class="p">)</span>
        <span class="n">td</span><span class="o">.</span><span class="n">Marker</span><span class="o">.</span><span class="n">id_color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">td</span><span class="o">.</span><span class="n">Marker</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">label</span>
<span class="c1">#   td.Marker.symbol=[&#39;dot&#39;,&#39;cross&#39;,&#39;circle&#39;, &#39;dot&#39;]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xoffset</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">xoffset</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="nb">list</span><span class="p">([</span><span class="n">xoffset</span><span class="p">]),</span> <span class="n">np</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yoffset</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">yoffset</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="nb">list</span><span class="p">([</span><span class="n">yoffset</span><span class="p">]),</span> <span class="n">np</span><span class="p">)</span>
    <span class="n">td</span><span class="o">.</span><span class="n">Marker</span><span class="o">.</span><span class="n">xoffset</span><span class="o">=</span><span class="n">xoffset</span>
    <span class="n">td</span><span class="o">.</span><span class="n">Marker</span><span class="o">.</span><span class="n">yoffset</span><span class="o">=</span><span class="n">yoffset</span>

    <span class="c1"># Create the template</span>
    <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">createtemplate</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&quot;deftaylor&quot;</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x1</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x2</span><span class="o">=.</span><span class="mi">9</span>
    <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y1</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y2</span><span class="o">=.</span><span class="mi">9</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xtic1</span><span class="o">.</span><span class="n">y1</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xtic1</span><span class="o">.</span><span class="n">y2</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">xtic1</span><span class="o">.</span><span class="n">y1</span><span class="o">+.</span><span class="mi">01</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xmintic1</span><span class="o">.</span><span class="n">y1</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xmintic1</span><span class="o">.</span><span class="n">y2</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">xmintic1</span><span class="o">.</span><span class="n">y1</span><span class="o">+.</span><span class="mi">005</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xlabel1</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y1</span><span class="o">-.</span><span class="mi">01</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xname</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">xtic1</span><span class="o">.</span><span class="n">y1</span> <span class="o">-</span> <span class="o">.</span><span class="mi">05</span>

    <span class="c1"># Sets the correlation major line</span>
    <span class="n">l</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">createline</span><span class="p">()</span>
    <span class="n">l</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span>
    <span class="n">l</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">ytic2</span><span class="o">.</span><span class="n">x1</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">ytic2</span><span class="o">.</span><span class="n">x2</span><span class="o">=.</span><span class="mi">9</span>
    <span class="n">t</span><span class="o">.</span><span class="n">ytic2</span><span class="o">.</span><span class="n">line</span><span class="o">=</span><span class="n">l</span>
    <span class="n">majorcor</span><span class="o">=</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">([</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span><span class="o">.</span><span class="mi">99</span><span class="p">])</span>
    <span class="n">td</span><span class="o">.</span><span class="n">cticlabels1</span><span class="o">=</span><span class="n">majorcor</span>

    <span class="c1"># Sets the correlation minor line</span>
    <span class="n">l</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">createline</span><span class="p">()</span>
    <span class="n">l</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="s1">&#39;dot&#39;</span>
    <span class="n">l</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">l</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">252</span><span class="p">]</span> <span class="c1"># grey</span>
    <span class="n">t</span><span class="o">.</span><span class="n">ymintic2</span><span class="o">.</span><span class="n">x1</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">ymintic2</span><span class="o">.</span><span class="n">x2</span><span class="o">=.</span><span class="mi">9</span>
    <span class="n">t</span><span class="o">.</span><span class="n">ymintic2</span><span class="o">.</span><span class="n">line</span><span class="o">=</span><span class="n">l</span>
    <span class="n">minorcor</span><span class="o">=</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">([</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="o">.</span><span class="mi">4</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span><span class="o">.</span><span class="mi">91</span><span class="p">,</span><span class="o">.</span><span class="mi">92</span><span class="p">,</span><span class="o">.</span><span class="mi">93</span><span class="p">,</span><span class="o">.</span><span class="mi">94</span><span class="p">,</span><span class="o">.</span><span class="mi">96</span><span class="p">,</span><span class="o">.</span><span class="mi">97</span><span class="p">,</span><span class="o">.</span><span class="mi">98</span><span class="p">,</span><span class="o">.</span><span class="mi">998</span><span class="p">])</span>
    <span class="n">td</span><span class="o">.</span><span class="n">cmtics1</span><span class="o">=</span><span class="n">minorcor</span>

    <span class="c1"># Sets standard dev major tics</span>
    <span class="n">l</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">createline</span><span class="p">()</span>
    <span class="n">l</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span>
    <span class="n">l</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xtic2</span><span class="o">.</span><span class="n">y1</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xtic2</span><span class="o">.</span><span class="n">y2</span><span class="o">=.</span><span class="mi">9</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xtic2</span><span class="o">.</span><span class="n">line</span><span class="o">=</span><span class="n">l</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xtic2</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">stdticks</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">mjrstd1</span><span class="o">=</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">stdticks</span><span class="p">)</span>
    <span class="n">td</span><span class="o">.</span><span class="n">xticlabels1</span><span class="o">=</span><span class="n">mjrstd1</span>
    <span class="n">mjrstd2</span><span class="o">=</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">(</span><span class="n">stdticks</span><span class="p">)</span>
    <span class="n">td</span><span class="o">.</span><span class="n">yticlabels1</span><span class="o">=</span><span class="n">mjrstd2</span>

    <span class="c1"># Sets the std minor line</span>
    <span class="n">l</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">createline</span><span class="p">()</span>
    <span class="n">l</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="s1">&#39;dot&#39;</span>
    <span class="n">l</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">l</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">252</span><span class="p">]</span> <span class="c1"># grey</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xmintic2</span><span class="o">.</span><span class="n">y1</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xmintic2</span><span class="o">.</span><span class="n">y2</span><span class="o">=.</span><span class="mi">9</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xmintic2</span><span class="o">.</span><span class="n">line</span><span class="o">=</span><span class="n">l</span>
    <span class="n">t</span><span class="o">.</span><span class="n">xmintic2</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">mnrstd</span><span class="o">=</span><span class="n">vcs</span><span class="o">.</span><span class="n">mklabels</span><span class="p">((</span><span class="n">stdticks</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">stdticks</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">td</span><span class="o">.</span><span class="n">xmtics1</span><span class="o">=</span><span class="n">mnrstd</span>
    <span class="n">td</span><span class="o">.</span><span class="n">ymtics1</span><span class="o">=</span><span class="n">mjrstd1</span>

    <span class="c1"># Sets the reference</span>
    <span class="n">l</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">createline</span><span class="p">()</span>
    <span class="n">l</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span>
    <span class="n">l</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span>
<span class="c1">#   l.color=[ref_color]</span>
    <span class="n">l</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">242</span><span class="p">]</span>
    <span class="n">t</span><span class="o">.</span><span class="n">line2</span><span class="o">.</span><span class="n">line</span><span class="o">=</span><span class="n">l</span>

    <span class="c1"># Sets the maximum for arc value</span>
    <span class="k">if</span> <span class="n">stdmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">stdmax</span> <span class="o">=</span> <span class="n">stdticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">td</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">stdmax</span>

    <span class="c1"># Main plot</span>
    <span class="n">kwsf</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;savefig&#39;</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">td</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">show</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Save</span>
    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">suf</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="s1">&#39;postscript&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;gif&#39;</span><span class="p">,</span> <span class="s1">&#39;gif&#39;</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">savefig</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">suf</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">func</span><span class="p">)(</span><span class="n">savefig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwsf</span><span class="p">)</span>
                <span class="k">break</span></div>

<div class="viewcode-block" id="dtaylor"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.dtaylor">[docs]</a><span class="k">def</span> <span class="nf">dtaylor</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">stdref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Directly plot a Taylor diagram</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **stats**: Statistics is the form ``[std, corr]`` or ``[[std1,corr1],[std2,corr2],...]``</span>
<span class="sd">        - **stdref**: Standard deviation of reference</span>
<span class="sd">        - **labels**,optional: Label of the points. Obviously, if there are several points, there must have several labels.</span>
<span class="sd">          If ``None``, it tries to get it from the `long_name` attribute. If ``False``, it doesn&#39;t display it.</span>
<span class="sd">        - **reflabel**,optional: Name of the reference label. It defaults to ``&quot;Reference&quot;``.</span>
<span class="sd">        $_taylor_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stats</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span><span class="o">+</span><span class="n">stats</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">elif</span> <span class="n">stats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">_taylor_</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">stdref</span><span class="o">=</span><span class="n">stdref</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="taylor"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.taylor">[docs]</a><span class="k">def</span> <span class="nf">taylor</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a Taylor diagram after computing statistics</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **datasets**: One or several arrays that must be evaluated against the reference.</span>
<span class="sd">          Best is to provide :mod:`cdms2` variables with an appropriate `long_name` attribute</span>
<span class="sd">          to set labels automatically.</span>
<span class="sd">        - **ref**: Reference array of the same shape as all ``datasets`` arrays.</span>
<span class="sd">        - **labels**,optional: Label of the points.</span>
<span class="sd">          Obviously, if there are several points, there must have several labels.</span>
<span class="sd">          If ``None``, it tries to get it from the `long_name` attribute.</span>
<span class="sd">          If ``False``, it doesn&#39;t display it.</span>
<span class="sd">        - **reflabel**,optional: Name of the reference label.</span>
<span class="sd">          It defaults to the `long_name` attribute or to ``&quot;Reference&quot;``.</span>
<span class="sd">        - **normalize**,optional: Normalize standard deviation and RMSE</span>
<span class="sd">        $_taylor_</span>

<span class="sd">    :Example:</span>

<span class="sd">        Basic usage:</span>

<span class="sd">        &gt;&gt;&gt; taylor(var_model, var_obs, title=&#39;Single point&#39;, reflabel=&#39;Observations&#39;)</span>

<span class="sd">        Two variables with the same reference:</span>

<span class="sd">        &gt;&gt;&gt; taylor([var_model1,var_model2], var_ref)</span>

<span class="sd">        Two variables without the same reference (like temprature and salinity):</span>

<span class="sd">        &gt;&gt;&gt; taylor([sst,sss], [sstref,sssref], labels=True)</span>

<span class="sd">        A huge model ensemble of SST with colors varying with averaged SSS:</span>

<span class="sd">        &gt;&gt;&gt; taylor([sstm for sstm in sstens], sstsat, colors=cdutil.averager(sss, &#39;xy&#39;))</span>

<span class="sd">    :Tutorial: &quot;:ref:`user.tut.misc.plot.basic.taylor`&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check datasets, units and labels</span>
    <span class="c1"># - datasets</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">datasets</span><span class="p">]</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">asma</span><span class="p">()</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">datasets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
    <span class="c1"># - references</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref</span><span class="p">]</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ref</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">asma</span><span class="p">()</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># Statistics</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stdref</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">d</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">ref</span><span class="p">)):</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">d</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">statistics</span><span class="o">.</span><span class="n">__correlation</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">r</span><span class="p">)])</span>
        <span class="n">stdref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

    <span class="c1"># Diagram</span>
    <span class="k">return</span> <span class="n">_taylor_</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">stdref</span><span class="o">=</span><span class="n">stdref</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_taylor_</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stdref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refcolor</span><span class="o">=</span><span class="s1">&#39;.5&#39;</span><span class="p">,</span>
    <span class="n">reflabel</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">addref</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minimal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stdmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">autoresize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;- **stdref**, optional: Standard deviation of the reference used either when</span>
<span class="sd">          normalizing statistics or to plot the reference arc and point.</span>
<span class="sd">          All statistics can have a different reference standard deviation;</span>
<span class="sd">          in this case, statistics are normalized (``normalize`` is set to True).</span>
<span class="sd">        - **addref**,optional: Add the reference arc and point to the plot.</span>
<span class="sd">        - **normalize**, optional: Force the normalization of statistics (standard</span>
<span class="sd">          deviations).</span>
<span class="sd">        - **negative**,optional: Force plot of negative correlations.</span>
<span class="sd">        - **legend**, optional: Add the legend.</span>
<span class="sd">        - **size**,optional: Size(s) of the markers in points.</span>
<span class="sd">        - **colors**,optional: Color of the points. It can be a list to set</span>
<span class="sd">          a different color for each pair.</span>
<span class="sd">        - **cmap**, optional: Colormap use when ``colors`` is a numeric array.</span>
<span class="sd">        - **label_colors**,optional: Color of the labels.</span>
<span class="sd">          If ``&quot;same&quot;``, color is taken from ``colors``.</span>
<span class="sd">        - **label_&lt;keyword&gt;**,optional: ``&lt;keyword&gt;`` is passed</span>
<span class="sd">          to :func:`~matplotlib.pyplot.text` for plotting the labels.</span>
<span class="sd">        - **symbols**,optional: Symbols for the points (default to ``&quot;o&quot;``).</span>
<span class="sd">        - **point_&lt;keyword&gt;**,optional: ``&lt;keyword&gt;`` is passed to</span>
<span class="sd">          :func:`~matplotlib.pyplot.plot` (:func:`~matplotlib.pyplot.scatter` if</span>
<span class="sd">          ``scatter`` is True) or for plotting the points.</span>
<span class="sd">        - **reflabel**,optional: Label of the reference.</span>
<span class="sd">        - **refcolor**,optional: Color of the reference.</span>
<span class="sd">        - **title**,optional: A string for the general title.</span>
<span class="sd">        - **scatter**, optional: Use :func:`matplotlib.pyplot.scatter` to improve</span>
<span class="sd">          plot efficiency when the number of points is huge. Labels are not plotted in</span>
<span class="sd">          this mode.</span>
<span class="sd">        - **savefig**,optional: Save figure to ``savefig``.</span>
<span class="sd">        - **savefig_&lt;keyword&gt;**,optional: ``&lt;keyword&gt;`` is used for saving figure.</span>
<span class="sd">        - **savefigs**,optional: Save figure to ``savefig`` using :func:`~vacumm.misc.plot.savefigs`.</span>
<span class="sd">        - **savefigs_&lt;keyword&gt;**,optional: ``&lt;keyword&gt;`` is used for saving figure using :func:`~vacumm.misc.plot.savefigs`.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="k">import</span> <span class="n">offset_copy</span>

    <span class="c1"># Normalization</span>
    <span class="n">np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;singleref&#39;</span><span class="p">,</span> <span class="n">scatter</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stdref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">stdref</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">])</span>
    <span class="n">stdref</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stdref</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stdref</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">stdref</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="k">if</span> <span class="n">stdref</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">stdref</span><span class="p">,</span> <span class="n">stdref</span><span class="o">.</span><span class="n">mean</span><span class="p">()):</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">stats</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">stdref</span>
        <span class="n">stdref</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Arrays</span>
    <span class="k">if</span> <span class="n">stdmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stdmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">stats</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">stdref</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">corrmin</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">negative</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">negative</span> <span class="o">=</span> <span class="n">corrmin</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="n">sticks</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">stdmax</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">stdmax</span> <span class="o">=</span> <span class="n">sticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">stdmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">stdmax</span> <span class="k">if</span> <span class="n">negative</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">sticksref</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stdmax</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">),</span> <span class="n">sticks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">sticks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rticks</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="p">[</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="o">.</span><span class="mi">99</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
        <span class="n">rticks</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rticks</span><span class="p">[:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="n">rticks</span>

    <span class="c1"># Check options</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span>  <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">np</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]):</span> <span class="c1"># list of scalars</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="p">,))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scatter</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">Scalar2RGB</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)(</span><span class="n">colors</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">broadcast</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">np</span><span class="p">))</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="p">)</span>
    <span class="n">label_size</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label_size&#39;</span><span class="p">,</span> <span class="n">P</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="p">)</span>
    <span class="n">label_colors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label_colors&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label_colors</span><span class="o">==</span><span class="s1">&#39;same&#39;</span><span class="p">:</span>
        <span class="n">label_colors</span> <span class="o">=</span> <span class="n">colors</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label_colors</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;symbols&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">),</span> <span class="n">np</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">negative</span> <span class="ow">and</span> <span class="n">autoresize</span><span class="p">:</span>
        <span class="n">x0</span><span class="p">,</span><span class="n">y0</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span><span class="o">*</span><span class="mf">2.</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span>
        <span class="k">if</span> <span class="n">autoresize</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">x1</span> <span class="o">/=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">y1</span> <span class="o">/=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">),</span><span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Conversion function</span>
    <span class="k">def</span> <span class="nf">xy</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">corr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">std</span><span class="o">*</span><span class="n">corr</span><span class="p">,</span> <span class="n">std</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">corr</span><span class="p">))</span>

    <span class="c1"># Start the plot</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">minimal</span><span class="p">:</span> <span class="n">_start_plot_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c1"># Points</span>
    <span class="n">kwpt</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">)</span>
    <span class="n">kwlab</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scatter</span><span class="p">:</span>

        <span class="c1"># All points</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">(</span><span class="n">stats</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">stats</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ppts</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">sizes</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwpt</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">ppts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>

            <span class="c1"># Single point</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span>
            <span class="n">ppts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">markersize</span><span class="o">=</span><span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">**</span><span class="n">kwpt</span><span class="p">))</span>

            <span class="c1"># Labels</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">transoffset</span> <span class="o">=</span> <span class="n">offset_copy</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mf">1.2</span><span class="o">*</span><span class="n">sizes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;points&#39;</span><span class="p">)</span>
                <span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transoffset</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">kwlab</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">labels</span>

    <span class="c1"># Decorations for normal plots</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">minimal</span><span class="p">:</span>


        <span class="c1"># Boundary standard deviation arc</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">stdmax</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">arc</span><span class="p">)</span>

        <span class="c1"># Intermediates standard deviation arcs</span>
        <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">sticks</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">pstd</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;grid.linewidth&#39;</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">pstd</span><span class="p">)</span>

        <span class="c1"># RMS (red) for first ref only</span>
        <span class="n">rmax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">stdmax</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">stdref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sticksref</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">prms</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="n">stdref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">r</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;grid.linewidth&#39;</span><span class="p">],</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">prms</span><span class="p">)</span>
            <span class="n">prms</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">prms</span><span class="o">.</span><span class="n">set_clip_path</span><span class="p">(</span><span class="n">arc</span><span class="p">)</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="n">stdref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="n">rmax</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">stdmax</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="n">rmax</span>
            <span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">stdref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Reference</span>
    <span class="n">addref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="n">addref</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addref</span><span class="p">:</span>

        <span class="c1"># First Arc</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Arc</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">stdref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">stdref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">refcolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># All points unless normalized</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">rslice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">imax</span><span class="p">)</span>
        <span class="n">pref</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stdref</span><span class="p">[</span><span class="n">rslice</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">stdref</span><span class="p">[</span><span class="n">rslice</span><span class="p">]),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">refcolor</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">minimal</span><span class="p">:</span>

        <span class="c1"># Ticks for correlation</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rticks</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">xy</span><span class="p">(</span><span class="n">stdmax</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">xy</span><span class="p">(</span><span class="n">stdmax</span><span class="o">*.</span><span class="mi">98</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
            <span class="n">dxt</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="n">x1</span><span class="o">/</span><span class="n">stdmax</span>
            <span class="n">dyt</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="n">y1</span><span class="o">/</span><span class="n">stdmax</span>
            <span class="n">P</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">pcor</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;grid.linewidth&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">transoffset</span> <span class="o">=</span> <span class="n">offset_copy</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">dxt</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dyt</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;points&#39;</span><span class="p">)</span>
            <span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">transoffset</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="p">)</span>
        <span class="n">xt</span> <span class="o">=</span> <span class="n">yt</span> <span class="o">=</span> <span class="n">stdmax</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">dxt</span> <span class="o">=</span> <span class="mi">29</span><span class="o">*</span><span class="n">xt</span><span class="o">/</span><span class="n">stdmax</span>
        <span class="n">dyt</span> <span class="o">=</span> <span class="mi">29</span><span class="o">*</span><span class="n">yt</span><span class="o">/</span><span class="n">stdmax</span>
        <span class="n">transoffset</span> <span class="o">=</span> <span class="n">offset_copy</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">dxt</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dyt</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;points&#39;</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="s1">&#39;Correlation&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">],</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">transoffset</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mf">45.</span><span class="p">)</span>

        <span class="c1"># Legend</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">legstd</span> <span class="o">=</span> <span class="s1">&#39;Standard dev.&#39;</span>
            <span class="n">legrms</span> <span class="o">=</span> <span class="s1">&#39;RMS error&#39;</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">legstd</span> <span class="o">=</span> <span class="s1">&#39;Rel. &#39;</span><span class="o">+</span><span class="n">legstd</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">legrms</span> <span class="o">=</span> <span class="s1">&#39;Rel. &#39;</span><span class="o">+</span><span class="n">legrms</span>
            <span class="n">hdls</span> <span class="o">=</span> <span class="p">(</span><span class="n">pcor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pstd</span><span class="p">,</span> <span class="n">prms</span><span class="p">)</span>
            <span class="n">labs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Correlation&#39;</span><span class="p">,</span> <span class="n">legstd</span><span class="p">,</span> <span class="n">legrms</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">addref</span><span class="p">:</span>
                <span class="n">hdls</span> <span class="o">+=</span> <span class="n">pref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">labs</span> <span class="o">+=</span> <span class="n">reflabel</span><span class="p">,</span>
            <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">hdls</span><span class="p">,</span> <span class="n">labs</span><span class="p">,</span>
                <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">negative</span> <span class="k">else</span> <span class="s1">&#39;upper left&#39;</span><span class="p">,</span>
                <span class="c1">#markerscale=10,</span>
                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;legend_&#39;</span><span class="p">,</span>
                    <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span><span class="o">.</span><span class="n">legendPatch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Final setup</span>
        <span class="n">P</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">stdmin</span><span class="p">,</span> <span class="n">stdmax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stdmax</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="c1">#ax.set_frame_on(False)</span>
        <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="o">-</span><span class="n">sticks</span><span class="p">[:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sticks</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">sticks</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">sticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_bottom</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
        <span class="n">P</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">stdlabel</span> <span class="o">=</span> <span class="s1">&#39;Standard deviation&#39;</span>
        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span> <span class="n">stdlabel</span> <span class="o">=</span> <span class="s1">&#39;Relative &#39;</span><span class="o">+</span><span class="n">stdlabel</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">stdlabel</span> <span class="o">+=</span> <span class="s1">&#39; [</span><span class="si">%s</span><span class="s1">]&#39;</span><span class="o">%</span><span class="n">units</span>
        <span class="n">P</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">stdlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">negative</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">stdlabel</span><span class="p">)</span>

        <span class="c1"># End</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">autoresize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor diagram&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title_y&#39;</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;savefigs_pdf&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">_end_plot_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">P</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ppts</span>



<div class="viewcode-block" id="dtarget"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.dtarget">[docs]</a><span class="k">def</span> <span class="nf">dtarget</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="n">rmsc</span><span class="p">,</span> <span class="n">stdmod</span><span class="p">,</span> <span class="n">stdref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="n">sizes</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Target diagram&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a (direct) target diagram from already computed statistics</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **bias** : Bias.</span>
<span class="sd">        - **rmsc**: Centered RMS error.</span>
<span class="sd">        - **stdmod**: Standard deviation of the model.</span>
<span class="sd">        - **stdref**, optional: Standard deviation of the observations.</span>
<span class="sd">        - **colors**, optional: Single or list of colors, or</span>
<span class="sd">          array of values, used to color markers.</span>
<span class="sd">        - **sizes**, optional: Single or list of sizes of markers.</span>
<span class="sd">        - **title**, optional: Title of the plot.</span>
<span class="sd">        - **scatter_&lt;keyword&gt;**, optional: ``&lt;keyword&gt;`` is passed</span>
<span class="sd">          to :func:`matplotlib.pyplot.scatter`.</span>
<span class="sd">        - **circle_&lt;keyword&gt;**, optional: ``&lt;keyword&gt;`` is passed</span>
<span class="sd">          change the properties of circles.</span>

<span class="sd">    .. todo::</span>

<span class="sd">        Make two versions of :func:`target`, as for Taylor</span>
<span class="sd">        diagrams: one like with direct statistics, one with</span>
<span class="sd">        :mod:`MV2` variables as arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">kwscat</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;scatter_&#39;</span><span class="p">)</span>
    <span class="n">kwscat</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
    <span class="n">kwcb</span> <span class="o">=</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;colorbar_&#39;</span><span class="p">)</span>
    <span class="n">kwcir</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;circle_&#39;</span><span class="p">)</span>

    <span class="c1"># Convert to masked arrays</span>
    <span class="n">bias</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bias</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stdref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">stdref</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">stdref</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stdref</span><span class="p">),</span> <span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">stdmod</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stdmod</span><span class="p">)</span>
    <span class="n">rmsc</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rmsc</span><span class="p">)</span>
    <span class="n">np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bias</span><span class="p">)</span>

    <span class="c1"># Make plotted stats</span>
    <span class="n">nrmsc</span> <span class="o">=</span> <span class="n">rmsc</span> <span class="o">/</span> <span class="n">stdref</span>
    <span class="n">nrmsc</span> <span class="o">*=</span> <span class="n">N</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">stdmod</span><span class="o">-</span><span class="n">stdref</span><span class="p">)</span>
    <span class="n">nbias</span> <span class="o">=</span> <span class="n">bias</span> <span class="o">/</span> <span class="n">stdref</span>

    <span class="c1"># Broadcast plot params</span>
    <span class="k">if</span> <span class="n">colors</span><span class="o">==</span><span class="s1">&#39;rms&#39;</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rmsc</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">bias</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">broadcast</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sizes</span><span class="p">),</span> <span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># Start the plot</span>
    <span class="n">_start_plot_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">nrmsc</span><span class="p">,</span> <span class="n">nbias</span><span class="p">,</span> <span class="n">sizes</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwscat</span><span class="p">)</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="o">-</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="n">xmax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="o">-</span><span class="n">xmax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span>

    <span class="c1"># Arcs</span>
    <span class="n">dict_check_defaults</span><span class="p">(</span><span class="n">kwcir</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;grid.linewidth&#39;</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pstd</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="o">**</span><span class="n">kwcir</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">pstd</span><span class="p">)</span>
    <span class="n">kwcir</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Circle</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwcir</span><span class="p">))</span>

    <span class="c1"># Colorbar</span>
    <span class="k">if</span> <span class="n">colorbar</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;RMS&#39;</span>
        <span class="k">if</span> <span class="n">units</span><span class="p">:</span> <span class="n">label</span> <span class="o">+=</span> <span class="s1">&#39; [</span><span class="si">%s</span><span class="s1">]&#39;</span><span class="o">%</span><span class="n">units</span>
        <span class="n">kwcb</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">kwcb</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;pad&#39;</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
        <span class="n">kwcb</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;fraction&#39;</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">**</span><span class="n">kwcb</span><span class="p">)</span>

    <span class="c1"># Finish plot</span>
    <span class="n">P</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$RMSC/\sigma_</span><span class="si">{obs}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
    <span class="n">P</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$Bias/\sigma_</span><span class="si">{obs}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">autoresize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">_end_plot_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span></div>

<span class="n">target</span> <span class="o">=</span> <span class="n">dtarget</span>


<div class="viewcode-block" id="rankhist"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.rankhist">[docs]</a><span class="k">def</span> <span class="nf">rankhist</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">ens</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Rank histogram&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot rank histogram</span>

<span class="sd">    The rank is computed using :func:`~vacumm.misc.stats.ensrank`.</span>
<span class="sd">    It may vary from ``0`` to ``nens``.</span>

<span class="sd">    - **obs**, (...): Observations or rank</span>
<span class="sd">    - **ens**, (nens,...): Ensemble or nens</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">stats</span> <span class="k">import</span> <span class="n">ensrank</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ens</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">rank</span><span class="p">,</span> <span class="n">nens</span> <span class="o">=</span> <span class="n">obs</span><span class="p">,</span> <span class="n">ens</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ens</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ens</span><span class="p">)</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="n">ensrank</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">ens</span><span class="p">)</span>
        <span class="n">nens</span> <span class="o">=</span> <span class="n">ens</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">kwhist</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;hist_&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">rank</span><span class="p">):</span> <span class="n">rank</span> <span class="o">=</span> <span class="n">rank</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
    <span class="n">_start_plot_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="n">nens</span><span class="o">+</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">pdf</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
        <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwhist</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">nens</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">bins</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">P</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rank&#39;</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P(rank)&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;savefigs_pdf&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">_end_plot_</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">patches</span></div>


<div class="viewcode-block" id="ellipsis"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.ellipsis">[docs]</a><span class="k">def</span> <span class="nf">ellipsis</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">,</span><span class="n">eAXIS</span><span class="p">,</span><span class="n">eaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">gobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sign_usearrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sign_usecolor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sign_usewidth</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">key_align</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">key_orientation</span><span class="o">=</span><span class="s1">&#39;tangential&#39;</span><span class="p">,</span>
    <span class="n">glow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">key_position</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span><span class="n">key_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(value)g</span><span class="s1"> </span><span class="si">%(units)s</span><span class="s1">&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a dicretized ellipsis</span>

<span class="sd">    - **xpos**: X position of the ellipsis.</span>
<span class="sd">    - **ypos**: Y    //</span>
<span class="sd">    - **eAXIS**: Length of grand axis</span>
<span class="sd">    - *eaxis*: Length of little axis [default: eAXIS]</span>
<span class="sd">    - *rotation*: Rotation angle in degrees of grand axis from X axis [default: 0.]</span>
<span class="sd">    - *sign*: Indicate a direction of evolution along the ellipsis using a variable line width and/or color [default: 0]. If 0, nothing is done. If positive or negative, it defines the direction relative the trigonometric convention.</span>
<span class="sd">    - *sign_usearrow*: Use an arrow to indicate sign [default: True]</span>
<span class="sd">    - *sign_usewidth*: Use width variation to indicate sign [default: False]</span>
<span class="sd">    - *sign_usecolor*: Use color variation (from grey to default color) to indicate sign [default: False]</span>
<span class="sd">    - *scale*: Scale factor to apply to grand and little axes [default: 1.]</span>
<span class="sd">    - *np*: Number of discretized segments [default: 100]</span>
<span class="sd">    - *gobj*: Graphical object on which to plot the ellipsis (can be a Basemap object) [default: ~matplotlib.pyplot.gca()]. If map object, eAXIS and eaxis are supposed to be in kilometers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Angles for discretization</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">np</span><span class="p">)</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pp</span><span class="p">,</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span> <span class="c1"># Closed</span>
    <span class="n">np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>

    <span class="c1"># Axes</span>
    <span class="n">eAXIS</span> <span class="o">=</span> <span class="n">eA_orig</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">eAXIS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eaxis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">eaxis</span> <span class="o">=</span> <span class="n">eAXIS</span>
    <span class="n">eaxis</span> <span class="o">=</span> <span class="n">ea_orig</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">eaxis</span><span class="p">)</span>
    <span class="n">eaxis</span> <span class="o">*=</span> <span class="n">scale</span>
    <span class="n">eAXIS</span> <span class="o">*=</span> <span class="n">scale</span>

    <span class="c1"># Map</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span> <span class="n">gobj</span> <span class="o">=</span> <span class="n">m</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Map</span>
    <span class="k">if</span> <span class="n">gobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gobj</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span> <span class="n">Map</span><span class="p">):</span>
        <span class="n">gobj</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span>
    <span class="n">ismap</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gobj</span><span class="p">,</span><span class="n">Basemap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ismap</span><span class="p">:</span>
        <span class="n">iscyl</span> <span class="o">=</span> <span class="n">gobj</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span>
        <span class="n">eaxis</span> <span class="o">*=</span> <span class="mf">1.e3</span> <span class="c1"># km</span>
        <span class="n">eAXIS</span> <span class="o">*=</span> <span class="mf">1.e3</span> <span class="c1"># km</span>

    <span class="c1"># Discretization</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="n">rotation</span> <span class="o">*=</span>  <span class="n">N</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="k">for</span> <span class="n">ip</span><span class="p">,</span><span class="n">ap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pp</span><span class="p">):</span>
        <span class="c1"># Basic ellipsis</span>
        <span class="n">xxx</span> <span class="o">=</span> <span class="n">eAXIS</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">yyy</span> <span class="o">=</span> <span class="n">eaxis</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="c1"># Rotation</span>
        <span class="n">xx</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxx</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span> <span class="o">-</span> <span class="n">yyy</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
        <span class="n">yy</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxx</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span> <span class="o">+</span> <span class="n">yyy</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
        <span class="c1"># Cylindrical map: meters to degrees</span>
        <span class="k">if</span> <span class="n">ismap</span> <span class="ow">and</span> <span class="n">iscyl</span><span class="p">:</span>
            <span class="n">xx</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2deg</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">ip</span><span class="p">],</span><span class="n">ypos</span><span class="p">)</span>
            <span class="n">yy</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2deg</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span>

    <span class="c1"># Add position</span>
    <span class="k">if</span> <span class="n">ismap</span><span class="p">:</span> <span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span> <span class="o">=</span> <span class="n">gobj</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">)</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="n">xpos</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">+</span> <span class="n">ypos</span>

    <span class="c1"># Add axes</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">kwaxes</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span>
            <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ea</span><span class="p">,</span><span class="n">ap</span> <span class="ow">in</span> <span class="p">(</span><span class="n">eAXIS</span><span class="p">,</span><span class="mf">0.</span><span class="p">),(</span><span class="n">eaxis</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">xaxis</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation</span><span class="o">+</span><span class="n">ap</span><span class="p">)</span> <span class="o">*</span> <span class="n">ea</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">yaxis</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation</span><span class="o">+</span><span class="n">ap</span><span class="p">)</span> <span class="o">*</span> <span class="n">ea</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">ismap</span> <span class="ow">and</span> <span class="n">iscyl</span><span class="p">:</span>
                <span class="n">xaxis</span> <span class="o">=</span> <span class="n">m2deg</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span><span class="n">ypos</span><span class="p">)</span>
                <span class="n">yaxis</span> <span class="o">=</span> <span class="n">m2deg</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
            <span class="n">gobj</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xaxis</span><span class="o">+</span><span class="n">xpos</span><span class="p">,</span><span class="n">yaxis</span><span class="o">+</span><span class="n">ypos</span><span class="p">,</span><span class="o">**</span><span class="n">kwaxes</span><span class="p">)</span>

    <span class="c1"># Plot command</span>
    <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
        <span class="n">pcmd</span> <span class="o">=</span> <span class="n">gobj</span><span class="o">.</span><span class="n">fill</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pcmd</span> <span class="o">=</span> <span class="n">gobj</span><span class="o">.</span><span class="n">plot</span>

    <span class="c1"># Plot with sign indicator</span>
    <span class="n">myplot</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">kwkey</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">:</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sign_usearrow</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fill</span><span class="p">:</span> <span class="c1"># FIXME: color and fill for ellipsis</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.linewidth&#39;</span><span class="p">])</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cl</span> <span class="o">=</span> <span class="n">ColorConverter</span><span class="p">()</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.color&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pps</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pps</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">sign</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span>
            <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sign_usewidth</span><span class="p">:</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span> <span class="o">/</span> <span class="n">factor</span> <span class="o">+</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">linewidth</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span><span class="o">/</span><span class="n">np</span>
                <span class="k">if</span> <span class="n">sign_usecolor</span><span class="p">:</span>
                    <span class="n">cl</span> <span class="o">=</span> <span class="p">(</span>  <span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ip</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">-</span><span class="n">ip</span><span class="p">)</span><span class="o">*.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ip</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">-</span><span class="n">ip</span><span class="p">)</span><span class="o">*.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">ip</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">-</span><span class="n">ip</span><span class="p">)</span><span class="o">*.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">myplot</span> <span class="o">=</span> <span class="n">pcmd</span><span class="p">([</span><span class="n">xx</span><span class="p">[</span><span class="n">ip</span><span class="p">],</span><span class="n">xx</span><span class="p">[</span><span class="n">ip</span><span class="o">+</span><span class="mi">1</span><span class="p">]],[</span><span class="n">yy</span><span class="p">[</span><span class="n">ip</span><span class="p">],</span><span class="n">yy</span><span class="p">[</span><span class="n">ip</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cl</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xshaft</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">;</span> <span class="n">yshaft</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">slen</span> <span class="o">=</span> <span class="n">sign</span><span class="o">*</span><span class="n">eAXIS</span><span class="o">/</span><span class="mf">4.</span>
            <span class="n">ap</span> <span class="o">=</span> <span class="n">pp</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">*</span><span class="mf">3.</span><span class="o">/</span><span class="mf">4.</span><span class="p">))]</span>
            <span class="n">xxx</span> <span class="o">=</span> <span class="n">eAXIS</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">yyy</span> <span class="o">=</span> <span class="n">eaxis</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">xshaft</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxx</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span> <span class="o">-</span> <span class="n">yyy</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
            <span class="n">yshaft</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xxx</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span> <span class="o">+</span> <span class="n">yyy</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ia</span><span class="p">,</span><span class="n">aa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">aa</span> <span class="o">*=</span> <span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">*.</span><span class="mi">85</span>
                <span class="n">xshaft</span><span class="p">[</span><span class="n">ia</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xshaft</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">slen</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">aa</span><span class="o">+</span><span class="n">rotation</span><span class="p">)</span>
                <span class="n">yshaft</span><span class="p">[</span><span class="n">ia</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">yshaft</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">slen</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">aa</span><span class="o">+</span><span class="n">rotation</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ismap</span> <span class="ow">and</span> <span class="n">iscyl</span><span class="p">:</span>
                <span class="n">xshaft</span> <span class="o">=</span> <span class="n">m2deg</span><span class="p">(</span><span class="n">xshaft</span><span class="p">,</span><span class="n">ypos</span><span class="p">)</span>
                <span class="n">yshaft</span> <span class="o">=</span> <span class="n">m2deg</span><span class="p">(</span><span class="n">yshaft</span><span class="p">)</span>
            <span class="n">kws</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">gobj</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xshaft</span><span class="o">+</span><span class="n">xpos</span><span class="p">,</span><span class="n">yshaft</span><span class="o">+</span><span class="n">ypos</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">myplot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">myplot</span> <span class="o">=</span> <span class="n">pcmd</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glow</span><span class="p">:</span>
            <span class="n">add_glow</span><span class="p">(</span><span class="n">myplot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span>
            <span class="n">add_shadow</span><span class="p">(</span><span class="n">myplot</span><span class="p">)</span>

    <span class="c1"># Plot key</span>
    <span class="k">if</span> <span class="n">key</span><span class="p">:</span>

        <span class="c1"># Position</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">%</span> <span class="n">N</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">key_x</span> <span class="o">=</span> <span class="n">key_position</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span> <span class="o">*</span> <span class="n">eAXIS</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">key_y</span> <span class="o">=</span> <span class="n">key_position</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span> <span class="o">*</span> <span class="n">eaxis</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span> <span class="p">;</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
        <span class="k">if</span> <span class="n">key_align</span> <span class="o">!=</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span>
            <span class="n">key_x</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">key_y</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">ismap</span> <span class="ow">and</span> <span class="n">iscyl</span><span class="p">:</span>
            <span class="n">key_x</span> <span class="o">=</span> <span class="n">m2deg</span><span class="p">(</span><span class="n">key_x</span><span class="p">,</span><span class="n">ypos</span><span class="p">)</span>
            <span class="n">key_y</span> <span class="o">=</span> <span class="n">m2deg</span><span class="p">(</span><span class="n">key_y</span><span class="p">)</span>
        <span class="n">key_x</span> <span class="o">+=</span> <span class="n">xpos</span>
        <span class="n">key_y</span> <span class="o">+=</span> <span class="n">ypos</span>
        <span class="n">key_rotation</span> <span class="o">=</span> <span class="n">rotation</span>
        <span class="k">if</span> <span class="n">key_orientation</span> <span class="o">==</span> <span class="s1">&#39;tangential&#39;</span><span class="p">:</span>
            <span class="n">key_rotation</span> <span class="o">-=</span> <span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Params</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">myplot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span><span class="n">alpha</span><span class="o">=</span><span class="n">myplot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_alpha</span><span class="p">(),</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">key_rotation</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">kwkey</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Content</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">eA_orig</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">key_text</span> <span class="o">=</span> <span class="n">key_format</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>

        <span class="c1"># Draw</span>
        <span class="n">kglow</span> <span class="o">=</span> <span class="n">kwkey</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;glow&#39;</span><span class="p">,</span> <span class="n">glow</span><span class="p">)</span>
        <span class="n">kwkglow</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwkey</span><span class="p">,</span> <span class="s1">&#39;glow&#39;</span><span class="p">)</span>
        <span class="n">kshadow</span> <span class="o">=</span> <span class="n">kwkey</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;shadow&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="p">)</span>
        <span class="n">kwkshadow</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwkey</span><span class="p">,</span> <span class="s1">&#39;shadow&#39;</span><span class="p">)</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">key_x</span><span class="p">,</span><span class="n">key_y</span><span class="p">,</span><span class="n">key_text</span><span class="p">,</span><span class="o">**</span><span class="n">kwkey</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kglow</span><span class="p">:</span>
            <span class="n">add_glow</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwkglow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kshadow</span><span class="p">:</span>
            <span class="n">add_shadow</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwkshadow</span><span class="p">)</span>



    <span class="c1"># Normal plot</span>
    <span class="k">return</span> <span class="n">myplot</span></div>


<div class="viewcode-block" id="add_colorbar"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_colorbar">[docs]</a><span class="k">def</span> <span class="nf">add_colorbar</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">horizontal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">drawedges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">barwidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">barmargin</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Standalone colorbar&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
                <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#axes = fig.gca()</span>
        <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">barwidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">barwidth</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">barmargin</span><span class="o">-</span><span class="n">barwidth</span><span class="p">,</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span><span class="n">barwidth</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">barwidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">barwidth</span> <span class="o">=</span> <span class="o">.</span><span class="mi">18</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="p">[</span><span class="n">barmargin</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="n">barwidth</span><span class="p">,</span><span class="o">.</span><span class="mi">92</span><span class="p">]</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">frameon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="n">frameon</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="n">frameon</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">levels</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">tmp</span> <span class="o">=</span> <span class="n">_levels_</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sm</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">levels</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">sm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="s1">&#39;Missing explicit arguments sm&#39;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="s1">&#39;show&#39;</span><span class="p">,</span><span class="s1">&#39;savefig&#39;</span><span class="p">,</span><span class="s1">&#39;units&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span><span class="nb">vars</span><span class="o">=</span><span class="n">var</span><span class="p">,</span><span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span><span class="n">colorbar_horizontal</span><span class="o">=</span><span class="n">horizontal</span><span class="p">,</span>
        <span class="n">colorbar_position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span><span class="n">standalone</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_end_plot_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cb</span></div>

<div class="viewcode-block" id="scolorbar"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.scolorbar">[docs]</a><span class="k">def</span> <span class="nf">scolorbar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shortcut to :func:`add_colorbar`&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">add_colorbar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_plot_grid_</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">samp</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="p">::</span><span class="n">samp</span><span class="p">],</span> <span class="n">yy</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="p">::</span><span class="n">samp</span><span class="p">]),</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">samp</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xx</span><span class="p">[::</span><span class="n">samp</span><span class="p">,</span> <span class="n">ix</span><span class="p">],</span> <span class="n">yy</span><span class="p">[::</span><span class="n">samp</span><span class="p">,</span> <span class="n">ix</span><span class="p">]),</span>
        <span class="n">oo</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">oo</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">oo</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">oo</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Axes3D</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">oo</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">oo</span><span class="p">)</span>


<div class="viewcode-block" id="add_grid"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_grid">[docs]</a><span class="k">def</span> <span class="nf">add_grid</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xcorners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycorners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markerlinewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">label_edges</span><span class="o">=</span><span class="s1">&#39;Cell edges&#39;</span><span class="p">,</span> <span class="n">label_centers</span><span class="o">=</span><span class="s1">&#39;Cell centers&#39;</span><span class="p">,</span> <span class="n">samp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a a 1D or 2D grid to a plot</span>

<span class="sd">    Params:</span>
<span class="sd">        - **gg**: A cdms grid OR a (lon,lat) tuple of axes OR a cdms variable with a grid</span>
<span class="sd">        - **x/ycorners**: Corners coordinates (ny+1,nx+1)</span>
<span class="sd">        - *borders*: Display cell borders</span>
<span class="sd">        - *centers*: Display cell centers. If == 2, connect centers.</span>
<span class="sd">        - *samp*: Undersampling rate</span>
<span class="sd">        - *m*: A basemap instance to plot on</span>
<span class="sd">        - *color*: Default color (or *c*)</span>
<span class="sd">        - *linecolor*: Color of the lines (or *lc*) [defaults to *color*]</span>
<span class="sd">        - *linestyle*: Line style (or *ls*)</span>
<span class="sd">        - *edgecolor*: Edge color of marker (or *ec*) [defaults to *color*]</span>
<span class="sd">        - *facecolor*: Face color of marker (or *fc*) [defaults to *color*]</span>
<span class="sd">        - *marker*: Type of marker</span>
<span class="sd">        - *markersize*: Size of markers (or *s*)</span>
<span class="sd">        - *alpha*: Alpha transparency (or *a*)</span>
<span class="sd">        - *zorder*: Order of the grid in the stack (100 should be above all objects)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Axes</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">get_xy</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Edges</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;borders&#39;</span><span class="p">,</span> <span class="n">edges</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">edges</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xcorners</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ycorners</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xx2d_</span><span class="p">,</span> <span class="n">yy2d_</span> <span class="o">=</span> <span class="n">meshbounds</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="n">xx2d</span> <span class="o">=</span> <span class="n">xcorners</span> <span class="k">if</span> <span class="n">xcorners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">xx2d_</span>
        <span class="n">yy2d</span> <span class="o">=</span> <span class="n">ycorners</span> <span class="k">if</span> <span class="n">ycorners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">yy2d_</span>
    <span class="k">if</span> <span class="n">centers</span><span class="p">:</span>
        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>

    <span class="c1"># Geographic map</span>
<span class="c1">#    if m is None and gobjs(&#39;m&#39;): m = gobjs(&#39;m&#39;)[-1]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">axes</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Basemap</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">centers</span><span class="p">:</span>
            <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">xx2d</span><span class="p">,</span> <span class="n">yy2d</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">xx2d</span><span class="p">,</span> <span class="n">yy2d</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c1"># Style</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">linecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">linecolor</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">edgecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">facecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="n">color</span>
    <span class="n">linestyle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="p">)</span>
    <span class="n">linecolor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lc&#39;</span><span class="p">,</span> <span class="n">linecolor</span><span class="p">)</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">markersize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="p">)</span>
    <span class="n">kwlines</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;colors&#39;</span><span class="p">:[</span><span class="n">linecolor</span><span class="p">],</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">:</span><span class="n">linestyle</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span><span class="n">linewidth</span><span class="p">}</span>

    <span class="c1"># Centers</span>
    <span class="k">if</span> <span class="n">centers</span><span class="p">:</span>

        <span class="c1"># Markers</span>
        <span class="k">if</span> <span class="n">centers</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">kwdef</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">kwdef</span><span class="p">[</span><span class="s1">&#39;markerfacecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">facecolor</span>
            <span class="n">kwdef</span><span class="p">[</span><span class="s1">&#39;markeredgecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edgecolor</span>
            <span class="n">kwdef</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">markerlinewidth</span>
            <span class="n">kwdef</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_centers</span>
            <span class="n">kwdef</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
            <span class="n">centers</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">[::</span><span class="n">samp</span><span class="p">,</span> <span class="p">::</span><span class="n">samp</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy</span><span class="p">[::</span><span class="n">samp</span><span class="p">,</span> <span class="p">::</span><span class="n">samp</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="n">kwdef</span><span class="p">))</span>

        <span class="c1"># Lines</span>
        <span class="k">if</span> <span class="n">centers</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">centers</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">kwpg</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="n">kwlines</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">_plot_grid_</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">label_edges</span><span class="p">,</span> <span class="o">**</span><span class="n">kwpg</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">centers</span><span class="o">=</span><span class="kc">None</span>

    <span class="c1"># Create lines</span>
    <span class="k">if</span> <span class="n">edges</span><span class="p">:</span>
        <span class="n">kwpg</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="n">kwlines</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">_plot_grid_</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xx2d</span><span class="p">,</span> <span class="n">yy2d</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">label_edges</span><span class="p">,</span> <span class="o">**</span><span class="n">kwpg</span><span class="p">)</span>

<span class="c1">#        lines = ()</span>
<span class="c1">#        ny, nx = gg.shape</span>
<span class="c1">#        for iy in xrange(0, ny+1, samp):</span>
<span class="c1">#            lines += zip(xx2d[iy, ::samp], yy2d[iy, ::samp]),</span>
<span class="c1">#        for ix in xrange(0, nx+1, samp):</span>
<span class="c1">#            lines += zip(xx2d[::samp, ix], yy2d[::samp, ix]),</span>
<span class="c1">#        kwdef = {&#39;colors&#39;:[linecolor], &#39;linestyles&#39;:linestyle, &#39;linewidths&#39;:linewidth}</span>
<span class="c1">#        edges = LineCollection(lines, **kwfilter(kwargs, &#39;edge&#39;, defaults=kwdef))</span>
<span class="c1">#        edges.set_alpha(alpha)</span>
<span class="c1">#        edges.set_zorder(zorder)</span>
<span class="c1">#        edges.set_label(label_edges)</span>
<span class="c1">#        ax.add_collection(edges)</span>
<span class="c1">#        gobjs(grid_edges=edges)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edges</span><span class="o">=</span><span class="kc">None</span>

    <span class="k">return</span> <span class="n">centers</span><span class="p">,</span> <span class="n">edges</span></div>



<span class="c1">####################</span>
<span class="c1"># Plot alterations #</span>
<span class="c1">####################</span>

<span class="c1">#def cached_map(*args):</span>
<span class="c1">#   &quot;&quot;&quot;Check if we have a cached map</span>
<span class="c1">#</span>
<span class="c1">#   @usage:</span>
<span class="c1">#   &gt;&gt;&gt; m = cached_map(lon_min, lon_max, lat_min, lat_max, projection, resolution)</span>
<span class="c1">#   &gt;&gt;&gt; m = cached_map(m) # Does only caching of map</span>
<span class="c1">#   &quot;&quot;&quot;</span>
<span class="c1">#   # We already have one in live memory</span>
<span class="c1">#   if isinstance(args[0], Basemap):</span>
<span class="c1">#       # Save it</span>
<span class="c1">#       cache_map(args[0])</span>
<span class="c1">#       # Get it</span>
<span class="c1">#       return args[0]</span>
<span class="c1">#   # Guess</span>
<span class="c1">#   file = _cached_map_file_(*args)</span>
<span class="c1">##  print &#39;Checking&#39;, file, os.path.exists(file)</span>
<span class="c1">#   if not os.path.exists(file): return None</span>
<span class="c1">##  print &#39;Loadind cached map from &#39;+os.path.basename(file)</span>
<span class="c1">#   f = open(file)</span>
<span class="c1">#   m = cPickle.load(f)</span>
<span class="c1">#   f.close()</span>
<span class="c1">#   return m</span>
<span class="c1">#</span>
<span class="c1">#def cache_map(m):</span>
<span class="c1">#   &quot;&quot;&quot;Cache a map if still not cached&quot;&quot;&quot;</span>
<span class="c1">#   if m is None: return</span>
<span class="c1">#   file = _cached_map_file_(m.llcrnrlon, m.urcrnrlon, m.llcrnrlat, m.urcrnrlat, m.projection, m.resolution)</span>
<span class="c1">#   if not os.path.exists(file):</span>
<span class="c1">##      print &#39;Caching map to &#39;+os.path.basename(file)</span>
<span class="c1">#       f = open(file, &#39;wb&#39;)</span>
<span class="c1">#       cPickle.dump(m, f)</span>
<span class="c1">#       f.close()</span>
<span class="c1">#</span>
<span class="c1">#def _cached_map_file_(lon_min, lon_max, lat_min, lat_max, proj, res):</span>
<span class="c1">#   return os.path.join(_cached_map_dir,</span>
<span class="c1">#       &#39;cached_map.%(lon_min)g_%(lon_max)g.%(lat_min)g_%(lat_max)g.%(proj)s.%(res)s.pyk&#39; % vars())</span>
<span class="c1">#</span>


<div class="viewcode-block" id="rotate_tick_labels"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.rotate_tick_labels">[docs]</a><span class="k">def</span> <span class="nf">rotate_tick_labels</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">vertical</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rotate labels along an axis</span>

<span class="sd">    - **angle**: Angle in degrees OR False.</span>
<span class="sd">    - *vertical*: On vertical axis if not 0 [default: 0]</span>
<span class="sd">    - Other arguments are passed to :func:`~matplotlib.pyplot.setp`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">func</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;ax.get_</span><span class="si">%s</span><span class="s1">ticklabels()&#39;</span> <span class="o">%</span> <span class="s1">&#39;xy&#39;</span><span class="p">[</span><span class="n">vertical</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">angle</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">P</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span><span class="s2">&quot;rotation&quot;</span><span class="p">,</span><span class="n">angle</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="xrotate"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.xrotate">[docs]</a><span class="k">def</span> <span class="nf">xrotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rotate xticklabels</span>

<span class="sd">    See: :func:`rotate_tick_labels`&quot;&quot;&quot;</span>
    <span class="n">rotate_tick_labels</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
<div class="viewcode-block" id="yrotate"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.yrotate">[docs]</a><span class="k">def</span> <span class="nf">yrotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rotate yticklabels</span>

<span class="sd">    See: :func:`rotate_tick_labels`&quot;&quot;&quot;</span>
    <span class="n">rotate_tick_labels</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="rotate_xlabels"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.rotate_xlabels">[docs]</a><span class="k">def</span> <span class="nf">rotate_xlabels</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shortcut to :func:`xrotate`&quot;&quot;&quot;</span>
    <span class="n">rotate_tick_labels</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
<div class="viewcode-block" id="rotate_ylabels"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.rotate_ylabels">[docs]</a><span class="k">def</span> <span class="nf">rotate_ylabels</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shortcut to :func:`yrotate`&quot;&quot;&quot;</span>
    <span class="n">rotate_tick_labels</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_xyscale_</span><span class="p">(</span><span class="n">xylim</span><span class="p">,</span><span class="n">factor</span><span class="p">,</span><span class="n">keep_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">keep_max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;=</span><span class="mf">0.</span><span class="p">:</span> <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="k">if</span> <span class="n">factor</span> <span class="o">==</span> <span class="mf">1.</span> <span class="ow">or</span> <span class="p">(</span><span class="n">keep_min</span> <span class="ow">and</span> <span class="n">keep_max</span><span class="p">):</span> <span class="n">xylim</span><span class="p">()</span>
    <span class="n">mn</span><span class="p">,</span><span class="n">mx</span> <span class="o">=</span> <span class="n">xylim</span><span class="p">()</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">mx</span><span class="o">-</span><span class="n">mn</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">factor</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">mn</span> <span class="o">-=</span> <span class="n">delta</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">keep_max</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">keep_min</span><span class="p">)</span>
    <span class="n">mx</span> <span class="o">+=</span> <span class="n">delta</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">keep_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">keep_max</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xylim</span><span class="p">(</span><span class="n">minmax</span><span class="p">(</span><span class="n">auto_scale</span><span class="p">([</span><span class="n">mn</span><span class="p">,</span><span class="n">mx</span><span class="p">])))</span>


<div class="viewcode-block" id="xscale"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.xscale">[docs]</a><span class="k">def</span> <span class="nf">xscale</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scale xlim using factor and auto_scale</span>

<span class="sd">    - **factor**: Relative factor with 1. meaning no change</span>
<span class="sd">    - *keep_min/keep_max*: Kee min/max during scaling [default: False]</span>

<span class="sd">    Return: New xlim()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_xyscale_</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">xlim</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="scale_xlim"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.scale_xlim">[docs]</a><span class="k">def</span> <span class="nf">scale_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shortcut to :func:`xscale`&quot;&quot;&quot;</span>
    <span class="n">xscale</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="yscale"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.yscale">[docs]</a><span class="k">def</span> <span class="nf">yscale</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scale ylim using factor and auto_scale</span>

<span class="sd">    - **factor**: Relative factor with 1. meaning no change</span>
<span class="sd">    - *keep_min/keep_max*: Kee min/max during scaling [default: False]</span>

<span class="sd">    Return: New ylim()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_xyscale_</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">ylim</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="scale_ylim"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.scale_ylim">[docs]</a><span class="k">def</span> <span class="nf">scale_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shortcut to :func:`yscale`&quot;&quot;&quot;</span>
    <span class="n">yscale</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="xhide"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.xhide">[docs]</a><span class="k">def</span> <span class="nf">xhide</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Hide or not an axis</span>

<span class="sd">    - **choice**: What to do [default: True]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">P</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span><span class="ow">not</span> <span class="n">choice</span><span class="p">)</span></div>

<div class="viewcode-block" id="yhide"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.yhide">[docs]</a><span class="k">def</span> <span class="nf">yhide</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Hide or not an axis</span>

<span class="sd">    - **choice**: What to do [default: True]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">P</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span><span class="ow">not</span> <span class="n">choice</span><span class="p">)</span></div>

<div class="viewcode-block" id="xdate"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.xdate">[docs]</a><span class="k">def</span> <span class="nf">xdate</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mf">45.</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Consider x axis as dates</span>

<span class="sd">    $_xydate_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_xydate_</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ydate"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.ydate">[docs]</a><span class="k">def</span> <span class="nf">ydate</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Consider y axis as dates</span>

<span class="sd">    $_xydate_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_xydate_</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_xydateold_</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">locator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minor_locator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nominor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">nmax_ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - *tz*: Time zone.</span>
<span class="sd">    - *auto*: Auto Scaling [default: True]</span>
<span class="sd">    - *rotation*: Rotation angle of tick labels. If None, automatic [default: None]</span>
<span class="sd">    - *fmt*: Date format.</span>
<span class="sd">    - *locator*: Major locator. Can be within [&#39;year&#39;,&#39;month&#39;,&#39;Weekday&#39;,&#39;day&#39;,&#39;hour&#39;,&#39;minute&#39;,&#39;second&#39;] or be like matplotlib.dates.MonthLocator().</span>
<span class="sd">    - *minor_locator*: Minor locator.</span>
<span class="sd">    - *nominor*: Do not try to add minor ticks [default: False]</span>
<span class="sd">    - *nmax_ticks*: Maximal number of ticks</span>
<span class="sd">    - *locator_&lt;keyword&gt;*: &lt;keyword&gt; is passed to locator if locator is a string. If locator = &#39;month&#39;, locator = MonthLocator(locator_&lt;keyword&gt;=&lt;value&gt;).</span>
<span class="sd">    - *minor_locator_&lt;keyword&gt;*: Same with minor_locator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="c1">##  print &#39;xlimssss&#39;,P.gca(),ax</span>
<span class="c1">##  if ax.get_xlim() == (0.,1.): raise &#39;a&#39;</span>
    <span class="c1"># Base</span>
    <span class="n">exec</span> <span class="s2">&quot;ax.</span><span class="si">%s</span><span class="s2">axis_date(tz)&quot;</span> <span class="o">%</span> <span class="n">xy</span>

    <span class="c1"># Scale axes</span>
    <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;scale&#39;</span><span class="o">+</span><span class="n">xy</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;scale&#39;</span><span class="o">+</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}[</span><span class="n">xy</span><span class="p">]:</span><span class="kc">False</span><span class="p">})</span>

    <span class="c1"># Rotates labels</span>
    <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;rotate_</span><span class="si">%s</span><span class="s2">labels&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">)(</span><span class="n">rotation</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># String case for locators</span>
    <span class="n">auto_major</span> <span class="o">=</span> <span class="n">locator</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="n">major_locator</span> <span class="o">=</span> <span class="n">locator</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;weekday&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span><span class="s1">&#39;second&#39;</span><span class="p">]</span>
    <span class="n">locs</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">loc</span><span class="o">+</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">])</span>
    <span class="n">kwmjl</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;locator&#39;</span><span class="p">)</span>
    <span class="n">kwmnl</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;minor_locator&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">major_locator</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">:</span>
            <span class="n">major_locator</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">major_locator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;Locator(**kwmjl)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">major_locator</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">minor_locator</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">minor_locator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">:</span>
            <span class="n">minor_locator</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">minor_locator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;Locator(**kwmnl)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minor_locator</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Tick locations</span>
    <span class="n">guess_major</span> <span class="o">=</span> <span class="n">major_locator</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">nmax_ticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">nmax_ticks</span> <span class="o">=</span> <span class="mi">24</span>
    <span class="k">if</span> <span class="n">major_locator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">major_locator</span> <span class="o">=</span> <span class="n">get_major_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">nticks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;ax.get_</span><span class="si">%s</span><span class="s2">ticks()&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">nmax_ticks</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">major_locator</span><span class="p">,</span><span class="n">AutoDateLocator</span><span class="p">):</span>
        <span class="c1"># Major ticks</span>
        <span class="n">locname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">major_locator</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">nticks</span> <span class="o">=</span> <span class="n">nmax_ticks</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1">#       mlr = major_locator.rule._rrule</span>
        <span class="k">while</span> <span class="n">nticks</span> <span class="o">&gt;</span> <span class="n">nmax_ticks</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">major_locator</span> <span class="o">=</span> <span class="n">set_major_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(interval=</span><span class="si">%i</span><span class="s2">,**kwmjl)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">locname</span><span class="p">,</span><span class="n">i</span><span class="p">)),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">major_locator</span> <span class="o">=</span> <span class="n">set_major_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%i</span><span class="s2">,**kwmjl)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">locname</span><span class="p">,</span><span class="n">i</span><span class="p">)),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">nticks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;ax.get_</span><span class="si">%s</span><span class="s2">ticks()&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nmax_ticks</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nmax_ticks</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">major_locator</span><span class="p">,</span><span class="n">AutoDateLocator</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">N</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">major_locator</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_data_interval</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">lims</span> <span class="o">=</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">datalim_to_dt</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lims</span> <span class="o">=</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">viewlim_to_dt</span><span class="p">()</span>
        <span class="n">major_locator</span> <span class="o">=</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">get_locator</span><span class="p">(</span><span class="o">*</span><span class="n">lims</span><span class="p">)</span>

    <span class="c1"># Fix phase of some locators</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sampling</span> <span class="o">=</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">_rrule</span><span class="o">.</span><span class="n">_interval</span> <span class="c1"># sampling interval</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">sampling</span> <span class="o">=</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_base</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">_rrule</span><span class="o">.</span><span class="n">_freq</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">YEARLY</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="n">DAILY</span> <span class="ow">and</span> <span class="n">sampling</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="c1"># Fix daily/7 to weekly/monday locator (start on monday)</span>
        <span class="n">major_locator</span> <span class="o">=</span> <span class="n">set_major_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">WeekdayLocator</span><span class="p">(</span><span class="n">MO</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="n">HOURLY</span> <span class="ow">and</span> <span class="n">sampling</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Fix hourly locator to start at mindnight</span>
        <span class="n">good</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
        <span class="n">sampling</span> <span class="o">=</span> <span class="n">good</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">good</span><span class="p">,</span> <span class="n">sampling</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">good</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">byhour</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">sampling</span><span class="p">)</span>
        <span class="n">major_locator</span> <span class="o">=</span> <span class="n">set_major_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">byhour</span><span class="o">=</span><span class="n">byhour</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">major_unit</span> <span class="o">=</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">_get_unit</span><span class="p">()</span>

    <span class="c1"># Tick format</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Try a special date formatter</span>
        <span class="k">if</span> <span class="n">trange</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">trange</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="mf">24.</span><span class="p">:</span> <span class="c1"># H/M</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">trange</span> <span class="o">&lt;</span> <span class="mi">31</span> <span class="ow">and</span> <span class="n">trange</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># d/m</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">trange</span> <span class="o">&lt;</span> <span class="mi">365</span> <span class="ow">and</span> <span class="n">trange</span> <span class="o">&gt;</span> <span class="mi">31</span><span class="p">:</span> <span class="c1"># m/d</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">trange</span> <span class="o">&lt;</span> <span class="mi">365</span><span class="o">*</span><span class="mi">5</span> <span class="ow">and</span> <span class="n">trange</span> <span class="o">&gt;</span> <span class="mi">365</span><span class="p">:</span> <span class="c1"># Y/m</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">DateFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">SpecialDateFormatter</span><span class="p">(</span><span class="o">*</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">SpecialDateFormatter</span><span class="p">(</span><span class="o">**</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">+=</span> <span class="p">({},</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">SpecialDateFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="n">SpecialDateFormatter</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;rotate_</span><span class="si">%s</span><span class="s2">labels&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">)(</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;ax.</span><span class="si">%s</span><span class="s2">axis.set_major_formatter&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">)(</span><span class="n">fmt</span><span class="p">)</span>

    <span class="c1"># Minor ticks</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">nominor</span><span class="p">:</span>
<span class="c1">#       # Minor formatter for special case</span>
<span class="c1">#       if fmt is not None and isinstance(fmt,SpecialDateFormatter):</span>
<span class="c1">#           eval(&quot;ax.%saxis.set_minor_formatter&quot; % xy)(fmt)</span>
        <span class="c1"># Direct</span>
        <span class="k">if</span> <span class="n">minor_locator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">minor_locator</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># From sampling</span>
        <span class="k">if</span> <span class="n">sampling</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">get_locator_from_units</span><span class="p">(</span><span class="n">major_locator</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># From units</span>
        <span class="k">if</span> <span class="n">major_unit</span> <span class="o">==</span> <span class="mi">365</span><span class="p">:</span> <span class="c1"># Year</span>
            <span class="k">for</span> <span class="n">nmaj</span><span class="p">,</span><span class="n">itv</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="n">nmax_ticks</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">nticks</span> <span class="o">&lt;=</span> <span class="n">nmaj</span><span class="p">:</span>
                    <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">MonthLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">itv</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">elif</span> <span class="n">major_unit</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span> <span class="c1"># Month</span>
            <span class="k">if</span> <span class="n">nticks</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">DayLocator</span><span class="p">(</span><span class="n">bymonthday</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">WeekdayLocator</span><span class="p">(</span><span class="n">MO</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">major_unit</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span> <span class="c1"># Week</span>
            <span class="k">if</span> <span class="n">nticks</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span> <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">DayLocator</span><span class="p">(),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">major_unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Day</span>
            <span class="k">for</span> <span class="n">nmaj</span><span class="p">,</span><span class="n">itv</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="n">nmax_ticks</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">nticks</span> <span class="o">&lt;=</span> <span class="n">nmaj</span><span class="p">:</span>
                    <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">HourLocator</span><span class="p">(</span><span class="n">byhour</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">itv</span><span class="p">)),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">elif</span> <span class="n">major_unit</span> <span class="o">==</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">24.</span><span class="p">:</span> <span class="c1"># Hour</span>
            <span class="k">for</span> <span class="n">nmaj</span><span class="p">,</span><span class="n">itv</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="n">nmax_ticks</span><span class="p">,</span><span class="mi">30</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">nticks</span> <span class="o">&lt;=</span> <span class="n">nmaj</span><span class="p">:</span>
                    <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">MinuteLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">itv</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">elif</span> <span class="n">major_unit</span> <span class="o">==</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">24.</span><span class="o">*</span><span class="mf">60.</span><span class="p">):</span> <span class="c1"># Minutes</span>
            <span class="k">for</span> <span class="n">nmaj</span><span class="p">,</span><span class="n">itv</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="n">nmax_ticks</span><span class="p">,</span><span class="mi">30</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">nticks</span> <span class="o">&lt;=</span> <span class="n">nmaj</span><span class="p">:</span>
                    <span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">SecondLocator</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">itv</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">break</span>

<span class="k">def</span> <span class="nf">_xydate_</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;dual&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">locator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minor_locator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">minor_formatter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nominor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">nmax_ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - *tz*: Time zone.</span>
<span class="sd">    - *auto*: Auto Scaling [default: True]</span>
<span class="sd">    - *rotation*: Rotation angle of tick labels. If None, automatic [default: None]</span>
<span class="sd">    - *fmt*: Date format.</span>
<span class="sd">    - *locator*: Major locator. Can be within [&#39;year&#39;,&#39;month&#39;,&#39;Weekday&#39;,&#39;day&#39;,&#39;hour&#39;,&#39;minute&#39;,&#39;second&#39;] or be like matplotlib.dates.MonthLocator().</span>
<span class="sd">    - *minor_locator*: Minor locator.</span>
<span class="sd">    - *nominor*: Do not try to add minor ticks [default: False]</span>
<span class="sd">    - *nmax_ticks*: Maximal number of ticks</span>
<span class="sd">    - *locator_&lt;keyword&gt;*: &lt;keyword&gt; is passed to locator if locator is a string. If locator = &#39;month&#39;, locator = MonthLocator(locator_&lt;keyword&gt;=&lt;value&gt;).</span>
<span class="sd">    - *minor_locator_&lt;keyword&gt;*: Same with minor_locator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xy</span><span class="o">+</span><span class="s1">&#39;axis&#39;</span><span class="p">)</span>
<span class="c1">##  print &#39;xlimssss&#39;,P.gca(),ax</span>
<span class="c1">##  if ax.get_xlim() == (0.,1.): raise &#39;a&#39;</span>
    <span class="c1"># Base</span>
    <span class="n">exec</span> <span class="s2">&quot;axes.</span><span class="si">%s</span><span class="s2">axis_date(tz)&quot;</span> <span class="o">%</span> <span class="n">xy</span>

    <span class="c1"># Scale axes</span>
    <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;scale&#39;</span><span class="o">+</span><span class="n">xy</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;scale&#39;</span><span class="o">+</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">}[</span><span class="n">xy</span><span class="p">]:</span><span class="kc">False</span><span class="p">})</span>

    <span class="c1"># Guess locators</span>
    <span class="n">major_locator</span> <span class="o">=</span> <span class="n">locator</span>
    <span class="k">if</span> <span class="n">nominor</span><span class="p">:</span> <span class="n">minor_locator</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;weekday&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span><span class="s1">&#39;second&#39;</span><span class="p">]</span>
    <span class="n">locs</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">loc</span><span class="o">+</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">])</span>
    <span class="n">kwmjl</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;locator&#39;</span><span class="p">)</span>
    <span class="n">kwmnl</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;minor_locator&#39;</span><span class="p">)</span>
    <span class="c1"># - major</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">major_locator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">major_locator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">:</span>
            <span class="n">major_locator</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">major_locator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;Locator(**kwmjl)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">major_locator</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">major_locator</span> <span class="o">=</span> <span class="n">AutoDateLocator2</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">major_locator</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">major_locator</span><span class="p">)</span>
<span class="c1">#    # - minor</span>
<span class="c1">#    if minor_locator is 1 or minor_locator is True:</span>
<span class="c1">#        minor_locator = &#39;auto&#39;</span>
<span class="c1">#    if isinstance(minor_locator, str):</span>
<span class="c1">#        if minor_locator.lower() in locs:</span>
<span class="c1">#            minor_locator = eval(minor_locator.lower().title()+&#39;Locator(**kwmnl)&#39;)</span>
<span class="c1">#        elif minor_locator.lower().startswith(&#39;auto&#39;):</span>
<span class="c1">#            minor_locator = AutoDateMinorLocator(**kwmnl)</span>
<span class="c1">#        else:</span>
<span class="c1">#            minor_locator = None</span>
<span class="c1">#    if minor_locator:</span>
<span class="c1">#        print &#39;axis.set_minor_locator&#39;</span>
<span class="c1">#        axis.set_minor_locator(minor_locator)</span>



    <span class="c1"># Tick format</span>
    <span class="c1"># - major</span>
    <span class="k">if</span> <span class="n">major_locator</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;dual&#39;</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;simple&#39;</span> <span class="ow">or</span> <span class="n">fmt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">AutoDateFormatter2</span><span class="p">(</span><span class="n">major_locator</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span> <span class="ow">or</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">fmt</span>  <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">AutoDualDateFormatter</span><span class="p">(</span><span class="n">major_locator</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">DateFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">DualDateFormatter</span><span class="p">(</span><span class="o">*</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">DualDateFormatter</span><span class="p">(</span><span class="o">**</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">+=</span> <span class="p">({},</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">DualDateFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">fmt</span><span class="p">:</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
<span class="c1">#        if rotation is not None and not isinstance(fmt, (DualDateFormatter, AutoDualDateFormatter)):</span>
<span class="c1">#            P.setp(axis.get_majorticklabels(), &quot;rotation&quot;, angle, *args)</span>
<span class="c1">#</span>
<span class="c1">#        # - minor</span>
<span class="c1">#        if not nominor and minor_locator:</span>
<span class="c1">#            if minor_formatter is True:</span>
<span class="c1">#                minor_formatter = AutoDateFormatter2()</span>
<span class="c1">#            elif isinstance(minor_formatter, str):</span>
<span class="c1">#                minor_formatter = DateFormatter(fmt)</span>
<span class="c1">#            if minor_formatter:</span>
<span class="c1">#                axis.set_minor_formatter(minor_formatter)</span>


<div class="viewcode-block" id="get_locator_from_units"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.get_locator_from_units">[docs]</a><span class="k">def</span> <span class="nf">get_locator_from_units</span><span class="p">(</span><span class="n">locator</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">reps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;^interval$&#39;</span><span class="p">,</span><span class="s1">&#39;^by&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">reps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">rep</span><span class="p">,</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kw</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">locator</span><span class="o">.</span><span class="n">_get_unit</span><span class="p">()</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="mf">365.</span><span class="p">,</span><span class="mf">30.</span><span class="p">,</span><span class="mf">7.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mf">24.</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mf">60.</span><span class="p">),</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mf">3600.</span><span class="p">)]</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="p">[</span><span class="n">YearLocator</span><span class="p">,</span><span class="n">MonthLocator</span><span class="p">,</span><span class="n">WeekdayLocator</span><span class="p">,</span>
        <span class="n">DayLocator</span><span class="p">,</span><span class="n">HourLocator</span><span class="p">,</span><span class="n">MinuteLocator</span><span class="p">,</span><span class="n">SecondLocator</span><span class="p">]</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">units</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">unit</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">loc</span> <span class="ow">is</span> <span class="n">HourLocator</span><span class="p">:</span> <span class="c1"># fix hour problem</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;byhour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;interval&#39;</span><span class="p">])</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">if</span> <span class="n">loc</span> <span class="ow">is</span> <span class="n">WeekdayLocator</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">MO</span><span class="p">,)</span><span class="o">+</span><span class="n">args</span>
    <span class="k">return</span> <span class="n">loc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="set_major_locator"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.set_major_locator">[docs]</a><span class="k">def</span> <span class="nf">set_major_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">locator</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;ax.</span><span class="si">%s</span><span class="s2">axis.set_major_locator(locator)&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">get_major_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_major_locator"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.get_major_locator">[docs]</a><span class="k">def</span> <span class="nf">get_major_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">real</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">locator</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;ax.</span><span class="si">%s</span><span class="s2">axis.get_major_locator()&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">real</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">locator</span><span class="p">,</span><span class="n">AutoDateLocator</span><span class="p">):</span>
            <span class="n">locator</span> <span class="o">=</span> <span class="n">locator</span><span class="o">.</span><span class="n">get_locator</span><span class="p">(</span><span class="o">*</span><span class="n">locator</span><span class="o">.</span><span class="n">datalim_to_dt</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">locator</span></div>

<div class="viewcode-block" id="set_minor_locator"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.set_minor_locator">[docs]</a><span class="k">def</span> <span class="nf">set_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">locator</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;ax.</span><span class="si">%s</span><span class="s2">axis.set_minor_locator(locator)&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">get_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_minor_locator"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.get_minor_locator">[docs]</a><span class="k">def</span> <span class="nf">get_minor_locator</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;ax.</span><span class="si">%s</span><span class="s2">axis.get_minor_locator()&quot;</span> <span class="o">%</span> <span class="n">xy</span><span class="p">)</span></div>

<div class="viewcode-block" id="add_logo"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_logo">[docs]</a><span class="k">def</span> <span class="nf">add_logo</span><span class="p">(</span><span class="n">logofile</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">tool</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a logo to the background of the figure</span>

<span class="sd">    .. warning:: Except when ``loc=&#39;lower left&#39;, scale=1`` is passed as arguments,</span>
<span class="sd">      the logo is rescaled each time the figure is resized.</span>

<span class="sd">    .. note:: It is highly suggested to prefer png to other formats for your logo.</span>

<span class="sd">    :Params:</span>

<span class="sd">        - *file*: File of the image.</span>
<span class="sd">        - *axes*: Axes specs of the image (overwrites loc and scale keywords),</span>
<span class="sd">          passed to meth:`~matplotlib.figure.Figure.add_axes`.</span>
<span class="sd">        - *loc*: Position of the image (use words in &#39;lower&#39;, &#39;upper&#39;, &#39;left&#39;,</span>
<span class="sd">          &#39;right&#39;, &#39;center&#39;) .</span>
<span class="sd">        - *scale*: Scale the image. By default, it is auto scale so that the logo is</span>
<span class="sd">          never greater than 1/4 of the figure width or height.</span>
<span class="sd">        - *alpha*: Alpha transparency.</span>
<span class="sd">        - *tool*: None, &#39;mpl&#39; (png only) or &#39;pil&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">logofile</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s2">&quot;Logo file not found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">logofile</span><span class="p">)</span>

    <span class="c1"># Read image</span>
    <span class="k">if</span> <span class="n">tool</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">logofile</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;png&#39;</span><span class="p">):</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;mpl&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;pil&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">tool</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mpl&#39;</span><span class="p">,</span> <span class="s1">&#39;pil&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s1">&#39;Please choose a valid tool for plotting your logo: &#39;</span>
            <span class="s1">&#39;&quot;mpl&quot; (png only), &quot;pil&quot;, or None&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tool</span><span class="o">==</span><span class="s1">&#39;mpl&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logo</span>  <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">logofile</span><span class="p">)</span>
            <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t read your logo file. &quot;</span>
                <span class="s2">&quot;Please convert it to png format or install PIL and use `tool=&#39;pil&#39;`&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">PIL.Image</span> <span class="k">as</span> <span class="nn">Image</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">Image</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t import PIL to plot your logo. Convert it to png&quot;</span>
                    <span class="s2">&quot; and use `tool=&#39;mpl&#39;` calling add_logo&quot;</span><span class="p">)</span>
        <span class="n">logo</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">logofile</span><span class="p">)</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">logo</span><span class="o">.</span><span class="n">size</span>

    <span class="c1"># Dimensions and position</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rcParams</span>
    <span class="n">dpi</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoscale_on</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">scale</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">loc</span><span class="o">==</span><span class="s1">&#39;lower left&#39;</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>


        <span class="n">dx</span> <span class="o">=</span> <span class="n">nx</span><span class="o">/</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_figwidth</span><span class="p">()</span><span class="o">*</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ny</span><span class="o">/</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_figheight</span><span class="p">()</span><span class="o">*</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="n">dy</span> <span class="o">*=</span> <span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scalex</span> <span class="o">=</span> <span class="n">scaley</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="k">if</span> <span class="n">dx</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">25</span><span class="p">:</span>
                <span class="n">scalex</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span><span class="o">/</span><span class="n">dx</span>
            <span class="k">if</span> <span class="n">dy</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">25</span><span class="p">:</span>
                <span class="n">scaley</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span><span class="o">/</span><span class="n">dy</span>
            <span class="k">if</span> <span class="n">scalex</span> <span class="o">&lt;</span> <span class="mf">1.</span> <span class="ow">or</span> <span class="n">scaley</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">scalex</span><span class="p">,</span><span class="n">scaley</span><span class="p">)</span>
                <span class="n">dx</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">dy</span> <span class="o">*=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="s1">&#39;upper&#39;</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">dy</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;lower&#39;</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">-</span><span class="n">dy</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;right&#39;</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">dx</span>
            <span class="n">anchor</span>  <span class="o">=</span> <span class="n">anchor</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;left&#39;</span> <span class="ow">in</span> <span class="n">loc</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">anchor</span>  <span class="o">=</span> <span class="n">anchor</span> <span class="o">+</span> <span class="s1">&#39;W&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">-</span><span class="n">dx</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">anchor</span>  <span class="o">=</span> <span class="n">anchor</span> <span class="o">+</span> <span class="s1">&#39;C&#39;</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">y</span><span class="o">+</span><span class="n">dy</span><span class="o">/</span><span class="mf">2.</span>
        <span class="k">if</span> <span class="n">anchor</span><span class="o">==</span><span class="s1">&#39;CC&#39;</span><span class="p">:</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;C&#39;</span> <span class="ow">in</span> <span class="n">anchor</span><span class="p">:</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="n">anchor</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">figimage</span><span class="p">(</span><span class="n">logo</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">logo</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">im</span></div>


<div class="viewcode-block" id="wedge"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.wedge">[docs]</a><span class="k">def</span> <span class="nf">wedge</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">shadow_alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span><span class="n">circle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">strength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">strength_cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">from_north</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">center_radius</span><span class="o">=.</span><span class="mi">04</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a wedge</span>

<span class="sd">    - **direction**: Direction of the wedge in degrees from north</span>
<span class="sd">    - *width*: Base width of the wedge in degrees [default: 20]</span>
<span class="sd">    - *shadow*: Add a shadow [default: False]</span>
<span class="sd">    - *shadow_alpha*: Alpha transparency of the shadow [default: .5]</span>
<span class="sd">    - *circle*: Add a circle arround the wedge [default: True]</span>
<span class="sd">    - *shadow_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :class:`matplotlib.patches.Shadow` class.</span>
<span class="sd">    - *circle_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :class:`matplotlib.patches.Circle` class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Figure and axes</span>
    <span class="n">onfig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">onfig</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Relative strength</span>
    <span class="c1"># - color</span>
    <span class="k">if</span> <span class="n">strength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">facecolor</span> <span class="o">=</span> <span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">strength_cmap</span><span class="p">)</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="n">strength</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="c1"># - scale</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>

    <span class="c1"># Plot the wedge</span>
    <span class="n">r</span> <span class="o">=</span> <span class="o">.</span><span class="mi">41</span><span class="o">*</span><span class="n">scale</span>
<span class="c1">##  direction = (90.-direction+180+360)%360.</span>
    <span class="k">if</span> <span class="n">from_north</span><span class="p">:</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="mf">90.</span><span class="o">-</span><span class="n">direction</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">direction</span><span class="o">+</span><span class="mi">180</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span><span class="o">%</span><span class="mf">360.</span>
    <span class="n">zorder</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;zorder&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ww</span> <span class="o">=</span> <span class="n">Wedge</span><span class="p">((</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="mf">1.1</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">direction</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">),</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="mf">1.1</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">direction</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)),</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">,</span>
        <span class="n">direction</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">direction</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;edgecolor&#39;</span><span class="p">,</span><span class="s1">&#39;facecolor&#39;</span><span class="p">,</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span><span class="s1">&#39;antialiased&#39;</span><span class="p">],</span>
            <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
    <span class="n">ww</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span>

    <span class="c1"># Center</span>
    <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
        <span class="n">cen</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">center_radius</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#aaaaaa&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">cen</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">cen</span><span class="p">)</span>


    <span class="c1"># Shadow</span>
    <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span><span class="n">r</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span><span class="n">r</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">sdw</span> <span class="o">=</span> <span class="n">Shadow</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;shadow&#39;</span><span class="p">))</span>
        <span class="n">sdw</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">shadow_alpha</span><span class="p">)</span>
        <span class="n">sdw</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">sdw</span><span class="p">)</span>

    <span class="c1"># Circle</span>
    <span class="k">if</span> <span class="n">circle</span><span class="p">:</span>
        <span class="n">cir</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="o">.</span><span class="mi">48</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;circle&#39;</span><span class="p">))</span>
        <span class="n">cir</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">cir</span><span class="p">)</span>

    <span class="c1"># End</span>
    <span class="n">P</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-.</span><span class="mi">52</span><span class="p">,</span><span class="o">.</span><span class="mi">52</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-.</span><span class="mi">52</span><span class="p">,</span><span class="o">.</span><span class="mi">52</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">_end_plot_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ww</span></div>

<div class="viewcode-block" id="add_time_mark"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_time_mark">[docs]</a><span class="k">def</span> <span class="nf">add_time_mark</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span><span class="c1">#:,alongx=True):</span>
    <span class="sd">&quot;&quot;&quot;Plot a time mark along a time axis using a line and a marker</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **date**: Date (converted using :func:`~vacumm.misc.atime.mpl`).</span>
<span class="sd">        - **color**, optional: Color of the line and marker.</span>
<span class="sd">        - **line**, optional: Plot the line?</span>
<span class="sd">        - **line_&lt;kw&gt;**, optional: Keyword ``kw`` is passed to</span>
<span class="sd">          :func:`~matplotlib.pyplot.axvline`.</span>
<span class="sd">        - **marker**, optional: Plot the marker? Or symbol.</span>
<span class="sd">        - **line_&lt;kw&gt;**, optional: Keyword ``kw`` is passed to</span>
<span class="sd">          :func:`~matplotlib.pyplot.axvline`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Inits</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xlim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwline</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;line&#39;</span><span class="p">)</span>
    <span class="n">kwmarker</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">)</span>
    <span class="n">kwshad</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;shadow&#39;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="c1"># MPL time</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">add_shadow</span>

    <span class="c1"># Line</span>
    <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">kwline</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwline</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span>
            <span class="n">add_shadow</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwshad</span><span class="p">)</span>

    <span class="c1"># Marker</span>
    <span class="k">if</span> <span class="n">marker</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">kwmarker</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="p">)</span>
        <span class="n">kwmarker</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">date</span><span class="p">],</span> <span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>  <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwmarker</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span>
            <span class="n">add_shadow</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwshad</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="add_key"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_key">[docs]</a><span class="k">def</span> <span class="nf">add_key</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">xmargin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ymargin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a key to specify the plot number in a figure</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **key**, optional: A string or a integer. If an integer is given,</span>
<span class="sd">          it converted to letter (1-&gt;&#39;a&#39;).</span>
<span class="sd">        - **pos**, optional: Position of the key. It can be an integer or string:</span>

<span class="sd">            - ``1 = top left``</span>
<span class="sd">            - ``2 = top right``</span>
<span class="sd">            - ``3 = bottom right``</span>
<span class="sd">            - ``4 = bottom left``</span>

<span class="sd">          If negative, push it outside axis box.</span>
<span class="sd">          It can also be an explicit position</span>
<span class="sd">        - **fmt**, optional: Format of the string.</span>
<span class="sd">        - **{x|y}margin**, optional: Margin from axes in points.</span>
<span class="sd">        - Other keywords are passed to :func:`~matplotlib.pyplot.text`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Base</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">):</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c1"># Text</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span><span class="p">[</span><span class="n">key</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">%</span><span class="n">key</span>

    <span class="c1"># Position</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">gpos</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]][</span><span class="n">xpos</span> <span class="o">&lt;</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">gpos</span><span class="p">[</span><span class="n">ypos</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">gpos</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]][</span><span class="s1">&#39;bottom&#39;</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">gpos</span><span class="p">[</span><span class="s1">&#39;right&#39;</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]</span>
        <span class="n">xpos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">ypos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

    <span class="c1"># Alignment</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;va&#39;</span><span class="p">,</span>  <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">][</span><span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]])</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ha&#39;</span><span class="p">,</span>  <span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">][</span><span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]])</span>

    <span class="c1"># Margin</span>
    <span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="k">import</span> <span class="n">ScaledTranslation</span>
    <span class="n">xmargin</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xmargin</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))</span>
    <span class="n">ymargin</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ymargin</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">pos</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]))</span>
    <span class="n">transMargin</span> <span class="o">=</span> <span class="n">ScaledTranslation</span><span class="p">(</span><span class="n">xmargin</span><span class="o">/</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="n">ymargin</span><span class="o">/</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="p">)</span>

    <span class="c1"># Add to plot</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="o">+</span><span class="n">transMargin</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="hldays"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.hldays">[docs]</a><span class="k">def</span> <span class="nf">hldays</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;.95&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highlight different days with a different background color</span>

<span class="sd">    :Params:</span>

<span class="sd">        - *color*: Background color.</span>
<span class="sd">        - *y*: Work on Y axis.</span>
<span class="sd">        - Other keyparam are passed to :func:`~matplotlib.pyplot.axhspan`</span>
<span class="sd">          or :func:`~matplotlib.pyplot.axvspan`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Base</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">):</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c1"># Bonds</span>
    <span class="n">ttmin</span><span class="p">,</span> <span class="n">ttmax</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="s1">&#39;get_</span><span class="si">%s</span><span class="s1">lim&#39;</span><span class="o">%</span><span class="s1">&#39;xy&#39;</span><span class="p">[</span><span class="n">y</span><span class="p">])()</span>
    <span class="kn">from</span> <span class="nn">vacumm.misc.atime</span> <span class="k">import</span> <span class="n">numtime</span>
    <span class="k">if</span> <span class="n">tmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="n">ttmin</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="n">numtime</span><span class="p">(</span><span class="n">tmin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="n">ttmax</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="n">numtime</span><span class="p">(</span><span class="n">tmax</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">tmax</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Patch</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;zorder&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
    <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">axspan</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="s1">&#39;ax</span><span class="si">%s</span><span class="s1">span&#39;</span><span class="o">%</span><span class="s1">&#39;vh&#39;</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmax</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axspan</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
<span class="c1">#        objs[-1].set_zorder(0)</span>
    <span class="nb">getattr</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="s1">&#39;set_</span><span class="si">%s</span><span class="s1">lim&#39;</span><span class="o">%</span><span class="s1">&#39;xy&#39;</span><span class="p">[</span><span class="n">y</span><span class="p">])(</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">objs</span></div>



<div class="viewcode-block" id="xi2a"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.xi2a">[docs]</a><span class="k">def</span> <span class="nf">xi2a</span><span class="p">(</span><span class="n">inch</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from inch to X axis coordinates&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_data_interval</span><span class="p">()</span><span class="o">.</span><span class="n">get_bounds</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># data</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_figwidth</span><span class="p">())</span> <span class="c1"># inch to data</span>
    <span class="k">return</span>  <span class="n">trans</span><span class="o">*</span><span class="n">inch</span> <span class="c1"># data units</span></div>

<div class="viewcode-block" id="yi2a"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.yi2a">[docs]</a><span class="k">def</span> <span class="nf">yi2a</span><span class="p">(</span><span class="n">inch</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from inch to Y axis coordinates&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_data_interval</span><span class="p">()</span><span class="o">.</span><span class="n">get_bounds</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># data</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_figheight</span><span class="p">())</span> <span class="c1"># inch to data</span>
    <span class="k">return</span>  <span class="n">trans</span><span class="o">*</span><span class="n">inch</span> <span class="c1"># data units</span></div>

<div class="viewcode-block" id="yi2f"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.yi2f">[docs]</a><span class="k">def</span> <span class="nf">yi2f</span><span class="p">(</span><span class="n">inch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from inch to relative height of figure&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">inch</span><span class="o">/</span><span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_figheight</span><span class="p">()</span></div>

<div class="viewcode-block" id="xi2f"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.xi2f">[docs]</a><span class="k">def</span> <span class="nf">xi2f</span><span class="p">(</span><span class="n">inch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from inch to relative width of figure&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">inch</span><span class="o">/</span><span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_figwidth</span><span class="p">()</span></div>

<div class="viewcode-block" id="gobjs"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.gobjs">[docs]</a><span class="k">def</span> <span class="nf">gobjs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Store and retreive graphic objects of the current axes&quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;gobjs&#39;</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">gobjs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">gobjs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">gobjs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">gobjs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">gobjs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">gobjs</span></div>


<div class="viewcode-block" id="savefigs"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.savefigs">[docs]</a><span class="k">def</span> <span class="nf">savefigs</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">png</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pdf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nodots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save a figure in multiple formats (optimized for sphinx doc generator)</span>

<span class="sd">    - **basename**: File name without suffix</span>
<span class="sd">    - *png*: If True, save to png format</span>
<span class="sd">    - *pdf*: If True, save to pdf format</span>
<span class="sd">    - *verbose*: If True, print file names that are created</span>
<span class="sd">    - Other keywords are passed to :func:`~matplotlib.pyplot.savefig`</span>

<span class="sd">    .. warning::</span>

<span class="sd">        Dots (&#39;.&#39;) in figure name are converted to dashes  (&#39;-&#39;)</span>
<span class="sd">        for compatilibity reasons with latex.</span>
<span class="sd">        It is optimized for the sphinx doc generator and may</span>
<span class="sd">        NOT BE SUITABLE FOR YOU. In this case, use</span>
<span class="sd">        :func:`~matplotlib.pyplot.savefig` instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;py&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">basename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">ext</span><span class="p">):</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">nodots</span><span class="p">:</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">basename</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">))</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span> <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">figfiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ext</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">figfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;Wrote to &#39;</span><span class="o">+</span><span class="n">file</span>
    <span class="k">return</span> <span class="n">figfiles</span></div>

<div class="viewcode-block" id="make_movie"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.make_movie">[docs]</a><span class="k">def</span> <span class="nf">make_movie</span><span class="p">(</span><span class="n">fig_pattern</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">windows</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make a movie from a series of figures</span>

<span class="sd">    - **fig_pattern** Unix-like file pattern to select png figures.</span>
<span class="sd">    - **outfile**: Output file.</span>
<span class="sd">    - *delay**: Delay in seconds between two frames.</span>
<span class="sd">    - *windows*: When output is a movie, choose basic mpeg for windows instead of mpeg4 codec.</span>
<span class="sd">    - *clean*: If ``True``, remove figures once the movies os created.</span>

<span class="sd">    :Usage:</span>

<span class="sd">    &gt;&gt;&gt; make_movie(&#39;/home/toto/fig*.png&#39;, &#39;movie.mpg&#39;, delay=.5, clean=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check input files</span>
<span class="c1">#   fig_pattern = os.path.abspath(fig_pattern)</span>
<span class="c1">#   files = glob.glob(fig_pattern)</span>
<span class="c1">#   assert len(files), &#39;No figure files found&#39;</span>
<span class="c1">#   if verbose: print &#39;Found %i figure files&#39;%len(files)</span>
<span class="c1">#   outfile = os.path.abspath(outfile)</span>

    <span class="c1"># Command</span>
    <span class="k">if</span> <span class="n">outfile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;gif&#39;</span><span class="p">):</span>
        <span class="n">delay</span> <span class="o">*=</span> <span class="mf">100.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fig_pattern</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">fig_pattern</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fig_pattern</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;convert -delay </span><span class="si">%(delay)i</span><span class="s1"> </span><span class="si">%(fig_pattern)s</span><span class="s1"> </span><span class="si">%(outfile)s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">vars</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">delay</span>
        <span class="k">if</span> <span class="n">windows</span><span class="p">:</span>
            <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;msmpeg4v2&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">codec</span> <span class="o">=</span> <span class="s1">&#39;mpeg4&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;mencoder mf://</span><span class="si">%(fig_pattern)s</span><span class="s2"> -lavcopts vcodec=</span><span class="si">%(codec)s</span><span class="s2">:vbitrate=800 -mf type=png:fps=</span><span class="si">%(delay)s</span><span class="s2">  -ovc lavc  -oac copy  -o </span><span class="si">%(outfile)s</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">vars</span><span class="p">()</span>

    <span class="c1"># Execution</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;Executing command: &#39;</span><span class="o">+</span><span class="n">cmd</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span>  <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">out</span>
        <span class="nb">print</span> <span class="n">err</span>
    <span class="nb">print</span> <span class="s1">&#39;ret&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span>  <span class="n">err</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemError</span>


    <span class="c1"># Clean files</span>
    <span class="k">if</span> <span class="n">clean</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;Cleaning files&#39;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;rm -f </span><span class="si">%(fig_pattern)s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">vars</span><span class="p">(),</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span>  <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">out</span>
            <span class="nb">print</span> <span class="n">err</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemError</span>
    <span class="k">return</span> <span class="n">outfile</span></div>


<div class="viewcode-block" id="get_cls"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.get_cls">[docs]</a><span class="k">def</span> <span class="nf">get_cls</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">simple_colors</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a list of string argument for :func:`~matplotlib.pyplot.plot` to specify the color and the linestyle</span>

<span class="sd">    - **n**: Length of the list</span>
<span class="sd">    - *colors*: Colors on which to cycle</span>
<span class="sd">    - *linestyles*: Linestyles on which to cycle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
        <span class="n">cc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">:</span> <span class="k">break</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="n">linestyles</span><span class="p">):</span>
        <span class="n">ll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">:</span> <span class="k">break</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">ll</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span></div>

<span class="c1">#############</span>
<span class="c1"># Utilities #</span>
<span class="c1">#############</span>

<span class="k">def</span> <span class="nf">_check_var_</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">rank</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tadd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tadd_copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">tlocal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">xatts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">yatts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - *xaxis*: Use this X axis.</span>
<span class="sd">    - *yaxis*: Use this Y axis.</span>
<span class="sd">    - *tadd*: Add value to time (like tadd=1 or tadd=(1,&#39;day&#39;))</span>
<span class="sd">    - *tadd*: Make a copy of the axis before any tadd [default: True]</span>
<span class="sd">    - *tlocal*: Convert current UTC time axes to local time [default: False]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>

    <span class="c1"># Arrows</span>
    <span class="n">istuple</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">istuple</span><span class="p">:</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">cdms</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">var</span><span class="p">),]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">cdms</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get vectors and modulus</span>
        <span class="n">vx</span><span class="p">,</span><span class="n">vy</span> <span class="o">=</span> <span class="p">[</span><span class="n">cdms</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="p">]</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">MV</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">vy</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">]</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span><span class="s1">&#39;units&#39;</span><span class="p">):</span>
                <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">vv</span><span class="o">.</span><span class="n">units</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span><span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
                <span class="n">ln</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
        <span class="n">ln</span>  <span class="o">=</span> <span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ln</span> <span class="o">=</span> <span class="s1">&#39;Modulus&#39;</span>
        <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="n">ln</span>
        <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setAxisList</span><span class="p">(</span><span class="nb">vars</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">getAxisList</span><span class="p">())</span>
        <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setGrid</span><span class="p">(</span><span class="nb">vars</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">getGrid</span><span class="p">())</span>
        <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;modulus&#39;</span>

<span class="c1"># Loop on all set</span>
    <span class="k">for</span> <span class="n">ivar</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">vars</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">var</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rank</span><span class="p">,</span> <span class="s1">&#39;Your variable must have a rank &gt; </span><span class="si">%i</span><span class="s1"> (current rank is </span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rank</span><span class="p">,</span><span class="n">var</span><span class="o">.</span><span class="n">rank</span><span class="p">())</span>
        <span class="n">check_axes</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Reorder axes</span>
        <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="p">;</span> <span class="n">clone</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">rank</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">))</span><span class="o">+</span><span class="n">order</span><span class="p">)[</span><span class="o">-</span><span class="n">rank</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">var_order</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getOrder</span><span class="p">()</span>
            <span class="c1"># Order requested axes if found</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">order</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">var_order</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span> <span class="ow">and</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">var_order</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># Move bad axes to front</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s1">&#39;xyzt&#39;</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getOrder</span><span class="p">()[</span><span class="o">-</span><span class="n">rank</span><span class="p">:]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">order</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="n">rank</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span> <span class="ow">and</span> <span class="n">order</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">-</span><span class="n">rank</span><span class="o">-</span><span class="n">order</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)):</span>
                        <span class="nb">print</span> <span class="s1">&#39;It seems that axis #</span><span class="si">%i</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) of var should not be there and cannot be moved&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Reduce rank</span>
        <span class="k">while</span> <span class="n">var</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rank</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">clone</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="p">;</span> <span class="n">clone</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Put variable on new axes if requested</span>
        <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="s1">&#39;Length of new xaxis (</span><span class="si">%i</span><span class="s1">) is different from length of var (</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xaxis</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">([]):</span> <span class="n">xaxis</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span><span class="n">copy</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span><span class="n">AbstractAxis</span><span class="p">):</span>
                <span class="n">tmpaxis</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
                <span class="n">tmpaxis</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">xaxis</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">clone</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="p">;</span> <span class="n">clone</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">var</span><span class="o">.</span><span class="n">setAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">xaxis</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">clone</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="p">;</span> <span class="n">clone</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">var2d</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">,</span><span class="n">xatts</span><span class="o">=</span><span class="n">xatts</span><span class="p">,</span><span class="n">yatts</span><span class="o">=</span><span class="n">yatts</span><span class="p">)</span>
        <span class="nb">vars</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>

    <span class="c1"># Set to local time</span>
    <span class="k">if</span> <span class="n">tlocal</span> <span class="ow">and</span> <span class="n">tadd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tadd</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">time</span><span class="o">.</span><span class="n">altzone</span><span class="p">,</span><span class="s1">&#39;seconds&#39;</span><span class="p">)</span>

    <span class="c1"># Add time</span>
    <span class="k">if</span> <span class="n">tadd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">taxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
            <span class="n">tpos</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getOrder</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tpos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">taxis</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">taxis</span> <span class="ow">in</span> <span class="n">taxes</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># Already treated</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tadd</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">mytaxis</span> <span class="o">=</span> <span class="n">axis_add</span><span class="p">(</span><span class="n">taxis</span><span class="p">,</span><span class="n">tadd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tadd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">copy</span><span class="o">=</span><span class="n">tadd_copy</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mytaxis</span> <span class="o">=</span> <span class="n">axis_add</span><span class="p">(</span><span class="n">taxis</span><span class="p">,</span><span class="n">tadd</span><span class="p">,</span><span class="n">copy</span><span class="o">=</span><span class="n">tadd_copy</span><span class="p">)</span>
                <span class="n">taxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tadd_copy</span><span class="p">:</span> <span class="c1"># A copy is safer</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">setAxis</span><span class="p">(</span><span class="n">tpos</span><span class="p">,</span><span class="n">mytaxis</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>



<span class="k">def</span> <span class="nf">_start_plot_</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">subplot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">subplots_adjust</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">bgcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">noframe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fullscreen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Misc settings:</span>

<span class="sd">    - *figure*: Figure number.</span>
<span class="sd">    - *figsize*: Initialize the figure with this size.</span>
<span class="sd">    - *subplots_adjust*: Dictionary sent to :func:`~matplotlib.pyplot.subplots_adjust`. You can also use keyparams &#39;left&#39;, &#39;right&#39;, &#39;top&#39;, &#39;bottom&#39;, &#39;wspace&#39;, &#39;hspace&#39; !</span>
<span class="sd">    - *sa*: Alias for subplots_adjust.</span>
<span class="sd">    - *bgcolor*: Background axis color.</span>
<span class="sd">    - *axes_rect*: [left, bottom, width, height] in normalized (0,1) units to create axes using :func:`~matplotlib.pyplot.axes`.</span>
<span class="sd">    - *axes_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`~matplotlib.pyplot.axes`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subplots_adjust</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="n">subplots_adjust</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">adj</span> <span class="ow">in</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;wspace&#39;</span><span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">adj</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subplots_adjust</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">subplots_adjust</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">subplots_adjust</span><span class="p">[</span><span class="n">adj</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">adj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fullscreen</span><span class="p">:</span>
        <span class="n">noframe</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">subplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">subplots_adjust</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">default_axes_rect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">default_axes_rect</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">axes_rect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axes_rect&#39;</span><span class="p">,</span> <span class="n">default_axes_rect</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axes_rect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axes_rect</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes_rect</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes_rect</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">noframe</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figure_frameon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;axes_frameon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Figure size</span>
    <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize</span><span class="p">,</span><span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;figure&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">figure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;figure&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">noframe</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Axes</span>
    <span class="n">kwaxes</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;axes&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">subplot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subplot</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="o">*</span><span class="n">subplot</span><span class="p">,</span><span class="o">**</span><span class="n">kwaxes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">subplot</span><span class="p">,</span><span class="o">**</span><span class="n">kwaxes</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">axes_rect</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="o">*</span><span class="n">axes_rect</span><span class="p">,</span><span class="o">**</span><span class="n">kwaxes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">subplots_adjust</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="o">**</span><span class="n">subplots_adjust</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">noframe</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Axis background color</span>
    <span class="k">if</span> <span class="n">bgcolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_axis_bgcolor</span><span class="p">(</span><span class="n">bgcolor</span><span class="p">)</span>





<div class="viewcode-block" id="colorbar"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.colorbar">[docs]</a><span class="k">def</span> <span class="nf">colorbar</span><span class="p">(</span><span class="n">pp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drawedges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_horizontal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">standalone</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="s1">&#39;neither&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Colorbar:</span>

<span class="sd">    - *colorbar*: Plot the colorbar [default: True]</span>
<span class="sd">    - *colorbar_horizontal*: Colorbar is horizontal [defaults: False]</span>
<span class="sd">    - *colorbar_position*: To change the default position. Position is relative to the SPACE LEFT in the form (center,width) with values in [0,1] [defaults: False]</span>
<span class="sd">    - *colorbar_visible*: Colorbar is visible [defaults: True]</span>
<span class="sd">    - *colorbar_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`~matplotlib.pyplot.colorbar`</span>
<span class="sd">    - *units*: Indicate these units on along the colorbar, else it guessed from the variable or suppressed if value is False [default: None]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">colorbar</span><span class="p">:</span>

        <span class="c1"># Orientation</span>
        <span class="k">if</span> <span class="n">colorbar_horizontal</span><span class="p">:</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="s1">&#39;yx&#39;</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">colorbar_horizontal</span><span class="p">)]</span>
        <span class="c1"># Force the position</span>
        <span class="n">gca</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar_axes&#39;</span><span class="p">,</span> <span class="n">cax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">standalone</span><span class="p">:</span> <span class="n">gca</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">colorbar_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colorbar_position</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;auto&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">colorbar_horizontal</span><span class="p">:</span>
                    <span class="n">colorbar_position</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">colorbar_position</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colorbar_position</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">colorbar_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">colorbar_position</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">original</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cb_start</span> <span class="o">=</span> <span class="n">colorbar_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">colorbar_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colorbar_horizontal</span><span class="p">:</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cb_start</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">colorbar_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bbox_start</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox_start</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">bbox_start</span><span class="p">)</span><span class="o">*</span><span class="n">cb_start</span><span class="p">,</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">bbox_start</span><span class="p">)</span><span class="o">*</span><span class="n">colorbar_position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">standalone</span><span class="p">:</span> <span class="n">gca</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>

        <span class="c1"># Plot itself</span>
        <span class="n">kwaxis</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;colorbar_&#39;</span><span class="o">+</span><span class="n">xy</span><span class="p">)</span>
        <span class="n">kwlabel</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;colorbar_label&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;colorbar_extend&#39;</span><span class="p">,</span> <span class="n">extend</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">cax</span><span class="p">,</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">levels</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">gca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">gobjs</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">gca</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">tick1On</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tick2On</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Decorations</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="nb">vars</span> <span class="o">=</span> <span class="p">(</span><span class="nb">vars</span><span class="p">,)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
<span class="c1">#           func = getattr(cb.ax,&#39;set_%slabel&#39;%xy)</span>
            <span class="k">if</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">None</span><span class="p">]:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="o">**</span><span class="n">kwlabel</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">cdms</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">):</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="o">**</span><span class="n">kwlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isaxis</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">istime</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;cb.ax.set_</span><span class="si">%s</span><span class="s1">lim&#39;</span><span class="o">%</span><span class="n">xy</span><span class="p">)(</span><span class="n">minmax</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;cb.ax.dataLim.interval</span><span class="si">%s</span><span class="s1">().set_bounds&#39;</span><span class="o">%</span><span class="n">xy</span><span class="p">)(</span><span class="o">*</span><span class="n">minmax</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="n">decorate_axis</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">vertical</span><span class="o">=</span><span class="ow">not</span> <span class="n">colorbar_horizontal</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="o">**</span><span class="n">kwaxis</span><span class="p">)</span>
        <span class="c1"># Hide it?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">colorbar_visible</span><span class="p">:</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">gca</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cb</span></div>

<span class="n">_colorbar_</span> <span class="o">=</span> <span class="n">colorbar</span>

<span class="k">def</span> <span class="nf">colorbar_new</span><span class="p">(</span><span class="n">sm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drawedges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">standalone</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;neither&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a colorbar as :func:`~matplotlib.pyplot.colorbar` with some advanced features</span>

<span class="sd">    - *horizontal*: Colorbar is horizontal [defaults: False]</span>
<span class="sd">    - *position*: To change the default position. Position is relative to the SPACE LEFT in the form (center,width) with values in [0,1] [defaults: False]</span>
<span class="sd">    - *visible*: Colorbar is visible [defaults: True]</span>
<span class="sd">    - *units*: Indicate these units on along the colorbar, else it guessed from the variable or suppressed if value is False [default: None]</span>
<span class="sd">    - Other key are passed to :func:`~matplotlib.pyplot.colorbar`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span> <span class="k">return</span>

    <span class="c1"># Keywords</span>
    <span class="n">kwcb</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">))</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwcb</span><span class="p">)</span>

    <span class="c1"># Standalone</span>


    <span class="c1"># Orientation</span>
    <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="s1">&#39;yx&#39;</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">horizontal</span><span class="p">)]</span>

    <span class="c1"># Force the position</span>
    <span class="n">gca</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">cax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">standalone</span><span class="p">:</span> <span class="n">gca</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">position</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;auto&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="mf">0.3</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">original</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cb_start</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cb_start</span><span class="p">,</span>
                <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bbox_start</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox_start</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">bbox_start</span><span class="p">)</span><span class="o">*</span><span class="n">cb_start</span><span class="p">,</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">bbox_start</span><span class="p">)</span><span class="o">*</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">standalone</span><span class="p">:</span> <span class="n">gca</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>

    <span class="c1"># Plot itself</span>
    <span class="n">kwaxis</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">xy</span><span class="p">)</span>
    <span class="n">kwlabel</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">cax</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="n">extend</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">gobjs</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">gca</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">tick1On</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tick2On</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Decorations</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="nb">vars</span> <span class="o">=</span> <span class="p">(</span><span class="nb">vars</span><span class="p">,)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
<span class="c1">#           func = getattr(cb.ax,&#39;set_%slabel&#39;%xy)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">None</span><span class="p">]:</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="o">**</span><span class="n">kwlabel</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">cdms</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">):</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="o">**</span><span class="n">kwlabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isaxis</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">istime</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;cb.ax.set_</span><span class="si">%s</span><span class="s1">lim&#39;</span><span class="o">%</span><span class="n">xy</span><span class="p">)(</span><span class="n">minmax</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;cb.ax.dataLim.interval</span><span class="si">%s</span><span class="s1">().set_bounds&#39;</span><span class="o">%</span><span class="n">xy</span><span class="p">)(</span><span class="o">*</span><span class="n">minmax</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="n">decorate_axis</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">vertical</span><span class="o">=</span><span class="ow">not</span> <span class="n">horizontal</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="o">**</span><span class="n">kwaxis</span><span class="p">)</span>

    <span class="c1"># Hide it?</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">visible</span><span class="p">:</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">gca</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cb</span>



<span class="k">def</span> <span class="nf">_levels_</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">anomaly</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">nmax</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data levels:</span>

<span class="sd">    - *levels*: Force the use of these levels for contours.</span>
<span class="sd">    - *anomaly*: Levels must be symetric about zero (useful for anomly plots) and color map is misc.plot.cmap_bwre() [default: None]. If None, is is turned to True if max is near -min (20%)</span>
<span class="sd">    - *nmax*: Max number of levels (see misc.auto_scale) [default: 10]</span>
<span class="sd">    - *vmin*: Force min value for pcolor.</span>
<span class="sd">    - *vmax*: Force max value for pcolor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_value&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_value&#39;</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">anomaly</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mm</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="n">anomaly</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">((</span><span class="n">mm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">mm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">mm</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span> <span class="o">&lt;</span> <span class="o">.</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">anomaly</span><span class="p">:</span>
                <span class="n">mm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">minmax</span><span class="p">(</span><span class="n">var</span><span class="p">)))</span>
                <span class="n">levels</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">([</span><span class="o">-</span><span class="n">mm</span><span class="p">,</span><span class="n">mm</span><span class="p">],</span><span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">levels</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">)</span>
<span class="c1">#    if vmin is None:</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#    if vmax is None:</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">gobjs</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">levels</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">anomaly</span>

<span class="c1">#def _latlab_(deg):</span>
<span class="c1">#   return latlab(deg,decimal=False,no_seconds=True,no_zeros=True, )</span>
<span class="c1">#</span>
<span class="c1">#def _lonlab_(deg):</span>
<span class="c1">#   return lonlab(deg,decimal=False,no_seconds=True,no_zeros=True)</span>

<div class="viewcode-block" id="decorate_axis"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.decorate_axis">[docs]</a><span class="k">def</span> <span class="nf">decorate_axis</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">vertical</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">date_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_locator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_minor_locator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_nominor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">nodate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Axis decoration:</span>

<span class="sd">    - *[x/y]title*: Main label of the axis.</span>
<span class="sd">    - *[x/y]label*: Same as x/ytitle.</span>
<span class="sd">    - *[x/y]hide]*: Hide x/ytick labels.</span>
<span class="sd">    - *[x/y]rotation*: Rotation of x/ytick labels (except for time).</span>
<span class="sd">    - *[x/y]strict*: Strict axis limit.</span>
<span class="sd">    - *[x/y]lim*: Override axis limit.</span>
<span class="sd">    - *[x/y]min/max*: Override axis limit by x/ylim.</span>
<span class="sd">    - *[x/y]minmax/maxmin*: Set maximal value of x/ymin and minimal value or x/ymax.</span>
<span class="sd">    - *[x/y]nmax*: Max number of ticks.</span>
<span class="sd">    - *x/yfmt*: Numeric format for x/y axis if not of time type.</span>
<span class="sd">    - *date_rotation*: Rotation of time ticklabels.</span>
<span class="sd">    - *date_locator*: Major locator for dates.</span>
<span class="sd">    - *date_minor_locator*: Minor locator for dates.</span>
<span class="sd">    - *date_nominor*: Suppress minor ticks for dates.</span>
<span class="sd">    - *date_nmax_ticks*: Max number of ticks for dates</span>
<span class="sd">    - *nodate*: Time axis must not be formatted as a time axis [default: False]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Current axes</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gca</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gca</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Keywords</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">vatts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;minmax&#39;</span><span class="p">,</span> <span class="s1">&#39;maxmin&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">]</span>
    <span class="n">aatts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;fmt&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;tickfmt&#39;</span><span class="p">,</span> <span class="s1">&#39;tickformat&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;rotation&#39;</span><span class="p">,</span> <span class="s1">&#39;rotate&#39;</span><span class="p">),</span>
        <span class="s1">&#39;lim&#39;</span><span class="p">,</span> <span class="s1">&#39;hide&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;locator&#39;</span><span class="p">,</span> <span class="s1">&#39;minor_locator&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;nmax&#39;</span><span class="p">,</span> <span class="s1">&#39;nmax_ticks&#39;</span><span class="p">)]</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span><span class="c1">#strict=True)</span>
    <span class="k">for</span> <span class="n">raw_att</span> <span class="ow">in</span> <span class="n">aatts</span><span class="o">+</span><span class="n">vatts</span><span class="p">:</span>

        <span class="c1"># Merge aliases</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_att</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">dict_aliases</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">raw_att</span><span class="p">)</span>
            <span class="n">att</span> <span class="o">=</span> <span class="n">raw_att</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">att</span> <span class="o">=</span> <span class="n">raw_att</span>
            <span class="n">raw_att</span> <span class="o">=</span> <span class="n">raw_att</span><span class="p">,</span>

        <span class="c1"># Default values</span>
        <span class="c1"># - base</span>
        <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># - get it from cdms variable</span>
        <span class="k">if</span> <span class="n">cdms</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="ow">and</span> <span class="n">raw_att</span> <span class="ow">in</span> <span class="n">vatts</span><span class="p">:</span>
            <span class="n">kwvar</span> <span class="o">=</span> <span class="n">dict_aliases</span><span class="p">(</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">raw_att</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">att</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kwvar</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">att</span><span class="p">):</span>
                <span class="n">default</span> <span class="o">=</span> <span class="n">kwvar</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
        <span class="c1"># - special</span>
        <span class="k">if</span> <span class="n">defaults</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">att</span><span class="p">):</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>

        <span class="c1"># Get attribute</span>
        <span class="n">props</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
    <span class="n">props</span><span class="p">[</span><span class="s1">&#39;label_kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;label_&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">props</span><span class="p">[</span><span class="s1">&#39;label_kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;title_&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># X or Y axis?</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis_type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="s1">&#39;xy&#39;</span><span class="p">[</span><span class="n">vertical</span><span class="p">]</span>

    <span class="c1"># Functions</span>
    <span class="n">exec</span> <span class="s2">&quot;tick_func = P.</span><span class="si">%(xy)s</span><span class="s2">ticks ; label_func = P.</span><span class="si">%(xy)s</span><span class="s2">label ; date_func = </span><span class="si">%(xy)s</span><span class="s2">date ; keyaxis = &#39;</span><span class="si">%(xy)s</span><span class="s2">axis&#39; ; lim_func = P.</span><span class="si">%(xy)s</span><span class="s2">lim&quot;</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>
    <span class="n">funcs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Limits</span>
    <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">axis</span>
    <span class="n">axmin</span><span class="p">,</span> <span class="n">axmax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">]:</span>
        <span class="n">axmin</span><span class="p">,</span> <span class="n">axmax</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">],</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">xy</span><span class="o">+</span><span class="s1">&#39;min&#39;</span><span class="p">):</span>
                <span class="n">axmin</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="n">xy</span><span class="o">+</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">):</span>
                <span class="n">axmin</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">xy</span><span class="o">+</span><span class="s1">&#39;max&#39;</span><span class="p">):</span>
                <span class="n">axmax</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="n">xy</span><span class="o">+</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">):</span>
                <span class="n">axmax</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axmin</span><span class="p">,</span> <span class="n">axmax</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">axmin</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">axmax</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;minmax&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">axmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">axmin</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;minmax&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;maxmin&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">axmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axmax</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;maxmin&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">axmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lim_func</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">xy</span><span class="o">+</span><span class="s1">&#39;min&#39;</span><span class="p">:</span><span class="n">axmin</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">axmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lim_func</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">xy</span><span class="o">+</span><span class="s1">&#39;max&#39;</span><span class="p">:</span><span class="n">axmax</span><span class="p">})</span>
    <span class="c1">#axis_save = P.axis()</span>

    <span class="c1"># Ticks</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]:</span> <span class="c1"># Lon, lat or dep axis</span>

        <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">]:</span>
            <span class="n">lab_val</span> <span class="o">=</span> <span class="n">geo_scale</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">nmax</span><span class="o">=</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;nmax&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
                <span class="n">lab_func</span> <span class="o">=</span> <span class="n">lonlab</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lab_func</span> <span class="o">=</span> <span class="n">latlab</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lab_val</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">lab_func</span> <span class="o">=</span> <span class="n">deplab</span>
        <span class="n">kwtf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;fmt&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">kwtf</span><span class="p">[</span><span class="s1">&#39;fmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;fmt&#39;</span><span class="p">]</span>
        <span class="n">tick_func</span><span class="p">(</span><span class="n">lab_val</span><span class="p">,</span><span class="n">lab_func</span><span class="p">(</span><span class="n">lab_val</span><span class="p">,</span><span class="o">**</span><span class="n">kwtf</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nodate</span><span class="p">:</span> <span class="c1"># Time axis</span>

        <span class="k">if</span> <span class="n">date_fmt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="s1">&#39;units&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="c1"># Detect climatological plot -&gt; adapt date format</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nmonth</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">axis</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;months&#39;</span><span class="p">):</span>
                <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;months &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">subAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">))</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">(</span><span class="n">cdtime</span><span class="o">.</span><span class="n">DefaultCalendar</span><span class="p">)</span>
                <span class="n">nmonth</span> <span class="o">=</span> <span class="n">ct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">ct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nmonth</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">nmonth</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;DETECTED PLOT OF CLIMATOLOGY&quot;</span>
                <span class="k">if</span> <span class="n">date_rotation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">date_rotation</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">if</span> <span class="n">date_fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">date_fmt</span> <span class="o">=</span> <span class="s1">&#39;%b&#39;</span>
                <span class="k">if</span> <span class="n">date_locator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">date_locator</span> <span class="o">=</span> <span class="n">MonthLocator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">date_minor_locator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">date_minor_locator</span> <span class="o">=</span> <span class="n">MonthLocator</span><span class="p">(</span><span class="n">bymonthday</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="c1"># Rotate dates</span>
        <span class="k">if</span> <span class="n">date_rotation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vertical</span><span class="p">:</span>
                <span class="n">date_rotation</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">date_rotation</span> <span class="o">=</span> <span class="mf">30.</span>
        <span class="c1"># Ok let&#39;s format</span>
        <span class="n">trange</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kwdate</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">kwdate</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;nmax_ticks&#39;</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;nmax&#39;</span><span class="p">])</span>
        <span class="n">kwdate</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">axmin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">axmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">date_func</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">date_rotation</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">date_fmt</span><span class="p">,</span><span class="n">locator</span><span class="o">=</span><span class="n">date_locator</span><span class="p">,</span>
            <span class="n">minor_locator</span><span class="o">=</span><span class="n">date_minor_locator</span><span class="p">,</span><span class="n">nominor</span><span class="o">=</span><span class="n">date_nominor</span><span class="p">,</span><span class="n">trange</span><span class="o">=</span><span class="n">trange</span><span class="p">,</span>
            <span class="n">nospecial</span><span class="o">=</span><span class="n">date_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwdate</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;fmt&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Other axes</span>
        <span class="c1"># Numeric format</span>
            <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;P.gca().get_</span><span class="si">%s</span><span class="s1">axis()&#39;</span><span class="o">%</span><span class="n">xy</span><span class="p">)</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;fmt&#39;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;locator&#39;</span><span class="p">]:</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;P.gca().get_</span><span class="si">%s</span><span class="s1">axis()&#39;</span><span class="o">%</span><span class="n">xy</span><span class="p">)</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;locator&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;minor_locator&#39;</span><span class="p">]:</span>
        <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;P.gca().get_</span><span class="si">%s</span><span class="s1">axis()&#39;</span><span class="o">%</span><span class="n">xy</span><span class="p">)</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;minor_locator&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">nodate</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rotate_tick_labels</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">],</span><span class="n">vertical</span><span class="o">=</span><span class="n">vertical</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nodate</span><span class="p">:</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>

    <span class="c1"># Hiding</span>
    <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;hide&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">]</span> <span class="ow">and</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;hide&#39;</span><span class="p">]:</span>
        <span class="n">exec</span> <span class="n">xy</span><span class="o">+</span><span class="s1">&#39;hide()&#39;</span>

    <span class="c1"># Label</span>
    <span class="k">elif</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
            <span class="n">label_func</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;label_kwargs&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]:</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="s1">&#39;long_name&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="s1">&#39;units&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">ll</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cdms</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
                <span class="n">slabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">))</span> <span class="ow">and</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;None&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slabel</span><span class="p">):</span>
                    <span class="n">slabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]&#39;</span><span class="o">%</span><span class="n">units</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">slabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">slabel</span><span class="p">:</span>
                <span class="n">label_func</span><span class="p">(</span><span class="n">slabel</span><span class="p">,</span> <span class="o">**</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;label_kwargs&#39;</span><span class="p">])</span>


    <span class="k">if</span> <span class="n">axmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lim_func</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">xy</span><span class="o">+</span><span class="s1">&#39;min&#39;</span><span class="p">:</span><span class="n">axmin</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">axmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lim_func</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">xy</span><span class="o">+</span><span class="s1">&#39;max&#39;</span><span class="p">:</span><span class="n">axmax</span><span class="p">})</span>
    <span class="c1">#P.axis(axis_save)</span>
    <span class="k">if</span> <span class="n">gca</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">gca</span><span class="p">)</span></div>


<span class="c1">#def _strict_lims_(xaxis=None,yaxis=None):</span>
<span class="c1">#   if xaxis is not None:</span>
<span class="c1">#       P.xlim(minmax(xaxis))</span>
<span class="c1">#   if yaxis is not None:</span>
<span class="c1">#       P.ylim(minmax(yaxis))</span>


<span class="k">def</span> <span class="nf">_end_plot_</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figtext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">savefig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">logo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fullscreen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">autoresize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dayhl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - *title*: Title of the figure [defaults to var.long_name or &#39;&#39;]</span>
<span class="sd">    - *grid*: Plot the grid [default: True]</span>
<span class="sd">    - *dayhl*: Add day highlithing [default: False]</span>
<span class="sd">    - *figtext*: figtext Add text at a specified position on the figure. Example: figtext=[0,0,&#39;text&#39;] add a &#39;text&#39; at the lower left corner, or simply figtext=&#39;text&#39;.</span>
<span class="sd">    - *anchor*: Anchor of the axes (useful when resizing) in [&#39;C&#39;, &#39;SW&#39;, &#39;S&#39;, &#39;SE&#39;, &#39;E&#39;, &#39;NE&#39;, &#39;N&#39;, &#39;NW&#39;, &#39;W&#39;].</span>
<span class="sd">    - *logo*: Add a logo to the figure [default: False]. logo can be a file name.</span>
<span class="sd">    - *show*: Display the figure [default: True]</span>
<span class="sd">    - *savefig*: Save the figure to this file.</span>
<span class="sd">    - *savefigs*: Save the figure into multiple formats using :func:`savefigs` and &#39;savefigs&#39; as the prefix to the files.</span>
<span class="sd">    - *autoresize*: Auto resize the figure according axes (1 or True), axes+margins (2). If 0 or False, not resized [default: False=2].</span>
<span class="sd">    - *key*: Add a key (like &#39;a)&#39;) to the axes using add_key is different from None [default: None]</span>
<span class="sd">    - *close*: Close the figure at the end [default: False]</span>
<span class="sd">    - *title_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`~matplotlib.pyplot.title`</span>
<span class="sd">    - *key_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`add_key`</span>
<span class="sd">    - *logo_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`add_logo`</span>
<span class="sd">    - *figtext_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`~matplotlib.pyplot.figtext`</span>
<span class="sd">    - *savefig_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`~matplotlib.pyplot.savefig`</span>
<span class="sd">    - *savefigs_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`savefigs`</span>
<span class="sd">    - *grid_&lt;keyword&gt;*: &lt;keyword&gt; is passed to :func:`~matplotlib.pyplot.grid`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Overlay case</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">autoresize</span> <span class="ow">and</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_aspect</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;auto&#39;</span> <span class="ow">and</span> \
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Subplot</span><span class="p">)</span> <span class="ow">and</span> \
        <span class="n">ax</span><span class="o">.</span><span class="n">is_first_col</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ax</span><span class="o">.</span><span class="n">is_first_row</span><span class="p">()</span> <span class="ow">and</span> \
        <span class="n">ax</span><span class="o">.</span><span class="n">is_last_col</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ax</span><span class="o">.</span><span class="n">is_last_row</span><span class="p">():</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_aspect</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">==</span><span class="s1">&#39;equal&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">=</span><span class="mf">1.</span>
        <span class="n">r</span> <span class="o">*=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_data_ratio</span><span class="p">()</span>
<span class="c1">#       rect = P.gca().get_position(True)</span>
<span class="c1">#       if autoresize == 2: r *= rect.width/rect.height</span>
        <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">h</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">r</span><span class="p">)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">W</span>
        <span class="n">P</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">W</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">anchor</span><span class="o">=</span><span class="s1">&#39;C&#39;</span>
    <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_anchor</span><span class="p">(</span><span class="n">anchor</span><span class="p">)</span>

    <span class="c1"># Grid</span>
    <span class="n">gobjs</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;grid&#39;</span><span class="p">)))</span>

    <span class="c1"># Highlight days</span>
    <span class="k">if</span> <span class="n">dayhl</span><span class="p">:</span>
        <span class="n">gobjs</span><span class="p">(</span><span class="n">hldays</span><span class="o">=</span><span class="n">hldays</span><span class="p">(</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;dayhl&#39;</span><span class="p">)))</span>

    <span class="c1"># Title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">None</span><span class="p">]:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
                <span class="n">gobjs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">)))</span>

    <span class="c1"># Fig text</span>
    <span class="k">if</span> <span class="n">figtext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">figtext</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
            <span class="n">figtext</span> <span class="o">=</span> <span class="p">(</span><span class="n">figtext</span><span class="p">,)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">figtext</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">figtext</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">figtext</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">gobjs</span><span class="p">(</span><span class="n">figtext</span><span class="o">=</span><span class="n">P</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="o">*</span><span class="n">figtext</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;figtext&#39;</span><span class="p">,</span><span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;#888888&#39;</span><span class="p">})))</span>

    <span class="c1"># Key of axes</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gobjs</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">add_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">)))</span>

    <span class="c1"># Logo</span>
    <span class="k">if</span> <span class="n">logo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">kwlogo</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;logo&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logo</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">kwlogo</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logo</span>
        <span class="n">gobjs</span><span class="p">(</span><span class="n">logo</span><span class="o">=</span><span class="n">add_logo</span><span class="p">(</span><span class="o">**</span><span class="n">kwlogo</span><span class="p">))</span>

    <span class="c1"># Save it</span>
    <span class="n">backend</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">suff_standalone</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ps&#39;</span><span class="p">,</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span><span class="s1">&#39;svg&#39;</span><span class="p">]</span>
        <span class="n">suff_others</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="s1">&#39;gif&#39;</span><span class="p">,</span><span class="s1">&#39;jpg&#39;</span><span class="p">,</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="s1">&#39;bmp&#39;</span><span class="p">]</span>
        <span class="n">suff</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">savefig</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">suff</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">suff_others</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">backend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">suff_standalone</span><span class="p">:</span>
                <span class="n">savefig</span> <span class="o">+=</span> <span class="s1">&#39;.png&#39;</span>
            <span class="k">elif</span> <span class="n">backend</span> <span class="ow">in</span> <span class="n">suff_standalone</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">suff</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endwith</span><span class="p">(</span><span class="n">backend</span><span class="p">):</span>
                <span class="n">savefig</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">backend</span>
        <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefig</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;savefig&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;savefigs&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;savefigs&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">savefigs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;savefigs&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;savefigs_&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;savefigs&#39;</span><span class="p">]</span>

    <span class="c1"># Show or close</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">viewers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;pdf&#39;</span><span class="p">:[</span><span class="s1">&#39;/usr/bin/kghostview&#39;</span><span class="p">,</span><span class="s1">&#39;/usr/bin/evince&#39;</span><span class="p">,</span><span class="s1">&#39;/usr/bin/xpdf&#39;</span><span class="p">,</span><span class="s1">&#39;/usr/local/bin/acroread&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ps&#39;</span><span class="p">:[</span><span class="s1">&#39;/usr/bin/kghostview&#39;</span><span class="p">,</span><span class="s1">&#39;/usr/bin/evince&#39;</span><span class="p">,</span><span class="s1">&#39;/usr/bin/ghostview&#39;</span><span class="p">],</span>
            <span class="s1">&#39;svg&#39;</span><span class="p">:[</span><span class="s1">&#39;/usr/bin/svgdisplay&#39;</span><span class="p">,</span><span class="s1">&#39;/usr/bin/konqueror&#39;</span><span class="p">]}</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">in</span> <span class="n">viewers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tmpfig</span> <span class="o">=</span> <span class="n">mktemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">backend</span><span class="p">)</span>
                <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">tmpfig</span><span class="p">,</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="s1">&#39;savefig&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmpfig</span> <span class="o">=</span> <span class="n">savefig</span>
            <span class="k">for</span> <span class="n">viewer</span> <span class="ow">in</span> <span class="n">viewers</span><span class="p">[</span><span class="n">backend</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">viewer</span><span class="p">):</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">viewer</span><span class="p">,</span><span class="n">tmpfig</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="nb">print</span> <span class="s1">&#39;Unable to view file with command:&#39;</span><span class="p">,</span><span class="n">cmd</span>
                    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmpfig</span><span class="p">)</span>
                    <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">close</span><span class="p">:</span><span class="c1">#savefig is not None and kwargs.has_key(&#39;savefigs&#39;) and close:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>



<span class="k">class</span> <span class="nc">CachedBasemap</span><span class="p">(</span><span class="n">Basemap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">get_home</span>
        <span class="n">cache_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cache_dir&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_home</span><span class="p">(),</span> <span class="s1">&#39;basemap&#39;</span><span class="p">,</span> <span class="s1">&#39;cached_maps&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span>


<span class="c1">########</span>
<span class="c1"># Docs #</span>
<span class="c1">########</span>

<span class="k">def</span> <span class="nf">_fill_doc_</span><span class="p">(</span><span class="o">*</span><span class="n">funcs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Template</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">):</span>
            <span class="n">func_name</span> <span class="o">=</span> <span class="n">mm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">func_doc</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">func_name</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\t\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span><span class="n">func_doc</span><span class="p">})</span>

<span class="n">_fill_doc_</span><span class="p">(</span><span class="n">xdate</span><span class="p">,</span> <span class="n">ydate</span><span class="p">,</span> <span class="n">taylor</span><span class="p">,</span> <span class="n">dtaylor</span><span class="p">)</span>



<div class="viewcode-block" id="curve2"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.curve2">[docs]</a><span class="nd">@docfill</span>
<span class="k">def</span> <span class="nf">curve2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;curve2(data, parg=None, axis=None, title=None, savefig=None, show=True, **kwargs)</span>

<span class="sd">    Plot 1D data as a curve and return a :class:`~vacumm.misc.core_plot.Curve` object</span>
<span class="sd">    with properties also from :class:`~vacumm.misc.core_plot.Plot` and</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.Plot1D`.</span>


<span class="sd">    :Examples:</span>

<span class="sd">        &gt;&gt;&gt; curve2(sst, &#39;r-&#39;, shadow=True, ymax=25., long_name=&#39;SST&#39;, subplot=212)</span>

<span class="sd">        &gt;&gt;&gt; curve2(xe, label=&#39;Full signal&#39;, show=False)</span>
<span class="sd">        &gt;&gt;&gt; c = curve2(xef, label=&#39;Filtered signal&#39;, show=False)</span>
<span class="sd">        &gt;&gt;&gt; c.legend()</span>
<span class="sd">        &gt;&gt;&gt; c.savefig(&#39;xe.png&#39;)</span>


<span class="sd">    :Data params:</span>

<span class="sd">        {Curve_load_data[data]}</span>
<span class="sd">        {Plot1D__check_order_[vertical]}</span>
<span class="sd">        {Plot1D__set_axes_[axis]}</span>
<span class="sd">        {Plot[long_name]}</span>
<span class="sd">        {Plot[units]}</span>

<span class="sd">    :Curve params:</span>

<span class="sd">        {Curve_plot[parg]}</span>
<span class="sd">        {Curve_plot[nosingle]}</span>
<span class="sd">        {Curve_plot[err]}</span>
<span class="sd">        {Curve_plot[err_&lt;param&gt;]}</span>
<span class="sd">        {Curve_plot[fill_between]}</span>
<span class="sd">        {Curve_plot[fill_between_&lt;param&gt;]}</span>
<span class="sd">        {Curve_plot[label]}</span>
<span class="sd">        {Curve_plot[shadow]}</span>
<span class="sd">        {Curve_plot[shadow_&lt;param&gt;]}</span>

<span class="sd">    :Plot initialization:</span>

<span class="sd">        {Plot_pre_plot[fig]}</span>
<span class="sd">        {Plot_pre_plot[figsize]}</span>
<span class="sd">        {Plot_pre_plot[subplot]}</span>
<span class="sd">        {Plot_pre_plot[subplots_adjust]}</span>
<span class="sd">        {Plot_pre_plot[top/bottom/left/right/wspace/hspace]}</span>
<span class="sd">        {Plot_pre_plot[axes]}</span>
<span class="sd">        {Plot_pre_plot[axes_&lt;param&gt;]}</span>
<span class="sd">        {Plot_pre_plot[axes_rect]}</span>
<span class="sd">        {Plot_pre_plot[bgcolor]}</span>
<span class="sd">        {Plot_pre_plot[twin]}</span>
<span class="sd">        {Plot_pre_plot[noframe]}</span>
<span class="sd">        {Plot_pre_plot[fullscreen]}</span>

<span class="sd">    :Plot finalization:</span>

<span class="sd">        {Plot[title]}</span>
<span class="sd">        {Plot_post_plot[title_&lt;param&gt;]}</span>
<span class="sd">        {Plot[latex_units]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot_format_axes[x/y/vlim]}</span>
<span class="sd">        {Plot_format_axes[x/y/vminmax]}</span>
<span class="sd">        {Plot_format_axes[x/y/vmaxmin]}</span>
<span class="sd">        {Plot[x/ymasked]}</span>
<span class="sd">        {Plot[x/ylong_name]}</span>
<span class="sd">        {Plot[x/yunits]}</span>
<span class="sd">        {Plot[x/ylabel]}</span>
<span class="sd">        {Plot_format_axes[x/yticks]}</span>
<span class="sd">        {Plot_format_axes[x/yticklabels]}</span>
<span class="sd">        {Plot_format_axes[x/y/vskip]}</span>
<span class="sd">        {Plot_format_axes[x/yhide]}</span>
<span class="sd">        {Plot_post_plot[grid]}</span>
<span class="sd">        {Plot_post_plot[grid_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[figtext]}</span>
<span class="sd">        {Plot_post_plot[figtext_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[key]}</span>
<span class="sd">        {Plot_post_plot[key_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[anchor]}</span>
<span class="sd">        {Plot_post_plot[autoresize]}</span>
<span class="sd">        {Plot_post_plot[savefig]}</span>
<span class="sd">        {Plot_savefig[savefig_verbose]}</span>
<span class="sd">        {Plot_post_plot[savefig_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[savefigs]}</span>
<span class="sd">        {Plot_post_plot[savefigs_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[show]}</span>
<span class="sd">        {Plot_post_plot[close]}</span>

<span class="sd">    :Extra: A few matplotlib plot arguments can be passed (for exemple: ``linewidths``).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Curve</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;post_plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;parg&#39;</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;parg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">Curve</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="bar2"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.bar2">[docs]</a><span class="nd">@docfill</span>
<span class="k">def</span> <span class="nf">bar2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;bar2(data, width=1.,lag=0, align=&#39;center&#39;, offset=None, title=None, savefig=None, show=True, **kwargs)</span>

<span class="sd">    Plot data as a bar plot and return a :class:`~vacumm.misc.core_plot.Bar` object</span>
<span class="sd">    with properties also from :class:`~vacumm.misc.core_plot.Plot` and</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.Plot1D`.</span>

<span class="sd">    :Examples:</span>

<span class="sd">        &gt;&gt;&gt; bar2(rain, color=&#39;c&#39;, align=&#39;left&#39;, width=0.95, savefig=&#39;rain.png&#39;)</span>

<span class="sd">        &gt;&gt;&gt; bar2(rain, vminmax=5.,show=False)</span>
<span class="sd">        &gt;&gt;&gt; bar2(snow, offset=rain, title=&#39;Precipitations&#39;)</span>

<span class="sd">    :Data params:</span>

<span class="sd">        {Curve_load_data[data]}</span>
<span class="sd">        {Plot1D__check_order_[vertical]}</span>
<span class="sd">        {Plot1D__set_axes_[axis]}</span>
<span class="sd">        {Plot[long_name]}</span>
<span class="sd">        {Plot[units]}</span>

<span class="sd">    :Bar params:</span>

<span class="sd">        {Bar_plot[width]}</span>
<span class="sd">        {Bar_plot[lag]}</span>
<span class="sd">        {Bar_plot[align]}</span>
<span class="sd">        {Bar_plot[offset]}</span>
<span class="sd">        {Bar_plot[label]}</span>
<span class="sd">        {Bar_plot[shadow]}</span>
<span class="sd">        {Bar_plot[shadow_&lt;param&gt;]}</span>

<span class="sd">    :Plot initialization:</span>

<span class="sd">        {Plot_pre_plot[fig]}</span>
<span class="sd">        {Plot_pre_plot[figsize]}</span>
<span class="sd">        {Plot_pre_plot[subplot]}</span>
<span class="sd">        {Plot_pre_plot[subplots_adjust]}</span>
<span class="sd">        {Plot_pre_plot[top/bottom/left/right/wspace/hspace]}</span>
<span class="sd">        {Plot_pre_plot[axes]}</span>
<span class="sd">        {Plot_pre_plot[axes_&lt;param&gt;]}</span>
<span class="sd">        {Plot_pre_plot[axes_rect]}</span>
<span class="sd">        {Plot_pre_plot[bgcolor]}</span>
<span class="sd">        {Plot_pre_plot[twin]}</span>
<span class="sd">        {Plot_pre_plot[noframe]}</span>
<span class="sd">        {Plot_pre_plot[fullscreen]}</span>

<span class="sd">    :Plot finalization:</span>

<span class="sd">        {Plot[title]}</span>
<span class="sd">        {Plot_post_plot[title_&lt;param&gt;]}</span>
<span class="sd">        {Plot[latex_units]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot_format_axes[x/y/vlim]}</span>
<span class="sd">        {Plot_format_axes[x/y/vminmax]}</span>
<span class="sd">        {Plot_format_axes[x/y/vmaxmin]}</span>
<span class="sd">        {Plot[x/ymasked]}</span>
<span class="sd">        {Plot[x/ylong_name]}</span>
<span class="sd">        {Plot[x/yunits]}</span>
<span class="sd">        {Plot[x/ylabel]}</span>
<span class="sd">        {Plot_format_axes[x/yticks]}</span>
<span class="sd">        {Plot_format_axes[x/yticklabels]}</span>
<span class="sd">        {Plot_format_axes[x/y/vskip]}</span>
<span class="sd">        {Plot_format_axes[x/yhide]}</span>
<span class="sd">        {Plot_post_plot[grid]}</span>
<span class="sd">        {Plot_post_plot[grid_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[figtext]}</span>
<span class="sd">        {Plot_post_plot[figtext_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[key]}</span>
<span class="sd">        {Plot_post_plot[key_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[anchor]}</span>
<span class="sd">        {Plot_post_plot[autoresize]}</span>
<span class="sd">        {Plot_post_plot[savefig]}</span>
<span class="sd">        {Plot_savefig[savefig_verbose]}</span>
<span class="sd">        {Plot_post_plot[savefig_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[savefigs]}</span>
<span class="sd">        {Plot_post_plot[savefigs_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[show]}</span>
<span class="sd">        {Plot_post_plot[close]}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Bar</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;post_plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Bar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="stick2"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.stick2">[docs]</a><span class="nd">@docfill</span>
<span class="k">def</span> <span class="nf">stick2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;stick2(udata, vdata, polar=False, degrees=True, mod=False, pos=None, width=None, scale=None, color=&#39;k&#39;, line=True, levels=None, cmap=None, shadow=False, **kwargs)</span>

<span class="sd">    Plot data as a stick plot and return a :class:`~vacumm.misc.core_plot.Stick` object</span>
<span class="sd">    with properties also from :class:`~vacumm.misc.core_plot.Plot`,</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.Plot1D`, :class:`~vacumm.misc.core_plot.Curve`,</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.ScalarMappable` and</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.QuiverKey`.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; stick2(u, v, color=&#39;mod&#39;, vmax=10., quiver_scale=50., mod=True)</span>
<span class="sd">        &gt;&gt;&gt; stick2(r, a, polar=True, degrees=False, quiverkey_value=5)</span>

<span class="sd">    :Data params:</span>

<span class="sd">        {Stick_load_data[udata]}</span>
<span class="sd">        {Stick_load_data[vdata]}</span>
<span class="sd">        {Stick_load_data[polar]}</span>
<span class="sd">        {Stick_load_data[degrees]}</span>
<span class="sd">        {Plot1D__check_order_[vertical]}</span>
<span class="sd">        {Plot1D__set_axes_[axis]}</span>
<span class="sd">        {Plot[long_name]}</span>
<span class="sd">        {Plot[units]}</span>

<span class="sd">    :Stick params:</span>

<span class="sd">        {Stick_plot[pos]}</span>
<span class="sd">        {Stick_plot[mod]}</span>
<span class="sd">        {Stick_plot[mod_&lt;param&gt;]}</span>
<span class="sd">        {Stick_plot[line]}</span>
<span class="sd">        {Stick_plot[alpha]}</span>
<span class="sd">        {Stick_plot[headwidth]}</span>
<span class="sd">        {Stick_plot[headlength]}</span>
<span class="sd">        {Stick_plot[headaxislength]}</span>
<span class="sd">        {Stick_plot[minlength]}</span>
<span class="sd">        {Stick_plot[minshaft]}</span>
<span class="sd">        {Stick_plot[cmap]}</span>
<span class="sd">        {Stick_plot[cmap_&lt;param&gt;]}</span>
<span class="sd">        {Stick_plot[levels]}</span>
<span class="sd">        {Stick_plot[levels_&lt;param&gt;]}</span>
<span class="sd">        {Stick_plot[shadow]}</span>
<span class="sd">        {Stick_plot[shadow_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar_&lt;param&gt;]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_pos]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_text]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_value]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_units]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_latex_units]}</span>

<span class="sd">    :Plot initialization:</span>

<span class="sd">        {Plot_pre_plot[fig]}</span>
<span class="sd">        {Plot_pre_plot[figsize]}</span>
<span class="sd">        {Plot_pre_plot[subplot]}</span>
<span class="sd">        {Plot_pre_plot[subplots_adjust]}</span>
<span class="sd">        {Plot_pre_plot[top/bottom/left/right/wspace/hspace]}</span>
<span class="sd">        {Plot_pre_plot[axes]}</span>
<span class="sd">        {Plot_pre_plot[axes_&lt;param&gt;]}</span>
<span class="sd">        {Plot_pre_plot[axes_rect]}</span>
<span class="sd">        {Plot_pre_plot[bgcolor]}</span>
<span class="sd">        {Plot_pre_plot[twin]}</span>
<span class="sd">        {Plot_pre_plot[noframe]}</span>
<span class="sd">        {Plot_pre_plot[fullscreen]}</span>
<span class="sd">        {ScalarMappable_colorbar[cax]}</span>

<span class="sd">    :Plot finalization:</span>

<span class="sd">        {Plot[title]}</span>
<span class="sd">        {Plot_post_plot[title_&lt;param&gt;]}</span>
<span class="sd">        {Plot[latex_units]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot_format_axes[x/y/vlim]}</span>
<span class="sd">        {Plot_format_axes[x/y/vminmax]}</span>
<span class="sd">        {Plot_format_axes[x/y/vmaxmin]}</span>
<span class="sd">        {Plot[x/ymasked]}</span>
<span class="sd">        {Plot[x/ylong_name]}</span>
<span class="sd">        {Plot[x/yunits]}</span>
<span class="sd">        {Plot[x/ylabel]}</span>
<span class="sd">        {Plot_format_axes[x/yticks]}</span>
<span class="sd">        {Plot_format_axes[x/yticklabels]}</span>
<span class="sd">        {Plot_format_axes[x/y/vskip]}</span>
<span class="sd">        {Plot_format_axes[x/yhide]}</span>
<span class="sd">        {Plot_post_plot[grid]}</span>
<span class="sd">        {Plot_post_plot[grid_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[figtext]}</span>
<span class="sd">        {Plot_post_plot[figtext_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[key]}</span>
<span class="sd">        {Plot_post_plot[key_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[anchor]}</span>
<span class="sd">        {Plot_post_plot[autoresize]}</span>
<span class="sd">        {Plot_post_plot[savefig]}</span>
<span class="sd">        {Plot_savefig[savefig_verbose]}</span>
<span class="sd">        {Plot_post_plot[savefig_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[savefigs]}</span>
<span class="sd">        {Plot_post_plot[savefigs_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[show]}</span>
<span class="sd">        {Plot_post_plot[close]}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Stick</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;post_plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Stick</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="hov2"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.hov2">[docs]</a><span class="nd">@docfill</span>
<span class="k">def</span> <span class="nf">hov2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;hov2(data, order=None, contour=True, fill=&#39;pcolor&#39;, levels=None, colorbar=True, title=None, xaxis=None, yaxis=None, **kwargs)</span>

<span class="sd">    Plot data as a Hovmoller diagram (2D with one axis as time)</span>
<span class="sd">    and get a :class:`~vacumm.misc.core_plot.Nov` object.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; hov2(temp[:,-1,:,3], order=&#39;ty&#39;) # Force time as Y axis</span>
<span class="sd">        &gt;&gt;&gt; h = hov2(ssh, show=False)</span>

<span class="sd">    :Data params:</span>

<span class="sd">        {Plot2D_load_data[data]}</span>
<span class="sd">        {Plot__check_order_[order]}</span>
<span class="sd">        {Plot2D__set_axes_[x/yaxis]}</span>
<span class="sd">        {Plot[long_name]}</span>
<span class="sd">        {Plot[units]}</span>

<span class="sd">    :2D plot params:</span>

<span class="sd">        {Plot2D_plot[contour]}</span>
<span class="sd">        {Plot2D_plot_contour[contour_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[fill]}</span>
<span class="sd">        {Plot2D_plot_fill[nofill]}</span>
<span class="sd">        {ScalarMappable[levels]}</span>
<span class="sd">        {Plot2D_plot[levels_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable[levels_mode]}</span>
<span class="sd">        {ScalarMappable[keepminmax]}</span>
<span class="sd">        {ScalarMappable[nmax_levels]}</span>
<span class="sd">        {ScalarMappable[nmax]}</span>
<span class="sd">        {ScalarMappable[cmap]}</span>
<span class="sd">        {Plot2D_plot_fill[cmap_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[alpha]}</span>
<span class="sd">        {Plot2D_plot_fill[fill_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[shading]}</span>
<span class="sd">        {Plot2D_plot_fill[extend]}</span>
<span class="sd">        {Plot2D_plot_contour[linewidths]}</span>
<span class="sd">        {Plot2D_plot_contour[clabel]}</span>
<span class="sd">        {Plot2D_plot_contour[clabel_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_norm]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_samp]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/ysamp]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_res]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/yres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_relres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/yrelres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiverkey]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_pos]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_text]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_value]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_units]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_latex_units]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiverkey_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar_&lt;param&gt;]}</span>

<span class="sd">    :Plot initialization:</span>

<span class="sd">        {Plot_pre_plot[fig]}</span>
<span class="sd">        {Plot_pre_plot[figsize]}</span>
<span class="sd">        {Plot_pre_plot[subplot]}</span>
<span class="sd">        {Plot_pre_plot[subplots_adjust]}</span>
<span class="sd">        {Plot_pre_plot[top/bottom/left/right/wspace/hspace]}</span>
<span class="sd">        {Plot_pre_plot[axes]}</span>
<span class="sd">        {Plot_pre_plot[axes_&lt;param&gt;]}</span>
<span class="sd">        {Plot_pre_plot[axes_rect]}</span>
<span class="sd">        {Plot_pre_plot[bgcolor]}</span>
<span class="sd">        {Plot_pre_plot[twin]}</span>
<span class="sd">        {Plot_pre_plot[noframe]}</span>
<span class="sd">        {Plot_pre_plot[fullscreen]}</span>

<span class="sd">    :Plot finalization:</span>

<span class="sd">        {Plot[title]}</span>
<span class="sd">        {Plot_post_plot[title_&lt;param&gt;]}</span>
<span class="sd">        {Plot[latex_units]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot_format_axes[x/y/vlim]}</span>
<span class="sd">        {Plot_format_axes[x/y/vminmax]}</span>
<span class="sd">        {Plot_format_axes[x/y/vmaxmin]}</span>
<span class="sd">        {Plot[x/ymasked]}</span>
<span class="sd">        {Plot[x/ylong_name]}</span>
<span class="sd">        {Plot[x/yunits]}</span>
<span class="sd">        {Plot[x/ylabel]}</span>
<span class="sd">        {Plot_format_axes[x/yticks]}</span>
<span class="sd">        {Plot_format_axes[x/yticklabels]}</span>
<span class="sd">        {Plot_format_axes[x/y/vskip]}</span>
<span class="sd">        {Plot_format_axes[x/yhide]}</span>
<span class="sd">        {Plot_post_plot[grid]}</span>
<span class="sd">        {Plot_post_plot[grid_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[figtext]}</span>
<span class="sd">        {Plot_post_plot[figtext_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[key]}</span>
<span class="sd">        {Plot_post_plot[key_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[anchor]}</span>
<span class="sd">        {Plot_post_plot[autoresize]}</span>
<span class="sd">        {Plot_post_plot[savefig]}</span>
<span class="sd">        {Plot_savefig[savefig_verbose]}</span>
<span class="sd">        {Plot_post_plot[savefig_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[savefigs]}</span>
<span class="sd">        {Plot_post_plot[savefigs_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[show]}</span>
<span class="sd">        {Plot_post_plot[close]}</span>

<span class="sd">    :More:</span>

<span class="sd">        - **Specific params**: see :class:`~vacumm.misc.core_plot.Hov`.</span>
<span class="sd">        - **Scalar params**: see :class:`~vacumm.misc.core_plot.ScalarMappable`.</span>
<span class="sd">        - **Other generic params**: see :class:`~vacumm.misc.core_plot.Plot`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Hov</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;post_plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Hov</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="map2"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.map2">[docs]</a><span class="nd">@docfill</span>
<span class="k">def</span> <span class="nf">map2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;map2(data=None, proj=&#39;cyl&#39;, res=&#39;auto&#39;, lon=None, lat=None, contour=True, fill=&#39;pcolor&#39;, levels=None, colorbar=True, xaxis=None, yaxis=None, title=None, savefig=None, show=True, **kwargs)</span>

<span class="sd">    Plot an empty map or data on a map and return a :class:`~vacumm.misc.core_plot.Map`</span>
<span class="sd">    object</span>
<span class="sd">    with properties also from :class:`~vacumm.misc.core_plot.Plot`,</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.Plot2D`,</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.ScalarMappable` and</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.QuiverKey`.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; map2(xe, resolution=&#39;i&#39;)</span>
<span class="sd">        &gt;&gt;&gt; map2(lon=(-10,0), lat=(45,55), drawrivers=True, drawrivers_color=&#39;b&#39;)</span>
<span class="sd">        &gt;&gt;&gt; m = map(bathy, show=False)</span>
<span class="sd">        &gt;&gt;&gt; m.add_place(x, y, &#39;Brest&#39;)</span>
<span class="sd">        &gt;&gt;&gt; m.show()</span>

<span class="sd">    :Data params:</span>

<span class="sd">        {Plot2D_load_data[data]}</span>
<span class="sd">        {Map_load_data[lon]}</span>
<span class="sd">        {Map_load_data[lat]}</span>
<span class="sd">        {Plot2D__set_axes_[x/yaxis]}</span>
<span class="sd">        {Plot[long_name]}</span>
<span class="sd">        {Plot[units]}</span>
<span class="sd">        {Plot[latex_units]}</span>

<span class="sd">    :Map params:</span>

<span class="sd">        {Map_pre_plot[projection]}</span>
<span class="sd">        {Map_pre_plot[resolution]}</span>
<span class="sd">        {Map_pre_plot[map_update]}</span>
<span class="sd">        {Map_pre_plot[nocache]}</span>
<span class="sd">        {Map_pre_plot[zoom]}</span>
<span class="sd">        {Map_post_plot[fillcontinents]}</span>
<span class="sd">        {Map_post_plot[fillcontinents_&lt;param&gt;]}</span>
<span class="sd">        {Map_post_plot[land_color]}</span>
<span class="sd">        {Map_post_plot[drawrivers]}</span>
<span class="sd">        {Map_post_plot[drawrivers_&lt;param&gt;]}</span>
<span class="sd">        {Map_post_plot[meridians]}</span>
<span class="sd">        {Map_post_plot[drawmeridians]}</span>
<span class="sd">        {Map_post_plot[drawmeridians_&lt;param&gt;]}</span>
<span class="sd">        {Map_post_plot[parallels]}</span>
<span class="sd">        {Map_post_plot[drawparallels]}</span>
<span class="sd">        {Map_post_plot[drawparallels_&lt;param&gt;]}</span>
<span class="sd">        {Map_post_plot[meridional/zonal_labels]}</span>
<span class="sd">        {Map_post_plot[fullscreen]}</span>
<span class="sd">        {Map_post_plot[mapscale]}</span>
<span class="sd">        {Map_post_plot[mapscale_&lt;param&gt;]}</span>
<span class="sd">        {Map_post_plot[compass]}</span>
<span class="sd">        {Map_post_plot[compass_&lt;param&gt;]}</span>
<span class="sd">        {Map_post_plot[mscp]}</span>
<span class="sd">        {Map_post_plot[mscp_&lt;param&gt;]}</span>

<span class="sd">    :2D plot params:</span>

<span class="sd">        {Plot2D_plot[contour]}</span>
<span class="sd">        {Plot2D_plot_contour[contour_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[fill]}</span>
<span class="sd">        {Plot2D_plot_fill[nofill]}</span>
<span class="sd">        {ScalarMappable[levels]}</span>
<span class="sd">        {Plot2D_plot[levels_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable[levels_mode]}</span>
<span class="sd">        {ScalarMappable[keepminmax]}</span>
<span class="sd">        {ScalarMappable[nmax_levels]}</span>
<span class="sd">        {ScalarMappable[nmax]}</span>
<span class="sd">        {ScalarMappable[cmap]}</span>
<span class="sd">        {Plot2D_plot_fill[cmap_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[alpha]}</span>
<span class="sd">        {Plot2D_plot_fill[fill_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[shading]}</span>
<span class="sd">        {Plot2D_plot_fill[extend]}</span>
<span class="sd">        {Plot2D_plot_contour[linewidths]}</span>
<span class="sd">        {Plot2D_plot_contour[clabel]}</span>
<span class="sd">        {Plot2D_plot_contour[clabel_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_norm]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_samp]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/ysamp]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_res]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/yres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_relres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/yrelres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiverkey]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_pos]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_text]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_value]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_units]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_latex_units]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiverkey_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar_&lt;param&gt;]}</span>

<span class="sd">    :Plot initialization:</span>

<span class="sd">        {Plot_pre_plot[fig]}</span>
<span class="sd">        {Plot_pre_plot[figsize]}</span>
<span class="sd">        {Plot_pre_plot[subplot]}</span>
<span class="sd">        {Plot_pre_plot[subplots_adjust]}</span>
<span class="sd">        {Plot_pre_plot[top/bottom/left/right/wspace/hspace]}</span>
<span class="sd">        {Plot_pre_plot[axes]}</span>
<span class="sd">        {Plot_pre_plot[axes_&lt;param&gt;]}</span>
<span class="sd">        {Plot_pre_plot[axes_rect]}</span>
<span class="sd">        {Plot_pre_plot[bgcolor]}</span>
<span class="sd">        {Plot_pre_plot[twin]}</span>
<span class="sd">        {Plot_pre_plot[noframe]}</span>
<span class="sd">        {Plot_pre_plot[fullscreen]}</span>

<span class="sd">    :Plot finalization:</span>

<span class="sd">        {Plot[title]}</span>
<span class="sd">        {Plot_post_plot[title_&lt;param&gt;]}</span>
<span class="sd">        {Plot[latex_units]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot_format_axes[x/y/vlim]}</span>
<span class="sd">        {Plot_format_axes[x/y/vminmax]}</span>
<span class="sd">        {Plot_format_axes[x/y/vmaxmin]}</span>
<span class="sd">        {Plot[x/ymasked]}</span>
<span class="sd">        {Plot[x/ylong_name]}</span>
<span class="sd">        {Plot[x/yunits]}</span>
<span class="sd">        {Plot[x/ylabel]}</span>
<span class="sd">        {Plot_format_axes[x/yticks]}</span>
<span class="sd">        {Plot_format_axes[x/yticklabels]}</span>
<span class="sd">        {Plot_format_axes[x/y/vskip]}</span>
<span class="sd">        {Plot_format_axes[x/yhide]}</span>
<span class="sd">        {Plot_post_plot[grid]}</span>
<span class="sd">        {Plot_post_plot[grid_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[figtext]}</span>
<span class="sd">        {Plot_post_plot[figtext_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[key]}</span>
<span class="sd">        {Plot_post_plot[key_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[anchor]}</span>
<span class="sd">        {Plot_post_plot[autoresize]}</span>
<span class="sd">        {Plot_post_plot[savefig]}</span>
<span class="sd">        {Plot_savefig[savefig_verbose]}</span>
<span class="sd">        {Plot_post_plot[savefig_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[savefigs]}</span>
<span class="sd">        {Plot_post_plot[savefigs_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[show]}</span>
<span class="sd">        {Plot_post_plot[close]}</span>

<span class="sd">    :Other params:</span>

<span class="sd">        - **Specific params**: see :class:`~vacumm.misc.core_plot.Map`.</span>
<span class="sd">        - **Specific plot initialization params**: see :class:`~vacumm.misc.core_plot.Map.pre_plot`.</span>
<span class="sd">        - **Specific plot params**: see :class:`~vacumm.misc.core_plot.Map.plot`.</span>
<span class="sd">        - **Specific plot finalization params**: see :class:`~vacumm.misc.core_plot.Map.post_plot`.</span>
<span class="sd">        - **Other generic params**: see :class:`~vacumm.misc.core_plot.Plot`.</span>

<span class="sd">    &quot;&quot;&quot;</span>



    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Map</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;post_plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Map</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="section2"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.section2">[docs]</a><span class="nd">@docfill</span>
<span class="k">def</span> <span class="nf">section2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;section2(data, contour=True, fill=&#39;pcolor&#39;, levels=None, colorbar=True, title=None, xaxis=None, yaxis=None, **kwargs)</span>

<span class="sd">    Plot geographical data as a vertical-horizontal section</span>
<span class="sd">    and return a :class:`~vacumm.misc.core_plot.Section` object</span>
<span class="sd">    with properties also from :class:`~vacumm.misc.core_plot.Plot`,</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.Plot2D`,</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.ScalarMappable` and</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.QuiverKey`.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; section2(temp[0,:, :,3])</span>

<span class="sd">    :Data params:</span>

<span class="sd">        {Plot2D_load_data[data]}</span>
<span class="sd">        {Plot2D__set_axes_[x/yaxis]}</span>
<span class="sd">        {Plot[long_name]}</span>
<span class="sd">        {Plot[units]}</span>

<span class="sd">    :2D plot params:</span>

<span class="sd">        {Plot2D_plot[contour]}</span>
<span class="sd">        {Plot2D_plot_contour[contour_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[fill]}</span>
<span class="sd">        {Plot2D_plot_fill[nofill]}</span>
<span class="sd">        {ScalarMappable[levels]}</span>
<span class="sd">        {Plot2D_plot[levels_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable[levels_mode]}</span>
<span class="sd">        {ScalarMappable[keepminmax]}</span>
<span class="sd">        {ScalarMappable[nmax_levels]}</span>
<span class="sd">        {ScalarMappable[nmax]}</span>
<span class="sd">        {ScalarMappable[cmap]}</span>
<span class="sd">        {Plot2D_plot_fill[cmap_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[alpha]}</span>
<span class="sd">        {Plot2D_plot_fill[fill_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[shading]}</span>
<span class="sd">        {Plot2D_plot_fill[extend]}</span>
<span class="sd">        {Plot2D_plot_contour[linewidths]}</span>
<span class="sd">        {Plot2D_plot_contour[clabel]}</span>
<span class="sd">        {Plot2D_plot_contour[clabel_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_norm]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_samp]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/ysamp]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_res]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/yres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_relres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/yrelres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiverkey]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_pos]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_text]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_value]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_units]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_latex_units]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiverkey_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar_&lt;param&gt;]}</span>

<span class="sd">    :Plot initialization:</span>

<span class="sd">        {Plot_pre_plot[fig]}</span>
<span class="sd">        {Plot_pre_plot[figsize]}</span>
<span class="sd">        {Plot_pre_plot[subplot]}</span>
<span class="sd">        {Plot_pre_plot[subplots_adjust]}</span>
<span class="sd">        {Plot_pre_plot[top/bottom/left/right/wspace/hspace]}</span>
<span class="sd">        {Plot_pre_plot[axes]}</span>
<span class="sd">        {Plot_pre_plot[axes_&lt;param&gt;]}</span>
<span class="sd">        {Plot_pre_plot[axes_rect]}</span>
<span class="sd">        {Plot_pre_plot[bgcolor]}</span>
<span class="sd">        {Plot_pre_plot[twin]}</span>
<span class="sd">        {Plot_pre_plot[noframe]}</span>
<span class="sd">        {Plot_pre_plot[fullscreen]}</span>

<span class="sd">    :Plot finalization:</span>

<span class="sd">        {Plot[title]}</span>
<span class="sd">        {Plot_post_plot[title_&lt;param&gt;]}</span>
<span class="sd">        {Plot[latex_units]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot_format_axes[x/y/vlim]}</span>
<span class="sd">        {Plot_format_axes[x/y/vminmax]}</span>
<span class="sd">        {Plot_format_axes[x/y/vmaxmin]}</span>
<span class="sd">        {Plot[x/ymasked]}</span>
<span class="sd">        {Plot[x/ylong_name]}</span>
<span class="sd">        {Plot[x/yunits]}</span>
<span class="sd">        {Plot[x/ylabel]}</span>
<span class="sd">        {Plot_format_axes[x/yticks]}</span>
<span class="sd">        {Plot_format_axes[x/yticklabels]}</span>
<span class="sd">        {Plot_format_axes[x/y/vskip]}</span>
<span class="sd">        {Plot_format_axes[x/yhide]}</span>
<span class="sd">        {Plot_post_plot[grid]}</span>
<span class="sd">        {Plot_post_plot[grid_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[figtext]}</span>
<span class="sd">        {Plot_post_plot[figtext_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[key]}</span>
<span class="sd">        {Plot_post_plot[key_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[anchor]}</span>
<span class="sd">        {Plot_post_plot[autoresize]}</span>
<span class="sd">        {Plot_post_plot[savefig]}</span>
<span class="sd">        {Plot_savefig[savefig_verbose]}</span>
<span class="sd">        {Plot_post_plot[savefig_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[savefigs]}</span>
<span class="sd">        {Plot_post_plot[savefigs_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[show]}</span>
<span class="sd">        {Plot_post_plot[close]}</span>

<span class="sd">    :More:</span>

<span class="sd">        - **Specific params**: see :class:`~vacumm.misc.core_plot.Section`.</span>
<span class="sd">        - **Scalar params**: see :class:`~vacumm.misc.core_plot.ScalarMappable`.</span>
<span class="sd">        - **Other generic params**: see :class:`~vacumm.misc.core_plot.Plot`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Section</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;post_plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Section</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot2d"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.plot2d">[docs]</a><span class="nd">@docfill</span>
<span class="k">def</span> <span class="nf">plot2d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;plot2d(data, contour=True, fill=&#39;pcolor&#39;, levels=None, colorbar=True, xaxis=None, yaxis=None, title=None, savefig=None, show=True, **kwargs)</span>

<span class="sd">    Generic plot of a 2D variable and return</span>
<span class="sd">    a :class:`~vacumm.misc.core_plot.Plot2D` object</span>
<span class="sd">    with properties also from :class:`~vacumm.misc.core_plot.Plot`,</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.ScalarMappable` and</span>
<span class="sd">    :class:`~vacumm.misc.core_plot.QuiverKey`.</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; plot2d(xe)</span>

<span class="sd">    :Data params:</span>

<span class="sd">        {Plot2D_load_data[data]}</span>
<span class="sd">        {Map_load_data[lon]}</span>
<span class="sd">        {Map_load_data[lat]}</span>
<span class="sd">        {Plot2D__set_axes_[x/yaxis]}</span>
<span class="sd">        {Plot[long_name]}</span>
<span class="sd">        {Plot[units]}</span>
<span class="sd">        {Plot[latex_units]}</span>

<span class="sd">    :2D plot params:</span>

<span class="sd">        {Plot2D_plot[contour]}</span>
<span class="sd">        {Plot2D_plot_contour[contour_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[fill]}</span>
<span class="sd">        {Plot2D_plot_fill[nofill]}</span>
<span class="sd">        {ScalarMappable[levels]}</span>
<span class="sd">        {Plot2D_plot[levels_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable[levels_mode]}</span>
<span class="sd">        {ScalarMappable[keepminmax]}</span>
<span class="sd">        {ScalarMappable[nmax_levels]}</span>
<span class="sd">        {ScalarMappable[nmax]}</span>
<span class="sd">        {ScalarMappable[cmap]}</span>
<span class="sd">        {Plot2D_plot_fill[cmap_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[alpha]}</span>
<span class="sd">        {Plot2D_plot_fill[fill_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_fill[shading]}</span>
<span class="sd">        {Plot2D_plot_fill[extend]}</span>
<span class="sd">        {Plot2D_plot_contour[linewidths]}</span>
<span class="sd">        {Plot2D_plot_contour[clabel]}</span>
<span class="sd">        {Plot2D_plot_contour[clabel_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_&lt;param&gt;]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_norm]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_samp]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/ysamp]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_res]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/yres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_relres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiver_x/yrelres]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiverkey]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_pos]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_text]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_value]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_units]}</span>
<span class="sd">        {QuiverKey_quiverkey[quiverkey_latex_units]}</span>
<span class="sd">        {Plot2D_plot_quiver[quiverkey_&lt;param&gt;]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar]}</span>
<span class="sd">        {ScalarMappable_post_plot[colorbar_&lt;param&gt;]}</span>

<span class="sd">    :Plot initialization:</span>

<span class="sd">        {Plot_pre_plot[fig]}</span>
<span class="sd">        {Plot_pre_plot[figsize]}</span>
<span class="sd">        {Plot_pre_plot[subplot]}</span>
<span class="sd">        {Plot_pre_plot[subplots_adjust]}</span>
<span class="sd">        {Plot_pre_plot[top/bottom/left/right/wspace/hspace]}</span>
<span class="sd">        {Plot_pre_plot[axes]}</span>
<span class="sd">        {Plot_pre_plot[axes_&lt;param&gt;]}</span>
<span class="sd">        {Plot_pre_plot[axes_rect]}</span>
<span class="sd">        {Plot_pre_plot[bgcolor]}</span>
<span class="sd">        {Plot_pre_plot[twin]}</span>
<span class="sd">        {Plot_pre_plot[noframe]}</span>
<span class="sd">        {Plot_pre_plot[fullscreen]}</span>

<span class="sd">    :Plot finalization:</span>

<span class="sd">        {Plot[title]}</span>
<span class="sd">        {Plot_post_plot[title_&lt;param&gt;]}</span>
<span class="sd">        {Plot[latex_units]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot[x/ymin/max]}</span>
<span class="sd">        {Plot_format_axes[x/y/vlim]}</span>
<span class="sd">        {Plot_format_axes[x/y/vminmax]}</span>
<span class="sd">        {Plot_format_axes[x/y/vmaxmin]}</span>
<span class="sd">        {Plot[x/ymasked]}</span>
<span class="sd">        {Plot[x/ylong_name]}</span>
<span class="sd">        {Plot[x/yunits]}</span>
<span class="sd">        {Plot[x/ylabel]}</span>
<span class="sd">        {Plot_format_axes[x/yticks]}</span>
<span class="sd">        {Plot_format_axes[x/yticklabels]}</span>
<span class="sd">        {Plot_format_axes[x/y/vskip]}</span>
<span class="sd">        {Plot_format_axes[x/yhide]}</span>
<span class="sd">        {Plot_post_plot[grid]}</span>
<span class="sd">        {Plot_post_plot[grid_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[figtext]}</span>
<span class="sd">        {Plot_post_plot[figtext_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[legend]}</span>
<span class="sd">        {Plot_post_plot[legend_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[key]}</span>
<span class="sd">        {Plot_post_plot[key_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[anchor]}</span>
<span class="sd">        {Plot_post_plot[autoresize]}</span>
<span class="sd">        {Plot_post_plot[savefig]}</span>
<span class="sd">        {Plot_savefig[savefig_verbose]}</span>
<span class="sd">        {Plot_post_plot[savefig_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[savefigs]}</span>
<span class="sd">        {Plot_post_plot[savefigs_&lt;param&gt;]}</span>
<span class="sd">        {Plot_post_plot[show]}</span>
<span class="sd">        {Plot_post_plot[close]}</span>

<span class="sd">    :Other params:</span>

<span class="sd">        - **Specific params**: see :class:`~vacumm.misc.core_plot.Plot2D`.</span>
<span class="sd">        - **Specific plot initialization params**: see :class:`~vacumm.misc.core_plot.Plot.pre_plot`.</span>
<span class="sd">        - **Specific plot params**: see :class:`~vacumm.misc.core_plot.Plot2D.plot`.</span>
<span class="sd">        - **Specific plot finalization params**: see :class:`~vacumm.misc.core_plot.Plot.post_plot`.</span>
<span class="sd">        - **Other generic params**: see :class:`~vacumm.misc.core_plot.Plot`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Plot2D</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;post_plot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Plot2D</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="minimap"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.minimap">[docs]</a><span class="k">def</span> <span class="nf">minimap</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">14</span><span class="p">,</span> <span class="o">.</span><span class="mi">14</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">xmargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymargin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a minimap with :func:`map2`</span>

<span class="sd">    A minimap is small and generally in a corner of the figure,</span>
<span class="sd">    and used to show simple geographic information.</span>

<span class="sd">    :Examples:</span>

<span class="sd">        &gt;&gt;&gt; minimap(((lonmin,lonmax),(latmin,latmax))).add_point(-5,48)</span>
<span class="sd">        &gt;&gt;&gt; minimap(sst.getGrid())</span>
<span class="sd">        &gt;&gt;&gt; m = minimap(sst)</span>
<span class="sd">        &gt;&gt;&gt; m.add_point(lon, lat)</span>

<span class="sd">    :Return: A :class:`~vacumm.misc.core_plot.Map` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">grid</span> <span class="k">import</span> <span class="n">get_xy</span>
    <span class="kn">from</span> <span class="nn">color</span> <span class="k">import</span> <span class="n">RGB</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gg</span> <span class="k">if</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">gg</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_xy</span><span class="p">(</span><span class="n">gg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">zoombox</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="n">zoom</span><span class="p">,</span>
        <span class="n">xmargin</span><span class="o">=</span><span class="n">xmargin</span><span class="p">,</span> <span class="n">ymargin</span><span class="o">=</span><span class="n">ymargin</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="n">square</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;contour&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;pcolormesh&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;jet&#39;</span><span class="p">)</span>
    <span class="n">bgcolor</span> <span class="o">=</span> <span class="n">RGB</span><span class="p">(</span><span class="n">bgcolor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="n">bgcolor</span> <span class="o">+=</span> <span class="n">alpha</span><span class="p">,</span>
    <span class="n">oldax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">dict_check_defaults</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xhide</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yhide</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;merc&#39;</span><span class="p">,</span>
        <span class="n">drawparallels_linewidth</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">drawmeridians_linewidth</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">map2</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">),</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">axes_rect</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="n">bgcolor</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c1">#    m.axes.set_alpha(alpha)</span>
    <span class="n">fc</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_axobj</span><span class="p">(</span><span class="s1">&#39;fillcontinents&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alpha</span><span class="o">!=</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">fc</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">fc</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">oldax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="add_map_point"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_map_point">[docs]</a><span class="k">def</span> <span class="nf">add_map_point</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>  <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a small map with a point at specified longitude and latitude</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **gg**: Map limits passed to :func:`minimap`</span>
<span class="sd">          or  :meth:`~vacumm.misc.core_plot.Map` instance.</span>
<span class="sd">        - **lon/lat**: Coordinates of the point.</span>

<span class="sd">    :See also: :func:`minimap` :meth:`~vacumm.misc.core_plot.Plot.add_point`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwmap</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="s1">&#39;bbox&#39;</span><span class="p">,</span> <span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;fig&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwmap</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Map</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">Map</span><span class="p">):</span> <span class="n">m</span> <span class="o">=</span> <span class="n">gg</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">minimap</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="add_map_places"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_map_places">[docs]</a><span class="k">def</span> <span class="nf">add_map_places</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>  <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a small map with one or several places at specified longitude and latitude</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **gg**: Map limits passed to :func:`minimap`</span>
<span class="sd">          or  :meth:`~vacumm.misc.core_plot.Map` instance.</span>
<span class="sd">        - **lon/lat**: Coordinates arrays of the points.</span>
<span class="sd">        - **txt**: Text array associated to the points</span>

<span class="sd">    :See also: :func:`minimap` :meth:`~vacumm.misc.core_plot.Plot.add_place`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwmap</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="s1">&#39;bbox&#39;</span><span class="p">,</span> <span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;fig&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwmap</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Map</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">Map</span><span class="p">):</span> <span class="n">m</span> <span class="o">=</span> <span class="n">gg</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">minimap</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwmap</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">txt</span><span class="p">):</span>
      <span class="n">m</span><span class="o">.</span><span class="n">add_place</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">glow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="add_map_line"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_map_line">[docs]</a><span class="k">def</span> <span class="nf">add_map_line</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">extents</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a small map with a line at specified longitudes and latitudes</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **gg**: Map limits passed to :func:`minimap`</span>
<span class="sd">          or  :meth:`~vacumm.misc.core_plot.Map` instance.</span>
<span class="sd">        - **extents**: Extents in the forms ``[xmin,ymin,xmax,ymax]``</span>
<span class="sd">          ``dict(x=(xmin,xmax),y=xmin,xmax)`` or</span>
<span class="sd">              ``dict(lon=(xmin,xmax),lat=xmin,xmax)``.</span>

<span class="sd">    :See also: :func:`minimap` :meth:`~vacumm.misc.core_plot.Plot.add_line`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwmap</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="s1">&#39;bbox&#39;</span><span class="p">,</span> <span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;fig&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwmap</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Map</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">Map</span><span class="p">):</span> <span class="n">m</span> <span class="o">=</span> <span class="n">gg</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">minimap</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">extents</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="add_map_lines"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_map_lines">[docs]</a><span class="k">def</span> <span class="nf">add_map_lines</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a small map with a broken line specified longitudes and latitudes</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **gg**: Map limits passed to :func:`minimap`</span>
<span class="sd">          or  :meth:`~vacumm.misc.core_plot.Map` instance.</span>
<span class="sd">        - **xx/yy**: 1D arrays of coordinates.</span>

<span class="sd">    :See also: :func:`minimap` :meth:`~vacumm.misc.core_plot.Plot.add_lines`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwmap</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="s1">&#39;bbox&#39;</span><span class="p">,</span> <span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;fig&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwmap</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Map</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">Map</span><span class="p">):</span> <span class="n">m</span> <span class="o">=</span> <span class="n">gg</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">minimap</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="add_map_box"><a class="viewcode-back" href="../../../library/misc.plot.html#vacumm.misc.plot.add_map_box">[docs]</a><span class="k">def</span> <span class="nf">add_map_box</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a small map with a box at specified longitudes and latitudes</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **gg**: Map limits passed to :func:`minimap`</span>
<span class="sd">          or  :meth:`~vacumm.misc.core_plot.Map` instance.</span>
<span class="sd">        - **box**: Box limits in the forms ``[xmin,ymin,xmax,ymax]``</span>
<span class="sd">          ``dict(x=(xmin,xmax),y=xmin,xmax)`` or</span>
<span class="sd">          ``dict(lon=(xmin,xmax),lat=xmin,xmax)``.</span>

<span class="sd">    :See also: :func:`minimap` :meth:`~vacumm.misc.core_plot.Plot.add_box`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwmap</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="s1">&#39;bbox&#39;</span><span class="p">,</span> <span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;fig&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwmap</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">core_plot</span> <span class="k">import</span> <span class="n">Map</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">Map</span><span class="p">):</span> <span class="n">m</span> <span class="o">=</span> <span class="n">gg</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">minimap</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">add_box</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="c1">#####################################################################</span>
<span class="c1">######################################################################</span>
<span class="c1">#from grid.misc import meshgrid, meshbounds</span>


</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" >vacumm</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>