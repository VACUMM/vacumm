
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>vacumm.bathy.bathy &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="../../../_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" accesskey="U">vacumm</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vacumm.bathy.bathy</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Bathmetry tools</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Copyright or Â© or Copr. Actimar/IFREMER (2010-2018)</span>
<span class="c1">#</span>
<span class="c1"># This software is a computer program whose purpose is to provide</span>
<span class="c1"># utilities for handling oceanographic and atmospheric data,</span>
<span class="c1"># with the ultimate goal of validating the MARS model from IFREMER.</span>
<span class="c1">#</span>
<span class="c1"># This software is governed by the CeCILL license under French law and</span>
<span class="c1"># abiding by the rules of distribution of free software.  You can  use,</span>
<span class="c1"># modify and/ or redistribute the software under the terms of the CeCILL</span>
<span class="c1"># license as circulated by CEA, CNRS and INRIA at the following URL</span>
<span class="c1"># &quot;http://www.cecill.info&quot;.</span>
<span class="c1">#</span>
<span class="c1"># As a counterpart to the access to the source code and  rights to copy,</span>
<span class="c1"># modify and redistribute granted by the license, users are provided only</span>
<span class="c1"># with a limited warranty  and the software&#39;s author,  the holder of the</span>
<span class="c1"># economic rights,  and the successive licensors  have only  limited</span>
<span class="c1"># liability.</span>
<span class="c1">#</span>
<span class="c1"># In this respect, the user&#39;s attention is drawn to the risks associated</span>
<span class="c1"># with loading,  using,  modifying and/or developing or reproducing the</span>
<span class="c1"># software by the user in light of its specific status of free software,</span>
<span class="c1"># that may mean  that it is complicated to manipulate,  and  that  also</span>
<span class="c1"># therefore means  that it is reserved for developers  and  experienced</span>
<span class="c1"># professionals having in-depth computer knowledge. Users are therefore</span>
<span class="c1"># encouraged to load and test the software&#39;s suitability as regards their</span>
<span class="c1"># requirements in conditions enabling the security of their systems and/or</span>
<span class="c1"># data to be ensured and,  more generally, to use and operate it in the</span>
<span class="c1"># same conditions as regards security.</span>
<span class="c1">#</span>
<span class="c1"># The fact that you are presently reading this means that you have had</span>
<span class="c1"># knowledge of the CeCILL license and that you accept its terms.</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">cdms2</span><span class="o">,</span><span class="nn">MV2</span>
<span class="kn">from</span> <span class="nn">genutil</span> <span class="k">import</span> <span class="n">minmax</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">N</span>
<span class="n">MV</span> <span class="o">=</span> <span class="n">MV2</span>
<span class="n">cdms</span> <span class="o">=</span> <span class="n">cdms2</span>

<span class="kn">from</span> <span class="nn">vacumm.misc.axml.base</span> <span class="k">import</span> <span class="n">Base</span> <span class="k">as</span> <span class="n">XMLBase</span><span class="p">,</span> <span class="n">def_setget</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.io</span> <span class="k">import</span> <span class="n">XYZ</span><span class="p">,</span> <span class="n">XYZMerger</span>

<span class="kn">from</span> <span class="nn">string</span> <span class="k">import</span> <span class="n">Template</span>
<span class="kn">from</span> <span class="nn">ConfigParser</span> <span class="k">import</span> <span class="n">ConfigParser</span><span class="p">,</span> <span class="n">SafeConfigParser</span>
<span class="kn">import</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">Formatter</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">P</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">from</span> <span class="nn">vacumm.config</span> <span class="k">import</span> <span class="n">check_data_file</span><span class="p">,</span> <span class="n">get_config_sections</span><span class="p">,</span> <span class="n">get_config_value</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;print_bathy_list&#39;</span><span class="p">,</span> <span class="s1">&#39;Bathy&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_bathy&#39;</span><span class="p">,</span> <span class="s1">&#39;fmt_bathy&#39;</span><span class="p">,</span>  <span class="s1">&#39;bathy_list&#39;</span><span class="p">,</span>
    <span class="s1">&#39;XYZBathy&#39;</span><span class="p">,</span> <span class="s1">&#39;XYZBathyBankClient&#39;</span><span class="p">,</span> <span class="s1">&#39;XYZBathyBank&#39;</span><span class="p">,</span> <span class="s1">&#39;XYZBathyMerger&#39;</span><span class="p">,</span> <span class="s1">&#39;GriddedBathy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GriddedBathyMerger&#39;</span><span class="p">,</span> <span class="s1">&#39;NcGriddedBathy&#39;</span><span class="p">,</span> <span class="s1">&#39;NcGriddedBathyError&#39;</span><span class="p">,</span>
<span class="c1">#    &#39;get_cfgfiles_gridded&#39;</span>
    <span class="p">]</span>

<div class="viewcode-block" id="bathy_list"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.bathy_list">[docs]</a><span class="k">def</span> <span class="nf">bathy_list</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minstatus</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the list of bathymetries as dict</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **name**, optional: Request this bathymetry.</span>
<span class="sd">        - **cfgfile**, optional: Load this bathymetry config file.</span>
<span class="sd">        - **minstatus**, optional: Minimal status of availability</span>
<span class="sd">          of the bathymetry (see :func:`vacumm.config.check_data_file`):</span>

<span class="sd">            - ``0``: Bathy file not on disk and not downloadable</span>
<span class="sd">              (however, user can specify the path manually).</span>
<span class="sd">            - ``1``: File is not on disk, but downloadable.</span>
<span class="sd">            - ``2``: File is on disk.</span>

<span class="sd">    :Return:</span>

<span class="sd">        - If ``name`` is not provided, a dict of subdicts like this one::</span>

<span class="sd">            {&#39;etopo2&#39;:{&#39;file&#39;:&#39;/home/me/bathy.nc&#39;, &#39;var&#39;:&#39;btdata&#39;, ...}, ...}</span>

<span class="sd">        - Else, the subdict of the requested bathy::</span>

<span class="sd">            {&#39;file&#39;:&#39;/home/me/bathy.nc&#39;, &#39;var&#39;:&#39;btdata&#39;, ...}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Read config file</span>
    <span class="n">sections</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_config_sections</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfgfile</span><span class="p">,</span> <span class="n">parent_section</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="n">parent_option</span><span class="o">=</span><span class="s1">&#39;cfgfile_gridded&#39;</span><span class="p">,</span> <span class="n">getcfg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#    if not cfgfile: cfgfile = get_cfgfiles_gridded() # File name</span>
<span class="c1">#    dvars = get_dir_dict(__names__) # Various directory names</span>
<span class="c1">#    bathys = {}</span>
<span class="c1">#    f = ConfigParser()</span>
<span class="c1">#    f.read(cfgfile)</span>


    <span class="c1"># Loop on section</span>
    <span class="n">bathies</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">_check_bathy_file_</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">avail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#        if not os.path.exists(f.get(section, &#39;file&#39;, vars=dvars)): continue</span>
        <span class="k">if</span> <span class="n">status</span><span class="o">&lt;=</span><span class="n">minstatus</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">bathies</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="n">status</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;file_url&#39;</span><span class="p">,</span><span class="s1">&#39;file_license&#39;</span><span class="p">,</span><span class="s1">&#39;var&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="n">bathies</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_value</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">)</span>

    <span class="c1"># Found any bathy?</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">bathies</span><span class="p">):</span> <span class="k">raise</span> <span class="n">NcGriddedBathyError</span><span class="p">(</span><span class="s1">&#39;No bathy are available&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">bathies</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NcGriddedBathyError</span><span class="p">(</span><span class="s1">&#39;Wrong bathymetry name: &quot;</span><span class="si">%s</span><span class="s1">&quot;. Please choose one of these: </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="o">%</span>
                <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bathies</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="k">return</span> <span class="n">bathies</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">bathies</span></div>

<span class="k">def</span> <span class="nf">_check_bathy_file_</span><span class="p">(</span><span class="n">bathyname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make sure to have a bathy file (see :func:`~vacumm.config.check_data_file`)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">check_data_file</span><span class="p">(</span><span class="n">bathyname</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">parent_section</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="n">parent_option</span><span class="o">=</span><span class="s1">&#39;cfgfile_gridded&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c1">#def get_cfgfiles_gridded():</span>
<span class="c1">#    &quot;&quot;&quot;Name of the configuration file containing the list of netcdf gridded bathy files&quot;&quot;&quot;</span>
<span class="c1">#    return get_config_value(__name__, &#39;cfgfile_gridded&#39;)</span>

<div class="viewcode-block" id="print_bathy_list"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.print_bathy_list">[docs]</a><span class="k">def</span> <span class="nf">print_bathy_list</span><span class="p">(</span><span class="n">cfgfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print available bathymetries&quot;&quot;&quot;</span>
<span class="c1">#    if not cfgfile: cfgfile = get_cfgfiles_gridded()</span>
    <span class="nb">print</span> <span class="s1">&#39;List of bathymetries:&#39;</span>
    <span class="k">for</span> <span class="n">bathyname</span><span class="p">,</span><span class="n">vv</span> <span class="ow">in</span> <span class="n">bathy_list</span><span class="p">(</span><span class="n">cfgfile</span><span class="o">=</span><span class="n">cfgfile</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="n">bathyname</span>
        <span class="nb">print</span> <span class="s1">&#39;  status: &#39;</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;Not available (need user input)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Downloadable&#39;</span><span class="p">,</span> <span class="s1">&#39;On disk&#39;</span><span class="p">][</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;file_url&#39;</span><span class="p">,</span><span class="s1">&#39;file_license&#39;</span><span class="p">,</span><span class="s1">&#39;var&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;  - </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">vv</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>
<span class="n">list_bathy</span> <span class="o">=</span> <span class="n">print_bathy_list</span>

<div class="viewcode-block" id="Bathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.Bathy">[docs]</a><span class="k">class</span> <span class="nc">Bathy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a portion of the gridded bathymetry</span>

<span class="sd">    .. warning::</span>

<span class="sd">        This class is **DEPRECATED**.</span>
<span class="sd">        Please use :class:`NcGriddedBathy` instead.</span>

<span class="sd">    :Params:</span>

<span class="sd">        - *lon*: Longitude range [default: None]</span>
<span class="sd">        - *lat*: Latitude range [default: None]</span>
<span class="sd">        - *sampling*: Sampling in both directions [default: 1]</span>
<span class="sd">        - *fill*: If True, fill positive values with 0. [default: True]</span>
<span class="sd">        - *mask_function*: To mask points. Should be &#39;greater&#39; or &#39;less&#39;.</span>
<span class="sd">          If empty or None, no mask is applied [default: &#39;greater&#39;]</span>
<span class="sd">        - *mask_value*: Value used with mask_function [default: 0.]</span>
<span class="sd">        - *name*: Name of bathymetry within is list given by print_bathy_list()</span>

<span class="sd">    :Example:</span>


<span class="sd">    &gt;&gt;&gt; from vacumm import Bathy</span>
<span class="sd">    &gt;&gt;&gt; gg = Bathy((-9,10),(40,50),&#39;etopo2&#39;) # object creation</span>
<span class="sd">    &gt;&gt;&gt; gg.show() # quick plot</span>
<span class="sd">    &gt;&gt;&gt; gg.zoom((-5,0),(42,50)) # Select another zoom (lon/lat)</span>
<span class="sd">    &gt;&gt;&gt; mybathyvar = gg() # Get the current zoom</span>
<span class="sd">    &gt;&gt;&gt; mybathyvar = gg((-9,-8),(45,50)) # Get another zoom</span>
<span class="sd">    &gt;&gt;&gt; gg.write_ascii(&#39;/home/yoman/mybathy.dat&#39;) # dump to file</span>
<span class="sd">    &gt;&gt;&gt; gg.write_netcdf(&#39;/home/yoman/mybathy.nc&#39;) # same for a netcdf file</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;etopo2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Choose the bathymetry</span>
        <span class="n">bathy_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bathy_name&#39;</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="n">mybathy</span> <span class="o">=</span> <span class="n">bathy_list</span><span class="p">(</span><span class="n">bathy_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">mybathy</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_name</span> <span class="o">=</span> <span class="n">mybathy</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_name</span> <span class="o">=</span> <span class="n">mybathy</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_name</span> <span class="o">=</span> <span class="n">mybathy</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bathy_name</span> <span class="o">=</span> <span class="n">bathy_name</span>

        <span class="c1"># Default values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_range</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_range</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sampling</span> <span class="o">=</span><span class="mi">1</span>

        <span class="c1"># Zoom</span>
        <span class="n">cdms</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">longitude_aliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon_name</span><span class="p">)</span>
        <span class="n">cdms</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">latitude_aliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon_range</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_range</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_sampling</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span>


<div class="viewcode-block" id="Bathy.zoom"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.Bathy.zoom">[docs]</a>    <span class="k">def</span> <span class="nf">zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sampling</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mask_function</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">,</span><span class="n">mask_value</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select a zoom and set the current variable</span>

<span class="sd">        :Params:</span>

<span class="sd">        - *lon*: Longitude range [default: None]</span>
<span class="sd">        - *lat*: Latitude range [default: None]</span>
<span class="sd">        - *sampling*: Sampling in both directions [default: 1]</span>
<span class="sd">        - *fill*: If True, fill positive values with 0. [default: True]</span>
<span class="sd">        - *mask_function*: To mask points. Should be &#39;greater&#39; or &#39;less&#39;.</span>
<span class="sd">          If empty or None, no mask is applied [default: &#39;greater&#39;]</span>
<span class="sd">        - *mask_value*: Value used with mask_function [default: 0.]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">lon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_range</span>
        <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_range</span>
        <span class="k">if</span> <span class="n">lon</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_range</span> <span class="ow">and</span> <span class="n">lat</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_range</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">sampling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampling</span> <span class="o">=</span> <span class="n">sampling</span>
        <span class="k">if</span> <span class="n">fill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="o">=</span> <span class="n">fill</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_range</span> <span class="o">=</span> <span class="n">lon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_range</span> <span class="o">=</span> <span class="n">lat</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon_name</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon_range</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_name</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_range</span><span class="p">}</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">cdms</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">ilonmin</span><span class="p">,</span><span class="n">ilonmax</span><span class="p">,</span><span class="n">ilonsamp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_name</span><span class="p">]</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span><span class="o">.</span><span class="n">mapIntervalExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon_range</span><span class="p">)</span>
        <span class="n">ilatin</span><span class="p">,</span><span class="n">ilatmax</span><span class="p">,</span><span class="n">ilatsamp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_name</span><span class="p">]</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span><span class="o">.</span><span class="n">mapIntervalExt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat_range</span><span class="p">)</span>
        <span class="n">ilonsamp</span> <span class="o">=</span> <span class="n">ilatsamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_name</span><span class="p">][</span><span class="n">ilatin</span><span class="p">:</span><span class="n">ilatmax</span><span class="p">:</span><span class="n">ilatsamp</span><span class="p">,</span><span class="n">ilonmin</span><span class="p">:</span><span class="n">ilonmax</span><span class="p">:</span><span class="n">ilonsamp</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">setMissing</span><span class="p">(</span><span class="n">mask_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask_function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MV</span><span class="p">,</span><span class="s1">&#39;masked_&#39;</span><span class="o">+</span><span class="n">mask_function</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="p">[:],</span><span class="n">mask_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">filled</span><span class="p">()</span>
<span class="c1">#           self.bathy.unmask()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;bathy&#39;</span> <span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">bathy_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s1">&#39; bathymetry&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
        <span class="n">lon_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lon_axis</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;lon&#39;</span>
        <span class="n">lon_axis</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;Longitude&#39;</span>
        <span class="n">lon_axis</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_east&#39;</span>
        <span class="n">lat_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lat_axis</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;lat&#39;</span>
        <span class="n">lat_axis</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;Latitude&#39;</span>
        <span class="n">lat_axis</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_north&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">setAxisList</span><span class="p">([</span><span class="n">lat_axis</span><span class="p">,</span><span class="n">lon_axis</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lon2d</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat2d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon_axis</span><span class="o">.</span><span class="n">getValue</span><span class="p">(),</span><span class="n">lat_axis</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon2dp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat2dp</span> <span class="o">=</span> <span class="n">axes2d</span><span class="p">(</span><span class="n">lon_axis</span><span class="o">.</span><span class="n">getValue</span><span class="p">(),</span><span class="n">lat_axis</span><span class="o">.</span><span class="n">getValue</span><span class="p">(),</span><span class="n">bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yys</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Bathy.lon"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.Bathy.lon">[docs]</a>    <span class="k">def</span> <span class="nf">lon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Longitude axis &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span></div>

<div class="viewcode-block" id="Bathy.lat"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.Bathy.lat">[docs]</a>    <span class="k">def</span> <span class="nf">lat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Latitude axis &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span></div>


<div class="viewcode-block" id="Bathy.show"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.Bathy.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the current bathymetry</span>

<span class="sd">        - *lon*: Longitude range.</span>
<span class="sd">        - *lat*: Latitude range.</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            :func:`plot_bathy`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Zoom if requested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plot_bathy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="n">plot</span><span class="o">=</span><span class="n">show</span>

<div class="viewcode-block" id="Bathy.write_netcdf"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.Bathy.write_netcdf">[docs]</a>    <span class="k">def</span> <span class="nf">write_netcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the bathymetry as netcdf file</span>

<span class="sd">        - **file**: Output netcdf file name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">),</span><span class="s1">&#39;Your netcdf file name must end with .nc&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">cdms</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">from_bathy_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<div class="viewcode-block" id="Bathy.write_ascii"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.Bathy.write_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">write_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%10f</span><span class="s1"> </span><span class="si">%10f</span><span class="s1"> </span><span class="si">%10f</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the bathymetry as an ascii file in the format : x y z</span>

<span class="sd">        - **file**: Output file name</span>

<span class="sd">        - *fmt*: Format of lines [default: &#39;%10f %10f %10f&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bathy1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bathy1d</span><span class="p">)):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lon2d</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_lat2d</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">bathy1d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">bathy1d</span>
        <span class="nb">print</span> <span class="s1">&#39;Bathy wrote to ascii file&#39;</span><span class="p">,</span><span class="n">file</span></div></div>


<div class="viewcode-block" id="plot_bathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.plot_bathy">[docs]</a><span class="k">def</span> <span class="nf">plot_bathy</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow_stretch</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">shadow_shapiro</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow_alpha</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">shadow_black</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">white_deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nmax</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
    <span class="n">zmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a bathymetry</span>

<span class="sd">    - *lon*: Longitude range.</span>
<span class="sd">    - *lat*: Latitude range.</span>
<span class="sd">    - *show*:Display the figure [default: True]</span>
<span class="sd">    - *pcolor*: Use pcolor instead of contour [default: False]</span>
<span class="sd">    - *contour*: Add line contours [default: True]</span>
<span class="sd">    - *shadow*:Plot south-west shadows instead of filled contours.</span>
<span class="sd">    - *nmax*: Max number of levels for contours [default: 30]</span>
<span class="sd">    - *white_deep*: Deep contours are white [default: False]</span>
<span class="sd">    - All other keyword are passed to :func:`~vacumm.misc.plot.map2`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Input</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">bathy</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="n">GriddedBathy</span><span class="p">):</span>
        <span class="n">bathy</span> <span class="o">=</span> <span class="n">bathy</span><span class="o">.</span><span class="n">bathy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span>
            <span class="n">xxs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="s1">&#39;_xxs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">yys</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="s1">&#39;_yys&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xxs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lon2d</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">_lon2d</span>
                <span class="n">lat2d</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">_lat2d</span>
    <span class="k">elif</span> <span class="n">shadow</span><span class="p">:</span>
        <span class="n">xxs</span> <span class="o">=</span> <span class="n">yys</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">lon2d</span><span class="p">,</span><span class="n">lat2d</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">get_axis</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">getValue</span><span class="p">(),</span><span class="n">get_axis</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>

    <span class="c1"># Masking</span>
    <span class="k">if</span> <span class="s1">&#39;maxdep&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">zmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">maxdep</span>
    <span class="k">if</span> <span class="s1">&#39;maxalt&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">zmax</span> <span class="o">=</span> <span class="n">maxalt</span>
    <span class="k">if</span> <span class="n">zmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bathy</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="n">zmin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bathy</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="n">zmax</span><span class="p">)</span>

    <span class="c1"># Default arguments for map</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="n">bathy</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">):</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">minmax</span><span class="p">(</span><span class="n">bathy</span><span class="p">)</span>
<span class="c1">#        print &#39;cmap topo&#39;, vmin, vmax</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auto_cmap_topo</span><span class="p">((</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vmin&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)))</span>
<span class="c1">#       kwargs.setdefault(&#39;ticklabel_size&#39;,&#39;smaller&#39;)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;clabel_fontsize&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;clabel_alpha&#39;</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;clabel_glow_alpha&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clabel_alpha&#39;</span><span class="p">])</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;contourf&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nmax</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contour</span>
    <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;projection&#39;</span><span class="p">,</span> <span class="s1">&#39;merc&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;fmt&#39;</span><span class="p">,</span> <span class="n">BathyFormatter</span><span class="p">())</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;colorbar_format&#39;</span><span class="p">,</span> <span class="n">BathyFormatter</span><span class="p">())</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;levels_mode&#39;</span><span class="p">,</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;0.8&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;contour_linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">savefig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;savefig&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwsavefig</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;savefig_&#39;</span><span class="p">)</span>


    <span class="c1"># White contour when dark</span>
    <span class="k">if</span> <span class="n">contour</span> <span class="ow">and</span> <span class="n">white_deep</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span><span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nlevel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nlevel</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nlevel</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;contour_colors&#39;</span><span class="p">,</span><span class="nb">tuple</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>

    <span class="c1"># Call to map</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">map2</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Add shadow</span>
    <span class="k">if</span> <span class="n">shadow</span><span class="p">:</span>

        <span class="c1"># Filter</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">MV</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">fill_value</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shadow_shapiro</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">shapiro2d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Gradient</span>
        <span class="n">grd</span> <span class="o">=</span> <span class="n">deriv2d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="mf">45.</span><span class="p">,</span><span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fill_value</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="n">grdn</span> <span class="o">=</span> <span class="n">refine</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">grdn</span> <span class="o">=</span> <span class="n">norm_atan</span><span class="p">(</span><span class="n">grdn</span><span class="p">,</span><span class="n">stretch</span><span class="o">=</span><span class="n">shadow_stretch</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span> <span class="p">;</span> <span class="k">del</span> <span class="n">grd</span>

        <span class="c1"># Grid</span>
<span class="c1">#           im = m.map.imshow(grdn,cmap=P.get_cmap(&#39;gist_yarg&#39;),alpha=1) # gist_yarg , YlGnBu</span>
        <span class="k">if</span> <span class="n">xxs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">yys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lon2d</span><span class="p">,</span><span class="n">lat2d</span><span class="p">)</span>
            <span class="n">xxr</span> <span class="o">=</span> <span class="n">refine</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">yyr</span> <span class="o">=</span> <span class="n">refine</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">xxs</span><span class="p">,</span> <span class="n">yys</span> <span class="o">=</span> <span class="n">meshbounds</span><span class="p">(</span><span class="n">xxr</span><span class="p">,</span> <span class="n">yyr</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">GriddedBathy</span><span class="p">):</span>
                <span class="n">bb</span><span class="o">.</span><span class="n">_xxs</span> <span class="o">=</span> <span class="n">xxs</span>
                <span class="n">bb</span><span class="o">.</span><span class="n">_yys</span> <span class="o">=</span> <span class="n">yys</span>
            <span class="k">del</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">xxr</span><span class="p">,</span> <span class="n">yyr</span>

        <span class="c1"># Cmap</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap_custom</span><span class="p">((</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">((</span><span class="n">shadow_black</span><span class="p">,</span> <span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">))</span>

        <span class="c1"># Plot</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xxs</span><span class="p">,</span> <span class="n">yys</span><span class="p">,</span> <span class="n">grdn</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span><span class="c1">#P.get_cmap(&#39;gist_yarg&#39;))</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">shadow_alpha</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">del</span> <span class="n">grdn</span>

    <span class="c1"># Show it?</span>
    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwsavefig</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">m</span></div>

<span class="n">bathy</span><span class="o">=</span><span class="n">Bathy</span>

<span class="k">class</span> <span class="nc">BathyFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Label formatter for contour&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> m&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed</span> <span class="o">=</span> <span class="n">signed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span>
    <span class="k">def</span> <span class="nf">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span> <span class="o">%</span> <span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signed</span> <span class="ow">and</span> <span class="n">val</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">s</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">%</span> <span class="n">val</span>


<div class="viewcode-block" id="XYZBathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathy">[docs]</a><span class="k">class</span> <span class="nc">XYZBathy</span><span class="p">(</span><span class="n">XYZ</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For random bathymetries, like mnt files</span>

<span class="sd">        - **xyz**: A (x,y,z) tuple or a xyz file.</span>
<span class="sd">        - *long_name*: Long name (like a title) for this bathymetry.</span>

<span class="sd">    .. note::</span>

<span class="sd">        Bathymetry is supposed to be positive over water.</span>

<span class="sd">    :Usage:</span>

<span class="sd">        &gt;&gt;&gt; xzy1 = XZY(&#39;bathy1.xzy&#39;, long_name=&#39;My bathy&#39;)           # Load</span>
<span class="sd">        &gt;&gt;&gt; xyz1.select([-6,45,-4,48])</span>
<span class="sd">        &gt;&gt;&gt; xyz1 += XZY(&#39;bathy2.xzy&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print xyz1.x</span>
<span class="sd">        &gt;&gt;&gt; bathy = xyz1.togrid(mygrid)</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        :class:`~vacumm.misc.io.XYZ` :class:`~vacumm.bathy.shoreline` :class:`~vacumm.tide.station_info.MeanSeaLevel`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">check_sign</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Initialize</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Bathymetry&#39;</span><span class="p">)</span>
        <span class="n">XYZ</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Negative bathy</span>
        <span class="k">if</span> <span class="n">check_sign</span><span class="p">:</span>
            <span class="n">zmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span>
            <span class="n">zmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span>
            <span class="k">if</span> <span class="n">zmax</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="p">(</span><span class="n">zmin</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">zmin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">zmax</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">[:]</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span>


<div class="viewcode-block" id="XYZBathy.togrid"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathy.togrid">[docs]</a>    <span class="k">def</span> <span class="nf">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="n">proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>


        <span class="c1"># Shoreline for masking</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MV2</span><span class="o">.</span><span class="n">nomask</span> <span class="ow">and</span> <span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Clip for polygons</span>
            <span class="n">kwmask</span> <span class="o">=</span> <span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;mask&#39;</span><span class="p">)</span>
            <span class="n">clip</span> <span class="o">=</span> <span class="n">kwmask</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;clip&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">get_xy</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">;</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="p">;</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">*</span><span class="n">clip</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span><span class="o">*</span><span class="n">clip</span>
                <span class="n">clip</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="n">ymin</span><span class="o">-</span><span class="n">dy</span><span class="p">,</span> <span class="n">xmax</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">ymax</span><span class="o">+</span><span class="n">dy</span><span class="p">]</span>

            <span class="c1"># Auto resolution</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">(</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">))</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">get_best</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

            <span class="c1"># Direct handling</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Shapes</span><span class="p">)):</span>
                <span class="c1"># Get mask</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">get_shoreline</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">clip</span><span class="p">)</span>

        <span class="c1"># Normal case</span>
        <span class="k">return</span> <span class="n">XYZ</span><span class="o">.</span><span class="n">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cgrid</span><span class="o">=</span><span class="n">cgrid</span><span class="p">,</span>  <span class="n">proj</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="n">togrid</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">XYZ</span><span class="o">.</span><span class="n">togrid</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="XYZBathy.bathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathy.bathy">[docs]</a>    <span class="k">def</span> <span class="nf">bathy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Alias for :meth:`togrid`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">togrid</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="XYZBathy.plot"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathy.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">XYZ</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="n">plot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">XYZ</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">+</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    .. seealso::</span>

<span class="s2">        For value of default parameters: :meth:`~vacumm.misc.io.XYZ.plot`</span>
<span class="s2">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="XYZBathyBankClient"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBankClient">[docs]</a><span class="k">class</span> <span class="nc">XYZBathyBankClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An single element (bathy infos) of the :class:`XYZBathyBank`</span>

<span class="sd">    - **bank**: A bank instance.</span>
<span class="sd">    - **id**:Id of this bathy.</span>
<span class="sd">    - Other keywords are set as attributes (like long_name, etc).</span>

<span class="sd">    :Usage:</span>

<span class="sd">    Let ``xyzbc`` being an element of the bank.</span>

<span class="sd">    &gt;&gt;&gt; print xyzbc</span>
<span class="sd">    &gt;&gt;&gt; xyzbc.long_name = &#39;New long name&#39;</span>
<span class="sd">    &gt;&gt;&gt; xyzbc.xmax = -2.</span>
<span class="sd">    &gt;&gt;&gt; xyzbc.transp = False</span>
<span class="sd">    &gt;&gt;&gt; xyzbc.id = &#39;iroise&#39;             # Rename in the bank</span>
<span class="sd">    &gt;&gt;&gt; xyzbc.xyzfile = &#39;newfile.mnt&#39;   # xmin, xmax, ymin, ymax updated</span>
<span class="sd">    &gt;&gt;&gt; xyz = xyzbc.load()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_atts</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;xyzfile&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ymin&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ymax&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;transp&#39;</span><span class="p">,</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="n">bank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">bank</span><span class="o">.</span><span class="n">cfg</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="s1">&#39;No such bathy id &quot;</span><span class="si">%s</span><span class="s1">&quot; in bathy bank&#39;</span><span class="o">%</span><span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;xyzfile&#39;</span><span class="p">),</span> <span class="s1">&#39;No &quot;xyzfile&quot; defined for bathy &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="o">%</span><span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">att</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_atts_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">att</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atts</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atts_</span><span class="p">():</span>
            <span class="n">info</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">_get_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atts_</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
        <span class="n">get</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span><span class="s1">&#39;get&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_atts</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atts</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atts_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_</span><span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">att</span> <span class="o">==</span> <span class="s1">&#39;xyzfile&#39;</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="s1">&#39;xmin&#39;</span><span class="p">,</span> <span class="s1">&#39;xmax&#39;</span><span class="p">,</span> <span class="s1">&#39;ymin&#39;</span><span class="p">,</span> <span class="s1">&#39;ymax&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">remove_option</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">att</span> <span class="o">==</span> <span class="s1">&#39;id&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">):</span>
                <span class="c1"># Rename section</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">att</span><span class="p">),</span> <span class="s1">&#39;Bathy id &quot;</span><span class="si">%s</span><span class="s1">&quot; already exists!&#39;</span><span class="o">%</span><span class="n">att</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">opt</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">remove_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">_clients</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">id</span> <span class="o">==</span> <span class="s1">&#39;cfg&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s2">&quot;You can&#39;t change the cfg file&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atts_</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_check_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that infos are consistent&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xyzfile</span><span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> xyz bathy file does not exist&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">xyzfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fill what is missing</span>
            <span class="k">if</span> <span class="n">att</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">atts</span> <span class="o">=</span> <span class="p">[</span><span class="n">att</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atts_</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">atts</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_</span><span class="p">(</span><span class="n">att</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xyz</span> <span class="o">=</span> <span class="n">XYZBathy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xyzfile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">att</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">att</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_</span><span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">att</span><span class="p">))</span>
<span class="c1">#               elif xyz.long_name is not None:</span>
<span class="c1">#                   self.long_name = xyz.long_name</span>
<span class="c1">#               elif xyz.units is not None:</span>
<span class="c1">#                   self.units = xyz.units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<div class="viewcode-block" id="XYZBathyBankClient.save"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBankClient.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the bank&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>

<div class="viewcode-block" id="XYZBathyBankClient.load"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBankClient.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the bathymetry as a :class:`XYZBathy` instance</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            :meth:`~vacumm.misc.io.XYZ.clip`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xyzfile</span><span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> xyz bathy file does not exist&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">xyzfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">XYZBathy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xyzfile</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">long_name</span><span class="p">,</span> <span class="n">transp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transp</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">zone</span> <span class="o">!=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">zone</span><span class="o">=</span><span class="n">zone</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">xyz</span></div>

<div class="viewcode-block" id="XYZBathyBankClient.plot"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBankClient.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load and plot this bathy&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="XYZBathyBank"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank">[docs]</a><span class="k">class</span> <span class="nc">XYZBathyBank</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bank of XYZ bathymetry infos</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        :class:`XYZBathyBankClient`</span>

<span class="sd">    :Usage:</span>

<span class="sd">    &gt;&gt;&gt; xyzb = XYZBathyBank()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Guess file name</span>
        <span class="k">if</span> <span class="n">cfgfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">get_config_value</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;cfgfile_xyz&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="s1">&#39;banks&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">):</span>
                <span class="n">cfgfile</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;banks&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">)</span>
            <span class="c1">#else:</span>
            <span class="c1">#    raise Exception, &#39;Cannot read config file to guess bank file name&#39;</span>
        <span class="c1"># Read file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">SafeConfigParser</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span> <span class="o">=</span> <span class="n">cfgfile</span>
        <span class="k">if</span> <span class="n">cfgfile</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">XYZBathyBankClient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="XYZBathyBank.ids"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.ids">[docs]</a>    <span class="k">def</span> <span class="nf">ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the list of bathy ids&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;No bathymetry&#39;</span>
        <span class="n">infos</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">():</span>
            <span class="n">infos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="nb">id</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infos</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">())</span>

<div class="viewcode-block" id="XYZBathyBank.add"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyzfile</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a bathy to the bank</span>

<span class="sd">        - **xyzfile**: xyz file.</span>
<span class="sd">        - *id*: Id of the bank. If ``None``, it is guessed from the file name:</span>
<span class="sd">           ``xyzfile=&quot;/path/toto.xyz&quot;`` -&gt;  ``id=&quot;toto&quot;``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">xyzfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">id</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xyz&#39;</span><span class="p">):</span> <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">remove_section</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="s1">&#39;Bathymetry </span><span class="si">%s</span><span class="s1"> already exists&#39;</span><span class="o">%</span><span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;xyzfile&#39;</span><span class="p">,</span> <span class="n">xyzfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">XYZBathyBankClient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c1">#       self._save_()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_order_</span><span class="p">()</span></div>
    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="XYZBathyBank.remove"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a bathy from the bank</span>

<span class="sd">        *id*: A bathy id or :class:`XYZBathyBankClient` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">XYZBathyBankClient</span><span class="p">):</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No such bathymetry </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">remove_section</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_order_</span><span class="p">()</span></div>
<span class="c1">#       self._save_()</span>
    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="XYZBathyBank.copy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy bathy infos to another&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">id1</span><span class="p">),</span> <span class="s1">&#39;No such bathymetry </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">id1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">id2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="n">id2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">id1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">id2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span> <span class="n">opt</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="n">id2</span><span class="p">]</span> <span class="o">=</span> <span class="n">XYZBathyBankClient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_order_</span><span class="p">()</span></div>
<span class="c1">##      self._save_()</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="s1">&#39;No such bathymetry </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">xyzfile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">xyzfile</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__deltiem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

<div class="viewcode-block" id="XYZBathyBank.load"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a bathymetry as a :class:`XYZBathy` instance&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="s1">&#39;No such bathymetry &#39;</span><span class="o">+</span><span class="nb">id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span></div>

<div class="viewcode-block" id="XYZBathyBank.list"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all clients of the bank as a list&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>

<div class="viewcode-block" id="XYZBathyBank.select"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of bathymetries relevant to the specified region</span>

<span class="sd">        - *margin*: Margin for loading xyz bathies:</span>

<span class="sd">            - if None, the whole bathy is loaded from the bank,</span>
<span class="sd">            - else it should be a value relative to the approximative resolution (see :meth:`XYZBathy.resol`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">():</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
            <span class="k">if</span>   <span class="p">(</span><span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ymin</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ymax</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ymax</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">ymin</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">load</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">zone</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_order</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ordered</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_order</span><span class="p">()</span> <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
            <span class="n">res</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">cmp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_order</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_order</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="XYZBathyBank.set_order"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.set_order">[docs]</a>    <span class="k">def</span> <span class="nf">set_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a list of ids to define the order&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">defaults</span><span class="p">()[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">defaults</span><span class="p">()[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">([</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">order</span> <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">()])</span></div>
<div class="viewcode-block" id="XYZBathyBank.get_order"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.get_order">[docs]</a>    <span class="k">def</span> <span class="nf">get_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot;Get a list of ids that define the order&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_update_order_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_order</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">defaults</span><span class="p">()[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">([</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_order</span><span class="p">()</span> <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">()])</span>

<div class="viewcode-block" id="XYZBathyBank.save"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cfgfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cfgfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span> <span class="o">=</span> <span class="n">cfgfile</span>
        <span class="k">if</span> <span class="n">cfgfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VACUMMError</span><span class="p">(</span><span class="s1">&#39;You must provide a valid file name&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="XYZBathyBank.merger"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.merger">[docs]</a>    <span class="k">def</span> <span class="nf">merger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a :class:`XYZBathyMerger` instance using the current bank</span>

<span class="sd">        Keywords are passed to :meth:`select`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">merger</span> <span class="o">=</span> <span class="n">XYZBathyMerger</span><span class="p">()</span>
        <span class="n">merger</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merger</span></div>

<div class="viewcode-block" id="XYZBathyBank.plot"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyBank.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot current bathies using a :class:`XYZBathyMerger` instance&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">merger</span><span class="p">(</span><span class="o">**</span><span class="n">kwfilter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;merger&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="XYZBathyMerger"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyMerger">[docs]</a><span class="k">class</span> <span class="nc">XYZBathyMerger</span><span class="p">(</span><span class="n">XYZMerger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mix different bathymetries&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bank</span> <span class="o">=</span> <span class="n">XYZBathyBank</span><span class="p">()</span>
        <span class="n">XYZMerger</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
            <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_XYZ</span> <span class="o">=</span> <span class="n">XYZBathy</span>

    <span class="k">def</span> <span class="nf">_load_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># Bathy from the bank</span>
        <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bank</span><span class="o">.</span><span class="n">ids</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bank</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="c1"># Classic cases</span>
        <span class="k">return</span> <span class="n">XYZMerger</span><span class="o">.</span><span class="n">_load_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

<div class="viewcode-block" id="XYZBathyMerger.from_bank"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyMerger.from_bank">[docs]</a>    <span class="k">def</span> <span class="nf">from_bank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Append all bathymetries from the bank that cover the grid</span>

<span class="sd">        - *margin*: Relative margin for clipping datasets from the bank (see :meth:`~vacumm.misc.io.XYZ.clip` and :meth:`~vacumm.misc.io.XYZ.resol`)</span>

<span class="sd">        All parameters are passed to :meth:`XYZBathyBank.select`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bank</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xmax</span><span class="p">,</span>
            <span class="n">ymin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ymax</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">)</span></div>

<div class="viewcode-block" id="XYZBathyMerger.plot"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyMerger.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;XYZ merger&#39;</span><span class="p">,</span>
        <span class="n">m</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefigs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">XYZMerger</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="n">colorbar</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="n">savefig</span><span class="p">,</span> <span class="n">savefigs</span><span class="o">=</span><span class="n">savefigs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="n">plot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">XYZMerger</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="vm">__doc__</span>

<div class="viewcode-block" id="XYZBathyMerger.bathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.XYZBathyMerger.bathy">[docs]</a>    <span class="k">def</span> <span class="nf">bathy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a gridded bathymetry&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="p">()</span><span class="o">.</span><span class="n">bathy</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">_GriddedBathyMasked_</span><span class="p">:</span>
    <span class="n">_shoreline_mask</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_shoreline_margin</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">_shoreline_arg</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">shoreline</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="c1">#        self._masked_bathy = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_shoreline</span><span class="p">(</span><span class="n">shoreline</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_maxvalue</span><span class="p">(</span><span class="n">maxvalue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_fillvalue</span><span class="p">(</span><span class="n">fillvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_maxvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxvalue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the value over which bathy is masked.</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **maxvalue**: If not set to a scalar, bathy is not masked in this way.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxvalue</span> <span class="o">=</span> <span class="n">maxvalue</span>

    <span class="k">def</span> <span class="nf">set_fillvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fillvalue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set filling value when bathy is masked.</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **fillvalue**: If not set to a scalar, bathy is not filled when masked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fillvalue</span> <span class="o">=</span> <span class="n">fillvalue</span>

    <span class="k">def</span> <span class="nf">set_shoreline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shoreline</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the shoreline that to create a mask</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **shoreline**: ``&#39;auto&#39;``, :class:`~vacumm.bathy.ShoreLine` instance,</span>
<span class="sd">              argument to :func:`~vacumm.bathy.shoreline.get_shoreline`.</span>
<span class="sd">              If ``None`` or ``False``, shoreline is not used.</span>

<span class="sd">        .. note:: The mask is applied only if :meth:`masked_bathy` is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">shoreline</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span> <span class="ow">or</span> <span class="n">shoreline</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">shoreline</span> <span class="o">=</span> <span class="n">get_bestres</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lon</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lat</span><span class="p">()))</span>
        <span class="k">elif</span> <span class="n">shoreline</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">shoreline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_mask</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_masked_bathy</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">shoreline</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get the shoreline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_arg</span> <span class="o">=</span> <span class="n">shoreline</span>
        <span class="k">if</span> <span class="n">margin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_margin</span> <span class="o">=</span> <span class="n">margin</span>

    <span class="k">def</span> <span class="nf">get_shoreline_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the shoreline mask&quot;&quot;&quot;</span>
        <span class="c1"># We already have it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_mask</span>
        <span class="c1"># We skip</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_arg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>

        <span class="c1"># We compute it</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lon</span><span class="p">()</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lat</span><span class="p">()</span>
        <span class="n">xres</span><span class="p">,</span> <span class="n">yres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">()</span>
        <span class="n">clip</span> <span class="o">=</span> <span class="p">[</span><span class="n">lon</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_margin</span><span class="o">*</span><span class="n">xres</span><span class="p">,</span>
            <span class="n">lat</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_margin</span><span class="o">*</span><span class="n">yres</span><span class="p">,</span>
            <span class="n">lon</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_margin</span><span class="o">*</span><span class="n">xres</span><span class="p">,</span>
            <span class="n">lat</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_margin</span><span class="o">*</span><span class="n">yres</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_arg</span><span class="p">,</span> <span class="n">ShoreLine</span><span class="p">):</span>
            <span class="n">shoreline</span> <span class="o">=</span> <span class="n">get_shoreline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_arg</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">clip</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shoreline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shoreline</span> <span class="o">=</span> <span class="n">shoreline</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">clip</span><span class="p">)</span>

        <span class="c1"># Get the polygons</span>
        <span class="n">polys</span> <span class="o">=</span> <span class="n">shoreline</span><span class="o">.</span><span class="n">get_shapes</span><span class="p">()</span>

        <span class="c1"># Create the mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_mask</span> <span class="o">=</span> <span class="n">polygon_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">(),</span> <span class="n">polys</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">polys</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shoreline_mask</span>

    <span class="k">def</span> <span class="nf">reset_shoreline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the shoreline&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_shoreline</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">masked_bathy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a masked version of the bathymetry&quot;&quot;&quot;</span>
        <span class="c1"># Mask with value</span>
        <span class="n">bathy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxvalue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">N</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maxvalue</span><span class="p">):</span>
            <span class="n">bathy</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxvalue</span><span class="p">)</span>

        <span class="c1"># Not already available</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_shoreline_mask</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bathy</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Fill</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fillvalue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">N</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillvalue</span><span class="p">):</span>
            <span class="n">bathy</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">bathy</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillvalue</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt_bathy</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">)</span>

<div class="viewcode-block" id="fmt_bathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.fmt_bathy">[docs]</a><span class="k">def</span> <span class="nf">fmt_bathy</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format a bathymetry variable&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">bathy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="k">if</span> <span class="n">bathy</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;variable_&#39;</span><span class="p">):</span> <span class="n">bathy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;bathy&#39;</span>
    <span class="k">if</span> <span class="n">long_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">bathy</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="n">long_name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">bathy</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">):</span> <span class="n">bathy</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;Bathymetry&#39;</span>
    <span class="n">bathy</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
    <span class="k">return</span> <span class="n">bathy</span></div>



<div class="viewcode-block" id="GriddedBathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy">[docs]</a><span class="k">class</span> <span class="nc">GriddedBathy</span><span class="p">(</span><span class="n">_GriddedBathyMasked_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Interface to gridded bathymetries</span>

<span class="sd">    :Usage:</span>

<span class="sd">        &gt;&gt;&gt; b = GriddedBathy(var, shoreline=&#39;f&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b.plot_bathy(title=&#39;Bathymetry&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b.save(&#39;bathy.nc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; newvar = b.bathy(mask=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">shoreline</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">designateLongitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">designateLatitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">setGrid</span><span class="p">(</span><span class="n">create_grid</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">(),</span> <span class="n">var</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span> <span class="o">=</span> <span class="n">var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xres</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yres</span> <span class="o">=</span> <span class="n">resol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_grid</span><span class="p">())</span>
        <span class="n">_GriddedBathyMasked_</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shoreline</span><span class="o">=</span><span class="n">shoreline</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="n">maxvalue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon2d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat2d</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lon</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lat</span><span class="p">())</span>
<span class="c1">#        self._lon2dp,self._lat2dp = meshbounds(self.get_lon(), self.get_lat())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yys</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="GriddedBathy.get_lon"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy.get_lon">[docs]</a>    <span class="k">def</span> <span class="nf">get_lon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="GriddedBathy.get_lat"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy.get_lat">[docs]</a>    <span class="k">def</span> <span class="nf">get_lat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
<div class="viewcode-block" id="GriddedBathy.get_grid"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy.get_grid">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="o">.</span><span class="n">setGrid</span><span class="p">(</span><span class="n">create_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_lon</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lat</span><span class="p">()))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span></div>
<div class="viewcode-block" id="GriddedBathy.get_res"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy.get_res">[docs]</a>    <span class="k">def</span> <span class="nf">get_res</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xres</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yres</span></div>

<div class="viewcode-block" id="GriddedBathy.plot"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot using :func:`plot_bathy`&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mask</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;fillcontinents&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_bathy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GriddedBathy.regrid"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy.regrid">[docs]</a>    <span class="k">def</span> <span class="nf">regrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Regrid bathy to another grid&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">regrid2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">),</span> <span class="n">grid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GriddedBathy.bathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy.bathy">[docs]</a>    <span class="k">def</span> <span class="nf">bathy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the bathymetry variable</span>

<span class="sd">        :Params:</span>

<span class="sd">            - *mask*: If True and if a shoreline is set (with :meth:`set_shoreline`), apply a mask due to this shoreline.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">masked_bathy</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt_bathy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="GriddedBathy.save"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathy.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ncfile</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save bathy to a netcdf file</span>

<span class="sd">        :Params:</span>

<span class="sd">            - **ncfile**: Output netcdf file name</span>
<span class="sd">            - Other keywords are passed to :meth:`bathy`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bathy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathy</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ncfile</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bathy</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<span class="kn">from</span> <span class="nn">vacumm.misc.grid.regridding</span> <span class="k">import</span> <span class="n">GriddedMerger</span>
<div class="viewcode-block" id="GriddedBathyMerger"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathyMerger">[docs]</a><span class="k">class</span> <span class="nc">GriddedBathyMerger</span><span class="p">(</span><span class="n">GriddedMerger</span><span class="p">,</span> <span class="n">GriddedBathy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merger of gridded variables</span>

<span class="sd">    :Usage:</span>

<span class="sd">    &gt;&gt;&gt; merger = GriddedMerger(mygrid, long_name=&#39;My bathy&#39;)</span>
<span class="sd">    &gt;&gt;&gt; merger += etopo2(lon=(-10,0),lat=(42,50))</span>
<span class="sd">    &gt;&gt;&gt; merger += my_bathy</span>
<span class="sd">    &gt;&gt;&gt; merger.set_shoreline(&#39;i&#39;)</span>
<span class="sd">    &gt;&gt;&gt; merged_bathy = merger.bathy()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">shoreline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>

        <span class="n">GriddedMerger</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="n">_GriddedBathyMasked_</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shoreline</span><span class="o">=</span><span class="n">shoreline</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="n">maxvalue</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked_bathy</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_load_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">isVariable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;bathy&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">bathy</span><span class="p">):</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">bathy</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GriddedMerger</span><span class="o">.</span><span class="n">_load_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

<div class="viewcode-block" id="GriddedBathyMerger.merge"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathyMerger.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_ratio</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merge all variables onto the grid and apply final mask&quot;&quot;&quot;</span>
        <span class="c1"># Merge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span> <span class="o">=</span> <span class="n">GriddedMerger</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_ratio</span><span class="o">=</span><span class="n">res_ratio</span><span class="p">)</span>

        <span class="c1"># Mask</span>
        <span class="n">masked_bathy</span> <span class="o">=</span> <span class="n">GriddedBathy</span><span class="o">.</span><span class="n">bathy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">)</span>

        <span class="c1"># Finalize</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked_bathy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masked_bathy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">masked_bathy</span></div>

<div class="viewcode-block" id="GriddedBathyMerger.bathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathyMerger.bathy">[docs]</a>    <span class="k">def</span> <span class="nf">bathy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shortcut to :meth:`merge`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GriddedBathyMerger.plot"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.GriddedBathyMerger.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot merged bathy</span>

<span class="sd">        .. seealso:: :meth:`GriddedBathy.plot`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bathy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">merge</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">GriddedBathy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="NcGriddedBathyError"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.NcGriddedBathyError">[docs]</a><span class="k">class</span> <span class="nc">NcGriddedBathyError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="NcGriddedBathy"><a class="viewcode-back" href="../../../library/bathy.bathy.html#vacumm.bathy.bathy.NcGriddedBathy">[docs]</a><span class="k">class</span> <span class="nc">NcGriddedBathy</span><span class="p">(</span><span class="n">GriddedBathy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a gridded bathymetry from file</span>

<span class="sd">    :Params:</span>

<span class="sd">        - **lon/lat**, optional: Longitude and latitude selection.</span>
<span class="sd">        - **name**, optional: It is either</span>

<span class="sd">            - the name of bathymetry within the list given by :func:`print_bathy_list`</span>
<span class="sd">            - the name of netcdf file.</span>
<span class="sd">        - **i/jmargin**: Add or suppress a marginal grid points to the selected area (integer).</span>

<span class="sd">    :Example:</span>

<span class="sd">        &gt;&gt;&gt; b = NcGriddedBathy(lon=(-6,-4), lat=(48,49), maxvalue=None)</span>
<span class="sd">        &gt;&gt;&gt; b.save(&#39;bathy.nc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b.regrid(mygrid)</span>
<span class="sd">        &gt;&gt;&gt; b.plot(savefig=&#39;bathy.png&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b2 = NcGriddedBathy(name=&#39;bathy.nc&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cfgfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">varname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lonname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shoreline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">imargin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">jmargin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Source</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span> <span class="c1"># direct from netcf file</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bathyname</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varname</span> <span class="o">=</span> <span class="n">varname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonname</span> <span class="o">=</span> <span class="n">lonname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latname</span> <span class="o">=</span> <span class="n">latname</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># from config file</span>

            <span class="n">bathyname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bathyname&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">bathies</span> <span class="o">=</span> <span class="n">bathy_list</span><span class="p">(</span><span class="n">cfgfile</span><span class="o">=</span><span class="n">cfgfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bathyname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;etopo2&#39;</span> <span class="ow">in</span> <span class="n">bathies</span><span class="p">:</span>
                    <span class="n">bathyname</span> <span class="o">=</span> <span class="s1">&#39;etopo2&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kk</span> <span class="o">=</span> <span class="n">bathies</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="c1">#                    if not len(kk):</span>
<span class="c1">#                        raise NcGriddedBathyError(&#39;No valid bathymetry found&#39;)</span>
                    <span class="n">bathyname</span> <span class="o">=</span> <span class="n">kk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">_check_bathy_file_</span><span class="p">(</span><span class="n">bathyname</span><span class="p">)</span>
            <span class="n">mybathy</span> <span class="o">=</span> <span class="n">bathies</span><span class="p">[</span><span class="n">bathyname</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonname</span> <span class="o">=</span> <span class="n">lonname</span> <span class="ow">or</span> <span class="n">mybathy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latname</span> <span class="o">=</span> <span class="n">latname</span> <span class="ow">or</span> <span class="n">mybathy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varname</span> <span class="o">=</span> <span class="n">varname</span> <span class="ow">or</span> <span class="n">mybathy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bathyname</span> <span class="o">=</span> <span class="n">bathyname</span>

        <span class="c1"># Read</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NcGriddedBathyError</span><span class="p">(</span><span class="s1">&#39;Bathymetry file not found: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1"># - var name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">listvariables</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">varname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;bounds_&#39;</span><span class="p">):</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">varname</span> <span class="o">=</span> <span class="n">varname</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NcGriddedBathyError</span><span class="p">(</span><span class="s1">&#39;Cannot find a valid 2D variable in bathy file: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">varname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">listvariables</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NcGriddedBathyError</span><span class="p">(</span><span class="s1">&#39;Variable not in bathy file: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NcGriddedBathyError</span><span class="p">(</span><span class="s1">&#39;Bathy variable not 2D: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">)</span>
        <span class="c1"># - dim names</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lonname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonname</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lonname</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">listdimension</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lonname</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Bad longitude name &quot;</span><span class="si">%s</span><span class="s1">&quot; for variable &quot;</span><span class="si">%s</span><span class="s1">&quot;. Skipping...&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lonname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cdms</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">longitude_aliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lonname</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">latname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latname</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">latname</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">listdimension</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latname</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Bad latitude name &quot;</span><span class="si">%s</span><span class="s1">&quot; for variable &quot;</span><span class="si">%s</span><span class="s1">&quot;. Skipping...&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cdms</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">latitude_aliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latname</span><span class="p">)</span>
        <span class="c1"># - select</span>
        <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">designateLatitude</span><span class="p">()</span>
        <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">designateLongitude</span><span class="p">()</span>
        <span class="n">select</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">lon</span><span class="p">:</span> <span class="n">select</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span>
        <span class="k">if</span> <span class="n">lat</span><span class="p">:</span> <span class="n">select</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat</span>
        <span class="c1"># - read</span>
        <span class="k">if</span> <span class="s1">&#39;lon&#39;</span> <span class="ow">in</span> <span class="n">select</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">imargin</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">imargin</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span><span class="o">.</span><span class="n">mapIntervalExt</span><span class="p">(</span><span class="n">select</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
            <span class="n">select</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">imargin</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">imargin</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">select</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jmargin</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">jmargin</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span><span class="o">.</span><span class="n">mapIntervalExt</span><span class="p">(</span><span class="n">select</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
            <span class="n">select</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">jmargin</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">jmargin</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">bathy</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varname</span><span class="p">,</span> <span class="o">**</span><span class="n">select</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bathyname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bathy</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> bathymetry&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">bathyname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="c1"># Reverse</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">bathy</span><span class="p">[:]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># Finish initialisation</span>
        <span class="n">GriddedBathy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bathy</span><span class="p">,</span> <span class="n">shoreline</span><span class="o">=</span><span class="n">shoreline</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="n">maxvalue</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">fillvalue</span><span class="p">)</span></div>




<span class="c1">######################################################################</span>
<span class="kn">from</span> <span class="nn">shorelines</span> <span class="k">import</span> <span class="n">get_best</span><span class="p">,</span> <span class="n">get_shoreline</span><span class="p">,</span> <span class="n">ShoreLine</span><span class="p">,</span> <span class="n">get_bestres</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid</span> <span class="k">import</span> <span class="n">get_xy</span><span class="p">,</span> <span class="n">axes2d</span><span class="p">,</span> <span class="n">resol</span><span class="p">,</span> <span class="n">create_grid</span><span class="p">,</span> <span class="n">get_grid</span><span class="p">,</span> <span class="n">meshgrid</span><span class="p">,</span> \
    <span class="n">meshbounds</span><span class="p">,</span> <span class="n">get_axis</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid.regridding</span> <span class="k">import</span> <span class="n">griddata</span><span class="p">,</span> <span class="n">refine</span><span class="p">,</span> <span class="n">regrid2d</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid.masking</span> <span class="k">import</span> <span class="n">polygon_mask</span><span class="p">,</span> <span class="n">GetLakes</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.misc</span> <span class="k">import</span> <span class="n">kwfilter</span><span class="p">,</span> <span class="n">auto_scale</span><span class="p">,</span><span class="n">geo_scale</span><span class="p">,</span><span class="n">deplab</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.color</span> <span class="k">import</span> <span class="n">cmap_jete</span><span class="p">,</span> <span class="n">cmap_bathy</span><span class="p">,</span><span class="n">bistre</span><span class="p">,</span> <span class="n">cmap_custom</span><span class="p">,</span> <span class="n">auto_cmap_topo</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.plot</span> <span class="k">import</span> <span class="n">map2</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.filters</span> <span class="k">import</span> <span class="n">norm_atan</span><span class="p">,</span><span class="n">deriv2d</span><span class="p">,</span><span class="n">shapiro2d</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.io</span> <span class="k">import</span> <span class="n">Shapes</span>


<span class="c1">#b = NcGriddedBathy((9.2, 14.2), (-8.3, -3.4))</span>
<span class="c1">#b.plot(mask=True)</span>
<span class="c1">#</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../contents.html">Docs</a>|&nbsp;</li>
        <li><a href="../../../user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="../../../search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="../../../gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../vacumm.html" >vacumm</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>