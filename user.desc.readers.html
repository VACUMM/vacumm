
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Data readers &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Data readers</a><ul>
<li><a class="reference internal" href="#grille-des-lecteurs-et-autres-infos">Grille des lecteurs et autres infos</a></li>
<li><a class="reference internal" href="#sigma-coordinates-reader-and-converters">Sigma coordinates reader and converters</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/user.desc.readers.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="data-readers">
<span id="user-desc-readers"></span><h1>Data readers<a class="headerlink" href="#data-readers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="grille-des-lecteurs-et-autres-infos">
<span id="user-desc-readers-info"></span><h2>Grille des lecteurs et autres infos<a class="headerlink" href="#grille-des-lecteurs-et-autres-infos" title="Permalink to this headline">¶</a></h2>
<p>Il serait utile d’ajouter des méthodes génériques
de récupération d’information sur les fichiers associés aux lecteurs.
Une des méthodes est la lecture de la grille :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mars</span> <span class="o">=</span> <span class="n">MARS</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">mars</span><span class="o">.</span><span class="n">get_grid</span><span class="p">()</span>
</pre></div>
</div>
<p>Elle peut-être sauvegardée en cache.
La date ne sert ici qu’a sélectionner les fichiers à lire.
La récupération de la grille peut alors se faire en cherchant
la première variable qui contient une grille :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ncfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">varname</span><span class="p">,</span> <span class="n">varspec</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">grid</span>  <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
</div>
<div class="section" id="sigma-coordinates-reader-and-converters">
<span id="user-desc-readers-sigma"></span><h2>Sigma coordinates reader and converters<a class="headerlink" href="#sigma-coordinates-reader-and-converters" title="Permalink to this headline">¶</a></h2>
<p>Le but est d’adapter les formulations extantes de gestion des coordonnées sigma
afin de les intégrer dans les “lecteurs” de données (de type classe MARS).
Il est par exemple nécessaire de pouvoir s’adapter à la lecture de plusieurs fichiers.</p>
<p>Il existe le module <code class="xref py py-mod docutils literal notranslate"><span class="pre">actimar.assimilation.sigma</span></code> (lui même adapté de
<code class="xref py py-mod docutils literal notranslate"><span class="pre">pyinterpsig2z.sigma</span></code>) dont il faut s’inspirer.
Les classes de ce module sont explicitement attachée à un fichier,
dont elle tire le type de coordonnées sigma (via <code class="xref py py-meth docutils literal notranslate"><span class="pre">factory()</span></code>),
puis les différents paramètres
ou variables constantes dans le temps.
Le calcul des profondeurs se fait alors à un instant donné en lisant
eta, et les paramètres de profondeur pour une sélection de l’espace donné
(via par exemple <code class="xref py py-meth docutils literal notranslate"><span class="pre">sigma_to_depths()</span></code>).</p>
<p>Le but est alors de lire une seule fois le premier fichier pour
initialiser une classe de sigma en appelant <code class="xref py py-meth docutils literal notranslate"><span class="pre">factory()</span></code>.
Ensuite, il doit être possible de fournir un autre nom (descripteur) de fichier
lors de la conversion de sigma vers les profondeurs.</p>
<p>Exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialisation de l&#39;instance sigma</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;mymarsfile1.nc&#39;</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">Sigma</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
<span class="n">f1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Lecture des profondeurs</span>
<span class="kn">from</span> <span class="nn">cdms2.selectors</span> <span class="k">import</span> <span class="n">Selector</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">48</span><span class="p">))</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;mymarsfile2.nc&#39;</span><span class="p">)</span>
<span class="n">depths</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">.</span><span class="n">sigma_to_depths</span><span class="p">(</span><span class="n">seletor</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f2</span><span class="p">)</span>
</pre></div>
</div>
<p>Le descripteur de fichier est sauvegardé dans l’attribut <code class="xref py py-attr docutils literal notranslate"><span class="pre">Sigma.f</span></code>.
Il suffit simplement de le mettre à jour lors de l’appel de <code class="xref py py-meth docutils literal notranslate"><span class="pre">sigma_to_depths()</span></code>,
et le tour devrait être joué.</p>
<p>L’intégration dans les classes de lecteur peut se faire par exemple
en ajoutant les méthodes suivantes :</p>
<ul class="simple">
<li><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_sigma()</span></code> : création d’une instance <code class="xref py py-class docutils literal notranslate"><span class="pre">Sigma</span></code> avc la méthode <code class="xref py py-meth docutils literal notranslate"><span class="pre">factory()</span></code>.</li>
<li><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_sigma_depths()</span></code> : afin de récupérer les profondeurs.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>