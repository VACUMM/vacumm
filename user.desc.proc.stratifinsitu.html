
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Stratification : comparaisons en eaux peu profondes &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Stratification : comparaisons en eaux peu profondes</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#calculs-prealables">Calculs préalables</a></li>
<li><a class="reference internal" href="#recuperation-des-sorties-du-modeles">Récupération des sorties du modèles</a><ul>
<li><a class="reference internal" href="#champs-grilles">Champs grillés</a></li>
<li><a class="reference internal" href="#colocalisation">Colocalisation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calcul-de-la-pronfondeur-de-couche-melangee">Calcul de la pronfondeur de couche mélangée</a></li>
<li><a class="reference internal" href="#calcul-du-deficit-en-energie-potentielle">Calcul du déficit en énergie potentielle</a></li>
<li><a class="reference internal" href="#calcul-de-l-hydrologie-a-une-profondeur-donnee">Calcul de l’hydrologie à une profondeur donnée</a></li>
<li><a class="reference internal" href="#representation-graphiques">Représentation graphiques</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/user.desc.proc.stratifinsitu.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="stratification-comparaisons-en-eaux-peu-profondes">
<span id="user-desc-proc-stratifinsitu"></span><h1>Stratification : comparaisons en eaux peu profondes<a class="headerlink" href="#stratification-comparaisons-en-eaux-peu-profondes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Nous désirons comparer la profondeur de la couche mélangée (MLD), le déficit en énergie potentielle (PED) et l’hydrologie (température ou salinité) de trois manières différentes :</p>
<blockquote>
<div><ol class="arabic simple">
<li>Tracé des observations (points) sur fond 2D grillés de champs de modèles moyennés sur la période choisie.</li>
<li>Tracé des observations et des champs du modèles colocalisés avec les observations à l’aide d’un gros point (ou carré) pour le modèle et d’un point normal pour les observations.</li>
<li>Tracé des observations sur un champ de points de modèles colocalisés aux observations et interpolé avec griddata (Natgrid) sur la grille du modèle. Il a été noté que cette méthode interpole spatialement entre des points correspondant à des données de dates différentes.</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="calculs-prealables">
<h2>Calculs préalables<a class="headerlink" href="#calculs-prealables" title="Permalink to this headline">¶</a></h2>
<p>Nous faisons l’hypothèse que nous avons à notre disposition la température, la salinité et la profondeur sous la forme de tableaux de profils.</p>
<p>Dans le cas des <strong>données in-situ</strong>, nous avons par exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ndep</span><span class="p">,</span> <span class="n">nprof</span><span class="p">)</span>
<span class="n">sal</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ndep</span><span class="p">,</span> <span class="n">nprof</span><span class="p">)</span>
<span class="n">deps</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ndep</span><span class="p">,</span> <span class="n">nprof</span><span class="p">)</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Les profils in-situ ne sont pas renseignés entièrement dans ces tableaux 2D :
<code class="docutils literal notranslate"><span class="pre">ndep</span></code> est ici le nombre de niveaux verticaux maximal sur l’ensemble des profils.
Les tableaux <code class="docutils literal notranslate"><span class="pre">temp</span></code>, <code class="docutils literal notranslate"><span class="pre">sal</span></code> et <code class="docutils literal notranslate"><span class="pre">deps</span></code> sont ainsi supposés masqués.</p>
</div>
<p>Dans le cas des <strong>sorties de modèle</strong> sur la grille d’origine (instantanées ou moyénées dans le temps) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ndep</span><span class="p">,</span> <span class="n">nlat</span><span class="p">,</span> <span class="n">nlon</span><span class="p">)</span>
<span class="n">sal</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ndep</span><span class="p">,</span> <span class="n">nlat</span><span class="p">,</span> <span class="n">nlon</span><span class="p">)</span>
<span class="n">deps</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ndep</span><span class="p">,</span> <span class="n">nlat</span><span class="p">,</span> <span class="n">nlon</span><span class="p">)</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()[:]</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()[:]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Le tableau des profondeurs est supposé de même dimension que ceux
de la température et la salinité (cas générique).</p>
</div>
<p>Il convient d’abord de récupérer la densité grâce aux formules de l’UNESCO :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seawater</span>

<span class="c1"># Pression</span>
<span class="n">pres</span> <span class="o">=</span> <span class="n">seawater</span><span class="o">.</span><span class="n">csiro</span><span class="o">.</span><span class="n">pres</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">deps</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="c1"># Densité</span>
<span class="n">dens</span> <span class="o">=</span> <span class="n">seawater</span><span class="o">.</span><span class="n">csiro</span><span class="o">.</span><span class="n">dens</span><span class="p">(</span><span class="n">sal</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">pres</span><span class="p">)</span>
</pre></div>
</div>
<p>Il nous faut ensuite l’épaisseur associée à chaque pronfondeur en chaque point.
Pour le cas des profils in-situ :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Indice de profondeur max</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">temp</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

<span class="c1"># Épaisseur de base</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid</span> <span class="k">import</span> <span class="n">meshweights</span>
<span class="n">ddeps</span> <span class="o">=</span> <span class="n">meshweights</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Épaisseur du dernier niveau</span>
<span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">kmax</span><span class="p">):</span>
    <span class="n">ddeps</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ip</span><span class="p">]</span>
</pre></div>
</div>
<p>Pour les sorties de modèle :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ddeps</span> <span class="o">=</span> <span class="n">meshweights</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="recuperation-des-sorties-du-modeles">
<h2>Récupération des sorties du modèles<a class="headerlink" href="#recuperation-des-sorties-du-modeles" title="Permalink to this headline">¶</a></h2>
<div class="section" id="champs-grilles">
<h3>Champs grillés<a class="headerlink" href="#champs-grilles" title="Permalink to this headline">¶</a></h3>
<p>Les calculs sur champs grillés ne sont nécessaires que
pour le <strong>premier graphique</strong>.</p>
<p>Sachant que les profils peuvent couvrir une période temporelle importante,
rendant difficile la lecture et la manipulation de de sorties 4D du
modèle, il est fortement conseillé d’effectuer les calculs
en découpant en périodes de temps pas trop longues (utilisation
de <a class="reference internal" href="library/misc.atime.html#vacumm.misc.atime.Intervals" title="vacumm.misc.atime.Intervals"><code class="xref py py-class docutils literal notranslate"><span class="pre">Intervals</span></code></a> par exemple),
puis en concatenant les résultats.</p>
</div>
<div class="section" id="colocalisation">
<h3>Colocalisation<a class="headerlink" href="#colocalisation" title="Permalink to this headline">¶</a></h3>
<p>Pour les <strong>graphiques 2. et 3.</strong>, il est nécessaire de colocaliser le modèle
avec les observations.
Une fois cette colocalisation effectuées, les calculs se font exactement
de la même manière pour le modèle et les données in-situ.</p>
<p>La méthodologie consiste à boucler sur tous les profils
(de préférence par ordre de temps), puis à interpoler dans le temps
et l’espace horizontal.</p>
<p>On commence par initialiser les tableaux interpolés :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">temp_mars</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ndep_mars</span><span class="p">,</span> <span class="n">nprof</span><span class="p">))</span><span class="o">+</span><span class="n">MV2</span><span class="o">.</span><span class="n">masked</span>
<span class="n">temp_mars</span><span class="o">.</span><span class="n">setAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">temp_obs</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">sal_mod</span> <span class="o">=</span> <span class="n">temp_mod</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">deps_mod</span> <span class="o">=</span> <span class="n">temp_mod</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</pre></div>
</div>
<p>On définit les marges de lecture spatiale du modèle,
afin de lire des mini-blocs autour des profils
(voir <a class="reference internal" href="user.desc.proc.coastdiags.html#user-desc-proc-coastdiags-bour"><span class="std std-ref">Bourrelet d’eau froide</span></a>) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mars</span> <span class="o">=</span> <span class="n">MARS3D</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">mars</span><span class="o">.</span><span class="n">get_grid</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid</span> <span class="k">import</span> <span class="n">resol</span>
<span class="n">xres</span><span class="p">,</span> <span class="n">yres</span> <span class="o">=</span> <span class="n">resol</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
</pre></div>
</div>
<p>On boucle ensuite sur les dates des profils (par exemple une liste
au format <code class="xref py py-class docutils literal notranslate"><span class="pre">cdtime.comptime</span></code>).
Cette boucle temporelle est plus complexe que pour un simple fichier,
car nous traitons le général (sortie de prévisions) à l’aide d’un lecteur :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># On définit une marge de temps pour la recherche des fichiers</span>
<span class="c1"># (fonction de la fréquence des sorties)</span>
<span class="n">dtmax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)</span>

<span class="c1"># Autres inits</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.atime</span> <span class="k">import</span> <span class="n">add</span> <span class="k">as</span> <span class="n">add_time</span>
<span class="n">old_date_interval</span> <span class="o">=</span> <span class="kc">None</span>
<span class="kn">import</span> <span class="nn">cdms2</span>
<span class="n">cdms2</span><span class="o">.</span><span class="n">setAutoBounds</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Boucle temporelle</span>
<span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dates</span><span class="p">):</span>

    <span class="c1"># Limites spatiales</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">lons_obs</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">lats_obs</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span>
    <span class="n">lon_min</span> <span class="o">=</span> <span class="n">lon</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">xres</span>
    <span class="n">lon_max</span> <span class="o">=</span> <span class="n">lon</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">xres</span>
    <span class="n">lat_min</span> <span class="o">=</span> <span class="n">lat</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">yres</span>
    <span class="n">lat_max</span> <span class="o">=</span> <span class="n">lat</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">yres</span>

    <span class="c1"># Vérification de l&#39;ancien lecteur</span>
    <span class="k">if</span> <span class="n">old_date_interval</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
        <span class="n">date</span> <span class="o">&lt;</span> <span class="n">old_date_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> \
        <span class="n">date</span> <span class="o">&gt;</span> <span class="n">old_date_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span>

        <span class="c1"># Interval de temps</span>
        <span class="n">date_interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">add_time</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="o">-</span><span class="n">dtmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ctmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">add_time</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">dtmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ctmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># Initialisation du lecteur</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mars</span> <span class="o">=</span> <span class="n">MARS3D</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">date_interval</span><span class="p">,</span>
                <span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">continue</span>

    <span class="c1"># Récupération des indices des deux pas de temps utiles</span>
    <span class="n">mtime</span> <span class="o">=</span> <span class="n">mars</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
    <span class="n">mctime</span> <span class="o">=</span> <span class="n">mtime</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">()</span>
    <span class="n">mrtime</span> <span class="o">=</span> <span class="n">mtime</span><span class="o">.</span><span class="n">asRelativeTime</span><span class="p">()</span>
    <span class="n">ijk</span> <span class="o">=</span> <span class="n">mctime</span><span class="o">.</span><span class="n">mapIntervalExt</span><span class="p">((</span><span class="n">date</span><span class="p">,</span> <span class="n">date</span><span class="p">),</span> <span class="s1">&#39;ccb&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ijk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">ijk</span>
    <span class="k">if</span> <span class="n">mctime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">date</span><span class="p">:</span> <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Il est alors possible de lire les <strong>données les plus proches</strong>
(pas d’interpolation) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;ccb&#39;</span><span class="p">),</span>
    <span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="s1">&#39;ccb&#39;</span><span class="p">),</span>
    <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;ccb&#39;</span><span class="p">),</span> <span class="n">squuze</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">temp_mars</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span>  <span class="n">mars</span><span class="o">.</span><span class="n">load_temp</span><span class="p">()(</span><span class="o">**</span><span class="n">select</span><span class="p">)</span>
<span class="n">sal_mars</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span>  <span class="n">mars</span><span class="o">.</span><span class="n">load_sal</span><span class="p">()(</span><span class="o">**</span><span class="n">select</span><span class="p">)</span>
<span class="n">deps_mars</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span>  <span class="n">mars</span><span class="o">.</span><span class="n">deps_temp</span><span class="p">()(</span><span class="o">**</span><span class="n">select</span><span class="p">)</span>
</pre></div>
</div>
<p>S’il convient de faire une colocalisation par <strong>interpolation linéaire</strong> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lectures</span>
<span class="n">temp_mars_xyzt</span> <span class="o">=</span> <span class="n">mars</span><span class="o">.</span><span class="n">load_temp</span><span class="p">()[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
<span class="n">sal_mars_xyzt</span> <span class="o">=</span> <span class="n">mars</span><span class="o">.</span><span class="n">load_sal</span><span class="p">()[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
<span class="n">dens_mars_xyzt</span> <span class="o">=</span> <span class="n">mars</span><span class="o">.</span><span class="n">load_dens</span><span class="p">()[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Interpolations temporelles</span>
<span class="n">dt0</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">mtime</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">-</span><span class="n">mrtime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">dt1</span> <span class="o">=</span> <span class="n">mrtime</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">-</span><span class="n">date</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="n">mtime</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="n">f0</span> <span class="o">=</span> <span class="n">d0</span><span class="o">/</span><span class="p">(</span><span class="n">d0</span><span class="o">+</span><span class="n">d1</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">d1</span><span class="o">/</span><span class="p">(</span><span class="n">d0</span><span class="o">+</span><span class="n">d1</span><span class="p">)</span>
<span class="n">temp_mars_xyz</span> <span class="o">=</span> <span class="n">f0</span><span class="o">*</span><span class="n">temp_mars_xyzt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">f1</span><span class="o">*</span><span class="n">temp_mars_xyzt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sal_mars_xyz</span> <span class="o">=</span> <span class="n">f0</span><span class="o">*</span><span class="n">sal_mars_xyzt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">f1</span><span class="o">*</span><span class="n">sal_mars_xyzt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">deps_mars_xyz</span> <span class="o">=</span> <span class="n">f0</span><span class="o">*</span><span class="n">deps_mars_xyzt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">f1</span><span class="o">*</span><span class="n">deps_mars_xyzt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Interpolations spatiales</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid.regridding</span> <span class="k">import</span> <span class="n">grid2xy</span>
<span class="n">temp_mars</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid2xy</span><span class="p">(</span><span class="n">temp_mars_xyz</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon</span><span class="p">]),</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat</span><span class="p">]))</span>
<span class="n">sal_mars</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid2xy</span><span class="p">(</span><span class="n">sal_mars_xyz</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon</span><span class="p">]),</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat</span><span class="p">]))</span>
<span class="n">dens_mars</span><span class="p">[:,</span> <span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid2xy</span><span class="p">(</span><span class="n">dens_mars_xyz</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon</span><span class="p">]),</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat</span><span class="p">]))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On suppose l’existance de la méthode <code class="xref py py-meth docutils literal notranslate"><span class="pre">MARS3D.get_time()</span></code>.
Celle-ci peut s’implémenter facilement et propremement en
ajoutant la possibilité d’afiner la sélection lors de
la lecture d’une d’une variable ayant un axe de temps.
On peut alors la lire avec une sélection spatiale
afinée avec des <code class="docutils literal notranslate"><span class="pre">slice(0,1)</span></code> afin de la rendre plus légère,
puis en récupérant l’axe de temps :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_temp</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">level</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
</pre></div>
</div>
<p class="last">On pourrait aussi définir les méthode <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_ctime()</span></code>
et <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_rtime()</span></code> pour avoir facilement les temps
<code class="xref py py-class docutils literal notranslate"><span class="pre">cdtime.comptime</span></code> et <code class="xref py py-class docutils literal notranslate"><span class="pre">cdtime.reltime</span></code>
associés.</p>
</div>
</div>
</div>
<div class="section" id="calcul-de-la-pronfondeur-de-couche-melangee">
<span id="user-desc-proc-stratifinsitu-mld"></span><h2>Calcul de la pronfondeur de couche mélangée<a class="headerlink" href="#calcul-de-la-pronfondeur-de-couche-melangee" title="Permalink to this headline">¶</a></h2>
<p>Ce calcul fait l’hypothèse d’une structure océanique bi-couche en densité.
La profondeur de la couche mélangée est ainsi exprimée comme suit :</p>
<div class="math">
<p><img src="_images/math/9715e51db58536ce6235c05cfda9f270d3ae3ebd.png" alt="MLD = H (d_{max}-\overline{d})/(d_{max}-d_{min})"/></p>
</div><p>où <em>H</em> est la profondeur maximale and <em>d</em> la densité,
et où le surlignage siginifie une moyenne verticale.</p>
<p>Ce qui se traduit par :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Densité min/max</span>
<span class="n">dmin</span> <span class="o">=</span> <span class="n">dens</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dmax</span> <span class="o">=</span> <span class="n">dens</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Densité moyenne</span>
<span class="n">dmean</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ddeps</span><span class="p">)</span>

<span class="c1"># Profondeur max (max+demi épaisseur)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">deps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ddeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*.</span><span class="mi">5</span>

<span class="c1"># MLD</span>
<span class="n">mld</span> <span class="o">=</span> <span class="n">H</span><span class="o">*</span><span class="p">(</span><span class="n">dmax</span><span class="o">-</span><span class="n">dm</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span><span class="p">)</span>
<span class="n">mld</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
<span class="n">mld</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;Profondeur de la couche de mélange&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="calcul-du-deficit-en-energie-potentielle">
<h2>Calcul du déficit en énergie potentielle<a class="headerlink" href="#calcul-du-deficit-en-energie-potentielle" title="Permalink to this headline">¶</a></h2>
<p>On utilise la formule suivante :</p>
<div class="math">
<p><img src="_images/math/d49845445c5205a8bf1f683670683b89bbaa372e.png" alt="PED = \overline{g*\overline{d}*h}"/></p>
</div><p>où <em>g</em> est la gravité et <em>h</em> la profondeur.</p>
<p>Ce qui ce code comme suit :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Densité moyenne</span>
<span class="n">dmean</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ddeps</span><span class="p">)</span>

<span class="c1"># Anomalie de densité</span>
<span class="n">danom</span> <span class="o">=</span> <span class="n">dens</span><span class="o">-</span><span class="n">dmean</span>

<span class="c1"># Énergie potentielle disponible</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.phys.constants</span> <span class="k">import</span> <span class="n">g</span>
<span class="n">ape</span> <span class="o">=</span> <span class="n">danom</span> <span class="o">*</span> <span class="n">g</span>
<span class="n">ape</span> <span class="o">*=</span> <span class="n">ddeps</span>

<span class="c1"># Deficit</span>
<span class="n">ped</span> <span class="o">=</span> <span class="n">MV2</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">ape</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ddeps</span><span class="p">)</span>
<span class="n">ped</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;J.m^{-2}&#39;</span>
<span class="n">ped</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Definit d&#39;énergie potentielle&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="calcul-de-l-hydrologie-a-une-profondeur-donnee">
<h2>Calcul de l’hydrologie à une profondeur donnée<a class="headerlink" href="#calcul-de-l-hydrologie-a-une-profondeur-donnee" title="Permalink to this headline">¶</a></h2>
<p>Il s’agit d’interpoler verticalement les profils
in-situ et du modèle (colocalisés aux observations ou non) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Profondeur cible</span>
<span class="n">dep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span>

<span class="c1"># Axe pour interpolation</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.axes</span> <span class="k">import</span> <span class="n">create_dep</span>
<span class="n">depaxis</span> <span class="o">=</span> <span class="n">create_dep</span><span class="p">([</span><span class="n">dep</span><span class="p">])</span>

<span class="c1"># Interpolations</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.grid.regridding</span> <span class="k">import</span> <span class="n">interp1d</span>
<span class="n">ztemp_obs</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">temp_obs</span><span class="p">,</span> <span class="n">depaxis</span><span class="p">,</span> <span class="n">xmap</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">deps_obs</span><span class="p">)</span>
<span class="n">zsal_obs</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">sal_obs</span><span class="p">,</span> <span class="n">depaxis</span><span class="p">,</span> <span class="n">xmap</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">deps_obs</span><span class="p">)</span>
<span class="n">ztemp_mars</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">temp_mars</span><span class="p">,</span> <span class="n">depaxis</span><span class="p">,</span> <span class="n">xmap</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">deps_mars</span><span class="p">)</span>
<span class="n">zsal_mars</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">sal_mars</span><span class="p">,</span> <span class="n">depaxis</span><span class="p">,</span> <span class="n">xmap</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">deps_mars</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="representation-graphiques">
<h2>Représentation graphiques<a class="headerlink" href="#representation-graphiques" title="Permalink to this headline">¶</a></h2>
<p class="rubric">Observations sur fond de modèle grillé</p>
<p>On prend la MLD comme exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tailles (pour info)</span>
<span class="n">nlat_mars</span><span class="p">,</span> <span class="n">nlon_mars</span> <span class="o">=</span> <span class="n">mld_mars</span><span class="o">.</span><span class="n">shape</span>
<span class="n">nprof</span> <span class="o">=</span> <span class="n">mld_obs</span><span class="o">.</span><span class="n">shape</span>

<span class="c1"># Calcul des min et max initiaux</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mld_mars</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mld_obs</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mld_mars</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">mld_obs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;magic&#39;</span>

<span class="c1"># On trace de champ du modèle moyené sur la période choisie</span>
<span class="c1"># (note : mld_mars(nlon_mars, nlat_mars) )</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.plot</span> <span class="k">import</span> <span class="n">map2</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">map2</span><span class="p">(</span><span class="n">mld_mars</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

<span class="c1"># On trace les observations sous forme de points</span>
<span class="c1"># (note :  mld_mars(ndep_obs) )</span>
<span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_obs</span><span class="p">,</span> <span class="n">lats_obs</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">mld_obs</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">cmap</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Observations et modèle colocalisés sous forme de points</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tailles (pour info)</span>
<span class="n">nprof</span> <span class="o">=</span> <span class="n">mld_mars</span><span class="o">.</span><span class="n">shape</span>
<span class="n">nprof</span> <span class="o">=</span> <span class="n">mld_obs</span><span class="o">.</span><span class="n">shape</span>

<span class="c1"># Récupération des niveaux</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mld_mars</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mld_obs</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mld_mars</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">mld_obs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="kn">from</span> <span class="nn">vacumm.misc</span> <span class="k">import</span> <span class="n">auto_scale</span>
<span class="n">levels</span> <span class="o">=</span> <span class="n">auto_scale</span><span class="p">((</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Création de la palette</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.color</span> <span class="k">import</span> <span class="n">cmap_magic</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap_magic</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>

<span class="c1"># On trace de champ du modèle moyené sur la période choisie</span>
<span class="kn">from</span> <span class="nn">vacumm.misc.plot</span> <span class="k">import</span> <span class="n">map2</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">map2</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># On trace le modèle en fond</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_mars</span><span class="p">,</span> <span class="n">lats_mars</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">mld_mars</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

<span class="c1"># On trace les observations avec des points plus petits</span>
<span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_obs</span><span class="p">,</span> <span class="n">lats_obs</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">mld_obs</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">cmap</span><span class="p">)</span>

<span class="c1"># Colorbar</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="k">import</span> <span class="n">colorbar</span>
<span class="n">colorbar</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">$&#39;</span><span class="o">%</span><span class="n">mld_mars</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Observations sur fond de modèle colocalisé puis interpolé spatialement par triangulation</p>
<p>Le début se base sur l’exemple précédent :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tailles (pour info)</span>
<span class="n">nprof</span> <span class="o">=</span> <span class="n">mld_mars</span><span class="o">.</span><span class="n">shape</span>
<span class="n">nprof</span> <span class="o">=</span> <span class="n">mld_obs</span><span class="o">.</span><span class="n">shape</span>

<span class="c1"># [...]</span>

<span class="c1"># Triangulation du modèle</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">tri</span>
<span class="n">triang</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">lons_mars</span><span class="p">,</span> <span class="n">lats_mars</span><span class="p">)</span>

<span class="c1"># On trace le modèle en fond</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span> <span class="n">mld_mars</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

<span class="c1"># On ajout les points observés</span>
<span class="n">m</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lons_obs</span><span class="p">,</span> <span class="n">lats_obs</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">mld_obs</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">cmap</span><span class="p">)</span>

<span class="c1"># Colorbar</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="k">import</span> <span class="n">colorbar</span>
<span class="n">colorbar</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$</span><span class="si">%s</span><span class="s1">$&#39;</span><span class="o">%</span><span class="n">mld_mars</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>