
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>1.2.5. Using environment modules &#8212; VACUMM v3.6.2 documentation</title>
    <link rel="stylesheet" href="_static/vacumm.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
<!--<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="static/logo_vacumm.png" border="0" alt="vacumm"/></a>
</div>-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_vacumm.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.2.5. Using environment modules</a><ul>
<li><a class="reference internal" href="#introduction">1.2.5.1. Introduction</a></li>
<li><a class="reference internal" href="#default-module">1.2.5.2. Default module</a></li>
<li><a class="reference internal" href="#the-administrator-side">1.2.5.3. The administrator side</a></li>
<li><a class="reference internal" href="#the-user-side">1.2.5.4. The user side</a></li>
<li><a class="reference internal" href="#the-developer-side">1.2.5.5. The developer side</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/user.install.modenv.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-environment-modules">
<span id="user-install-modenv"></span><h1>1.2.5. Using environment modules<a class="headerlink" href="#using-environment-modules" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>1.2.5.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>As it has been metionned in both previous sections, the access to the Python included in UV-CDAT needs to modify the environement variable <span class="target" id="index-0"></span><a class="reference external" href="https://matplotlib.org/faq/environment_variables_faq.html#envvar-PATH" title="(in Matplotlib v3.0.2)"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code></a>, and the access to the library needs to modify the environment variable <span class="target" id="index-1"></span><a class="reference external" href="https://docs.python.org/dev/using/cmdline.html#envvar-PYTHONPATH" title="(in Python v3.8)"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a> if it has been installed in a different directory.</p>
<p>Knowing that it is possible manage and use multiple versions of CDAT and the VACUMM library,
as needed (in an operational framework, for a given project,
for the standard users, or those users who want the latest features),
it may become difficult to administrator to ensure that users can easily access the correct versions;
as it would be unpleasant for users to have to change themselves all environment variables (ie to know which variables and know all the paths).
An easy way to handle this problem is the use of <a class="reference external" href="http://modules.sourceforge.net">environment modules</a>.
This approach allows the administrator to manage multiple versions
and their dependencies transparently for the user,
who just need to insert two rows in its <code class="file docutils literal notranslate"><span class="pre">.cshrc</span></code> (ou <code class="file docutils literal notranslate"><span class="pre">.bashrc</span></code>) file
and know <strong class="command">module</strong> utility to load the environment he wants.</p>
<p>The documentation of the utility is located here:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://modules.sourceforge.net/">http://modules.sourceforge.net/</a></li>
<li><a class="reference external" href="http://modules.sourceforge.net/man/module.html">http://modules.sourceforge.net/man/module.html</a></li>
<li><a class="reference external" href="http://modules.sourceforge.net/man/modulefile.html">http://modules.sourceforge.net/man/modulefile.html</a></li>
<li><a class="reference external" href="http://sourceforge.net/p/modules/wiki/FAQ/">http://sourceforge.net/p/modules/wiki/FAQ/</a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="default-module">
<h2>1.2.5.2. Default module<a class="headerlink" href="#default-module" title="Permalink to this headline">¶</a></h2>
<p>The module utility makes possible to use several module version for the same software.</p>
<p>If we have for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; ls /my/modules/vacumm
<span class="m">0</span>.1
<span class="m">1</span>.0
trunk
</pre></div>
</div>
<p>To set a version as the default, you must be create in this directory a
<code class="file docutils literal notranslate"><span class="pre">.version</span></code> file containing:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c">#%Module</span>
<span class="k">set</span> ModulesVersion <span class="s2">&quot;1.0&quot;</span>
</pre></div>
</div>
<p>This file indicates which module file will be loaded by default
when only the directory is specified.
The command <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">vacumm</span></code>
then load the file module <code class="file docutils literal notranslate"><span class="pre">/my/modules/vacumm/1.0</span></code>.</p>
</div>
<div class="section" id="the-administrator-side">
<h2>1.2.5.3. The administrator side<a class="headerlink" href="#the-administrator-side" title="Permalink to this headline">¶</a></h2>
<p>It is first necessary that the administrator configures the use of environment modules.</p>
<p>The first step is to create a directory dedicated to the module files ,
and subdirectories dedicated to versions of CDAT, vacumm and their dependencies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; mkdir /my/modules
shell&gt; mkdir /my/modules/cdat
shell&gt; mkdir /my/modules/vacumm
</pre></div>
</div>
<p>Then, the module files for CDAT and its dependencies (voir <a class="reference internal" href="user.install.prereq.html#user-install-prereq"><span class="std std-ref">Prerequisites</span></a>)
should be created.
For example, if SCRIP is a dependency and is installed in the directory <code class="file docutils literal notranslate"><span class="pre">/my/soft/scrip</span></code>,
you must create the module file <code class="file docutils literal notranslate"><span class="pre">/my/modules/scrip</span></code> with the following content:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c">#%Module</span>
<span class="k">proc</span> ModulesHelp <span class="k">{</span> <span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> stderr <span class="s2">&quot;SCRIP regridder&quot;</span>
<span class="k">}</span>

<span class="nv">prepend-path</span> PATH <span class="o">/</span>my<span class="o">/</span>soft<span class="o">/</span>scrip
</pre></div>
</div>
<p>Python module <a class="reference external" href="https://matplotlib.org/basemap/api/basemap_api.html#module-mpl_toolkits.basemap" title="(in Basemap Matplotlib Toolkit v1.1.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">basemap</span></code></a> uses the GEOS library.
You must create the module file <code class="file docutils literal notranslate"><span class="pre">/my/modules/geos/3.2</span></code> :</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c">#%Module</span>
<span class="k">proc</span> ModulesHelp <span class="k">{</span> <span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> stderr <span class="s2">&quot;GEOS library&quot;</span>
<span class="k">}</span>

<span class="k">set</span> version <span class="mf">3.2</span>
<span class="nv">setenv</span> GEOS_LIB <span class="o">/</span>my<span class="o">/</span>soft<span class="o">/</span>geos<span class="o">/</span><span class="nv">$version</span><span class="o">/</span>lib
<span class="nv">prepend-path</span> LD_LIBRARY_PATH <span class="o">/</span>my<span class="o">/</span>soft<span class="o">/</span>geos<span class="o">/</span><span class="nv">$version</span><span class="o">/</span>lib
</pre></div>
</div>
<p><strong>Note</strong>: geos is now included with cdat&gt; = 6.0, it is not necessary to have a system and a module for geos apart.</p>
<p>The module file of CDAT :file:<a href="#id1"><span class="problematic" id="id2">`</span></a>/my/modules/cdat/5.2 can then be created taking into account dependencies and conflicts with other versions:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c">#%Module</span>
<span class="k">proc</span> ModulesHelp <span class="k">{</span> <span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> stderr <span class="s2">&quot;SCRIP regridder&quot;</span>
<span class="k">}</span>

<span class="nv">conlict</span> cdat
<span class="nv">module</span> load scrip
<span class="nv">module</span> load geos<span class="o">/</span><span class="mf">3.2</span>

<span class="k">set</span> version <span class="mf">5.2</span>
<span class="k">set</span> base_path <span class="o">/</span>my<span class="o">/</span>soft<span class="o">/</span>cdat
<span class="nv">prepend-path</span> PATH <span class="nv">$base_path</span><span class="o">/</span><span class="nv">$version</span><span class="o">/</span>bin
<span class="nv">prepend-path</span> LD_LIBRARY_PATH  <span class="nv">$base_path</span><span class="o">/</span><span class="nv">$version</span><span class="o">/</span>lib
<span class="nv">prepend-path</span> LD_LIBRARY_PATH  <span class="nv">$base_path</span><span class="o">/</span><span class="nv">$version</span><span class="o">/</span>Externals<span class="o">/</span>lib
<span class="nv">prepend-path</span> C_INCLUDE_PATH <span class="nv">$base_path</span><span class="o">/</span><span class="nv">$version</span><span class="o">/</span>include
</pre></div>
</div>
<p>If the default version of vacumm is installed in the python provided with CDAT,
the corresponding module file <code class="file docutils literal notranslate"><span class="pre">/my/modules/vacumm/1.0</span></code> then contains:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c">#%Module</span>
<span class="k">proc</span> ModulesHelp <span class="k">{</span> <span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> stderr <span class="s2">&quot;VACUMM python library&quot;</span>
<span class="k">}</span>

<span class="nv">conlict</span> vacumm
<span class="nv">module</span> load cdat
</pre></div>
</div>
<p>Here we only load CDAT as vacumm is installed in the default directory for installing python CDAT.</p>
<p>If another version of VACUMM exists
(installed with a –prefix equal to <code class="file docutils literal notranslate"><span class="pre">/my/soft/vacumm-recent</span></code>),
and using a different version of CDAT, we could have</p>
<blockquote>
<div>the file  <code class="file docutils literal notranslate"><span class="pre">/my/modules/vacumm/recent</span></code> :</div></blockquote>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c">#%Module</span>
<span class="k">proc</span> ModulesHelp <span class="k">{</span> <span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> stderr <span class="s2">&quot;VACUMM python library&quot;</span>
<span class="k">}</span>

<span class="nv">conlict</span> vacumm
<span class="nv">module</span> load cdat<span class="o">/</span><span class="mf">6.0</span>
<span class="nv">prepend-path</span> PATH <span class="o">/</span>my<span class="o">/</span>soft<span class="o">/</span>vacumm-recent<span class="o">/</span>bin
<span class="nv">prepend-path</span> PYTHONPATH <span class="o">/</span>my<span class="o">/</span>soft<span class="o">/</span>vacumm-recent<span class="o">/</span>lib<span class="o">/</span>python2.7<span class="o">/</span>site-packages
</pre></div>
</div>
<p>with cdat/6.0.0 module configured using this other CDAT.</p>
</div>
<div class="section" id="the-user-side">
<h2>1.2.5.4. The user side<a class="headerlink" href="#the-user-side" title="Permalink to this headline">¶</a></h2>
<p>The file <code class="file docutils literal notranslate"><span class="pre">$HOME/.cshrc</span></code> (ou <code class="file docutils literal notranslate"><span class="pre">$HOME/.bashrc</span></code>)
will typically contain the following lines:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modules</span>
<span class="c1"># - initialisation</span>
<span class="nb">source</span> /usr/share/modules/init/csh <span class="c1"># ou bash</span>
<span class="c1"># - ajout du repertoire des modules</span>
module use /my/modules
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">One should however be careful if the module is loaded cdat in a profile file as
<code class="file docutils literal notranslate"><span class="pre">$HOME/.bashrc</span></code> or <code class="file docutils literal notranslate"><span class="pre">$HOME/.cshrc</span></code>.
Since these files are loaded at logon (graphic or not),
side effects may occur because the version of python,
and packages that are installed are no longer those of
the system and some software or even the complete graphical session
may be unusable.
If this is the case, it can be solved by loading the CDAT module manually in your terminal.</p>
</div>
<p>The user then has an access to all environment modules defined in the previous section.
The see available modules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; module avail
</pre></div>
</div>
<p>To load the VACUMM library:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; module load vacumm
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to automatically load the library by inserting  <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">vacumm</span></code>
directly in the file  <code class="file docutils literal notranslate"><span class="pre">$HOME/.cshrc</span></code> after the line <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">use</span> <span class="pre">...</span></code></p>
</div>
<p>Then we check:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; module list
Currently Loaded Modulefiles:
  <span class="m">1</span><span class="o">)</span> scrip      <span class="m">2</span><span class="o">)</span> geos/3.2    <span class="m">3</span><span class="o">)</span> cdat/5.2     <span class="m">4</span><span class="o">)</span> vacumm/recent
shell&gt; <span class="nb">echo</span> <span class="nv">$PATH</span>
/my/soft/cdat/5.2/bin:/my/soft/scrip:... <span class="c1">#etc</span>
shell&gt; which python
/my/soft/cdat/5.2/bin/python
shell&gt; python -c <span class="s2">&quot;import vacumm&quot;</span>
</pre></div>
</div>
<p>To change the version of VACUMM in order to use, for instance,
an installation of the trunk branch that is regularly updated:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; module switch vacumm vacumm/trunk
</pre></div>
</div>
</div>
<div class="section" id="the-developer-side">
<span id="user-install-modenv-dev"></span><h2>1.2.5.5. The developer side<a class="headerlink" href="#the-developer-side" title="Permalink to this headline">¶</a></h2>
<p>The checkout (svn) of VACUMM contains a module file  <code class="file docutils literal notranslate"><span class="pre">etc/modulefiles/vacumm</span></code>
that can be used to directly exploit the sources:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; module use /path/to/my/vacumm/etc/modulefiles
shell&gt; module load vacumm
</pre></div>
</div>
<p>Not enter into conflict with (hide) another set of modules,
you can create your personal space for modules
and link this module file to this space:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; mkdir -p ~/etc/modulefiles/vacumm
shell&gt; ln -s /path/to/my/vacumm/etc/modulefiles ~/etc/modulefiles/vacumm/dev
</pre></div>
</div>
<p>This module requires a module named cdat, and an error will be displayed if it is not found.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you need to specify a particular cdat module for your development version, do not to modify
<code class="file docutils literal notranslate"><span class="pre">etc/modulefiles/vacumm</span></code> (to not commit it),
rather create a cdat directory in your own personal module space by
creating a module that loads the right cdat,
and optionally using the default module method described above.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; mkdir -p ~/etc/modulefiles/cdat
shell&gt; vi ~/etc/modulefiles/cdat/dev
</pre></div>
</div>
<p>Learn this new module <code class="file docutils literal notranslate"><span class="pre">cdat/dev</span></code> with the following content:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c">#%Module</span>
<span class="nv">module</span> load cdat<span class="o">/</span><span class="mf">6.0</span>
</pre></div>
</div>
<p>You can now load your development version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shell&gt; module load vacumm/dev
</pre></div>
</div>
<p>Et voilà, that’s all folks !</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="contents.html">Docs</a>|&nbsp;</li>
        <li><a href="user.faq.html">FAQ</a>|&nbsp;</li>
<!--         <li><a href="search.html">chercher</a>|&nbsp;</li> -->
        <li><a href="gallery.html">Gallery</a>|&nbsp;</li>
        <li><a href="https://forge.ifremer.fr/projects/vacumm">Forge</a>&nbsp; &raquo;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Actimar/IFREMER.
      Last updated on 21 Jan 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>